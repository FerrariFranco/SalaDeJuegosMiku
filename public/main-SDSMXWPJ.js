import{a as Tm,b as Am,c as xc,d as bm,e as as,f as kc,g as qo,h as Cm,i as Sm,j as Nc,k as ge,l as Qn,m as xt,n as Bo,o as us,p as Mc,q as Pm,r as Dm,s as cs,t as jo,u as Ge,v as Je,w as Fc}from"./chunk-ZAC5UBO3.js";import{$ as q,A as ht,Aa as dm,B as ue,Ba as fm,C as Y,Ca as os,D as tt,Da as pn,E as $e,Ea as Vc,F as dt,Fa as Oo,G as Rt,Ga as Lo,H as xr,Ha as Vt,I as bc,Ia as pm,J as Et,Ja as Uo,K as It,Ka as mm,L as tm,La as gm,M as Hn,Ma as _m,N as kr,Na as ym,O as nt,Oa as vm,P as Cc,Pa as wm,Q as dn,Qa as Em,R as Mo,Ra as Im,S as ne,Sa as mn,T as Z,Ta as Mr,U as Sc,V as rs,W as fn,X as Ve,Y as ee,_ as Pc,a as Dt,aa as j,b as xo,ba as Fe,c as Hp,ca as Nr,d as ko,da as be,e as Qp,ea as Ne,f as ln,fa as nm,g as Kn,ga as rm,h as wt,i as hn,j as Ae,k as Jp,ka as im,l as Xp,la as X,m as Vr,ma as is,n as Ic,o as Yp,oa as sm,p as Zp,pa as om,q as Zi,qa as am,r as es,ra as ss,s as Tc,sa as ft,t as ts,ta as um,u as Wn,ua as cm,v as Ac,va as lm,w as em,wa as Dc,x as No,xa as Fo,y as ns,ya as hm,z as at,za as Rc}from"./chunk-FZPDOVMK.js";import{a as je,b as ot,d as Ec,e as D}from"./chunk-7A67K276.js";var Om=(()=>{let e=class e{constructor(n,i){this._renderer=n,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}};e.\u0275fac=function(i){return new(i||e)(Z(Sc),Z(Cc))},e.\u0275dir=Rt({type:e});let r=e;return r})(),ww=(()=>{let e=class e extends Om{};e.\u0275fac=(()=>{let n;return function(s){return(n||(n=tm(e)))(s||e)}})(),e.\u0275dir=Rt({type:e,features:[fn]});let r=e;return r})(),Lc=new ue("");var Ew={provide:Lc,useExisting:ns(()=>_n),multi:!0};function Iw(){let r=Vc()?Vc().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}var Tw=new ue(""),_n=(()=>{let e=class e extends Om{constructor(n,i,s){super(n,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!Iw())}writeValue(n){let i=n??"";this.setProperty("value",i)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}};e.\u0275fac=function(i){return new(i||e)(Z(Sc),Z(Cc),Z(Tw,8))},e.\u0275dir=Rt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&be("input",function(u){return s._handleInput(u.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(u){return s._compositionEnd(u.target.value)})},features:[ss([Ew]),fn]});let r=e;return r})();function gn(r){return r==null||(typeof r=="string"||Array.isArray(r))&&r.length===0}function Lm(r){return r!=null&&typeof r.length=="number"}var Uc=new ue(""),qc=new ue(""),Aw=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,ut=class{static min(e){return bw(e)}static max(e){return Cw(e)}static required(e){return Sw(e)}static requiredTrue(e){return Pw(e)}static email(e){return Dw(e)}static minLength(e){return Rw(e)}static maxLength(e){return Vw(e)}static pattern(e){return xw(e)}static nullValidator(e){return Um(e)}static compose(e){return zm(e)}static composeAsync(e){return Km(e)}};function bw(r){return e=>{if(gn(e.value)||gn(r))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<r?{min:{min:r,actual:e.value}}:null}}function Cw(r){return e=>{if(gn(e.value)||gn(r))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>r?{max:{max:r,actual:e.value}}:null}}function Sw(r){return gn(r.value)?{required:!0}:null}function Pw(r){return r.value===!0?null:{required:!0}}function Dw(r){return gn(r.value)||Aw.test(r.value)?null:{email:!0}}function Rw(r){return e=>gn(e.value)||!Lm(e.value)?null:e.value.length<r?{minlength:{requiredLength:r,actualLength:e.value.length}}:null}function Vw(r){return e=>Lm(e.value)&&e.value.length>r?{maxlength:{requiredLength:r,actualLength:e.value.length}}:null}function xw(r){if(!r)return Um;let e,t;return typeof r=="string"?(t="",r.charAt(0)!=="^"&&(t+="^"),t+=r,r.charAt(r.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=r.toString(),e=r),n=>{if(gn(n.value))return null;let i=n.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function Um(r){return null}function qm(r){return r!=null}function Bm(r){return hm(r)?wt(r):r}function jm(r){let e={};return r.forEach(t=>{e=t!=null?je(je({},e),t):e}),Object.keys(e).length===0?null:e}function $m(r,e){return e.map(t=>t(r))}function kw(r){return!r.validate}function Gm(r){return r.map(e=>kw(e)?e:t=>e.validate(t))}function zm(r){if(!r)return null;let e=r.filter(qm);return e.length==0?null:function(t){return jm($m(t,e))}}function Bc(r){return r!=null?zm(Gm(r)):null}function Km(r){if(!r)return null;let e=r.filter(qm);return e.length==0?null:function(t){let n=$m(t,e).map(Bm);return Jp(n).pipe(Ae(jm))}}function jc(r){return r!=null?Km(Gm(r)):null}function Rm(r,e){return r===null?[e]:Array.isArray(r)?[...r,e]:[r,e]}function Wm(r){return r._rawValidators}function Hm(r){return r._rawAsyncValidators}function Oc(r){return r?Array.isArray(r)?r:[r]:[]}function Go(r,e){return Array.isArray(r)?r.includes(e):r===e}function Vm(r,e){let t=Oc(e);return Oc(r).forEach(i=>{Go(t,i)||t.push(i)}),t}function xm(r,e){return Oc(e).filter(t=>!Go(r,t))}var zo=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Bc(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=jc(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Lr=class extends zo{get formDirective(){return null}get path(){return null}},Jn=class extends zo{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Ko=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Nw={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},zA=ot(je({},Nw),{"[class.ng-submitted]":"isSubmitted"}),qr=(()=>{let e=class e extends Ko{constructor(n){super(n)}};e.\u0275fac=function(i){return new(i||e)(Z(Jn,2))},e.\u0275dir=Rt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&Pc("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[fn]});let r=e;return r})(),Xo=(()=>{let e=class e extends Ko{constructor(n){super(n)}};e.\u0275fac=function(i){return new(i||e)(Z(Lr,10))},e.\u0275dir=Rt({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&Pc("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[fn]});let r=e;return r})();var ls="VALID",$o="INVALID",Fr="PENDING",hs="DISABLED",Ur=class{},Wo=class extends Ur{constructor(e,t){super(),this.value=e,this.source=t}},fs=class extends Ur{constructor(e,t){super(),this.pristine=e,this.source=t}},ps=class extends Ur{constructor(e,t){super(),this.touched=e,this.source=t}},Or=class extends Ur{constructor(e,t){super(),this.status=e,this.source=t}};function Qm(r){return(Yo(r)?r.validators:r)||null}function Mw(r){return Array.isArray(r)?Bc(r):r||null}function Jm(r,e){return(Yo(e)?e.asyncValidators:r)||null}function Fw(r){return Array.isArray(r)?jc(r):r||null}function Yo(r){return r!=null&&!Array.isArray(r)&&typeof r=="object"}function Ow(r,e,t){let n=r.controls;if(!(e?Object.keys(n):n).length)throw new No(1e3,"");if(!n[t])throw new No(1001,"")}function Lw(r,e,t){r._forEachChild((n,i)=>{if(t[i]===void 0)throw new No(1002,"")})}var Ho=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=os(()=>this.statusReactive()),this.statusReactive=rs(void 0),this._pristine=os(()=>this.pristineReactive()),this.pristineReactive=rs(!0),this._touched=os(()=>this.touchedReactive()),this.touchedReactive=rs(!1),this._events=new xo,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return pn(this.statusReactive)}set status(e){pn(()=>this.statusReactive.set(e))}get valid(){return this.status===ls}get invalid(){return this.status===$o}get pending(){return this.status==Fr}get disabled(){return this.status===hs}get enabled(){return this.status!==hs}get pristine(){return pn(this.pristineReactive)}set pristine(e){pn(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return pn(this.touchedReactive)}set touched(e){pn(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(Vm(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Vm(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(xm(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(xm(e,this._rawAsyncValidators))}hasValidator(e){return Go(this._rawValidators,e)}hasAsyncValidator(e){return Go(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(ot(je({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new ps(!0,n))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:n})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,n),t&&e.emitEvent!==!1&&this._events.next(new ps(!1,n))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(ot(je({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new fs(!1,n))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,n),t&&e.emitEvent!==!1&&this._events.next(new fs(!0,n))}markAsPending(e={}){this.status=Fr;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Or(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(ot(je({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=hs,this.errors=null,this._forEachChild(i=>{i.disable(ot(je({},e),{onlySelf:!0}))}),this._updateValue();let n=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Wo(this.value,n)),this._events.next(new Or(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(ot(je({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=ls,this._forEachChild(n=>{n.enable(ot(je({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(ot(je({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ls||this.status===Fr)&&this._runAsyncValidator(n,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Wo(this.value,t)),this._events.next(new Or(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(ot(je({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?hs:ls}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Fr,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let n=Bm(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((n,i)=>n&&n._find(i),this)}getError(e,t){let n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,n){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||n)&&this._events.next(new Or(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,n)}_initObservables(){this.valueChanges=new kr,this.statusChanges=new kr}_calculateStatus(){return this._allControlsDisabled()?hs:this.errors?$o:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Fr)?Fr:this._anyControlsHaveStatus($o)?$o:ls}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let n=!this._anyControlsDirty(),i=this.pristine!==n;this.pristine=n,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new fs(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new ps(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Yo(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=Mw(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=Fw(this._rawAsyncValidators)}},Qo=class extends Ho{constructor(e,t,n){super(Qm(t),Jm(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){Lw(this,!0,e),Object.keys(e).forEach(n=>{Ow(this,!0,n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(n=>{let i=this.controls[n];i&&i.patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,i)=>{n.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,n)=>n._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,n]of Object.entries(this.controls))if(this.contains(t)&&e(n))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,n,i)=>((n.enabled||this.disabled)&&(t[i]=n.value),t))}_reduceChildren(e,t){let n=e;return this._forEachChild((i,s)=>{n=t(n,i,s)}),n}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var ms=new ue("CallSetDisabledState",{providedIn:"root",factory:()=>Zo}),Zo="always";function Uw(r,e){return[...e.path,r]}function $c(r,e,t=Zo){Xm(r,e),e.valueAccessor.writeValue(r.value),(r.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(r.disabled),jw(r,e),Gw(r,e),$w(r,e),qw(r,e)}function km(r,e,t=!0){let n=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(n),e.valueAccessor.registerOnTouched(n)),Bw(r,e),r&&(e._invokeOnDestroyCallbacks(),r._registerOnCollectionChange(()=>{}))}function Jo(r,e){r.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function qw(r,e){if(e.valueAccessor.setDisabledState){let t=n=>{e.valueAccessor.setDisabledState(n)};r.registerOnDisabledChange(t),e._registerOnDestroy(()=>{r._unregisterOnDisabledChange(t)})}}function Xm(r,e){let t=Wm(r);e.validator!==null?r.setValidators(Rm(t,e.validator)):typeof t=="function"&&r.setValidators([t]);let n=Hm(r);e.asyncValidator!==null?r.setAsyncValidators(Rm(n,e.asyncValidator)):typeof n=="function"&&r.setAsyncValidators([n]);let i=()=>r.updateValueAndValidity();Jo(e._rawValidators,i),Jo(e._rawAsyncValidators,i)}function Bw(r,e){let t=!1;if(r!==null){if(e.validator!==null){let i=Wm(r);if(Array.isArray(i)&&i.length>0){let s=i.filter(a=>a!==e.validator);s.length!==i.length&&(t=!0,r.setValidators(s))}}if(e.asyncValidator!==null){let i=Hm(r);if(Array.isArray(i)&&i.length>0){let s=i.filter(a=>a!==e.asyncValidator);s.length!==i.length&&(t=!0,r.setAsyncValidators(s))}}}let n=()=>{};return Jo(e._rawValidators,n),Jo(e._rawAsyncValidators,n),t}function jw(r,e){e.valueAccessor.registerOnChange(t=>{r._pendingValue=t,r._pendingChange=!0,r._pendingDirty=!0,r.updateOn==="change"&&Ym(r,e)})}function $w(r,e){e.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,r.updateOn==="blur"&&r._pendingChange&&Ym(r,e),r.updateOn!=="submit"&&r.markAsTouched()})}function Ym(r,e){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function Gw(r,e){let t=(n,i)=>{e.valueAccessor.writeValue(n),i&&e.viewToModelUpdate(n)};r.registerOnChange(t),e._registerOnDestroy(()=>{r._unregisterOnChange(t)})}function zw(r,e){r==null,Xm(r,e)}function Zm(r,e){if(!r.hasOwnProperty("model"))return!1;let t=r.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function Kw(r){return Object.getPrototypeOf(r.constructor)===ww}function Ww(r,e){r._syncPendingControls(),e.forEach(t=>{let n=t.control;n.updateOn==="submit"&&n._pendingChange&&(t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function eg(r,e){if(!e)return null;Array.isArray(e);let t,n,i;return e.forEach(s=>{s.constructor===_n?t=s:Kw(s)?n=s:i=s}),i||n||t||null}var Hw={provide:Lr,useExisting:ns(()=>gs)},ds=Promise.resolve(),gs=(()=>{let e=class e extends Lr{get submitted(){return pn(this.submittedReactive)}constructor(n,i,s){super(),this.callSetDisabledState=s,this._submitted=os(()=>this.submittedReactive()),this.submittedReactive=rs(!1),this._directives=new Set,this.ngSubmit=new kr,this.form=new Qo({},Bc(n),jc(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){ds.then(()=>{let i=this._findContainer(n.path);n.control=i.registerControl(n.name,n.control),$c(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){ds.then(()=>{let i=this._findContainer(n.path);i&&i.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){ds.then(()=>{let i=this._findContainer(n.path),s=new Qo({});zw(s,n),i.registerControl(n.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){ds.then(()=>{let i=this._findContainer(n.path);i&&i.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,i){ds.then(()=>{this.form.get(n.path).setValue(i)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submittedReactive.set(!0),Ww(this.form,this._directives),this.ngSubmit.emit(n),n?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}};e.\u0275fac=function(i){return new(i||e)(Z(Uc,10),Z(qc,10),Z(ms,8))},e.\u0275dir=Rt({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&be("submit",function(u){return s.onSubmit(u)})("reset",function(){return s.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ss([Hw]),fn]});let r=e;return r})();function Nm(r,e){let t=r.indexOf(e);t>-1&&r.splice(t,1)}function Mm(r){return typeof r=="object"&&r!==null&&Object.keys(r).length===2&&"value"in r&&"disabled"in r}var yn=class extends Ho{constructor(e=null,t,n){super(Qm(t),Jm(n,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Yo(t)&&(t.nonNullable||t.initialValueIsDefault)&&(Mm(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Nm(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Nm(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Mm(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Qw={provide:Jn,useExisting:ns(()=>Gc)},Fm=Promise.resolve(),Gc=(()=>{let e=class e extends Jn{constructor(n,i,s,a,u,c){super(),this._changeDetectorRef=u,this.callSetDisabledState=c,this.control=new yn,this._registered=!1,this.name="",this.update=new kr,this._parent=n,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=eg(this,a)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){let i=n.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),Zm(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){$c(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(n){Fm.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){let i=n.isDisabled.currentValue,s=i!==0&&fm(i);Fm.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?Uw(n,this._parent):[n]}};e.\u0275fac=function(i){return new(i||e)(Z(Lr,9),Z(Uc,10),Z(qc,10),Z(Lc,10),Z(dm,8),Z(ms,8))},e.\u0275dir=Rt({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ss([Qw]),fn,bc]});let r=e;return r})(),ea=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Rt({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let r=e;return r})();var tg=new ue(""),Jw={provide:Jn,useExisting:ns(()=>_s)},_s=(()=>{let e=class e extends Jn{set isDisabled(n){}constructor(n,i,s,a,u){super(),this._ngModelWarningConfig=a,this.callSetDisabledState=u,this.update=new kr,this._ngModelWarningSent=!1,this._setValidators(n),this._setAsyncValidators(i),this.valueAccessor=eg(this,s)}ngOnChanges(n){if(this._isControlChanged(n)){let i=n.form.previousValue;i&&km(i,this,!1),$c(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}Zm(n,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&km(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_isControlChanged(n){return n.hasOwnProperty("form")}};e._ngModelWarningSentOnce=!1,e.\u0275fac=function(i){return new(i||e)(Z(Uc,10),Z(qc,10),Z(Lc,10),Z(tg,8),Z(ms,8))},e.\u0275dir=Rt({type:e,selectors:[["","formControl",""]],inputs:{form:[0,"formControl","form"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[ss([Jw]),fn,bc]});let r=e;return r})();var ng=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({});let r=e;return r})();var Br=(()=>{let e=class e{static withConfig(n){return{ngModule:e,providers:[{provide:ms,useValue:n.callSetDisabledState??Zo}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[ng]});let r=e;return r})(),jr=(()=>{let e=class e{static withConfig(n){return{ngModule:e,providers:[{provide:tg,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:ms,useValue:n.callSetDisabledState??Zo}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=dt({type:e}),e.\u0275inj=ht({imports:[ng]});let r=e;return r})();var Xw="firebase",Yw="10.13.1";Ge(Xw,Yw,"app");var rt=new Dc("ANGULARFIRE2_VERSION");function na(r,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(a=>a.app===t);if(s.length===1)return s[0]}return t.container.getProvider(r).getImmediate({optional:!0})}var ys=(r,e)=>{let t=e?[e]:jo(),n=[];return t.forEach(i=>{i.container.getProvider(r).instances.forEach(a=>{n.includes(a)||n.push(a)})}),n},Tt=class{constructor(){return ys(Zw)}},Zw="app-check";function $r(){}var ta=class{zone;delegate;constructor(e,t=Qp){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){let i=this.zone,s=function(a){i.runGuarded(()=>{e.apply(this,[a])})};return this.delegate.schedule(s,t,n)}},Kc=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",$r,{},$r,$r)),t.pipe(em({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},kt=(()=>{class r{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new ta(Zone.current)),this.insideAngular=t.run(()=>new ta(Zone.current,ko)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(n){return new(n||r)(Y(nt))};static \u0275prov=at({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function ra(){let r=globalThis.\u0275AngularFireScheduler;if(!r)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return r}function e0(r){return ra().ngZone.runOutsideAngular(()=>r())}function Xn(r){return ra().ngZone.run(()=>r())}function Xe(r){return t0(ra())(r)}function t0(r){return function(t){return t=t.lift(new Kc(r.ngZone)),t.pipe(Kn(r.outsideAngular),ln(r.insideAngular))}}var n0=(r,e)=>function(){let n=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Xn(()=>r.apply(void 0,n))},Ht=(r,e)=>function(){let t,n=arguments;for(let s=0;s<arguments.length;s++)typeof n[s]=="function"&&(e&&(t||=Xn(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",$r,{},$r,$r))),n[s]=n0(n[s],t));let i=e0(()=>r.apply(this,n));if(!e)if(i instanceof Dt){let s=ra();return i.pipe(Kn(s.outsideAngular),ln(s.insideAngular))}else return Xn(()=>i);return i instanceof Dt?i.pipe(Xe):i instanceof Promise?Xn(()=>new Promise((s,a)=>i.then(u=>Xn(()=>s(u)),u=>Xn(()=>a(u))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:Xn(()=>i)};var r0="firebase",i0="10.13.1";Je.registerVersion(r0,i0,"app-compat");var s0=["ngOnDestroy"],sg=(r,e,t,n={})=>new Proxy(r,{get:(i,s)=>t.runOutsideAngular(()=>{if(r[s])return n?.spy?.get&&n.spy.get(s,r[s]),r[s];if(s0.indexOf(s)>-1)return()=>{};let a=e.toPromise().then(u=>{let c=u?.[s];return typeof c=="function"?c.bind(u):c?.then?c.then(d=>t.run(()=>d)):t.run(()=>c)});return new Proxy(()=>{},{get:(u,c)=>a[c],apply:(u,c,d)=>a.then(f=>{let m=f?.(...d);return n?.spy?.apply&&n.spy.apply(s,d,m),m})})})});var ia=class{constructor(e){return e}},vn=new ue("angularfire2.app.options"),Gr=new ue("angularfire2.app.name");function vs(r,e,t){let n=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||n;let a=Je.apps.filter(u=>u&&u.name===i.name)[0]||e.runOutsideAngular(()=>Je.initializeApp(r,i));try{if(JSON.stringify(r)!==JSON.stringify(a.options)){let u=!!module.hot;o0("error",`${a.name} Firebase App already initialized with different options${u?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new ia(a)}var o0=(r,...e)=>{Rc()&&typeof console<"u"&&console[r](...e)},a0={provide:ia,useFactory:vs,deps:[vn,nt,[new tt,Gr]]},og=(()=>{class r{static initializeApp(t,n){return{ngModule:r,providers:[{provide:vn,useValue:t},{provide:Gr,useValue:n}]}}constructor(t){Je.registerVersion("angularfire",rt.full,"core"),Je.registerVersion("angularfire",rt.full,"app-compat"),Je.registerVersion("angular",Fo.full,t.toString())}static \u0275fac=function(n){return new(n||r)(Y(dn))};static \u0275mod=dt({type:r});static \u0275inj=ht({providers:[a0]})}return r})();function sa(r,e,t,n,i){let[,s,a]=globalThis.\u0275AngularfireInstanceCache.find(u=>u[0]===r)||[];if(s)return u0(i,a)||(ig("error",`${e} was already initialized on the ${t} Firebase App with different settings.${c0?" You may need to reload as Firebase is not HMR aware.":""}`),ig("warn",{is:i,was:a})),s;{let u=n();return globalThis.\u0275AngularfireInstanceCache.push([r,u,i]),u}}function u0(r,e){try{return r.toString()===e.toString()}catch{return r===e}}var c0=typeof module<"u"&&!!module.hot,ig=(r,...e)=>{Rc()&&typeof console<"u"&&console[r](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Qt=class{constructor(e){return e}},Yn=class{constructor(){return jo()}};function l0(r){return r&&r.length===1?r[0]:new Qt(cs())}var Wc=new ue("angularfire2._apps"),h0={provide:Qt,useFactory:l0,deps:[[new tt,Wc]]},d0={provide:Yn,deps:[[new tt,Wc]]};function f0(r){return(e,t)=>{let n=t.get(dn);Ge("angularfire",rt.full,"core"),Ge("angularfire",rt.full,"app"),Ge("angular",Fo.full,n.toString());let i=e.runOutsideAngular(()=>r(t));return new Qt(i)}}function ag(r,...e){return xr([h0,d0,{provide:Wc,useFactory:f0(r),multi:!0,deps:[nt,Hn,kt,...e]}])}var ug=Ht(Dm,!0);var p0=new Map,m0={activated:!1,tokenObservers:[]},g0={initialized:!1,enabled:!1};function At(r){return p0.get(r)||Object.assign({},m0)}function fg(){return g0}var _0="https://content-firebaseappcheck.googleapis.com/v1";var y0="exchangeDebugToken",cg={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},Rb=24*60*60*1e3;var Qc=class{constructor(e,t,n,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return D(this,null,function*(){this.stop();try{this.pending=new xc,this.pending.promise.catch(t=>{}),yield v0(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new xc,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function v0(r){return new Promise(e=>{setTimeout(e,r)})}var w0={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},wn=new Sm("appCheck","AppCheck",w0);function pg(r){if(!At(r).activated)throw wn.create("use-before-activation",{appName:r.name})}function mg(n,i){return D(this,arguments,function*({url:r,body:e},t){let s={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let A=yield a.getHeartbeatsHeader();A&&(s["X-Firebase-Client"]=A)}let u={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(r,u)}catch(A){throw wn.create("fetch-network-error",{originalErrorMessage:A?.message})}if(c.status!==200)throw wn.create("fetch-status-error",{httpStatus:c.status});let d;try{d=yield c.json()}catch(A){throw wn.create("fetch-parse-error",{originalErrorMessage:A?.message})}let f=d.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw wn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let m=Number(f[1])*1e3,_=Date.now();return{token:d.token,expireTimeMillis:_+m,issuedAtTimeMillis:_}})}function gg(r,e){let{projectId:t,appId:n,apiKey:i}=r.options;return{url:`${_0}/projects/${t}/apps/${n}:${y0}?key=${i}`,body:{debug_token:e}}}var E0="firebase-app-check-database",I0=1,Jc="firebase-app-check-store";var oa=null;function T0(){return oa||(oa=new Promise((r,e)=>{try{let t=indexedDB.open(E0,I0);t.onsuccess=n=>{r(n.target.result)},t.onerror=n=>{var i;e(wn.create("storage-open",{originalErrorMessage:(i=n.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=n=>{let i=n.target.result;switch(n.oldVersion){case 0:i.createObjectStore(Jc,{keyPath:"compositeKey"})}}}catch(t){e(wn.create("storage-open",{originalErrorMessage:t?.message}))}}),oa)}function A0(r,e){return b0(C0(r),e)}function b0(r,e){return D(this,null,function*(){let n=(yield T0()).transaction(Jc,"readwrite"),s=n.objectStore(Jc).put({compositeKey:r,value:e});return new Promise((a,u)=>{s.onsuccess=c=>{a()},n.onerror=c=>{var d;u(wn.create("storage-set",{originalErrorMessage:(d=c.target.error)===null||d===void 0?void 0:d.message}))}})})}function C0(r){return`${r.options.appId}-${r.name}`}var Xc=new Bo("@firebase/app-check");function Hc(r,e){return qo()?A0(r,e).catch(t=>{Xc.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function _g(){return fg().enabled}function yg(){return D(this,null,function*(){let r=fg();if(r.enabled&&r.token)return r.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var S0={error:"UNKNOWN_ERROR"};function P0(r){return Tm.encodeString(JSON.stringify(r),!1)}function Yc(r,e=!1){return D(this,null,function*(){let t=r.app;pg(t);let n=At(t),i=n.token,s;if(i&&!ws(i)&&(n.token=void 0,i=void 0),!i){let c=yield n.cachedTokenPromise;c&&(ws(c)?i=c:yield Hc(t,void 0))}if(!e&&i&&ws(i))return{token:i.token};let a=!1;if(_g()){n.exchangeTokenPromise||(n.exchangeTokenPromise=mg(gg(t,yield yg()),r.heartbeatServiceProvider).finally(()=>{n.exchangeTokenPromise=void 0}),a=!0);let c=yield n.exchangeTokenPromise;return yield Hc(t,c),n.token=c,{token:c.token}}try{n.exchangeTokenPromise||(n.exchangeTokenPromise=n.provider.getToken().finally(()=>{n.exchangeTokenPromise=void 0}),a=!0),i=yield At(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?Xc.warn(c.message):Xc.error(c),s=c}let u;return i?s?ws(i)?u={token:i.token,internalError:s}:u=hg(s):(u={token:i.token},n.token=i,yield Hc(t,i)):u=hg(s),a&&x0(t,u),u})}function D0(r){return D(this,null,function*(){let e=r.app;pg(e);let{provider:t}=At(e);if(_g()){let n=yield yg(),{token:i}=yield mg(gg(e,n),r.heartbeatServiceProvider);return{token:i}}else{let{token:n}=yield t.getToken();return{token:n}}})}function R0(r,e,t,n){let{app:i}=r,s=At(i),a={next:t,error:n,type:e};if(s.tokenObservers=[...s.tokenObservers,a],s.token&&ws(s.token)){let u=s.token;Promise.resolve().then(()=>{t({token:u.token}),lg(r)}).catch(()=>{})}s.cachedTokenPromise.then(()=>lg(r))}function vg(r,e){let t=At(r),n=t.tokenObservers.filter(i=>i.next!==e);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function lg(r){let{app:e}=r,t=At(e),n=t.tokenRefresher;n||(n=V0(r),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function V0(r){let{app:e}=r;return new Qc(()=>D(this,null,function*(){let t=At(e),n;if(t.token?n=yield Yc(r,!0):n=yield Yc(r),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=At(e);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,i),Math.max(0,n-Date.now())}else return 0},cg.RETRIAL_MIN_WAIT,cg.RETRIAL_MAX_WAIT)}function x0(r,e){let t=At(r).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function ws(r){return r.expireTimeMillis-Date.now()>0}function hg(r){return{token:P0(S0),error:r}}var Zc=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=At(this.app);for(let t of e)vg(this.app,t.next);return Promise.resolve()}};function k0(r,e){return new Zc(r,e)}function N0(r){return{getToken:e=>Yc(r,e),getLimitedUseToken:()=>D0(r),addTokenListener:e=>R0(r,"INTERNAL",e),removeTokenListener:e=>vg(r.app,e)}}var M0="@firebase/app-check",F0="0.8.7";var O0="app-check",dg="app-check-internal";function L0(){us(new Qn(O0,r=>{let e=r.getProvider("app").getImmediate(),t=r.getProvider("heartbeat");return k0(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,e,t)=>{r.getProvider(dg).initialize()})),us(new Qn(dg,r=>{let e=r.getProvider("app-check").getImmediate();return N0(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Ge(M0,F0)}L0();var U0=["localhost","0.0.0.0","127.0.0.1"],jb=typeof window<"u"&&U0.includes(window.location.hostname);var el=new ue("angularfire2.auth.use-emulator"),tl=new ue("angularfire2.auth.settings"),nl=new ue("angularfire2.auth.tenant-id"),rl=new ue("angularfire2.auth.langugage-code"),il=new ue("angularfire2.auth.use-device-language"),sl=new ue("angularfire.auth.persistence"),ol=(r,e,t,n,i,s,a,u)=>sa(`${r.name}.auth`,"AngularFireAuth",r.name,()=>{let c=e.runOutsideAngular(()=>r.auth());if(t&&c.useEmulator(...t),n&&(c.tenantId=n),c.languageCode=i,s&&c.useDeviceLanguage(),a)for(let[d,f]of Object.entries(a))c.settings[d]=f;return u&&c.setPersistence(u),c},[t,n,i,s,a,u]),Es=(()=>{class r{authState;idToken;user;idTokenResult;credential;constructor(t,n,i,s,a,u,c,d,f,m,_,A){let x=new xo,N=hn(void 0).pipe(ln(a.outsideAngular),Wn(()=>s.runOutsideAngular(()=>import("./chunk-NJXUPNMH.js"))),Ae(()=>vs(t,s,n)),Ae(R=>ol(R,s,u,d,f,m,c,_)),Tc({bufferSize:1,refCount:!1}));if(Uo(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=hn(null);else{N.pipe(Zp()).subscribe();let R=N.pipe(Wn(F=>F.getRedirectResult().then(K=>K,()=>null)),Xe,Tc({bufferSize:1,refCount:!1})),G=N.pipe(Wn(F=>new Dt(K=>({unsubscribe:s.runOutsideAngular(()=>F.onAuthStateChanged(H=>K.next(H),H=>K.error(H),()=>K.complete()))})))),z=N.pipe(Wn(F=>new Dt(K=>({unsubscribe:s.runOutsideAngular(()=>F.onIdTokenChanged(H=>K.next(H),H=>K.error(H),()=>K.complete()))}))));this.authState=R.pipe(Ac(G),Kn(a.outsideAngular),ln(a.insideAngular)),this.user=R.pipe(Ac(z),Kn(a.outsideAngular),ln(a.insideAngular)),this.idToken=this.user.pipe(Wn(F=>F?wt(F.getIdToken()):hn(null))),this.idTokenResult=this.user.pipe(Wn(F=>F?wt(F.getIdTokenResult()):hn(null))),this.credential=Xp(R,x,this.authState.pipe(Vr(F=>!F))).pipe(Ae(F=>F?.user?F:null),Kn(a.outsideAngular),ln(a.insideAngular))}return sg(this,N,s,{spy:{apply:(R,G,z)=>{(R.startsWith("signIn")||R.startsWith("createUser"))&&z.then(F=>x.next(F))}}})}static \u0275fac=function(n){return new(n||r)(Y(vn),Y(Gr,8),Y(dn),Y(nt),Y(kt),Y(el,8),Y(tl,8),Y(nl,8),Y(rl,8),Y(il,8),Y(sl,8),Y(Tt,8))};static \u0275prov=at({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),Eg=(()=>{class r{constructor(){Je.registerVersion("angularfire",rt.full,"auth-compat")}static \u0275fac=function(n){return new(n||r)};static \u0275mod=dt({type:r});static \u0275inj=ht({providers:[Es]})}return r})();var Tg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ag={};var En,al;(function(){var r;function e(w,g){function v(){}v.prototype=g.prototype,w.D=g.prototype,w.prototype=new v,w.prototype.constructor=w,w.C=function(E,I,b){for(var y=Array(arguments.length-2),zt=2;zt<arguments.length;zt++)y[zt-2]=arguments[zt];return g.prototype[I].apply(E,y)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,g,v){v||(v=0);var E=Array(16);if(typeof g=="string")for(var I=0;16>I;++I)E[I]=g.charCodeAt(v++)|g.charCodeAt(v++)<<8|g.charCodeAt(v++)<<16|g.charCodeAt(v++)<<24;else for(I=0;16>I;++I)E[I]=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24;g=w.g[0],v=w.g[1],I=w.g[2];var b=w.g[3],y=g+(b^v&(I^b))+E[0]+3614090360&4294967295;g=v+(y<<7&4294967295|y>>>25),y=b+(I^g&(v^I))+E[1]+3905402710&4294967295,b=g+(y<<12&4294967295|y>>>20),y=I+(v^b&(g^v))+E[2]+606105819&4294967295,I=b+(y<<17&4294967295|y>>>15),y=v+(g^I&(b^g))+E[3]+3250441966&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(b^v&(I^b))+E[4]+4118548399&4294967295,g=v+(y<<7&4294967295|y>>>25),y=b+(I^g&(v^I))+E[5]+1200080426&4294967295,b=g+(y<<12&4294967295|y>>>20),y=I+(v^b&(g^v))+E[6]+2821735955&4294967295,I=b+(y<<17&4294967295|y>>>15),y=v+(g^I&(b^g))+E[7]+4249261313&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(b^v&(I^b))+E[8]+1770035416&4294967295,g=v+(y<<7&4294967295|y>>>25),y=b+(I^g&(v^I))+E[9]+2336552879&4294967295,b=g+(y<<12&4294967295|y>>>20),y=I+(v^b&(g^v))+E[10]+4294925233&4294967295,I=b+(y<<17&4294967295|y>>>15),y=v+(g^I&(b^g))+E[11]+2304563134&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(b^v&(I^b))+E[12]+1804603682&4294967295,g=v+(y<<7&4294967295|y>>>25),y=b+(I^g&(v^I))+E[13]+4254626195&4294967295,b=g+(y<<12&4294967295|y>>>20),y=I+(v^b&(g^v))+E[14]+2792965006&4294967295,I=b+(y<<17&4294967295|y>>>15),y=v+(g^I&(b^g))+E[15]+1236535329&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(I^b&(v^I))+E[1]+4129170786&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^I&(g^v))+E[6]+3225465664&4294967295,b=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(b^g))+E[11]+643717713&4294967295,I=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(I^b))+E[0]+3921069994&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(I^b&(v^I))+E[5]+3593408605&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^I&(g^v))+E[10]+38016083&4294967295,b=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(b^g))+E[15]+3634488961&4294967295,I=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(I^b))+E[4]+3889429448&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(I^b&(v^I))+E[9]+568446438&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^I&(g^v))+E[14]+3275163606&4294967295,b=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(b^g))+E[3]+4107603335&4294967295,I=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(I^b))+E[8]+1163531501&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(I^b&(v^I))+E[13]+2850285829&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^I&(g^v))+E[2]+4243563512&4294967295,b=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(b^g))+E[7]+1735328473&4294967295,I=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(I^b))+E[12]+2368359562&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(v^I^b)+E[5]+4294588738&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^I)+E[8]+2272392833&4294967295,b=g+(y<<11&4294967295|y>>>21),y=I+(b^g^v)+E[11]+1839030562&4294967295,I=b+(y<<16&4294967295|y>>>16),y=v+(I^b^g)+E[14]+4259657740&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(v^I^b)+E[1]+2763975236&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^I)+E[4]+1272893353&4294967295,b=g+(y<<11&4294967295|y>>>21),y=I+(b^g^v)+E[7]+4139469664&4294967295,I=b+(y<<16&4294967295|y>>>16),y=v+(I^b^g)+E[10]+3200236656&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(v^I^b)+E[13]+681279174&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^I)+E[0]+3936430074&4294967295,b=g+(y<<11&4294967295|y>>>21),y=I+(b^g^v)+E[3]+3572445317&4294967295,I=b+(y<<16&4294967295|y>>>16),y=v+(I^b^g)+E[6]+76029189&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(v^I^b)+E[9]+3654602809&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^I)+E[12]+3873151461&4294967295,b=g+(y<<11&4294967295|y>>>21),y=I+(b^g^v)+E[15]+530742520&4294967295,I=b+(y<<16&4294967295|y>>>16),y=v+(I^b^g)+E[2]+3299628645&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(I^(v|~b))+E[0]+4096336452&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~I))+E[7]+1126891415&4294967295,b=g+(y<<10&4294967295|y>>>22),y=I+(g^(b|~v))+E[14]+2878612391&4294967295,I=b+(y<<15&4294967295|y>>>17),y=v+(b^(I|~g))+E[5]+4237533241&4294967295,v=I+(y<<21&4294967295|y>>>11),y=g+(I^(v|~b))+E[12]+1700485571&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~I))+E[3]+2399980690&4294967295,b=g+(y<<10&4294967295|y>>>22),y=I+(g^(b|~v))+E[10]+4293915773&4294967295,I=b+(y<<15&4294967295|y>>>17),y=v+(b^(I|~g))+E[1]+2240044497&4294967295,v=I+(y<<21&4294967295|y>>>11),y=g+(I^(v|~b))+E[8]+1873313359&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~I))+E[15]+4264355552&4294967295,b=g+(y<<10&4294967295|y>>>22),y=I+(g^(b|~v))+E[6]+2734768916&4294967295,I=b+(y<<15&4294967295|y>>>17),y=v+(b^(I|~g))+E[13]+1309151649&4294967295,v=I+(y<<21&4294967295|y>>>11),y=g+(I^(v|~b))+E[4]+4149444226&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~I))+E[11]+3174756917&4294967295,b=g+(y<<10&4294967295|y>>>22),y=I+(g^(b|~v))+E[2]+718787259&4294967295,I=b+(y<<15&4294967295|y>>>17),y=v+(b^(I|~g))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+g&4294967295,w.g[1]=w.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,w.g[2]=w.g[2]+I&4294967295,w.g[3]=w.g[3]+b&4294967295}n.prototype.u=function(w,g){g===void 0&&(g=w.length);for(var v=g-this.blockSize,E=this.B,I=this.h,b=0;b<g;){if(I==0)for(;b<=v;)i(this,w,b),b+=this.blockSize;if(typeof w=="string"){for(;b<g;)if(E[I++]=w.charCodeAt(b++),I==this.blockSize){i(this,E),I=0;break}}else for(;b<g;)if(E[I++]=w[b++],I==this.blockSize){i(this,E),I=0;break}}this.h=I,this.o+=g},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var g=1;g<w.length-8;++g)w[g]=0;var v=8*this.o;for(g=w.length-8;g<w.length;++g)w[g]=v&255,v/=256;for(this.u(w),w=Array(16),g=v=0;4>g;++g)for(var E=0;32>E;E+=8)w[v++]=this.g[g]>>>E&255;return w};function s(w,g){var v=u;return Object.prototype.hasOwnProperty.call(v,w)?v[w]:v[w]=g(w)}function a(w,g){this.h=g;for(var v=[],E=!0,I=w.length-1;0<=I;I--){var b=w[I]|0;E&&b==g||(v[I]=b,E=!1)}this.g=v}var u={};function c(w){return-128<=w&&128>w?s(w,function(g){return new a([g|0],0>g?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return m;if(0>w)return R(d(-w));for(var g=[],v=1,E=0;w>=v;E++)g[E]=w/v|0,v*=4294967296;return new a(g,0)}function f(w,g){if(w.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(w.charAt(0)=="-")return R(f(w.substring(1),g));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=d(Math.pow(g,8)),E=m,I=0;I<w.length;I+=8){var b=Math.min(8,w.length-I),y=parseInt(w.substring(I,I+b),g);8>b?(b=d(Math.pow(g,b)),E=E.j(b).add(d(y))):(E=E.j(v),E=E.add(d(y)))}return E}var m=c(0),_=c(1),A=c(16777216);r=a.prototype,r.m=function(){if(N(this))return-R(this).m();for(var w=0,g=1,v=0;v<this.g.length;v++){var E=this.i(v);w+=(0<=E?E:4294967296+E)*g,g*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(x(this))return"0";if(N(this))return"-"+R(this).toString(w);for(var g=d(Math.pow(w,6)),v=this,E="";;){var I=K(v,g).g;v=G(v,I.j(g));var b=((0<v.g.length?v.g[0]:v.h)>>>0).toString(w);if(v=I,x(v))return b+E;for(;6>b.length;)b="0"+b;E=b+E}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function x(w){if(w.h!=0)return!1;for(var g=0;g<w.g.length;g++)if(w.g[g]!=0)return!1;return!0}function N(w){return w.h==-1}r.l=function(w){return w=G(this,w),N(w)?-1:x(w)?0:1};function R(w){for(var g=w.g.length,v=[],E=0;E<g;E++)v[E]=~w.g[E];return new a(v,~w.h).add(_)}r.abs=function(){return N(this)?R(this):this},r.add=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],E=0,I=0;I<=g;I++){var b=E+(this.i(I)&65535)+(w.i(I)&65535),y=(b>>>16)+(this.i(I)>>>16)+(w.i(I)>>>16);E=y>>>16,b&=65535,y&=65535,v[I]=y<<16|b}return new a(v,v[v.length-1]&-2147483648?-1:0)};function G(w,g){return w.add(R(g))}r.j=function(w){if(x(this)||x(w))return m;if(N(this))return N(w)?R(this).j(R(w)):R(R(this).j(w));if(N(w))return R(this.j(R(w)));if(0>this.l(A)&&0>w.l(A))return d(this.m()*w.m());for(var g=this.g.length+w.g.length,v=[],E=0;E<2*g;E++)v[E]=0;for(E=0;E<this.g.length;E++)for(var I=0;I<w.g.length;I++){var b=this.i(E)>>>16,y=this.i(E)&65535,zt=w.i(I)>>>16,Ni=w.i(I)&65535;v[2*E+2*I]+=y*Ni,z(v,2*E+2*I),v[2*E+2*I+1]+=b*Ni,z(v,2*E+2*I+1),v[2*E+2*I+1]+=y*zt,z(v,2*E+2*I+1),v[2*E+2*I+2]+=b*zt,z(v,2*E+2*I+2)}for(E=0;E<g;E++)v[E]=v[2*E+1]<<16|v[2*E];for(E=g;E<2*g;E++)v[E]=0;return new a(v,0)};function z(w,g){for(;(w[g]&65535)!=w[g];)w[g+1]+=w[g]>>>16,w[g]&=65535,g++}function F(w,g){this.g=w,this.h=g}function K(w,g){if(x(g))throw Error("division by zero");if(x(w))return new F(m,m);if(N(w))return g=K(R(w),g),new F(R(g.g),R(g.h));if(N(g))return g=K(w,R(g)),new F(R(g.g),g.h);if(30<w.g.length){if(N(w)||N(g))throw Error("slowDivide_ only works with positive integers.");for(var v=_,E=g;0>=E.l(w);)v=H(v),E=H(E);var I=Q(v,1),b=Q(E,1);for(E=Q(E,2),v=Q(v,2);!x(E);){var y=b.add(E);0>=y.l(w)&&(I=I.add(v),b=y),E=Q(E,1),v=Q(v,1)}return g=G(w,I.j(g)),new F(I,g)}for(I=m;0<=w.l(g);){for(v=Math.max(1,Math.floor(w.m()/g.m())),E=Math.ceil(Math.log(v)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),b=d(v),y=b.j(g);N(y)||0<y.l(w);)v-=E,b=d(v),y=b.j(g);x(b)&&(b=_),I=I.add(b),w=G(w,y)}return new F(I,w)}r.A=function(w){return K(this,w).h},r.and=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],E=0;E<g;E++)v[E]=this.i(E)&w.i(E);return new a(v,this.h&w.h)},r.or=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],E=0;E<g;E++)v[E]=this.i(E)|w.i(E);return new a(v,this.h|w.h)},r.xor=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],E=0;E<g;E++)v[E]=this.i(E)^w.i(E);return new a(v,this.h^w.h)};function H(w){for(var g=w.g.length+1,v=[],E=0;E<g;E++)v[E]=w.i(E)<<1|w.i(E-1)>>>31;return new a(v,w.h)}function Q(w,g){var v=g>>5;g%=32;for(var E=w.g.length-v,I=[],b=0;b<E;b++)I[b]=0<g?w.i(b+v)>>>g|w.i(b+v+1)<<32-g:w.i(b+v);return new a(I,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,al=Ag.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,En=Ag.Integer=a}).apply(typeof Tg<"u"?Tg:typeof self<"u"?self:typeof window<"u"?window:{});var aa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Jt={};var ul,cl,zr,ll,Is,ua,hl,dl,fl;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,l,h){return o==Array.prototype||o==Object.prototype||(o[l]=h.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof aa=="object"&&aa];for(var l=0;l<o.length;++l){var h=o[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=t(this);function i(o,l){if(l)e:{var h=n;o=o.split(".");for(var p=0;p<o.length-1;p++){var T=o[p];if(!(T in h))break e;h=h[T]}o=o[o.length-1],p=h[o],l=l(p),l!=p&&l!=null&&e(h,o,{configurable:!0,writable:!0,value:l})}}function s(o,l){o instanceof String&&(o+="");var h=0,p=!1,T={next:function(){if(!p&&h<o.length){var P=h++;return{value:l(P,o[P]),done:!1}}return p=!0,{done:!0,value:void 0}}};return T[Symbol.iterator]=function(){return T},T}i("Array.prototype.values",function(o){return o||function(){return s(this,function(l,h){return h})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return l=l!="object"?l:o?Array.isArray(o)?"array":l:"null",l=="array"||l=="object"&&typeof o.length=="number"}function d(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function f(o,l,h){return o.call.apply(o.bind,arguments)}function m(o,l,h){if(!o)throw Error();if(2<arguments.length){var p=Array.prototype.slice.call(arguments,2);return function(){var T=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(T,p),o.apply(l,T)}}return function(){return o.apply(l,arguments)}}function _(o,l,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,_.apply(null,arguments)}function A(o,l){var h=Array.prototype.slice.call(arguments,1);return function(){var p=h.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function x(o,l){function h(){}h.prototype=l.prototype,o.aa=l.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(p,T,P){for(var M=Array(arguments.length-2),ce=2;ce<arguments.length;ce++)M[ce-2]=arguments[ce];return l.prototype[T].apply(p,M)}}function N(o){let l=o.length;if(0<l){let h=Array(l);for(let p=0;p<l;p++)h[p]=o[p];return h}return[]}function R(o,l){for(let h=1;h<arguments.length;h++){let p=arguments[h];if(c(p)){let T=o.length||0,P=p.length||0;o.length=T+P;for(let M=0;M<P;M++)o[T+M]=p[M]}else o.push(p)}}class G{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function z(o){return/^[\s\xa0]*$/.test(o)}function F(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function K(o){return K[" "](o),o}K[" "]=function(){};var H=F().indexOf("Gecko")!=-1&&!(F().toLowerCase().indexOf("webkit")!=-1&&F().indexOf("Edge")==-1)&&!(F().indexOf("Trident")!=-1||F().indexOf("MSIE")!=-1)&&F().indexOf("Edge")==-1;function Q(o,l,h){for(let p in o)l.call(h,o[p],p,o)}function w(o,l){for(let h in o)l.call(void 0,o[h],h,o)}function g(o){let l={};for(let h in o)l[h]=o[h];return l}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,l){let h,p;for(let T=1;T<arguments.length;T++){p=arguments[T];for(h in p)o[h]=p[h];for(let P=0;P<v.length;P++)h=v[P],Object.prototype.hasOwnProperty.call(p,h)&&(o[h]=p[h])}}function I(o){var l=1;o=o.split(":");let h=[];for(;0<l&&o.length;)h.push(o.shift()),l--;return o.length&&h.push(o.join(":")),h}function b(o){u.setTimeout(()=>{throw o},0)}function y(){var o=Ju;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class zt{constructor(){this.h=this.g=null}add(l,h){let p=Ni.get();p.set(l,h),this.h?this.h.next=p:this.g=p,this.h=p}}var Ni=new G(()=>new qv,o=>o.reset());class qv{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Mi,Fi=!1,Ju=new zt,Wf=()=>{let o=u.Promise.resolve(void 0);Mi=()=>{o.then(Bv)}};var Bv=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){b(h)}var l=Ni;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}Fi=!1};function on(){this.s=this.s,this.C=this.C}on.prototype.s=!1,on.prototype.ma=function(){this.s||(this.s=!0,this.N())},on.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Le(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Le.prototype.h=function(){this.defaultPrevented=!0};var jv=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,l),u.removeEventListener("test",h,l)}catch{}return o}();function Oi(o,l){if(Le.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(H){e:{try{K(l.nodeName);var T=!0;break e}catch{}T=!1}T||(l=null)}}else h=="mouseover"?l=o.fromElement:h=="mouseout"&&(l=o.toElement);this.relatedTarget=l,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:$v[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Oi.aa.h.call(this)}}x(Oi,Le);var $v={2:"touch",3:"pen",4:"mouse"};Oi.prototype.h=function(){Oi.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Li="closure_listenable_"+(1e6*Math.random()|0),Gv=0;function zv(o,l,h,p,T){this.listener=o,this.proxy=null,this.src=l,this.type=h,this.capture=!!p,this.ha=T,this.key=++Gv,this.da=this.fa=!1}function mo(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function go(o){this.src=o,this.g={},this.h=0}go.prototype.add=function(o,l,h,p,T){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var M=Yu(o,l,p,T);return-1<M?(l=o[M],h||(l.fa=!1)):(l=new zv(l,this.src,P,!!p,T),l.fa=h,o.push(l)),l};function Xu(o,l){var h=l.type;if(h in o.g){var p=o.g[h],T=Array.prototype.indexOf.call(p,l,void 0),P;(P=0<=T)&&Array.prototype.splice.call(p,T,1),P&&(mo(l),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Yu(o,l,h,p){for(var T=0;T<o.length;++T){var P=o[T];if(!P.da&&P.listener==l&&P.capture==!!h&&P.ha==p)return T}return-1}var Zu="closure_lm_"+(1e6*Math.random()|0),ec={};function Hf(o,l,h,p,T){if(p&&p.once)return Jf(o,l,h,p,T);if(Array.isArray(l)){for(var P=0;P<l.length;P++)Hf(o,l[P],h,p,T);return null}return h=ic(h),o&&o[Li]?o.K(l,h,d(p)?!!p.capture:!!p,T):Qf(o,l,h,!1,p,T)}function Qf(o,l,h,p,T,P){if(!l)throw Error("Invalid event type");var M=d(T)?!!T.capture:!!T,ce=nc(o);if(ce||(o[Zu]=ce=new go(o)),h=ce.add(l,h,p,M,P),h.proxy)return h;if(p=Kv(),h.proxy=p,p.src=o,p.listener=h,o.addEventListener)jv||(T=M),T===void 0&&(T=!1),o.addEventListener(l.toString(),p,T);else if(o.attachEvent)o.attachEvent(Yf(l.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Kv(){function o(h){return l.call(o.src,o.listener,h)}let l=Wv;return o}function Jf(o,l,h,p,T){if(Array.isArray(l)){for(var P=0;P<l.length;P++)Jf(o,l[P],h,p,T);return null}return h=ic(h),o&&o[Li]?o.L(l,h,d(p)?!!p.capture:!!p,T):Qf(o,l,h,!0,p,T)}function Xf(o,l,h,p,T){if(Array.isArray(l))for(var P=0;P<l.length;P++)Xf(o,l[P],h,p,T);else p=d(p)?!!p.capture:!!p,h=ic(h),o&&o[Li]?(o=o.i,l=String(l).toString(),l in o.g&&(P=o.g[l],h=Yu(P,h,p,T),-1<h&&(mo(P[h]),Array.prototype.splice.call(P,h,1),P.length==0&&(delete o.g[l],o.h--)))):o&&(o=nc(o))&&(l=o.g[l.toString()],o=-1,l&&(o=Yu(l,h,p,T)),(h=-1<o?l[o]:null)&&tc(h))}function tc(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[Li])Xu(l.i,o);else{var h=o.type,p=o.proxy;l.removeEventListener?l.removeEventListener(h,p,o.capture):l.detachEvent?l.detachEvent(Yf(h),p):l.addListener&&l.removeListener&&l.removeListener(p),(h=nc(l))?(Xu(h,o),h.h==0&&(h.src=null,l[Zu]=null)):mo(o)}}}function Yf(o){return o in ec?ec[o]:ec[o]="on"+o}function Wv(o,l){if(o.da)o=!0;else{l=new Oi(l,this);var h=o.listener,p=o.ha||o.src;o.fa&&tc(o),o=h.call(p,l)}return o}function nc(o){return o=o[Zu],o instanceof go?o:null}var rc="__closure_events_fn_"+(1e9*Math.random()>>>0);function ic(o){return typeof o=="function"?o:(o[rc]||(o[rc]=function(l){return o.handleEvent(l)}),o[rc])}function Ue(){on.call(this),this.i=new go(this),this.M=this,this.F=null}x(Ue,on),Ue.prototype[Li]=!0,Ue.prototype.removeEventListener=function(o,l,h,p){Xf(this,o,l,h,p)};function He(o,l){var h,p=o.F;if(p)for(h=[];p;p=p.F)h.push(p);if(o=o.M,p=l.type||l,typeof l=="string")l=new Le(l,o);else if(l instanceof Le)l.target=l.target||o;else{var T=l;l=new Le(p,o),E(l,T)}if(T=!0,h)for(var P=h.length-1;0<=P;P--){var M=l.g=h[P];T=_o(M,p,!0,l)&&T}if(M=l.g=o,T=_o(M,p,!0,l)&&T,T=_o(M,p,!1,l)&&T,h)for(P=0;P<h.length;P++)M=l.g=h[P],T=_o(M,p,!1,l)&&T}Ue.prototype.N=function(){if(Ue.aa.N.call(this),this.i){var o=this.i,l;for(l in o.g){for(var h=o.g[l],p=0;p<h.length;p++)mo(h[p]);delete o.g[l],o.h--}}this.F=null},Ue.prototype.K=function(o,l,h,p){return this.i.add(String(o),l,!1,h,p)},Ue.prototype.L=function(o,l,h,p){return this.i.add(String(o),l,!0,h,p)};function _o(o,l,h,p){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();for(var T=!0,P=0;P<l.length;++P){var M=l[P];if(M&&!M.da&&M.capture==h){var ce=M.listener,Me=M.ha||M.src;M.fa&&Xu(o.i,M),T=ce.call(Me,p)!==!1&&T}}return T&&!p.defaultPrevented}function Zf(o,l,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function ep(o){o.g=Zf(()=>{o.g=null,o.i&&(o.i=!1,ep(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class Hv extends on{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:ep(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ui(o){on.call(this),this.h=o,this.g={}}x(Ui,on);var tp=[];function np(o){Q(o.g,function(l,h){this.g.hasOwnProperty(h)&&tc(l)},o),o.g={}}Ui.prototype.N=function(){Ui.aa.N.call(this),np(this)},Ui.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var sc=u.JSON.stringify,Qv=u.JSON.parse,Jv=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function oc(){}oc.prototype.h=null;function rp(o){return o.h||(o.h=o.i())}function ip(){}var qi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ac(){Le.call(this,"d")}x(ac,Le);function uc(){Le.call(this,"c")}x(uc,Le);var jn={},sp=null;function yo(){return sp=sp||new Ue}jn.La="serverreachability";function op(o){Le.call(this,jn.La,o)}x(op,Le);function Bi(o){let l=yo();He(l,new op(l))}jn.STAT_EVENT="statevent";function ap(o,l){Le.call(this,jn.STAT_EVENT,o),this.stat=l}x(ap,Le);function Qe(o){let l=yo();He(l,new ap(l,o))}jn.Ma="timingevent";function up(o,l){Le.call(this,jn.Ma,o),this.size=l}x(up,Le);function ji(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function $i(){this.g=!0}$i.prototype.xa=function(){this.g=!1};function Xv(o,l,h,p,T,P){o.info(function(){if(o.g)if(P)for(var M="",ce=P.split("&"),Me=0;Me<ce.length;Me++){var oe=ce[Me].split("=");if(1<oe.length){var qe=oe[0];oe=oe[1];var Be=qe.split("_");M=2<=Be.length&&Be[1]=="type"?M+(qe+"="+oe+"&"):M+(qe+"=redacted&")}}else M=null;else M=P;return"XMLHTTP REQ ("+p+") [attempt "+T+"]: "+l+`
`+h+`
`+M})}function Yv(o,l,h,p,T,P,M){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+T+"]: "+l+`
`+h+`
`+P+" "+M})}function Sr(o,l,h,p){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+ew(o,h)+(p?" "+p:"")})}function Zv(o,l){o.info(function(){return"TIMEOUT: "+l})}$i.prototype.info=function(){};function ew(o,l){if(!o.g)return l;if(!l)return null;try{var h=JSON.parse(l);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var p=h[o];if(!(2>p.length)){var T=p[1];if(Array.isArray(T)&&!(1>T.length)){var P=T[0];if(P!="noop"&&P!="stop"&&P!="close")for(var M=1;M<T.length;M++)T[M]=""}}}}return sc(h)}catch{return l}}var vo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},cp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},cc;function wo(){}x(wo,oc),wo.prototype.g=function(){return new XMLHttpRequest},wo.prototype.i=function(){return{}},cc=new wo;function an(o,l,h,p){this.j=o,this.i=l,this.l=h,this.R=p||1,this.U=new Ui(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new lp}function lp(){this.i=null,this.g="",this.h=!1}var hp={},lc={};function hc(o,l,h){o.L=1,o.v=Ao(Kt(l)),o.m=h,o.P=!0,dp(o,null)}function dp(o,l){o.F=Date.now(),Eo(o),o.A=Kt(o.v);var h=o.A,p=o.R;Array.isArray(p)||(p=[String(p)]),Cp(h.i,"t",p),o.C=0,h=o.j.J,o.h=new lp,o.g=Gp(o.j,h?l:null,!o.m),0<o.O&&(o.M=new Hv(_(o.Y,o,o.g),o.O)),l=o.U,h=o.g,p=o.ca;var T="readystatechange";Array.isArray(T)||(T&&(tp[0]=T.toString()),T=tp);for(var P=0;P<T.length;P++){var M=Hf(h,T[P],p||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),Bi(),Xv(o.i,o.u,o.A,o.l,o.R,o.m)}an.prototype.ca=function(o){o=o.target;let l=this.M;l&&Wt(o)==3?l.j():this.Y(o)},an.prototype.Y=function(o){try{if(o==this.g)e:{let Be=Wt(this.g);var l=this.g.Ba();let Rr=this.g.Z();if(!(3>Be)&&(Be!=3||this.g&&(this.h.h||this.g.oa()||kp(this.g)))){this.J||Be!=4||l==7||(l==8||0>=Rr?Bi(3):Bi(2)),dc(this);var h=this.g.Z();this.X=h;t:if(fp(this)){var p=kp(this.g);o="";var T=p.length,P=Wt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){$n(this),Gi(this);var M="";break t}this.h.i=new u.TextDecoder}for(l=0;l<T;l++)this.h.h=!0,o+=this.h.i.decode(p[l],{stream:!(P&&l==T-1)});p.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=h==200,Yv(this.i,this.u,this.A,this.l,this.R,Be,h),this.o){if(this.T&&!this.K){t:{if(this.g){var ce,Me=this.g;if((ce=Me.g?Me.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(ce)){var oe=ce;break t}}oe=null}if(h=oe)Sr(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fc(this,h);else{this.o=!1,this.s=3,Qe(12),$n(this),Gi(this);break e}}if(this.P){h=!0;let vt;for(;!this.J&&this.C<M.length;)if(vt=tw(this,M),vt==lc){Be==4&&(this.s=4,Qe(14),h=!1),Sr(this.i,this.l,null,"[Incomplete Response]");break}else if(vt==hp){this.s=4,Qe(15),Sr(this.i,this.l,M,"[Invalid Chunk]"),h=!1;break}else Sr(this.i,this.l,vt,null),fc(this,vt);if(fp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Be!=4||M.length!=0||this.h.h||(this.s=1,Qe(16),h=!1),this.o=this.o&&h,!h)Sr(this.i,this.l,M,"[Invalid Chunked Response]"),$n(this),Gi(this);else if(0<M.length&&!this.W){this.W=!0;var qe=this.j;qe.g==this&&qe.ba&&!qe.M&&(qe.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),vc(qe),qe.M=!0,Qe(11))}}else Sr(this.i,this.l,M,null),fc(this,M);Be==4&&$n(this),this.o&&!this.J&&(Be==4?qp(this.j,this):(this.o=!1,Eo(this)))}else yw(this.g),h==400&&0<M.indexOf("Unknown SID")?(this.s=3,Qe(12)):(this.s=0,Qe(13)),$n(this),Gi(this)}}}catch{}finally{}};function fp(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function tw(o,l){var h=o.C,p=l.indexOf(`
`,h);return p==-1?lc:(h=Number(l.substring(h,p)),isNaN(h)?hp:(p+=1,p+h>l.length?lc:(l=l.slice(p,p+h),o.C=p+h,l)))}an.prototype.cancel=function(){this.J=!0,$n(this)};function Eo(o){o.S=Date.now()+o.I,pp(o,o.I)}function pp(o,l){if(o.B!=null)throw Error("WatchDog timer not null");o.B=ji(_(o.ba,o),l)}function dc(o){o.B&&(u.clearTimeout(o.B),o.B=null)}an.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Zv(this.i,this.A),this.L!=2&&(Bi(),Qe(17)),$n(this),this.s=2,Gi(this)):pp(this,this.S-o)};function Gi(o){o.j.G==0||o.J||qp(o.j,o)}function $n(o){dc(o);var l=o.M;l&&typeof l.ma=="function"&&l.ma(),o.M=null,np(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function fc(o,l){try{var h=o.j;if(h.G!=0&&(h.g==o||pc(h.h,o))){if(!o.K&&pc(h.h,o)&&h.G==3){try{var p=h.Da.g.parse(l)}catch{p=null}if(Array.isArray(p)&&p.length==3){var T=p;if(T[0]==0){e:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)Do(h),So(h);else break e;yc(h),Qe(18)}}else h.za=T[1],0<h.za-h.T&&37500>T[2]&&h.F&&h.v==0&&!h.C&&(h.C=ji(_(h.Za,h),6e3));if(1>=_p(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else zn(h,11)}else if((o.K||h.g==o)&&Do(h),!z(l))for(T=h.Da.g.parse(l),l=0;l<T.length;l++){let oe=T[l];if(h.T=oe[0],oe=oe[1],h.G==2)if(oe[0]=="c"){h.K=oe[1],h.ia=oe[2];let qe=oe[3];qe!=null&&(h.la=qe,h.j.info("VER="+h.la));let Be=oe[4];Be!=null&&(h.Aa=Be,h.j.info("SVER="+h.Aa));let Rr=oe[5];Rr!=null&&typeof Rr=="number"&&0<Rr&&(p=1.5*Rr,h.L=p,h.j.info("backChannelRequestTimeoutMs_="+p)),p=h;let vt=o.g;if(vt){let Vo=vt.g?vt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Vo){var P=p.h;P.g||Vo.indexOf("spdy")==-1&&Vo.indexOf("quic")==-1&&Vo.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(mc(P,P.h),P.h=null))}if(p.D){let wc=vt.g?vt.g.getResponseHeader("X-HTTP-Session-Id"):null;wc&&(p.ya=wc,de(p.I,p.D,wc))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),p=h;var M=o;if(p.qa=$p(p,p.J?p.ia:null,p.W),M.K){yp(p.h,M);var ce=M,Me=p.L;Me&&(ce.I=Me),ce.B&&(dc(ce),Eo(ce)),p.g=M}else Lp(p);0<h.i.length&&Po(h)}else oe[0]!="stop"&&oe[0]!="close"||zn(h,7);else h.G==3&&(oe[0]=="stop"||oe[0]=="close"?oe[0]=="stop"?zn(h,7):_c(h):oe[0]!="noop"&&h.l&&h.l.ta(oe),h.v=0)}}Bi(4)}catch{}}var nw=class{constructor(o,l){this.g=o,this.map=l}};function mp(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function gp(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function _p(o){return o.h?1:o.g?o.g.size:0}function pc(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function mc(o,l){o.g?o.g.add(l):o.h=l}function yp(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}mp.prototype.cancel=function(){if(this.i=vp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function vp(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let h of o.g.values())l=l.concat(h.D);return l}return N(o.i)}function rw(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(c(o)){for(var l=[],h=o.length,p=0;p<h;p++)l.push(o[p]);return l}l=[],h=0;for(p in o)l[h++]=o[p];return l}function iw(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||typeof o=="string"){var l=[];o=o.length;for(var h=0;h<o;h++)l.push(h);return l}l=[],h=0;for(let p in o)l[h++]=p;return l}}}function wp(o,l){if(o.forEach&&typeof o.forEach=="function")o.forEach(l,void 0);else if(c(o)||typeof o=="string")Array.prototype.forEach.call(o,l,void 0);else for(var h=iw(o),p=rw(o),T=p.length,P=0;P<T;P++)l.call(void 0,p[P],h&&h[P],o)}var Ep=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sw(o,l){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var p=o[h].indexOf("="),T=null;if(0<=p){var P=o[h].substring(0,p);T=o[h].substring(p+1)}else P=o[h];l(P,T?decodeURIComponent(T.replace(/\+/g," ")):"")}}}function Gn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Gn){this.h=o.h,Io(this,o.j),this.o=o.o,this.g=o.g,To(this,o.s),this.l=o.l;var l=o.i,h=new Wi;h.i=l.i,l.g&&(h.g=new Map(l.g),h.h=l.h),Ip(this,h),this.m=o.m}else o&&(l=String(o).match(Ep))?(this.h=!1,Io(this,l[1]||"",!0),this.o=zi(l[2]||""),this.g=zi(l[3]||"",!0),To(this,l[4]),this.l=zi(l[5]||"",!0),Ip(this,l[6]||"",!0),this.m=zi(l[7]||"")):(this.h=!1,this.i=new Wi(null,this.h))}Gn.prototype.toString=function(){var o=[],l=this.j;l&&o.push(Ki(l,Tp,!0),":");var h=this.g;return(h||l=="file")&&(o.push("//"),(l=this.o)&&o.push(Ki(l,Tp,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Ki(h,h.charAt(0)=="/"?uw:aw,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Ki(h,lw)),o.join("")};function Kt(o){return new Gn(o)}function Io(o,l,h){o.j=h?zi(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function To(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function Ip(o,l,h){l instanceof Wi?(o.i=l,hw(o.i,o.h)):(h||(l=Ki(l,cw)),o.i=new Wi(l,o.h))}function de(o,l,h){o.i.set(l,h)}function Ao(o){return de(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function zi(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Ki(o,l,h){return typeof o=="string"?(o=encodeURI(o).replace(l,ow),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function ow(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Tp=/[#\/\?@]/g,aw=/[#\?:]/g,uw=/[#\?]/g,cw=/[#\?@]/g,lw=/#/g;function Wi(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function un(o){o.g||(o.g=new Map,o.h=0,o.i&&sw(o.i,function(l,h){o.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}r=Wi.prototype,r.add=function(o,l){un(this),this.i=null,o=Pr(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(l),this.h+=1,this};function Ap(o,l){un(o),l=Pr(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function bp(o,l){return un(o),l=Pr(o,l),o.g.has(l)}r.forEach=function(o,l){un(this),this.g.forEach(function(h,p){h.forEach(function(T){o.call(l,T,p,this)},this)},this)},r.na=function(){un(this);let o=Array.from(this.g.values()),l=Array.from(this.g.keys()),h=[];for(let p=0;p<l.length;p++){let T=o[p];for(let P=0;P<T.length;P++)h.push(l[p])}return h},r.V=function(o){un(this);let l=[];if(typeof o=="string")bp(this,o)&&(l=l.concat(this.g.get(Pr(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)l=l.concat(o[h])}return l},r.set=function(o,l){return un(this),this.i=null,o=Pr(this,o),bp(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o?(o=this.V(o),0<o.length?String(o[0]):l):l};function Cp(o,l,h){Ap(o,l),0<h.length&&(o.i=null,o.g.set(Pr(o,l),N(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(var h=0;h<l.length;h++){var p=l[h];let P=encodeURIComponent(String(p)),M=this.V(p);for(p=0;p<M.length;p++){var T=P;M[p]!==""&&(T+="="+encodeURIComponent(String(M[p]))),o.push(T)}}return this.i=o.join("&")};function Pr(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function hw(o,l){l&&!o.j&&(un(o),o.i=null,o.g.forEach(function(h,p){var T=p.toLowerCase();p!=T&&(Ap(this,p),Cp(this,T,h))},o)),o.j=l}function dw(o,l){let h=new $i;if(u.Image){let p=new Image;p.onload=A(cn,h,"TestLoadImage: loaded",!0,l,p),p.onerror=A(cn,h,"TestLoadImage: error",!1,l,p),p.onabort=A(cn,h,"TestLoadImage: abort",!1,l,p),p.ontimeout=A(cn,h,"TestLoadImage: timeout",!1,l,p),u.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else l(!1)}function fw(o,l){let h=new $i,p=new AbortController,T=setTimeout(()=>{p.abort(),cn(h,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:p.signal}).then(P=>{clearTimeout(T),P.ok?cn(h,"TestPingServer: ok",!0,l):cn(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(T),cn(h,"TestPingServer: error",!1,l)})}function cn(o,l,h,p,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),p(h)}catch{}}function pw(){this.g=new Jv}function mw(o,l,h){let p=h||"";try{wp(o,function(T,P){let M=T;d(T)&&(M=sc(T)),l.push(p+P+"="+encodeURIComponent(M))})}catch(T){throw l.push(p+"type="+encodeURIComponent("_badmap")),T}}function Hi(o){this.l=o.Ub||null,this.j=o.eb||!1}x(Hi,oc),Hi.prototype.g=function(){return new bo(this.l,this.j)},Hi.prototype.i=function(o){return function(){return o}}({});function bo(o,l){Ue.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(bo,Ue),r=bo.prototype,r.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,Ji(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Qi(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Ji(this)),this.g&&(this.readyState=3,Ji(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Sp(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Sp(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Qi(this):Ji(this),this.readyState==3&&Sp(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Qi(this))},r.Qa=function(o){this.g&&(this.response=o,Qi(this))},r.ga=function(){this.g&&Qi(this)};function Qi(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Ji(o)}r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=l.next();return o.join(`\r
`)};function Ji(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(bo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Pp(o){let l="";return Q(o,function(h,p){l+=p,l+=":",l+=h,l+=`\r
`}),l}function gc(o,l,h){e:{for(p in h){var p=!1;break e}p=!0}p||(h=Pp(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):de(o,l,h))}function ye(o){Ue.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(ye,Ue);var gw=/^https?$/i,_w=["POST","PUT"];r=ye.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,l,h,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():cc.g(),this.v=this.o?rp(this.o):rp(cc),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(P){Dp(this,P);return}if(o=h||"",h=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var T in p)h.set(T,p[T]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(let P of p.keys())h.set(P,p.get(P));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),T=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(_w,l,void 0))||p||T||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,M]of h)this.g.setRequestHeader(P,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{xp(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){Dp(this,P)}};function Dp(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,Rp(o),Co(o)}function Rp(o){o.A||(o.A=!0,He(o,"complete"),He(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,He(this,"complete"),He(this,"abort"),Co(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Co(this,!0)),ye.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Vp(this):this.bb())},r.bb=function(){Vp(this)};function Vp(o){if(o.h&&typeof a<"u"&&(!o.v[1]||Wt(o)!=4||o.Z()!=2)){if(o.u&&Wt(o)==4)Zf(o.Ea,0,o);else if(He(o,"readystatechange"),Wt(o)==4){o.h=!1;try{let M=o.Z();e:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var h;if(!(h=l)){var p;if(p=M===0){var T=String(o.D).match(Ep)[1]||null;!T&&u.self&&u.self.location&&(T=u.self.location.protocol.slice(0,-1)),p=!gw.test(T?T.toLowerCase():"")}h=p}if(h)He(o,"complete"),He(o,"success");else{o.m=6;try{var P=2<Wt(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",Rp(o)}}finally{Co(o)}}}}function Co(o,l){if(o.g){xp(o);let h=o.g,p=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||He(o,"ready");try{h.onreadystatechange=p}catch{}}}function xp(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function Wt(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<Wt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),Qv(l)}};function kp(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function yw(o){let l={};o=(o.g&&2<=Wt(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(z(o[p]))continue;var h=I(o[p]);let T=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let P=l[T]||[];l[T]=P,P.push(h)}w(l,function(p){return p.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xi(o,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||l}function Np(o){this.Aa=0,this.i=[],this.j=new $i,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Xi("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Xi("baseRetryDelayMs",5e3,o),this.cb=Xi("retryDelaySeedMs",1e4,o),this.Wa=Xi("forwardChannelMaxRetries",2,o),this.wa=Xi("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new mp(o&&o.concurrentRequestLimit),this.Da=new pw,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Np.prototype,r.la=8,r.G=1,r.connect=function(o,l,h,p){Qe(0),this.W=o,this.H=l||{},h&&p!==void 0&&(this.H.OSID=h,this.H.OAID=p),this.F=this.X,this.I=$p(this,null,this.W),Po(this)};function _c(o){if(Mp(o),o.G==3){var l=o.U++,h=Kt(o.I);if(de(h,"SID",o.K),de(h,"RID",l),de(h,"TYPE","terminate"),Yi(o,h),l=new an(o,o.j,l),l.L=2,l.v=Ao(Kt(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=l.v,h=!0),h||(l.g=Gp(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Eo(l)}jp(o)}function So(o){o.g&&(vc(o),o.g.cancel(),o.g=null)}function Mp(o){So(o),o.u&&(u.clearTimeout(o.u),o.u=null),Do(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function Po(o){if(!gp(o.h)&&!o.s){o.s=!0;var l=o.Ga;Mi||Wf(),Fi||(Mi(),Fi=!0),Ju.add(l,o),o.B=0}}function vw(o,l){return _p(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=l.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=ji(_(o.Ga,o,l),Bp(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let T=new an(this,this.j,o),P=this.o;if(this.S&&(P?(P=g(P),E(P,this.S)):P=this.S),this.m!==null||this.O||(T.H=P,P=null),this.P)e:{for(var l=0,h=0;h<this.i.length;h++){t:{var p=this.i[h];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(l+=p,4096<l){l=h;break e}if(l===4096||h===this.i.length-1){l=h+1;break e}}l=1e3}else l=1e3;l=Op(this,T,l),h=Kt(this.I),de(h,"RID",o),de(h,"CVER",22),this.D&&de(h,"X-HTTP-Session-Id",this.D),Yi(this,h),P&&(this.O?l="headers="+encodeURIComponent(String(Pp(P)))+"&"+l:this.m&&gc(h,this.m,P)),mc(this.h,T),this.Ua&&de(h,"TYPE","init"),this.P?(de(h,"$req",l),de(h,"SID","null"),T.T=!0,hc(T,h,null)):hc(T,h,l),this.G=2}}else this.G==3&&(o?Fp(this,o):this.i.length==0||gp(this.h)||Fp(this))};function Fp(o,l){var h;l?h=l.l:h=o.U++;let p=Kt(o.I);de(p,"SID",o.K),de(p,"RID",h),de(p,"AID",o.T),Yi(o,p),o.m&&o.o&&gc(p,o.m,o.o),h=new an(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),l&&(o.i=l.D.concat(o.i)),l=Op(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),mc(o.h,h),hc(h,p,l)}function Yi(o,l){o.H&&Q(o.H,function(h,p){de(l,p,h)}),o.l&&wp({},function(h,p){de(l,p,h)})}function Op(o,l,h){h=Math.min(o.i.length,h);var p=o.l?_(o.l.Na,o.l,o):null;e:{var T=o.i;let P=-1;for(;;){let M=["count="+h];P==-1?0<h?(P=T[0].g,M.push("ofs="+P)):P=0:M.push("ofs="+P);let ce=!0;for(let Me=0;Me<h;Me++){let oe=T[Me].g,qe=T[Me].map;if(oe-=P,0>oe)P=Math.max(0,T[Me].g-100),ce=!1;else try{mw(qe,M,"req"+oe+"_")}catch{p&&p(qe)}}if(ce){p=M.join("&");break e}}}return o=o.i.splice(0,h),l.D=o,p}function Lp(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;Mi||Wf(),Fi||(Mi(),Fi=!0),Ju.add(l,o),o.v=0}}function yc(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=ji(_(o.Fa,o),Bp(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,Up(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=ji(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Qe(10),So(this),Up(this))};function vc(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function Up(o){o.g=new an(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var l=Kt(o.qa);de(l,"RID","rpc"),de(l,"SID",o.K),de(l,"AID",o.T),de(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&de(l,"TO",o.ja),de(l,"TYPE","xmlhttp"),Yi(o,l),o.m&&o.o&&gc(l,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Ao(Kt(l)),h.m=null,h.P=!0,dp(h,o)}r.Za=function(){this.C!=null&&(this.C=null,So(this),yc(this),Qe(19))};function Do(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function qp(o,l){var h=null;if(o.g==l){Do(o),vc(o),o.g=null;var p=2}else if(pc(o.h,l))h=l.D,yp(o.h,l),p=1;else return;if(o.G!=0){if(l.o)if(p==1){h=l.m?l.m.length:0,l=Date.now()-l.F;var T=o.B;p=yo(),He(p,new up(p,h)),Po(o)}else Lp(o);else if(T=l.s,T==3||T==0&&0<l.X||!(p==1&&vw(o,l)||p==2&&yc(o)))switch(h&&0<h.length&&(l=o.h,l.i=l.i.concat(h)),T){case 1:zn(o,5);break;case 4:zn(o,10);break;case 3:zn(o,6);break;default:zn(o,2)}}}function Bp(o,l){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*l}function zn(o,l){if(o.j.info("Error code "+l),l==2){var h=_(o.fb,o),p=o.Xa;let T=!p;p=new Gn(p||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Io(p,"https"),Ao(p),T?dw(p.toString(),h):fw(p.toString(),h)}else Qe(2);o.G=0,o.l&&o.l.sa(l),jp(o),Mp(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Qe(2)):(this.j.info("Failed to ping google.com"),Qe(1))};function jp(o){if(o.G=0,o.ka=[],o.l){let l=vp(o.h);(l.length!=0||o.i.length!=0)&&(R(o.ka,l),R(o.ka,o.i),o.h.i.length=0,N(o.i),o.i.length=0),o.l.ra()}}function $p(o,l,h){var p=h instanceof Gn?Kt(h):new Gn(h);if(p.g!="")l&&(p.g=l+"."+p.g),To(p,p.s);else{var T=u.location;p=T.protocol,l=l?l+"."+T.hostname:T.hostname,T=+T.port;var P=new Gn(null);p&&Io(P,p),l&&(P.g=l),T&&To(P,T),h&&(P.l=h),p=P}return h=o.D,l=o.ya,h&&l&&de(p,h,l),de(p,"VER",o.la),Yi(o,p),p}function Gp(o,l,h){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Ca&&!o.pa?new ye(new Hi({eb:h})):new ye(o.pa),l.Ha(o.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function zp(){}r=zp.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Ro(){}Ro.prototype.g=function(o,l){return new st(o,l)};function st(o,l){Ue.call(this),this.g=new Np(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!z(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!z(l)&&(this.g.D=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new Dr(this)}x(st,Ue),st.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},st.prototype.close=function(){_c(this.g)},st.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=sc(o),o=h);l.i.push(new nw(l.Ya++,o)),l.G==3&&Po(l)},st.prototype.N=function(){this.g.l=null,delete this.j,_c(this.g),delete this.g,st.aa.N.call(this)};function Kp(o){ac.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(let h in l){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}x(Kp,ac);function Wp(){uc.call(this),this.status=1}x(Wp,uc);function Dr(o){this.g=o}x(Dr,zp),Dr.prototype.ua=function(){He(this.g,"a")},Dr.prototype.ta=function(o){He(this.g,new Kp(o))},Dr.prototype.sa=function(o){He(this.g,new Wp)},Dr.prototype.ra=function(){He(this.g,"b")},Ro.prototype.createWebChannel=Ro.prototype.g,st.prototype.send=st.prototype.o,st.prototype.open=st.prototype.m,st.prototype.close=st.prototype.close,fl=Jt.createWebChannelTransport=function(){return new Ro},dl=Jt.getStatEventTarget=function(){return yo()},hl=Jt.Event=jn,ua=Jt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},vo.NO_ERROR=0,vo.TIMEOUT=8,vo.HTTP_ERROR=6,Is=Jt.ErrorCode=vo,cp.COMPLETE="complete",ll=Jt.EventType=cp,ip.EventType=qi,qi.OPEN="a",qi.CLOSE="b",qi.ERROR="c",qi.MESSAGE="d",Ue.prototype.listen=Ue.prototype.K,zr=Jt.WebChannel=ip,cl=Jt.FetchXmlHttpFactory=Hi,ye.prototype.listenOnce=ye.prototype.L,ye.prototype.getLastError=ye.prototype.Ka,ye.prototype.getLastErrorCode=ye.prototype.Ba,ye.prototype.getStatus=ye.prototype.Z,ye.prototype.getResponseJson=ye.prototype.Oa,ye.prototype.getResponseText=ye.prototype.oa,ye.prototype.send=ye.prototype.ea,ye.prototype.setWithCredentials=ye.prototype.Ha,ul=Jt.XhrIo=ye}).apply(typeof aa<"u"?aa:typeof self<"u"?self:typeof window<"u"?window:{});var bg="@firebase/firestore";var Pe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Pe.UNAUTHENTICATED=new Pe(null),Pe.GOOGLE_CREDENTIALS=new Pe("google-credentials-uid"),Pe.FIRST_PARTY=new Pe("first-party-uid"),Pe.MOCK_USER=new Pe("mock-user");var Ii="10.13.1";var Pn=new Bo("@firebase/firestore");function Jr(){return Pn.logLevel}function yd(r){Pn.setLogLevel(r)}function k(r,...e){if(Pn.logLevel<=xt.DEBUG){let t=e.map(vd);Pn.debug(`Firestore (${Ii}): ${r}`,...t)}}function we(r,...e){if(Pn.logLevel<=xt.ERROR){let t=e.map(vd);Pn.error(`Firestore (${Ii}): ${r}`,...t)}}function mt(r,...e){if(Pn.logLevel<=xt.WARN){let t=e.map(vd);Pn.warn(`Firestore (${Ii}): ${r}`,...t)}}function vd(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}function U(r="Unexpected state"){let e=`FIRESTORE (${Ii}) INTERNAL ASSERTION FAILED: `+r;throw we(e),new Error(e)}function B(r,e){r||U()}function S_(r,e){r||U()}function O(r,e){return r}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends Cm{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var De=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var va=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},yl=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Pe.UNAUTHENTICATED))}shutdown(){}},vl=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},wl=class{constructor(e){this.t=e,this.currentUser=Pe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,i=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),s=new De;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new De,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let c=s;e.enqueueRetryable(()=>D(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},u=c=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new De)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(B(typeof n.accessToken=="string"),new va(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return B(e===null||typeof e=="string"),new Pe(e)}},El=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Pe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Il=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new El(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Pe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Tl=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Al=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let n=s=>{s.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(B(typeof t.token=="string"),this.R=t.token,new Tl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function q0(r){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}var wa=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let i=q0(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}};function W(r,e){return r<e?-1:r>e?1:0}function si(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function P_(r){return r+"\0"}var _e=class r{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new r(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var $=class r{constructor(e){this.timestamp=e}static fromTimestamp(e){return new r(e)}static min(){return new r(new _e(0,0))}static max(){return new r(new _e(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ea=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&U(),n===void 0?n=e.length-t:n>e.length-t&&U(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ie=class r extends Ea{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new V(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},B0=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ee=class r extends Ea{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return B0.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new V(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new V(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new V(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};var L=class r{constructor(e){this.path=e}static fromPath(e){return new r(ie.fromString(e))}static fromName(e){return new r(ie.fromString(e).popFirst(5))}static empty(){return new r(ie.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ie.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ie.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new ie(e.slice()))}};var oi=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};function bl(r){return r.fields.find(e=>e.kind===2)}function er(r){return r.fields.filter(e=>e.kind!==2)}oi.UNKNOWN_ID=-1;var ni=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ns=class r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r(0,gt.min())}};function D_(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=$.fromTimestamp(n===1e9?new _e(t+1,0):new _e(t,n));return new gt(i,L.empty(),e)}function R_(r){return new gt(r.readTime,r.key,-1)}var gt=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r($.min(),L.empty(),-1)}static max(){return new r($.max(),L.empty(),-1)}};function wd(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(r.documentKey,e.documentKey),t!==0?t:W(r.largestBatchId,e.largestBatchId))}var V_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ia=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Ln(r){return D(this,null,function*(){if(r.code!==S.FAILED_PRECONDITION||r.message!==V_)throw r;k("LocalStore","Unexpectedly lost primary lease")})}var C=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,a=new Array(s),u=0;for(let c=0;c<s;c++){let d=c;t(e[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};var Ta=class r{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new De,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new or(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=Ed(n.target.error);this.V.reject(new or(e,i))}}static open(e,t,n,i){try{return new r(t,e.transaction(i,n))}catch(s){throw new or(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(k("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Sl(t)}},Dn=class r{constructor(e,t,n){this.name=e,this.version=t,this.p=n,r.S(as())===12.2&&we("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return k("SimpleDb","Removing database:",e),tr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!qo())return!1;if(r.v())return!0;let e=as(),t=r.S(e),n=0<t&&t<10,i=x_(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return D(this,null,function*(){return this.db||(k("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;t(a)},i.onblocked=()=>{n(new or(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new V(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new V(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new or(e,a))},i.onupgradeneeded=s=>{k("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.p.O(a,i.transaction,s.oldVersion,this.version).next(()=>{k("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return D(this,null,function*(){let s=t==="readonly",a=0;for(;;){++a;try{this.db=yield this.M(e);let u=Ta.open(this.db,e,s?"readonly":"readwrite",n),c=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),C.reject(d))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){let c=u,d=c.name!=="FirebaseError"&&a<3;if(k("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function x_(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Cl=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return tr(this.B.delete())}},or=class extends V{constructor(e,t){super(S.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Un(r){return r.name==="IndexedDbTransactionError"}var Sl=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(k("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(k("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),tr(n)}add(e){return k("SimpleDb","ADD",this.store.name,e,e),tr(this.store.add(e))}get(e){return tr(this.store.get(e)).next(t=>(t===void 0&&(t=null),k("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return k("SimpleDb","DELETE",this.store.name,e),tr(this.store.delete(e))}count(){return k("SimpleDb","COUNT",this.store.name),tr(this.store.count())}U(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new C((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{let s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new C((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(e,t){k("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.W(i,t)}Y(e){let t=this.cursor({});return new C((n,i)=>{t.onerror=s=>{let a=Ed(s.target.error);i(a)},t.onsuccess=s=>{let a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(e,t){let n=[];return new C((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let c=new Cl(u),d=t(u.primaryKey,u.value,c);if(d instanceof C){let f=d.catch(m=>(c.done(),C.reject(m)));n.push(f)}c.isDone?i():c.K===null?u.continue():u.continue(c.K)}}).next(()=>C.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function tr(r){return new C((e,t)=>{r.onsuccess=n=>{let i=n.target.result;e(i)},r.onerror=n=>{let i=Ed(n.target.error);t(i)}})}var Cg=!1;function Ed(r){let e=Dn.S(as());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new V("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Cg||(Cg=!0,setTimeout(()=>{throw n},0)),n}}return r}var Pl=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){k("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>D(this,null,function*(){this.task=null;try{k("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Un(t)?k("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Ln(t)}yield this.X(6e4)}))}},Dl=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return D(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,i=t,s=!0;return C.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!n.has(a))return k("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(k("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{let a=R_(s);wd(a,n)>0&&(n=a)}),new gt(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var ct=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function ro(r){return r==null}function Ms(r){return r===0&&1/r==-1/0}function k_(r){return typeof r=="number"&&Number.isInteger(r)&&!Ms(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Ye(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Sg(e)),e=j0(r.get(t),e);return Sg(e)}function j0(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Sg(r){return r+""}function Nt(r){let e=r.length;if(B(e>=2),e===2)return B(r.charAt(0)===""&&r.charAt(1)===""),ie.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let a=r.indexOf("",s);switch((a<0||a>t)&&U(),r.charAt(a+1)){case"":let u=r.substring(s,a),c;i.length===0?c=u:(i+=u,c=i,i=""),n.push(c);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:U()}s=a+2}return new ie(n)}var Pg=["userId","batchId"];function fa(r,e){return[r,Ye(e)]}function N_(r,e,t){return[r,Ye(e),t]}var $0={},G0=["prefixPath","collectionGroup","readTime","documentId"],z0=["prefixPath","collectionGroup","documentId"],K0=["collectionGroup","readTime","prefixPath","documentId"],W0=["canonicalId","targetId"],H0=["targetId","path"],Q0=["path","targetId"],J0=["collectionId","parent"],X0=["indexId","uid"],Y0=["uid","sequenceNumber"],Z0=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],eE=["indexId","uid","orderedDocumentKey"],tE=["userId","collectionPath","documentId"],nE=["userId","collectionPath","largestBatchId"],rE=["userId","collectionGroup","largestBatchId"],M_=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],iE=[...M_,"documentOverlays"],F_=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],O_=F_,Id=[...O_,"indexConfiguration","indexState","indexEntries"],sE=Id,oE=[...Id,"globals"];var Fs=class extends Ia{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function xe(r,e){let t=O(r);return Dn.F(t._e,e)}function Dg(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function yr(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function L_(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}var fe=class r{constructor(e,t){this.comparator=e,this.root=t||Ft.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ft.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ft.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ti(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ti(this.root,e,this.comparator,!1)}getReverseIterator(){return new ti(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ti(this.root,e,this.comparator,!0)}},ti=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ft=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();let e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}};Ft.EMPTY=null,Ft.RED=!0,Ft.BLACK=!1;Ft.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Ft(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var le=class r{constructor(e){this.comparator=e,this.data=new fe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Aa(this.data.getIterator())}getIteratorFrom(e){return new Aa(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},Aa=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Kr(r){return r.hasNext()?r.getNext():void 0}var lt=class r{constructor(e){this.fields=e,e.sort(Ee.comparator)}static empty(){return new r([])}unionWith(e){let t=new le(Ee.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return si(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var ba=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function U_(){return typeof atob<"u"}var Te=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ba("Invalid base64 string: "+s):s}}(e);return new r(t)}static fromUint8Array(e){let t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Te.EMPTY_BYTE_STRING=new Te("");var aE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zt(r){if(B(!!r),typeof r=="string"){let e=0,t=aE.exec(r);if(B(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:pe(r.seconds),nanos:pe(r.nanos)}}function pe(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Rn(r){return typeof r=="string"?Te.fromBase64String(r):Te.fromUint8Array(r)}function mu(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Td(r){let e=r.mapValue.fields.__previous_value__;return mu(e)?Td(e):e}function Os(r){let e=Zt(r.mapValue.fields.__local_write_time__.timestampValue);return new _e(e.seconds,e.nanos)}var Rl=class{constructor(e,t,n,i,s,a,u,c,d){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=d}},Vn=class r{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};var Cn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},pa={nullValue:"NULL_VALUE"};function ar(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?mu(r)?4:q_(r)?9007199254740991:gu(r)?10:11:U()}function Ut(r,e){if(r===e)return!0;let t=ar(r);if(t!==ar(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Os(r).isEqual(Os(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=Zt(i.timestampValue),u=Zt(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return Rn(i.bytesValue).isEqual(Rn(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return pe(i.geoPointValue.latitude)===pe(s.geoPointValue.latitude)&&pe(i.geoPointValue.longitude)===pe(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return pe(i.integerValue)===pe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=pe(i.doubleValue),u=pe(s.doubleValue);return a===u?Ms(a)===Ms(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return si(r.arrayValue.values||[],e.arrayValue.values||[],Ut);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Dg(a)!==Dg(u))return!1;for(let c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!Ut(a[c],u[c])))return!1;return!0}(r,e);default:return U()}}function Ls(r,e){return(r.values||[]).find(t=>Ut(t,e))!==void 0}function xn(r,e){if(r===e)return 0;let t=ar(r),n=ar(e);if(t!==n)return W(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(r.booleanValue,e.booleanValue);case 2:return function(s,a){let u=pe(s.integerValue||s.doubleValue),c=pe(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return Rg(r.timestampValue,e.timestampValue);case 4:return Rg(Os(r),Os(e));case 5:return W(r.stringValue,e.stringValue);case 6:return function(s,a){let u=Rn(s),c=Rn(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){let u=s.split("/"),c=a.split("/");for(let d=0;d<u.length&&d<c.length;d++){let f=W(u[d],c[d]);if(f!==0)return f}return W(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){let u=W(pe(s.latitude),pe(a.latitude));return u!==0?u:W(pe(s.longitude),pe(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Vg(r.arrayValue,e.arrayValue);case 10:return function(s,a){var u,c,d,f;let m=s.fields||{},_=a.fields||{},A=(u=m.value)===null||u===void 0?void 0:u.arrayValue,x=(c=_.value)===null||c===void 0?void 0:c.arrayValue,N=W(((d=A?.values)===null||d===void 0?void 0:d.length)||0,((f=x?.values)===null||f===void 0?void 0:f.length)||0);return N!==0?N:Vg(A,x)}(r.mapValue,e.mapValue);case 11:return function(s,a){if(s===Cn.mapValue&&a===Cn.mapValue)return 0;if(s===Cn.mapValue)return 1;if(a===Cn.mapValue)return-1;let u=s.fields||{},c=Object.keys(u),d=a.fields||{},f=Object.keys(d);c.sort(),f.sort();for(let m=0;m<c.length&&m<f.length;++m){let _=W(c[m],f[m]);if(_!==0)return _;let A=xn(u[c[m]],d[f[m]]);if(A!==0)return A}return W(c.length,f.length)}(r.mapValue,e.mapValue);default:throw U()}}function Rg(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return W(r,e);let t=Zt(r),n=Zt(e),i=W(t.seconds,n.seconds);return i!==0?i:W(t.nanos,n.nanos)}function Vg(r,e){let t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){let s=xn(t[i],n[i]);if(s)return s}return W(t.length,n.length)}function ai(r){return Vl(r)}function Vl(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){let n=Zt(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return Rn(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return L.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=Vl(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${Vl(t.fields[a])}`;return i+"}"}(r.mapValue):U()}function ur(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function xl(r){return!!r&&"integerValue"in r}function Us(r){return!!r&&"arrayValue"in r}function xg(r){return!!r&&"nullValue"in r}function kg(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ma(r){return!!r&&"mapValue"in r}function gu(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ds(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return yr(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Ds(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ds(r.arrayValue.values[t]);return e}return Object.assign({},r)}function q_(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var B_={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function uE(r){return"nullValue"in r?pa:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?ur(Vn.empty(),L.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?gu(r)?B_:{mapValue:{}}:U()}function cE(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?ur(Vn.empty(),L.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?B_:"mapValue"in r?gu(r)?{mapValue:{}}:Cn:U()}function Ng(r,e){let t=xn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function Mg(r,e){let t=xn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}var We=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ma(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ds(t)}setAll(e){let t=Ee.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=Ds(a):i.push(u.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());ma(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ut(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];ma(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){yr(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(Ds(this.value))}};function j_(r){let e=[];return yr(r.fields,(t,n)=>{let i=new Ee([t]);if(ma(n)){let s=j_(n.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new lt(e)}var Re=class r{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new r(e,0,$.min(),$.min(),$.min(),We.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,$.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,$.min(),$.min(),We.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,$.min(),$.min(),We.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=We.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=We.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var qt=class{constructor(e,t){this.position=e,this.inclusive=t}};function Fg(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],a=r.position[i];if(s.field.isKeyField()?n=L.comparator(L.fromName(a.referenceValue),t.key):n=xn(a,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Og(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Ut(r.position[t],e.position[t]))return!1;return!0}var cr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function lE(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}var Ca=class{},te=class r extends Ca{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Ml(e,t,n):t==="array-contains"?new Ll(e,n):t==="in"?new Sa(e,n):t==="not-in"?new Ul(e,n):t==="array-contains-any"?new ql(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Fl(e,n):new Ol(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(xn(t,this.value)):t!==null&&ar(this.value)===ar(t)&&this.matchesComparison(xn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ae=class r extends Ca{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new r(e,t)}matches(e){return ui(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function ui(r){return r.op==="and"}function kl(r){return r.op==="or"}function Ad(r){return $_(r)&&ui(r)}function $_(r){for(let e of r.filters)if(e instanceof ae)return!1;return!0}function Nl(r){if(r instanceof te)return r.field.canonicalString()+r.op.toString()+ai(r.value);if(Ad(r))return r.filters.map(e=>Nl(e)).join(",");{let e=r.filters.map(t=>Nl(t)).join(",");return`${r.op}(${e})`}}function G_(r,e){return r instanceof te?function(n,i){return i instanceof te&&n.op===i.op&&n.field.isEqual(i.field)&&Ut(n.value,i.value)}(r,e):r instanceof ae?function(n,i){return i instanceof ae&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&G_(a,i.filters[u]),!0):!1}(r,e):void U()}function z_(r,e){let t=r.filters.concat(e);return ae.create(t,r.op)}function K_(r){return r instanceof te?function(t){return`${t.field.canonicalString()} ${t.op} ${ai(t.value)}`}(r):r instanceof ae?function(t){return t.op.toString()+" {"+t.getFilters().map(K_).join(" ,")+"}"}(r):"Filter"}var Ml=class extends te{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},Fl=class extends te{constructor(e,t){super(e,"in",t),this.keys=W_("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Ol=class extends te{constructor(e,t){super(e,"not-in",t),this.keys=W_("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function W_(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>L.fromName(n.referenceValue))}var Ll=class extends te{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Us(t)&&Ls(t.arrayValue,this.value)}},Sa=class extends te{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ls(this.value.arrayValue,t)}},Ul=class extends te{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ls(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Ls(this.value.arrayValue,t)}},ql=class extends te{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Us(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Ls(this.value.arrayValue,n))}};var Bl=class{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function jl(r,e=null,t=[],n=[],i=null,s=null,a=null){return new Bl(r,e,t,n,i,s,a)}function lr(r){let e=O(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Nl(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),ro(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>ai(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>ai(n)).join(",")),e.ue=t}return e.ue}function io(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!lE(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!G_(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Og(r.startAt,e.startAt)&&Og(r.endAt,e.endAt)}function Pa(r){return L.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Da(r,e){return r.filters.filter(t=>t instanceof te&&t.field.isEqual(e))}function Lg(r,e,t){let n=pa,i=!0;for(let s of Da(r,e)){let a=pa,u=!0;switch(s.op){case"<":case"<=":a=uE(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=pa}Ng({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let a=t.position[s];Ng({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}}return{value:n,inclusive:i}}function Ug(r,e,t){let n=Cn,i=!0;for(let s of Da(r,e)){let a=Cn,u=!0;switch(s.op){case">=":case">":a=cE(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Cn}Mg({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let a=t.position[s];Mg({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}}return{value:n,inclusive:i}}var bt=class{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function H_(r,e,t,n,i,s,a,u){return new bt(r,e,t,n,i,s,a,u)}function Ti(r){return new bt(r)}function qg(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function bd(r){return r.collectionGroup!==null}function ri(r){let e=O(r);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new le(Ee.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new cr(s,n))}),t.has(Ee.keyField().canonicalString())||e.ce.push(new cr(Ee.keyField(),n))}return e.ce}function Ze(r){let e=O(r);return e.le||(e.le=hE(e,ri(r))),e.le}function hE(r,e){if(r.limitType==="F")return jl(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new cr(i.field,s)});let t=r.endAt?new qt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new qt(r.startAt.position,r.startAt.inclusive):null;return jl(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function $l(r,e){let t=r.filters.concat([e]);return new bt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Ra(r,e,t){return new bt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function so(r,e){return io(Ze(r),Ze(e))&&r.limitType===e.limitType}function Q_(r){return`${lr(Ze(r))}|lt:${r.limitType}`}function Xr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>K_(i)).join(", ")}]`),ro(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>ai(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>ai(i)).join(",")),`Target(${n})`}(Ze(r))}; limitType=${r.limitType})`}function oo(r,e){return e.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):L.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(let s of ri(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(a,u,c){let d=Fg(a,u,c);return a.inclusive?d<=0:d<0}(n.startAt,ri(n),i)||n.endAt&&!function(a,u,c){let d=Fg(a,u,c);return a.inclusive?d>=0:d>0}(n.endAt,ri(n),i))}(r,e)}function J_(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function X_(r){return(e,t)=>{let n=!1;for(let i of ri(r)){let s=dE(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function dE(r,e,t){let n=r.field.isKeyField()?L.comparator(e.key,t.key):function(s,a,u){let c=a.data.field(s),d=u.data.field(s);return c!==null&&d!==null?xn(c,d):U()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return U()}}var Bt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){yr(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return L_(this.inner)}size(){return this.innerSize}};var fE=new fe(L.comparator);function it(){return fE}var Y_=new fe(L.comparator);function Ss(...r){let e=Y_;for(let t of r)e=e.insert(t.key,t);return e}function Z_(r){let e=Y_;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Mt(){return Rs()}function ey(){return Rs()}function Rs(){return new Bt(r=>r.toString(),(r,e)=>r.isEqual(e))}var pE=new fe(L.comparator),mE=new le(L.comparator);function J(...r){let e=mE;for(let t of r)e=e.add(t);return e}var gE=new le(W);function Cd(){return gE}function Sd(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ms(e)?"-0":e}}function ty(r){return{integerValue:""+r}}function ny(r,e){return k_(e)?ty(e):Sd(r,e)}var ci=class{constructor(){this._=void 0}};function _E(r,e,t){return r instanceof kn?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&mu(s)&&(s=Td(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof en?iy(r,e):r instanceof tn?sy(r,e):function(i,s){let a=ry(i,s),u=Bg(a)+Bg(i.Pe);return xl(a)&&xl(i.Pe)?ty(u):Sd(i.serializer,u)}(r,e)}function yE(r,e,t){return r instanceof en?iy(r,e):r instanceof tn?sy(r,e):t}function ry(r,e){return r instanceof Nn?function(n){return xl(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}var kn=class extends ci{},en=class extends ci{constructor(e){super(),this.elements=e}};function iy(r,e){let t=oy(e);for(let n of r.elements)t.some(i=>Ut(i,n))||t.push(n);return{arrayValue:{values:t}}}var tn=class extends ci{constructor(e){super(),this.elements=e}};function sy(r,e){let t=oy(e);for(let n of r.elements)t=t.filter(i=>!Ut(i,n));return{arrayValue:{values:t}}}var Nn=class extends ci{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function Bg(r){return pe(r.integerValue||r.doubleValue)}function oy(r){return Us(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var hr=class{constructor(e,t){this.field=e,this.transform=t}};function vE(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof en&&i instanceof en||n instanceof tn&&i instanceof tn?si(n.elements,i.elements,Ut):n instanceof Nn&&i instanceof Nn?Ut(n.Pe,i.Pe):n instanceof kn&&i instanceof kn}(r.transform,e.transform)}var Gl=class{constructor(e,t){this.version=e,this.transformResults=t}},ve=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ga(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}var li=class{};function ay(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Fn(r.key,ve.none()):new Mn(r.key,r.data,ve.none());{let t=r.data,n=We.empty(),i=new le(Ee.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new Ct(r.key,n,new lt(i.toArray()),ve.none())}}function wE(r,e,t){r instanceof Mn?function(i,s,a){let u=i.value.clone(),c=$g(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof Ct?function(i,s,a){if(!ga(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=$g(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(uy(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Vs(r,e,t,n){return r instanceof Mn?function(s,a,u,c){if(!ga(s.precondition,a))return u;let d=s.value.clone(),f=Gg(s.fieldTransforms,c,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,e,t,n):r instanceof Ct?function(s,a,u,c){if(!ga(s.precondition,a))return u;let d=Gg(s.fieldTransforms,c,a),f=a.data;return f.setAll(uy(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(r,e,t,n):function(s,a,u){return ga(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,e,t)}function EE(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=ry(n.transform,i||null);s!=null&&(t===null&&(t=We.empty()),t.set(n.field,s))}return t||null}function jg(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&si(n,i,(s,a)=>vE(s,a))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}var Mn=class extends li{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ct=class extends li{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function uy(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function $g(r,e,t){let n=new Map;B(r.length===t.length);for(let i=0;i<t.length;i++){let s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,yE(a,u,t[i]))}return n}function Gg(r,e,t){let n=new Map;for(let i of r){let s=i.transform,a=t.data.field(i.field);n.set(i.field,_E(s,a,e))}return n}var Fn=class extends li{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},qs=class extends li{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Bs=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&wE(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=Vs(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=Vs(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=ey();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;let c=ay(a,u);c!==null&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument($.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),J())}isEqual(e){return this.batchId===e.batchId&&si(this.mutations,e.mutations,(t,n)=>jg(t,n))&&si(this.baseMutations,e.baseMutations,(t,n)=>jg(t,n))}},zl=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){B(e.mutations.length===n.length);let i=function(){return pE}(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(e,t,n,i)}};var js=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Kl=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ce,re;function cy(r){switch(r){default:return U();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0}}function ly(r){if(r===void 0)return we("GRPC error has no .code"),S.UNKNOWN;switch(r){case Ce.OK:return S.OK;case Ce.CANCELLED:return S.CANCELLED;case Ce.UNKNOWN:return S.UNKNOWN;case Ce.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case Ce.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case Ce.INTERNAL:return S.INTERNAL;case Ce.UNAVAILABLE:return S.UNAVAILABLE;case Ce.UNAUTHENTICATED:return S.UNAUTHENTICATED;case Ce.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case Ce.NOT_FOUND:return S.NOT_FOUND;case Ce.ALREADY_EXISTS:return S.ALREADY_EXISTS;case Ce.PERMISSION_DENIED:return S.PERMISSION_DENIED;case Ce.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case Ce.ABORTED:return S.ABORTED;case Ce.OUT_OF_RANGE:return S.OUT_OF_RANGE;case Ce.UNIMPLEMENTED:return S.UNIMPLEMENTED;case Ce.DATA_LOSS:return S.DATA_LOSS;default:return U()}}(re=Ce||(Ce={}))[re.OK=0]="OK",re[re.CANCELLED=1]="CANCELLED",re[re.UNKNOWN=2]="UNKNOWN",re[re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",re[re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",re[re.NOT_FOUND=5]="NOT_FOUND",re[re.ALREADY_EXISTS=6]="ALREADY_EXISTS",re[re.PERMISSION_DENIED=7]="PERMISSION_DENIED",re[re.UNAUTHENTICATED=16]="UNAUTHENTICATED",re[re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",re[re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",re[re.ABORTED=10]="ABORTED",re[re.OUT_OF_RANGE=11]="OUT_OF_RANGE",re[re.UNIMPLEMENTED=12]="UNIMPLEMENTED",re[re.INTERNAL=13]="INTERNAL",re[re.UNAVAILABLE=14]="UNAVAILABLE",re[re.DATA_LOSS=15]="DATA_LOSS";var zg=null;function hy(){return new TextEncoder}var IE=new En([4294967295,4294967295],0);function Kg(r){let e=hy().encode(r),t=new al;return t.update(e),new Uint8Array(t.digest())}function Wg(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new En([t,n],0),new En([i,s],0)]}var Wl=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new sr(`Invalid padding: ${t}`);if(n<0)throw new sr(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new sr(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new sr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=En.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(En.fromNumber(n)));return i.compare(IE)===1&&(i=new En([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Kg(e),[n,i]=Wg(t);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new r(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(this.Ie===0)return;let t=Kg(e),[n,i]=Wg(t);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},sr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var $s=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,Gs.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r($.min(),i,new fe(W),it(),J())}},Gs=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,J(),J(),J())}};var ii=class{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}},Va=class{constructor(e,t){this.targetId=e,this.me=t}},xa=class{constructor(e,t,n=Te.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},ka=class{constructor(){this.fe=0,this.ge=Qg(),this.pe=Te.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=J(),t=J(),n=J();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:U()}}),new Gs(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=Qg()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,B(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Hl=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=it(),this.qe=Hg(),this.Qe=new fe(W)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,n=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Pa(s))if(n===0){let a=new L(s.path);this.Ue(t,a,Re.newNoDocument(a,$.min()))}else B(n===1);else{let a=this.Ye(t);if(a!==n){let u=this.Ze(e),c=u?this.Xe(u,e,a):1;if(c!==0){this.je(t);let d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}zg?.et(function(f,m,_,A,x){var N,R,G,z,F,K;let H={localCacheCount:f,existenceFilterCount:m.count,databaseId:_.database,projectId:_.projectId},Q=m.unchangedNames;return Q&&(H.bloomFilter={applied:x===0,hashCount:(N=Q?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(z=(G=(R=Q?.bits)===null||R===void 0?void 0:R.bitmap)===null||G===void 0?void 0:G.length)!==null&&z!==void 0?z:0,padding:(K=(F=Q?.bits)===null||F===void 0?void 0:F.padding)!==null&&K!==void 0?K:0,mightContain:w=>{var g;return(g=A?.mightContain(w))!==null&&g!==void 0&&g}}),H}(a,e.me,this.Le.tt(),u,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,a,u;try{a=Rn(n).toUint8Array()}catch(c){if(c instanceof ba)return mt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Wl(a,i,s)}catch(c){return mt(c instanceof sr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.Ie===0?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,a)=>{let u=this.Je(a);if(u){if(s.current&&Pa(u.target)){let c=new L(u.target.path);this.ke.get(c)!==null||this.it(a,c)||this.Ue(a,c,Re.newNoDocument(c,e))}s.be&&(t.set(a,s.ve()),s.Ce())}});let n=J();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{let d=this.Je(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));let i=new $s(e,t,this.Qe,this.ke,n);return this.ke=it(),this.qe=Hg(),this.Qe=new fe(W),i}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new ka,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new le(W),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||k("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new ka),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Hg(){return new fe(L.comparator)}function Qg(){return new fe(L.comparator)}var TE={asc:"ASCENDING",desc:"DESCENDING"},AE={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},bE={and:"AND",or:"OR"},Ql=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Jl(r,e){return r.useProto3Json||ro(e)?e:{value:e}}function hi(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function dy(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function CE(r,e){return hi(r,e.toTimestamp())}function Ie(r){return B(!!r),$.fromTimestamp(function(t){let n=Zt(t);return new _e(n.seconds,n.nanos)}(r))}function Pd(r,e){return Xl(r,e).canonicalString()}function Xl(r,e){let t=function(i){return new ie(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function fy(r){let e=ie.fromString(r);return B(Ty(e)),e}function zs(r,e){return Pd(r.databaseId,e.path)}function Ot(r,e){let t=fy(e);if(t.get(1)!==r.databaseId.projectId)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new L(gy(t))}function py(r,e){return Pd(r.databaseId,e)}function my(r){let e=fy(r);return e.length===4?ie.emptyPath():gy(e)}function Yl(r){return new ie(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function gy(r){return B(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Jg(r,e,t){return{name:zs(r,e),fields:t.value.mapValue.fields}}function _y(r,e,t){let n=Ot(r,e.name),i=Ie(e.updateTime),s=e.createTime?Ie(e.createTime):$.min(),a=new We({mapValue:{fields:e.fields}}),u=Re.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function SE(r,e){return"found"in e?function(n,i){B(!!i.found),i.found.name,i.found.updateTime;let s=Ot(n,i.found.name),a=Ie(i.found.updateTime),u=i.found.createTime?Ie(i.found.createTime):$.min(),c=new We({mapValue:{fields:i.found.fields}});return Re.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){B(!!i.missing),B(!!i.readTime);let s=Ot(n,i.missing),a=Ie(i.readTime);return Re.newNoDocument(s,a)}(r,e):U()}function PE(r,e){let t;if("targetChange"in e){e.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:U()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(B(f===void 0||typeof f=="string"),Te.fromBase64String(f||"")):(B(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Te.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(d){let f=d.code===void 0?S.UNKNOWN:ly(d.code);return new V(f,d.message||"")}(a);t=new xa(n,i,s,u||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=Ot(r,n.document.name),s=Ie(n.document.updateTime),a=n.document.createTime?Ie(n.document.createTime):$.min(),u=new We({mapValue:{fields:n.document.fields}}),c=Re.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];t=new ii(d,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=Ot(r,n.document),s=n.readTime?Ie(n.readTime):$.min(),a=Re.newNoDocument(i,s),u=n.removedTargetIds||[];t=new ii([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=Ot(r,n.document),s=n.removedTargetIds||[];t=new ii([],s,i,null)}else{if(!("filter"in e))return U();{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new Kl(i,s),u=n.targetId;t=new Va(u,a)}}return t}function Ks(r,e){let t;if(e instanceof Mn)t={update:Jg(r,e.key,e.value)};else if(e instanceof Fn)t={delete:zs(r,e.key)};else if(e instanceof Ct)t={update:Jg(r,e.key,e.data),updateMask:NE(e.fieldMask)};else{if(!(e instanceof qs))return U();t={verify:zs(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof kn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof en)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof tn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Nn)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw U()}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:CE(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:U()}(r,e.precondition)),t}function Zl(r,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?ve.updateTime(Ie(s.updateTime)):s.exists!==void 0?ve.exists(s.exists):ve.none()}(e.currentDocument):ve.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;if("setToServerValue"in u)B(u.setToServerValue==="REQUEST_TIME"),c=new kn;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new en(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new tn(f)}else"increment"in u?c=new Nn(a,u.increment):U();let d=Ee.fromServerFormat(u.fieldPath);return new hr(d,c)}(r,i)):[];if(e.update){e.update.name;let i=Ot(r,e.update.name),s=new We({mapValue:{fields:e.update.fields}});if(e.updateMask){let a=function(c){let d=c.fieldPaths||[];return new lt(d.map(f=>Ee.fromServerFormat(f)))}(e.updateMask);return new Ct(i,s,a,t,n)}return new Mn(i,s,t,n)}if(e.delete){let i=Ot(r,e.delete);return new Fn(i,t)}if(e.verify){let i=Ot(r,e.verify);return new qs(i,t)}return U()}function DE(r,e){return r&&r.length>0?(B(e!==void 0),r.map(t=>function(i,s){let a=i.updateTime?Ie(i.updateTime):Ie(s);return a.isEqual($.min())&&(a=Ie(s)),new Gl(a,i.transformResults||[])}(t,e))):[]}function yy(r,e){return{documents:[py(r,e.path)]}}function vy(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=py(r,i);let s=function(d){if(d.length!==0)return Iy(ae.create(d,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(_){return{field:Yr(_.field),direction:VE(_.dir)}}(f))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=Jl(r,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:i}}function wy(r){let e=my(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){B(n===1);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(m){let _=Ey(m);return _ instanceof ae&&Ad(_)?_.getFilters():[_]}(t.where));let a=[];t.orderBy&&(a=function(m){return m.map(_=>function(x){return new cr(Zr(x.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(_))}(t.orderBy));let u=null;t.limit&&(u=function(m){let _;return _=typeof m=="object"?m.value:m,ro(_)?null:_}(t.limit));let c=null;t.startAt&&(c=function(m){let _=!!m.before,A=m.values||[];return new qt(A,_)}(t.startAt));let d=null;return t.endAt&&(d=function(m){let _=!m.before,A=m.values||[];return new qt(A,_)}(t.endAt)),H_(e,i,a,s,u,"F",c,d)}function RE(r,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Ey(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=Zr(t.unaryFilter.field);return te.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Zr(t.unaryFilter.field);return te.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Zr(t.unaryFilter.field);return te.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Zr(t.unaryFilter.field);return te.create(a,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(r):r.fieldFilter!==void 0?function(t){return te.create(Zr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return ae.create(t.compositeFilter.filters.map(n=>Ey(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U()}}(t.compositeFilter.op))}(r):U()}function VE(r){return TE[r]}function xE(r){return AE[r]}function kE(r){return bE[r]}function Yr(r){return{fieldPath:r.canonicalString()}}function Zr(r){return Ee.fromServerFormat(r.fieldPath)}function Iy(r){return r instanceof te?function(t){if(t.op==="=="){if(kg(t.value))return{unaryFilter:{field:Yr(t.field),op:"IS_NAN"}};if(xg(t.value))return{unaryFilter:{field:Yr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(kg(t.value))return{unaryFilter:{field:Yr(t.field),op:"IS_NOT_NAN"}};if(xg(t.value))return{unaryFilter:{field:Yr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yr(t.field),op:xE(t.op),value:t.value}}}(r):r instanceof ae?function(t){let n=t.getFilters().map(i=>Iy(i));return n.length===1?n[0]:{compositeFilter:{op:kE(t.op),filters:n}}}(r):U()}function NE(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Ty(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var di=class r{constructor(e,t,n,i,s=$.min(),a=$.min(),u=Te.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Na=class{constructor(e){this.ct=e}};function ME(r,e){let t;if(e.document)t=_y(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=L.fromSegments(e.noDocument.path),i=fr(e.noDocument.readTime);t=Re.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U();{let n=L.fromSegments(e.unknownDocument.path),i=fr(e.unknownDocument.version);t=Re.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){let s=new _e(i[0],i[1]);return $.fromTimestamp(s)}(e.readTime)),t}function Xg(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ma(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,a){return{name:zs(s,a.key),fields:a.data.value.mapValue.fields,updateTime:hi(s,a.version.toTimestamp()),createTime:hi(s,a.createTime.toTimestamp())}}(r.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:dr(e.version)};else{if(!e.isUnknownDocument())return U();n.unknownDocument={path:t.path.toArray(),version:dr(e.version)}}return n}function Ma(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function dr(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function fr(r){let e=new _e(r.seconds,r.nanoseconds);return $.fromTimestamp(e)}function nr(r,e){let t=(e.baseMutations||[]).map(s=>Zl(r.ct,s));for(let s=0;s<e.mutations.length-1;++s){let a=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let u=e.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>Zl(r.ct,s)),i=_e.fromMillis(e.localWriteTimeMs);return new Bs(e.batchId,i,t,n)}function Ps(r){let e=fr(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?fr(r.lastLimboFreeSnapshotVersion):$.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return B(s.documents.length===1),Ze(Ti(my(s.documents[0])))}(r.query):function(s){return Ze(wy(s))}(r.query),new di(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Te.fromBase64String(r.resumeToken))}function Ay(r,e){let t=dr(e.snapshotVersion),n=dr(e.lastLimboFreeSnapshotVersion),i;i=Pa(e.target)?yy(r.ct,e.target):vy(r.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:lr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function Dd(r){let e=wy({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Ra(e,e.limit,"L"):e}function pl(r,e){return new js(e.largestBatchId,Zl(r.ct,e.overlayMutation))}function Yg(r,e){let t=e.path.lastSegment();return[r,Ye(e.path.popLast()),t]}function Zg(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:dr(n.readTime),documentKey:Ye(n.documentKey.path),largestBatchId:n.largestBatchId}}var eh=class{getBundleMetadata(e,t){return e_(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:fr(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return e_(e).put(function(i){return{bundleId:i.id,createTime:dr(Ie(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return t_(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:Dd(s.bundledQuery),readTime:fr(s.readTime)}}(n)})}saveNamedQuery(e,t){return t_(e).put(function(i){return{name:i.name,readTime:dr(Ie(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function e_(r){return xe(r,"bundles")}function t_(r){return xe(r,"namedQueries")}var Fa=class r{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new r(e,n)}getOverlay(e,t){return Ts(e).get(Yg(this.userId,t)).next(n=>n?pl(this.serializer,n):null)}getOverlays(e,t){let n=Mt();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,a)=>{let u=new js(t,a);i.push(this.ht(e,u))}),C.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(a=>i.add(Ye(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(Ts(e).j("collectionPathOverlayIndex",u))}),C.waitFor(s)}getOverlaysForCollection(e,t,n){let i=Mt(),s=Ye(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ts(e).U("collectionPathOverlayIndex",a).next(u=>{for(let c of u){let d=pl(this.serializer,c);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s=Mt(),a,u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ts(e).J({index:"collectionGroupOverlayIndex",range:u},(c,d,f)=>{let m=pl(this.serializer,d);s.size()<i||m.largestBatchId===a?(s.set(m.getKey(),m),a=m.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Ts(e).put(function(i,s,a){let[u,c,d]=Yg(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Ks(i.ct,a.mutation)}}(this.serializer,this.userId,t))}};function Ts(r){return xe(r,"documentOverlays")}var th=class{Pt(e){return xe(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let n=t?.value;return n?Te.fromUint8Array(n):Te.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var Xt=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(pe(e.integerValue));else if("doubleValue"in e){let n=pe(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Ms(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=Zt(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Rn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?q_(e)?this.dt(t,Number.MAX_SAFE_INTEGER):gu(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):U()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let n=e.fields||{};this.dt(t,55);for(let i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;let s=e.fields||{};this.dt(t,53);let a="value",u=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(pe(u)),this.Vt(a,t),this.Tt(s[a],t)}bt(e,t){let n=e.values||[];this.dt(t,50);for(let i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),L.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};Xt.vt=new Xt;function FE(r){if(r===0)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function n_(r){let e=64-function(n){let i=0;for(let s=0;s<8;++s){let a=FE(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(e/8)}var nh=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),n=n_(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),n=n_(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},rh=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},ih=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},rr=class{constructor(){this.jt=new nh,this.Ht=new rh(this.jt),this.Jt=new ih(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var ir=class r{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function In(r,e){let t=r.indexId-e.indexId;return t!==0?t:(t=r_(r.arrayValue,e.arrayValue),t!==0?t:(t=r_(r.directionalValue,e.directionalValue),t!==0?t:L.comparator(r.documentKey,e.documentKey)))}function r_(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}var Oa=class{constructor(e){this.Xt=new le((t,n)=>Ee.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(B(e.collectionGroup===this.collectionId),this.nn)return!1;let t=bl(e);if(t!==void 0&&!this.sn(t))return!1;let n=er(e),i=new Set,s=0,a=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){let u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=n[s];if(!this.on(u,c)||!this._n(this.en[a++],c))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.en.length||!this._n(this.en[a++],u))return!1}return!0}an(){if(this.nn)return null;let e=new le(Ee.comparator),t=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new ni(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new ni(n.field,0))}for(let n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new ni(n.field,n.dir==="asc"?0:1)));return new oi(oi.UNKNOWN_ID,this.collectionId,t,Ns.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function by(r){var e,t;if(B(r instanceof te||r instanceof ae),r instanceof te){if(r instanceof Sa){let i=((t=(e=r.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>te.create(r.field,"==",s)))||[];return ae.create(i,"or")}return r}let n=r.filters.map(i=>by(i));return ae.create(n,r.op)}function OE(r){if(r.getFilters().length===0)return[];let e=ah(by(r));return B(Cy(e)),sh(e)||oh(e)?[e]:e.getFilters()}function sh(r){return r instanceof te}function oh(r){return r instanceof ae&&Ad(r)}function Cy(r){return sh(r)||oh(r)||function(t){if(t instanceof ae&&kl(t)){for(let n of t.getFilters())if(!sh(n)&&!oh(n))return!1;return!0}return!1}(r)}function ah(r){if(B(r instanceof te||r instanceof ae),r instanceof te)return r;if(r.filters.length===1)return ah(r.filters[0]);let e=r.filters.map(n=>ah(n)),t=ae.create(e,r.op);return t=La(t),Cy(t)?t:(B(t instanceof ae),B(ui(t)),B(t.filters.length>1),t.filters.reduce((n,i)=>Rd(n,i)))}function Rd(r,e){let t;return B(r instanceof te||r instanceof ae),B(e instanceof te||e instanceof ae),t=r instanceof te?e instanceof te?function(i,s){return ae.create([i,s],"and")}(r,e):i_(r,e):e instanceof te?i_(e,r):function(i,s){if(B(i.filters.length>0&&s.filters.length>0),ui(i)&&ui(s))return z_(i,s.getFilters());let a=kl(i)?i:s,u=kl(i)?s:i,c=a.filters.map(d=>Rd(d,u));return ae.create(c,"or")}(r,e),La(t)}function i_(r,e){if(ui(e))return z_(e,r.getFilters());{let t=e.filters.map(n=>Rd(r,n));return ae.create(t,"or")}}function La(r){if(B(r instanceof te||r instanceof ae),r instanceof te)return r;let e=r.getFilters();if(e.length===1)return La(e[0]);if($_(r))return r;let t=e.map(i=>La(i)),n=[];return t.forEach(i=>{i instanceof te?n.push(i):i instanceof ae&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:ae.create(n,r.op)}var uh=class{constructor(){this.un=new Ws}addToCollectionParentIndex(e,t){return this.un.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(gt.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(gt.min())}updateCollectionGroup(e,t,n){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},Ws=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new le(ie.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new le(ie.comparator)).toArray()}};var ca=new Uint8Array(0),ch=class{constructor(e,t){this.databaseId=t,this.cn=new Ws,this.ln=new Bt(n=>lr(n),(n,i)=>io(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:n,parent:Ye(i)};return s_(e).put(s)}return C.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[P_(t),""],!1,!0);return s_(e).U(i).next(s=>{for(let a of s){if(a.collectionId!==t)break;n.push(Nt(a.parent))}return n})}addFieldIndex(e,t){let n=As(e),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;let s=n.add(i);if(t.indexState){let a=Hr(e);return s.next(u=>{a.put(Zg(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=As(e),i=Hr(e),s=Wr(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=As(e),n=Wr(e),i=Hr(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return C.forEach(this.hn(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new Oa(n).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=Wr(e),i=!0,s=new Map;return C.forEach(this.hn(t),a=>this.Pn(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=J(),u=[];return C.forEach(s,(c,d)=>{k("IndexedDbIndexManager",`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(K=>`${K.fieldPath}:${K.kind}`).join(",")}`}(c)} to execute ${lr(t)}`);let f=function(F,K){let H=bl(K);if(H===void 0)return null;for(let Q of Da(F,H.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(d,c),m=function(F,K){let H=new Map;for(let Q of er(K))for(let w of Da(F,Q.fieldPath))switch(w.op){case"==":case"in":H.set(Q.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return H.set(Q.fieldPath.canonicalString(),w.value),Array.from(H.values())}return null}(d,c),_=function(F,K){let H=[],Q=!0;for(let w of er(K)){let g=w.kind===0?Lg(F,w.fieldPath,F.startAt):Ug(F,w.fieldPath,F.startAt);H.push(g.value),Q&&(Q=g.inclusive)}return new qt(H,Q)}(d,c),A=function(F,K){let H=[],Q=!0;for(let w of er(K)){let g=w.kind===0?Ug(F,w.fieldPath,F.endAt):Lg(F,w.fieldPath,F.endAt);H.push(g.value),Q&&(Q=g.inclusive)}return new qt(H,Q)}(d,c),x=this.In(c,d,_),N=this.In(c,d,A),R=this.Tn(c,d,m),G=this.En(c.indexId,f,x,_.inclusive,N,A.inclusive,R);return C.forEach(G,z=>n.G(z,t.limit).next(F=>{F.forEach(K=>{let H=L.fromSegments(K.documentKey);a.has(H)||(a=a.add(H),u.push(H))})}))}).next(()=>u)}return C.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=OE(ae.create(e.filters,"and")).map(n=>jl(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,i,s,a,u){let c=(t!=null?t.length:1)*Math.max(n.length,s.length),d=c/(t!=null?t.length:1),f=[];for(let m=0;m<c;++m){let _=t?this.dn(t[m/d]):ca,A=this.An(e,_,n[m%d],i),x=this.Rn(e,_,s[m%d],a),N=u.map(R=>this.An(e,_,R,!0));f.push(...this.createRange(A,x,N))}return f}An(e,t,n,i){let s=new ir(e,L.empty(),t,n);return i?s:s.Zt()}Rn(e,t,n,i){let s=new ir(e,L.empty(),t,n);return i?s.Zt():s}Pn(e,t){let n=new Oa(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(let u of s)n.rn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2,i=this.hn(t);return C.forEach(i,s=>this.Pn(e,s).next(a=>{a?n!==0&&a.fields.length<function(c){let d=new le(Ee.comparator),f=!1;for(let m of c.filters)for(let _ of m.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let m of c.orderBy)m.field.isKeyField()||(d=d.add(m.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(t)&&i.length>1&&n===2?1:n)}Vn(e,t){let n=new rr;for(let i of er(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let a=n.Yt(i.kind);Xt.vt.It(s,a)}return n.zt()}dn(e){let t=new rr;return Xt.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let n=new rr;return Xt.vt.It(ur(this.databaseId,t),n.Yt(function(s){let a=er(s);return a.length===0?0:a[a.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let i=[];i.push(new rr);let s=0;for(let a of er(e)){let u=n[s++];for(let c of i)if(this.fn(t,a.fieldPath)&&Us(u))i=this.gn(i,a,u);else{let d=c.Yt(a.kind);Xt.vt.It(u,d)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){let i=[...e],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let c=new rr;c.seed(u.zt()),Xt.vt.It(a,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof te&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=As(e),i=Hr(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{let a=[];return C.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,m){let _=m?new Ns(m.sequenceNumber,new gt(fr(m.readTime),new L(Nt(m.documentKey)),m.largestBatchId)):Ns.empty(),A=f.fields.map(([x,N])=>new ni(Ee.fromServerFormat(x),N));return new oi(f.indexId,f.collectionGroup,A,_)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:W(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=As(e),s=Hr(e);return this.yn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>C.forEach(u,c=>s.put(Zg(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){let n=new Map;return C.forEach(t,(i,s)=>{let a=n.get(i.collectionGroup);return(a?C.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),C.forEach(u,c=>this.wn(e,i,c).next(d=>{let f=this.Sn(s,c);return d.isEqual(f)?C.resolve():this.bn(e,s,c,d,f)}))))})}Dn(e,t,n,i){return Wr(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return Wr(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){let i=Wr(e),s=new le(In);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(a,u)=>{s=s.add(new ir(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(e,t){let n=new le(In),i=this.Vn(t,e);if(i==null)return n;let s=bl(t);if(s!=null){let a=e.data.field(s.fieldPath);if(Us(a))for(let u of a.arrayValue.values||[])n=n.add(new ir(t.indexId,e.key,this.dn(u),i))}else n=n.add(new ir(t.indexId,e.key,ca,i));return n}bn(e,t,n,i,s){k("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let a=[];return function(c,d,f,m,_){let A=c.getIterator(),x=d.getIterator(),N=Kr(A),R=Kr(x);for(;N||R;){let G=!1,z=!1;if(N&&R){let F=f(N,R);F<0?z=!0:F>0&&(G=!0)}else N!=null?z=!0:G=!0;G?(m(R),R=Kr(x)):z?(_(N),N=Kr(A)):(N=Kr(A),R=Kr(x))}}(i,s,In,u=>{a.push(this.Dn(e,t,n,u))},u=>{a.push(this.vn(e,t,n,u))}),C.waitFor(a)}yn(e){let t=1;return Hr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>In(a,u)).filter((a,u,c)=>!u||In(a,c[u-1])!==0);let i=[];i.push(e);for(let a of n){let u=In(a,e),c=In(a,t);if(u===0)i[0]=e.Zt();else if(u>0&&c<0)i.push(a),i.push(a.Zt());else if(c>0)break}i.push(t);let s=[];for(let a=0;a<i.length;a+=2){if(this.Cn(i[a],i[a+1]))return[];let u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,ca,[]],c=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,ca,[]];s.push(IDBKeyRange.bound(u,c))}return s}Cn(e,t){return In(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(o_)}getMinOffset(e,t){return C.mapArray(this.hn(t),n=>this.Pn(e,n).next(i=>i||U())).next(o_)}};function s_(r){return xe(r,"collectionParents")}function Wr(r){return xe(r,"indexEntries")}function As(r){return xe(r,"indexConfiguration")}function Hr(r){return xe(r,"indexState")}function o_(r){B(r.length!==0);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;wd(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new gt(e.readTime,e.documentKey,t)}var a_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},pt=class r{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Sy(r,e,t){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId),u=0,c=n.J({range:a},(f,m,_)=>(u++,_.delete()));s.push(c.next(()=>{B(u===1)}));let d=[];for(let f of t.mutations){let m=N_(e,f.key.path,t.batchId);s.push(i.delete(m)),d.push(f.key)}return C.waitFor(s).next(()=>d)}function Ua(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw U();e=r.noDocument}return JSON.stringify(e).length}pt.DEFAULT_COLLECTION_PERCENTILE=10,pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pt.DEFAULT=new pt(41943040,pt.DEFAULT_COLLECTION_PERCENTILE,pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pt.DISABLED=new pt(-1,0,0);var qa=class r{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){B(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new r(s,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Tn(e).J({index:"userMutationsIndex",range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=ei(e),a=Tn(e);return a.add({}).next(u=>{B(typeof u=="number");let c=new Bs(u,t,n,i),d=function(A,x,N){let R=N.baseMutations.map(z=>Ks(A.ct,z)),G=N.mutations.map(z=>Ks(A.ct,z));return{userId:x,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:R,mutations:G}}(this.serializer,this.userId,c),f=[],m=new le((_,A)=>W(_.canonicalString(),A.canonicalString()));for(let _ of i){let A=N_(this.userId,_.key.path,u);m=m.add(_.key.path.popLast()),f.push(a.put(d)),f.push(s.put(A,$0))}return m.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Fn[u]=c.keys()}),C.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return Tn(e).get(t).next(n=>n?(B(n.userId===this.userId),nr(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?C.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Tn(e).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(B(u.batchId>=n),s=nr(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Tn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Tn(e).U("userMutationsIndex",t).next(n=>n.map(i=>nr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=fa(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return ei(e).J({range:i},(a,u,c)=>{let[d,f,m]=a,_=Nt(f);if(d===this.userId&&t.path.isEqual(_))return Tn(e).get(m).next(A=>{if(!A)throw U();B(A.userId===this.userId),s.push(nr(this.serializer,A))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new le(W),i=[];return t.forEach(s=>{let a=fa(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=ei(e).J({range:u},(d,f,m)=>{let[_,A,x]=d,N=Nt(A);_===this.userId&&s.path.isEqual(N)?n=n.add(x):m.done()});i.push(c)}),C.waitFor(i).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=fa(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new le(W);return ei(e).J({range:a},(c,d,f)=>{let[m,_,A]=c,x=Nt(_);m===this.userId&&n.isPrefixOf(x)?x.length===i&&(u=u.add(A)):f.done()}).next(()=>this.xn(e,u))}xn(e,t){let n=[],i=[];return t.forEach(s=>{i.push(Tn(e).get(s).next(a=>{if(a===null)throw U();B(a.userId===this.userId),n.push(nr(this.serializer,a))}))}),C.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Sy(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),C.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return C.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return ei(e).J({range:n},(s,a,u)=>{if(s[0]===this.userId){let c=Nt(s[1]);i.push(c)}else u.done()}).next(()=>{B(i.length===0)})})}containsKey(e,t){return Py(e,this.userId,t)}Nn(e){return Dy(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function Py(r,e,t){let n=fa(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return ei(r).J({range:s,H:!0},(u,c,d)=>{let[f,m,_]=u;f===e&&m===i&&(a=!0),d.done()}).next(()=>a)}function Tn(r){return xe(r,"mutations")}function ei(r){return xe(r,"documentMutations")}function Dy(r){return xe(r,"mutationQueues")}var fi=class r{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new r(0)}static kn(){return new r(-1)}};var lh=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let n=new fi(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>$.fromTimestamp(new _e(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Qr(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(B(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let i=0,s=[];return Qr(e).J((a,u)=>{let c=Ps(u);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>C.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Qr(e).J((n,i)=>{let s=Ps(i);t(s)})}qn(e){return u_(e).get("targetGlobalKey").next(t=>(B(t!==null),t))}Qn(e,t){return u_(e).put("targetGlobalKey",t)}Kn(e,t){return Qr(e).put(Ay(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=lr(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return Qr(e).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{let d=Ps(u);io(t,d.target)&&(s=d,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=An(e);return t.forEach(a=>{let u=Ye(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),C.waitFor(i)}removeMatchingKeys(e,t,n){let i=An(e);return C.forEach(t,s=>{let a=Ye(s.path);return C.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=An(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=An(e),s=J();return i.J({range:n,H:!0},(a,u,c)=>{let d=Nt(a[1]),f=new L(d);s=s.add(f)}).next(()=>s)}containsKey(e,t){let n=Ye(t.path),i=IDBKeyRange.bound([n],[P_(n)],!1,!0),s=0;return An(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}ot(e,t){return Qr(e).get(t).next(n=>n?Ps(n):null)}};function Qr(r){return xe(r,"targets")}function u_(r){return xe(r,"targetGlobal")}function An(r){return xe(r,"targetDocuments")}function c_([r,e],[t,n]){let i=W(r,t);return i===0?W(e,n):i}var hh=class{constructor(e){this.Un=e,this.buffer=new le(c_),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();c_(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},dh=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){k("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>D(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Un(t)?k("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Ln(t)}yield this.Hn(3e5)}))}},fh=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return C.resolve(ct.oe);let n=new hh(t);return this.Jn.forEachTarget(e,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(a_)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),a_):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,a,u,c,d,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,a=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(n=m,u=Date.now(),this.removeTargets(e,n,t))).next(m=>(s=m,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(m=>(d=Date.now(),Jr()<=xt.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${m} documents in `+(d-c)+`ms
Total Duration: ${d-f}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function LE(r,e){return new fh(r,e)}var ph=class{constructor(e,t){this.db=e,this.garbageCollector=LE(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,i)=>t(i))}addReference(e,t,n){return la(e,n)}removeReference(e,t,n){return la(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return la(e,t)}nr(e,t){return function(i,s){let a=!1;return Dy(i).Y(u=>Py(i,u,s).next(c=>(c&&(a=!0),C.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(a,u)=>{if(u<=t){let c=this.nr(e,a).next(d=>{if(!d)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,$.min()),An(e).delete(function(m){return[0,Ye(m.path)]}(a))))});i.push(c)}}).next(()=>C.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return la(e,t)}tr(e,t){let n=An(e),i,s=ct.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:d})=>{a===0?(s!==ct.oe&&t(new L(Nt(i)),s),s=d,i=c):s=ct.oe}).next(()=>{s!==ct.oe&&t(new L(Nt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function la(r,e){return An(r).put(function(n,i){return{targetId:0,path:Ye(n.path),sequenceNumber:i}}(e,r.currentSequenceNumber))}var Ba=class{constructor(){this.changes=new Bt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?C.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var mh=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Zn(e).put(n)}removeEntry(e,t,n){return Zn(e).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ma(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=Re.newInvalidDocument(t);return Zn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(bs(t))},(i,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:Re.newInvalidDocument(t)};return Zn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(bs(t))},(i,s)=>{n={document:this.ir(t,s),size:Ua(s)}}).next(()=>n)}getEntries(e,t){let n=it();return this._r(e,t,(i,s)=>{let a=this.ir(i,s);n=n.insert(i,a)}).next(()=>n)}ar(e,t){let n=it(),i=new fe(L.comparator);return this._r(e,t,(s,a)=>{let u=this.ir(s,a);n=n.insert(s,u),i=i.insert(s,Ua(a))}).next(()=>({documents:n,ur:i}))}_r(e,t,n){if(t.isEmpty())return C.resolve();let i=new le(d_);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(bs(i.first()),bs(i.last())),a=i.getIterator(),u=a.getNext();return Zn(e).J({index:"documentKeyIndex",range:s},(c,d,f)=>{let m=L.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&d_(u,m)<0;)n(u,null),u=a.getNext();u&&u.isEqual(m)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.$(bs(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let a=t.path,u=[a.popLast().toArray(),a.lastSegment(),Ma(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Zn(e).U(IDBKeyRange.bound(u,c,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=it();for(let m of d){let _=this.ir(L.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);_.isFoundDocument()&&(oo(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=it(),a=h_(t,n),u=h_(t,gt.max());return Zn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,d,f)=>{let m=this.ir(L.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(m.key,m),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new gh(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return l_(e).get("remoteDocumentGlobalKey").next(t=>(B(!!t),t))}rr(e,t){return l_(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let n=ME(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual($.min())))return n}return Re.newInvalidDocument(e)}};function Ry(r){return new mh(r)}var gh=class extends Ba{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Bt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new le((s,a)=>W(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,u.readTime)),a.isValidDocument()){let c=Xg(this.cr.serializer,a);i=i.add(s.path.popLast());let d=Ua(c);n+=d-u.size,t.push(this.cr.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){let c=Xg(this.cr.serializer,a.convertToNoDocument($.min()));t.push(this.cr.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),C.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:i})=>(i.forEach((s,a)=>{this.lr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function l_(r){return xe(r,"remoteDocumentGlobal")}function Zn(r){return xe(r,"remoteDocumentsV14")}function bs(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function h_(r,e){let t=e.documentKey.path.toArray();return[r,Ma(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function d_(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=W(t[s],n[s]),i)return i;return i=W(t.length,n.length),i||(i=W(t[t.length-2],n[n.length-2]),i||W(t[t.length-1],n[n.length-1]))}var _h=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var ja=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&Vs(n.mutation,i,lt.empty(),_e.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,J()).next(()=>n))}getLocalViewOfDocuments(e,t,n=J()){let i=Mt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=Ss();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let n=Mt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,J()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=it(),a=Rs(),u=function(){return Rs()}();return t.forEach((c,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof Ct)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Vs(f.mutation,d,f.mutation.getFieldMask(),_e.now())):a.set(d.key,lt.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((d,f)=>a.set(d,f)),t.forEach((d,f)=>{var m;return u.set(d,new _h(f,(m=a.get(d))!==null&&m!==void 0?m:null))}),u))}recalculateAndSaveOverlays(e,t){let n=Rs(),i=new fe((a,u)=>a-u),s=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(c=>{let d=t.get(c);if(d===null)return;let f=n.get(c)||lt.empty();f=u.applyToLocalView(d,f),n.set(c,f);let m=(i.get(u.batchId)||J()).add(c);i=i.insert(u.batchId,m)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),d=c.key,f=c.value,m=ey();f.forEach(_=>{if(!s.has(_)){let A=ay(t.get(_),n.get(_));A!==null&&m.set(_,A),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return C.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):bd(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):C.resolve(Mt()),u=-1,c=s;return a.next(d=>C.forEach(d,(f,m)=>(u<m.largestBatchId&&(u=m.largestBatchId),s.get(f)?C.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,c,d,J())).next(f=>({batchId:u,changes:Z_(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(n=>{let i=Ss();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,a=Ss();return this.indexManager.getCollectionParents(e,s).next(u=>C.forEach(u,c=>{let d=function(m,_){return new bt(_,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,n,i).next(f=>{f.forEach((m,_)=>{a=a.insert(m,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,Re.newInvalidDocument(f)))});let u=Ss();return a.forEach((c,d)=>{let f=s.get(c);f!==void 0&&Vs(f.mutation,d,lt.empty(),_e.now()),oo(t,d)&&(u=u.insert(c,d))}),u})}};var yh=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return C.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ie(i.createTime)}}(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:Dd(i.bundledQuery),readTime:Ie(i.readTime)}}(t)),C.resolve()}};var vh=class{constructor(){this.overlays=new fe(L.comparator),this.Ir=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Mt();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),C.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Ir.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),C.resolve()}getOverlaysForCollection(e,t,n){let i=Mt(),s=t.length+1,a=new L(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let c=u.getNext().value,d=c.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new fe((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=Mt(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=Mt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return C.resolve(u)}ht(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new js(t,n));let s=this.Ir.get(t);s===void 0&&(s=J(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}};var wh=class{constructor(){this.sessionToken=Te.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var Hs=class{constructor(){this.Tr=new le(Se.Er),this.dr=new le(Se.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let n=new Se(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Se(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){let t=new L(new ie([])),n=new Se(t,e),i=new Se(t,e+1),s=[];return this.dr.forEachInRange([n,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new L(new ie([])),n=new Se(t,e),i=new Se(t,e+1),s=J();return this.dr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new Se(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},Se=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return L.comparator(e.key,t.key)||W(e.wr,t.wr)}static Ar(e,t){return W(e.wr,t.wr)||L.comparator(e.key,t.key)}};var Eh=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new le(Se.Er)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Bs(s,t,n,i);this.mutationQueue.push(a);for(let u of i)this.br=this.br.add(new Se(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.vr(n),s=i<0?0:i;return C.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new Se(t,0),i=new Se(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],a=>{let u=this.Dr(a.wr);s.push(u)}),C.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new le(W);return t.forEach(i=>{let s=new Se(i,0),a=new Se(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],u=>{n=n.add(u.wr)})}),C.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;L.isDocumentKey(s)||(s=s.child(""));let a=new Se(new L(s),0),u=new le(W);return this.br.forEachWhile(c=>{let d=c.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(c.wr)),!0)},a),C.resolve(this.Cr(u))}Cr(e){let t=[];return e.forEach(n=>{let i=this.Dr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){B(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return C.forEach(t.mutations,i=>{let s=new Se(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){let n=new Se(t,0),i=this.br.firstAfterOrEqual(n);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Ih=class{constructor(e){this.Mr=e,this.docs=function(){return new fe(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return C.resolve(n?n.document.mutableCopy():Re.newInvalidDocument(t))}getEntries(e,t){let n=it();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Re.newInvalidDocument(i))}),C.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=it(),a=t.path,u=new L(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:d,value:{document:f}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||wd(R_(f),n)<=0||(i.has(f.key)||oo(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return C.resolve(s)}getAllFromCollectionGroup(e,t,n,i){U()}Or(e,t){return C.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Th(this)}getSize(e){return C.resolve(this.size)}},Th=class extends Ba{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),C.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Ah=class{constructor(e){this.persistence=e,this.Nr=new Bt(t=>lr(t),io),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Hs,this.targetCount=0,this.kr=fi.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),C.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new fi(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Kn(t),C.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),C.waitFor(s).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let n=this.Nr.get(t)||null;return C.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),C.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),C.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Br.yr(t);return C.resolve(n)}containsKey(e,t){return C.resolve(this.Br.containsKey(t))}};var $a=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ct(0),this.Kr=!1,this.Kr=!0,this.$r=new wh,this.referenceDelegate=e(this),this.Ur=new Ah(this),this.indexManager=new uh,this.remoteDocumentCache=function(i){return new Ih(i)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Na(t),this.Gr=new yh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new vh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Eh(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){k("MemoryPersistence","Starting transaction:",e);let i=new bh(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return C.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}},bh=class extends Ia{constructor(e){super(),this.currentSequenceNumber=e}},Ga=class r{constructor(e){this.persistence=e,this.Jr=new Hs,this.Yr=null}static Zr(e){return new r(e)}get Xr(){if(this.Yr)return this.Yr;throw U()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),C.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),C.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.Xr,n=>{let i=L.fromPath(n);return this.ei(e,i).next(s=>{s||t.removeEntry(i,$.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return C.or([()=>C.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var Ch=class{constructor(e){this.serializer=e}O(e,t,n,i){let s=new Ta("createOrUpgrade",t);n<1&&i>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Pg,{unique:!0}),c.createObjectStore("documentMutations")}(e),f_(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=C.resolve();return n<3&&i>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),f_(e)),a=a.next(()=>function(c){let d=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(c,d){return d.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Pg,{unique:!0});let m=d.store("mutations"),_=f.map(A=>m.put(A));return C.waitFor(_)})}(e,s))),a=a.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&i>=5&&(a=a.next(()=>this.ni(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&i>=7&&(a=a.next(()=>this.ii(s))),n<8&&i>=8&&(a=a.next(()=>this.si(e,s))),n<9&&i>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&i>=10&&(a=a.next(()=>this.oi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{(function(c){let d=c.createObjectStore("documentOverlays",{keyPath:tE});d.createIndex("collectionPathOverlayIndex",nE,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",rE,{unique:!1})})(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){let d=c.createObjectStore("remoteDocumentsV14",{keyPath:G0});d.createIndex("documentKeyIndex",z0),d.createIndex("collectionGroupIndex",K0)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.ai(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:X0}).createIndex("sequenceNumberIndex",Y0,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Z0}).createIndex("documentKeyIndex",eE,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),a}ri(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=Ua(i)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>C.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>C.forEach(u,c=>{B(c.userId===s.userId);let d=nr(this.serializer,c);return Sy(e,s.userId,d).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((a,u)=>{let c=new ie(a),d=function(m){return[0,Ye(m)]}(c);s.push(t.get(d).next(f=>f?C.resolve():(m=>t.put({targetId:0,path:Ye(m),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>C.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:J0});let n=t.store("collectionParents"),i=new Ws,s=a=>{if(i.add(a)){let u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:Ye(c)})}};return t.store("remoteDocuments").J({H:!0},(a,u)=>{let c=new ie(a);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,u,c],d)=>{let f=Nt(u);return s(f.popLast())}))}oi(e){let t=e.store("targets");return t.J((n,i)=>{let s=Ps(i),a=Ay(this.serializer,s);return t.put(a)})}_i(e,t){let n=t.store("remoteDocuments"),i=[];return n.J((s,a)=>{let u=t.store("remoteDocumentsV14"),c=function(m){return m.document?new L(ie.fromString(m.document.name).popFirst(5)):m.noDocument?L.fromSegments(m.noDocument.path):m.unknownDocument?L.fromSegments(m.unknownDocument.path):U()}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>C.waitFor(i))}ai(e,t){let n=t.store("mutations"),i=Ry(this.serializer),s=new $a(Ga.Zr,this.serializer.ct);return n.U().next(a=>{let u=new Map;return a.forEach(c=>{var d;let f=(d=u.get(c.userId))!==null&&d!==void 0?d:J();nr(this.serializer,c).keys().forEach(m=>f=f.add(m)),u.set(c.userId,f)}),C.forEach(u,(c,d)=>{let f=new Pe(d),m=Fa.lt(this.serializer,f),_=s.getIndexManager(f),A=qa.lt(f,this.serializer,_,s.referenceDelegate);return new ja(i,A,m,_).recalculateAndSaveOverlaysForDocumentKeys(new Fs(t,ct.oe),c).next()})})}};function f_(r){r.createObjectStore("targetDocuments",{keyPath:H0}).createIndex("documentTargetsIndex",Q0,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",W0,{unique:!0}),r.createObjectStore("targetGlobal")}var ml="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Sh=class r{constructor(e,t,n,i,s,a,u,c,d,f,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=a,this.document=u,this.ci=d,this.li=f,this.hi=m,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!r.D())throw new V(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ph(this,i),this.Ai=t+"main",this.serializer=new Na(c),this.Ri=new Dn(this.Ai,this.hi,new Ch(this.serializer)),this.$r=new th,this.Ur=new lh(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ry(this.serializer),this.Gr=new eh,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,f===!1&&we("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new V(S.FAILED_PRECONDITION,ml);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new ct(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>D(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>D(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>D(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ha(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Un(e))return k("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return k("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Cs(e).get("owner").next(t=>C.resolve(this.vi(t)))}Ci(e){return ha(e).delete(this.clientId)}Fi(){return D(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=xe(t,"clientMetadata");return n.U().next(i=>{let s=this.xi(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return C.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?C.resolve(!0):Cs(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new V(S.FAILED_PRECONDITION,ml);return!1}}return!(!this.networkEnabled||!this.inForeground)||ha(e).U().next(n=>this.xi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&k("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return D(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Fs(e,ct.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>ha(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return qa.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ch(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Fa.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){k("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?oE:c===16?sE:c===15?Id:c===14?O_:c===13?F_:c===12?iE:c===11?M_:void U()}(this.hi),a;return this.Ri.runTransaction(e,i,s,u=>(a=new Fs(u,this.Qr?this.Qr.next():ct.oe),t==="readwrite-primary"?this.wi(a).next(c=>!!c||this.Si(a)).next(c=>{if(!c)throw we(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new V(S.FAILED_PRECONDITION,V_);return n(a)}).next(c=>this.Di(a).next(()=>c)):this.Ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ki(e){return Cs(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new V(S.FAILED_PRECONDITION,ml)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Cs(e).put("owner",t)}static D(){return Dn.D()}bi(e){let t=Cs(e);return t.get("owner").next(n=>this.vi(n)?(k("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):C.resolve())}Mi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(we(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;kc()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return k("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return we("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){we("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Cs(r){return xe(r,"owner")}function ha(r){return xe(r,"clientMetadata")}function Vd(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}var Ph=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=J(),i=J();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};var Dh=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var za=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return kc()?8:x_(as())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.Yi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Dh;return this.Xi(e,t,a).next(u=>{if(s.result=u,this.zi)return this.es(e,t,a,u.size)})}).next(()=>s.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(Jr()<=xt.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Xr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),C.resolve()):(Jr()<=xt.DEBUG&&k("QueryEngine","Query:",Xr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(Jr()<=xt.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Xr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ze(t))):C.resolve())}Yi(e,t){if(qg(t))return C.resolve(null);let n=Ze(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Ra(t,null,"F"),n=Ze(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let a=J(...s);return this.Ji.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{let d=this.ts(t,u);return this.ns(t,d,a,c.readTime)?this.Yi(e,Ra(t,null,"F")):this.rs(e,d,t,c)}))})))}Zi(e,t,n,i){return qg(t)||i.isEqual($.min())?C.resolve(null):this.Ji.getDocuments(e,n).next(s=>{let a=this.ts(t,s);return this.ns(t,a,n,i)?C.resolve(null):(Jr()<=xt.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Xr(t)),this.rs(e,a,t,D_(i,-1)).next(u=>u))})}ts(e,t){let n=new le(X_(e));return t.forEach((i,s)=>{oo(e,s)&&(n=n.add(s))}),n}ns(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,n){return Jr()<=xt.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Xr(t)),this.Ji.getDocumentsMatchingQuery(e,t,gt.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var Rh=class{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new fe(W),this._s=new Bt(s=>lr(s),io),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ja(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function Vy(r,e,t,n){return new Rh(r,e,t,n)}function xy(r,e){return D(this,null,function*(){let t=O(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],c=J();for(let d of i){a.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function UE(r,e){let t=O(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,c,d,f){let m=d.batch,_=m.keys(),A=C.resolve();return _.forEach(x=>{A=A.next(()=>f.getEntry(c,x)).next(N=>{let R=d.docVersions.get(x);B(R!==null),N.version.compareTo(R)<0&&(m.applyToRemoteDocument(N,d),N.isValidDocument()&&(N.setReadTime(d.commitVersion),f.addEntry(N)))})}),A.next(()=>u.mutationQueue.removeMutationBatch(c,m))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=J();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(c=c.add(u.batch.mutations[d].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function ky(r){let e=O(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function qE(r,e){let t=O(r),n=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let u=[];e.targetChanges.forEach((f,m)=>{let _=i.get(m);if(!_)return;u.push(t.Ur.removeMatchingKeys(s,f.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(s,f.addedDocuments,m)));let A=_.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?A=A.withResumeToken(Te.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,n)),i=i.insert(m,A),function(N,R,G){return N.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=3e8?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(_,A,f)&&u.push(t.Ur.updateTargetData(s,A))});let c=it(),d=J();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Ny(s,a,e.documentUpdates).next(f=>{c=f.Ps,d=f.Is})),!n.isEqual($.min())){let f=t.Ur.getLastRemoteSnapshotVersion(s).next(m=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return C.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,d)).next(()=>c)}).then(s=>(t.os=i,s))}function Ny(r,e,t){let n=J(),i=J();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=it();return t.forEach((u,c)=>{let d=s.get(u);c.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual($.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):k("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",c.version)}),{Ps:a,Is:i}})}function BE(r,e){let t=O(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function pi(r,e){let t=O(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ur.getTargetData(n,e).next(s=>s?(i=s,C.resolve(i)):t.Ur.allocateTargetId(n).next(a=>(i=new di(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.os.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function mi(r,e,t){return D(this,null,function*(){let n=O(r),i=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Un(a))throw a;k("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.os=n.os.remove(e),n._s.delete(i.target)})}function Ka(r,e,t){let n=O(r),i=$.min(),s=J();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,f){let m=O(c),_=m._s.get(f);return _!==void 0?C.resolve(m.os.get(_)):m.Ur.getTargetData(d,f)}(n,a,Ze(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.ss.getDocumentsMatchingQuery(a,e,t?i:$.min(),t?s:J())).next(u=>(Oy(n,J_(e),u),{documents:u,Ts:s})))}function My(r,e){let t=O(r),n=O(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(a=>a?a.target:null))}function Fy(r,e){let t=O(r),n=t.us.get(e)||$.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,D_(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Oy(t,e,i),i))}function Oy(r,e,t){let n=r.us.get(e)||$.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(e,n)}function jE(r,e,t,n){return D(this,null,function*(){let i=O(r),s=J(),a=it();for(let d of t){let f=e.Es(d.metadata.name);d.document&&(s=s.add(f));let m=e.ds(d);m.setReadTime(e.As(d.metadata.readTime)),a=a.insert(f,m)}let u=i.cs.newChangeBuffer({trackRemovals:!0}),c=yield pi(i,function(f){return Ze(Ti(ie.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>Ny(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(d,c.targetId).next(()=>i.Ur.addMatchingKeys(d,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.Ps,f.Is)).next(()=>f.Ps)))})}function $E(n,i){return D(this,arguments,function*(r,e,t=J()){let s=yield pi(r,Ze(Dd(e.bundledQuery))),a=O(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let c=Ie(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return a.Gr.saveNamedQuery(u,e);let d=s.withResumeToken(Te.EMPTY_BYTE_STRING,c);return a.os=a.os.insert(d.targetId,d),a.Ur.updateTargetData(u,d).next(()=>a.Ur.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.Ur.addMatchingKeys(u,t,s.targetId)).next(()=>a.Gr.saveNamedQuery(u,e))})})}function p_(r,e){return`firestore_clients_${r}_${e}`}function m_(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function gl(r,e){return`firestore_targets_${r}_${e}`}var Wa=class r{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Rs(e,t,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new V(i.error.code,i.error.message))),a?new r(e,t,i.state,s):(we("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},xs=class r{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){let n=JSON.parse(t),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new V(n.error.code,n.error.message))),s?new r(e,n.state,i):(we("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ha=class r{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let n=JSON.parse(t),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=Cd();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=k_(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(e,s):(we("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Vh=class r{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new r(t.clientId,t.onlineState):(we("SharedClientState",`Failed to parse online state: ${e}`),null)}},Qs=class{constructor(){this.activeTargetIds=Cd()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},ks=class{constructor(e,t,n,i,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new fe(W),this.started=!1,this.bs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=p_(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Qs),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return D(this,null,function*(){let e=yield this.syncEngine.Qi();for(let n of e){if(n===this.ps)continue;let i=this.getItem(p_(this.persistenceKey,n));if(i){let s=Ha.Rs(n,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let n=this.Ls(t);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(gl(this.persistenceKey,e));if(n){let i=xs.Rs(e,n);i&&(t=i.state)}}return this.Ks.fs(e),this.Ns(),t}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(gl(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return k("SharedClientState","READ",e,t),t}setItem(e,t){k("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){k("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(k("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void we("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>D(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let n=this.Gs(t.key);return this.zs(n,null)}{let n=this.js(t.key,t.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let n=this.Ys(t.key,t.newValue);if(n)return this.Zs(n)}}else if(t.key===this.xs){if(t.newValue!==null){let n=this.Ls(t.newValue);if(n)return this.Bs(n)}}else if(t.key===this.vs){let n=function(s){let a=ct.oe;if(s!=null)try{let u=JSON.parse(s);B(typeof u=="number"),a=u}catch(u){we("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(t.newValue);n!==ct.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Os){let n=this.Xs(t.newValue);yield Promise.all(n.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){let i=new Wa(this.currentUser,e,t,n),s=m_(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=m_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){let i=gl(this.persistenceKey,e),s=new xs(e,t,n);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let n=this.Gs(e);return Ha.Rs(n,t)}Hs(e,t){let n=this.Fs.exec(e),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Wa.Rs(new Pe(s),i,t)}Ys(e,t){let n=this.Ms.exec(e),i=Number(n[1]);return xs.Rs(i,t)}Ls(e){return Vh.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return D(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);k("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let n=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.io(a,u).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Cd();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Qa=class{constructor(){this.so=new Qs,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Qs,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var xh=class{_o(e){}shutdown(){}};var Ja=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){k("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){k("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var da=null;function _l(){return da===null?da=function(){return 268435456+Math.round(2147483648*Math.random())}():da++,"0x"+da.toString(16)}var GE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var kh=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Ke="WebChannelConnection",Nh=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,n,i,s,a){let u=_l(),c=this.xo(t,n.toUriEncodedString());k("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);let d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,s,a),this.No(t,c,d,i).then(f=>(k("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw mt("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}Lo(t,n,i,s,a,u){return this.Mo(t,n,i,s,a)}Oo(t,n,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ii}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}xo(t,n){let i=GE[t];return`${this.Do}/v1/${n}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){let s=_l();return new Promise((a,u)=>{let c=new ul;c.setWithCredentials(!0),c.listenOnce(ll.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Is.NO_ERROR:let f=c.getResponseJson();k(Ke,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case Is.TIMEOUT:k(Ke,`RPC '${e}' ${s} timed out`),u(new V(S.DEADLINE_EXCEEDED,"Request time out"));break;case Is.HTTP_ERROR:let m=c.getStatus();if(k(Ke,`RPC '${e}' ${s} failed with status:`,m,"response text:",c.getResponseText()),m>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);let A=_?.error;if(A&&A.status&&A.message){let x=function(R){let G=R.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(G)>=0?G:S.UNKNOWN}(A.status);u(new V(x,A.message))}else u(new V(S.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new V(S.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{k(Ke,`RPC '${e}' ${s} completed.`)}});let d=JSON.stringify(i);k(Ke,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",d,n,15)})}Bo(e,t,n){let i=_l(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=fl(),u=dl(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.xmlHttpFactory=new cl({})),this.Oo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let f=s.join("");k(Ke,`Creating RPC '${e}' stream ${i}: ${f}`,c);let m=a.createWebChannel(f,c),_=!1,A=!1,x=new kh({Io:R=>{A?k(Ke,`Not sending because RPC '${e}' stream ${i} is closed:`,R):(_||(k(Ke,`Opening RPC '${e}' stream ${i} transport.`),m.open(),_=!0),k(Ke,`RPC '${e}' stream ${i} sending:`,R),m.send(R))},To:()=>m.close()}),N=(R,G,z)=>{R.listen(G,F=>{try{z(F)}catch(K){setTimeout(()=>{throw K},0)}})};return N(m,zr.EventType.OPEN,()=>{A||(k(Ke,`RPC '${e}' stream ${i} transport opened.`),x.yo())}),N(m,zr.EventType.CLOSE,()=>{A||(A=!0,k(Ke,`RPC '${e}' stream ${i} transport closed`),x.So())}),N(m,zr.EventType.ERROR,R=>{A||(A=!0,mt(Ke,`RPC '${e}' stream ${i} transport errored:`,R),x.So(new V(S.UNAVAILABLE,"The operation could not be completed")))}),N(m,zr.EventType.MESSAGE,R=>{var G;if(!A){let z=R.data[0];B(!!z);let F=z,K=F.error||((G=F[0])===null||G===void 0?void 0:G.error);if(K){k(Ke,`RPC '${e}' stream ${i} received error:`,K);let H=K.status,Q=function(v){let E=Ce[v];if(E!==void 0)return ly(E)}(H),w=K.message;Q===void 0&&(Q=S.INTERNAL,w="Unknown error status: "+H+" with message "+K.message),A=!0,x.So(new V(Q,w)),m.close()}else k(Ke,`RPC '${e}' stream ${i} received:`,z),x.bo(z)}}),N(u,hl.STAT_EVENT,R=>{R.stat===ua.PROXY?k(Ke,`RPC '${e}' stream ${i} detected buffering proxy`):R.stat===ua.NOPROXY&&k(Ke,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.wo()},0),x}};function Ly(){return typeof window<"u"?window:null}function _a(){return typeof document<"u"?document:null}function ao(r){return new Ql(r,!0)}var Js=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&k("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Xa=class{constructor(e,t,n,i,s,a,u,c){this.ui=e,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Js(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return D(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return D(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return D(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(we(t.toString()),we("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===t&&this.P_(n,i)},n=>{e(()=>{let i=new V(S.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,t){let n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>D(this,null,function*(){this.state=0,this.start()}))}I_(e){return k("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(k("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Mh=class extends Xa{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=PE(this.serializer,e),n=function(s){if(!("targetChange"in s))return $.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?$.min():a.readTime?Ie(a.readTime):$.min()}(e);return this.listener.d_(t,n)}A_(e){let t={};t.database=Yl(this.serializer),t.addTarget=function(s,a){let u,c=a.target;if(u=Pa(c)?{documents:yy(s,c)}:{query:vy(s,c)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=dy(s,a.resumeToken);let d=Jl(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo($.min())>0){u.readTime=hi(s,a.snapshotVersion.toTimestamp());let d=Jl(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,e);let n=RE(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){let t={};t.database=Yl(this.serializer),t.removeTarget=e,this.a_(t)}},Fh=class extends Xa{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return B(!!e.streamToken),this.lastStreamToken=e.streamToken,B(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){B(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=DE(e.writeResults,e.commitTime),n=Ie(e.commitTime);return this.listener.g_(n,t)}p_(){let e={};e.database=Yl(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>Ks(this.serializer,n))};this.a_(t)}};var Oh=class extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(e,Xl(t,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new V(S.UNKNOWN,s.toString())})}Lo(e,t,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(e,Xl(t,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(S.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},Lh=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(we(t),this.D_=!1):k("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var Uh=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(a=>{n.enqueueAndForget(()=>D(this,null,function*(){qn(this)&&(k("RemoteStore","Restarting streams for network reachability change."),yield function(c){return D(this,null,function*(){let d=O(c);d.L_.add(4),yield Ai(d),d.q_.set("Unknown"),d.L_.delete(4),yield uo(d)})}(this))}))}),this.q_=new Lh(n,i)}};function uo(r){return D(this,null,function*(){if(qn(r))for(let e of r.B_)yield e(!0)})}function Ai(r){return D(this,null,function*(){for(let e of r.B_)yield e(!1)})}function _u(r,e){let t=O(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Nd(t)?kd(t):Ci(t).r_()&&xd(t,e))}function gi(r,e){let t=O(r),n=Ci(t);t.N_.delete(e),n.r_()&&Uy(t,e),t.N_.size===0&&(n.r_()?n.o_():qn(t)&&t.q_.set("Unknown"))}function xd(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ci(r).A_(e)}function Uy(r,e){r.Q_.xe(e),Ci(r).R_(e)}function kd(r){r.Q_=new Hl({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),Ci(r).start(),r.q_.v_()}function Nd(r){return qn(r)&&!Ci(r).n_()&&r.N_.size>0}function qn(r){return O(r).L_.size===0}function qy(r){r.Q_=void 0}function zE(r){return D(this,null,function*(){r.q_.set("Online")})}function KE(r){return D(this,null,function*(){r.N_.forEach((e,t)=>{xd(r,e)})})}function WE(r,e){return D(this,null,function*(){qy(r),Nd(r)?(r.q_.M_(e),kd(r)):r.q_.set("Unknown")})}function HE(r,e,t){return D(this,null,function*(){if(r.q_.set("Online"),e instanceof xa&&e.state===2&&e.cause)try{yield function(i,s){return D(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.N_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.N_.delete(u),i.Q_.removeTarget(u))})}(r,e)}catch(n){k("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Ya(r,n)}else if(e instanceof ii?r.Q_.Ke(e):e instanceof Va?r.Q_.He(e):r.Q_.We(e),!t.isEqual($.min()))try{let n=yield ky(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){let u=s.Q_.rt(a);return u.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let f=s.N_.get(d);f&&s.N_.set(d,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,d)=>{let f=s.N_.get(c);if(!f)return;s.N_.set(c,f.withResumeToken(Te.EMPTY_BYTE_STRING,f.snapshotVersion)),Uy(s,c);let m=new di(f.target,c,d,f.sequenceNumber);xd(s,m)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){k("RemoteStore","Failed to raise snapshot:",n),yield Ya(r,n)}})}function Ya(r,e,t){return D(this,null,function*(){if(!Un(e))throw e;r.L_.add(1),yield Ai(r),r.q_.set("Offline"),t||(t=()=>ky(r.localStore)),r.asyncQueue.enqueueRetryable(()=>D(this,null,function*(){k("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield uo(r)}))})}function By(r,e){return e().catch(t=>Ya(r,t,e))}function bi(r){return D(this,null,function*(){let e=O(r),t=On(e),n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;QE(e);)try{let i=yield BE(e.localStore,n);if(i===null){e.O_.length===0&&t.o_();break}n=i.batchId,JE(e,i)}catch(i){yield Ya(e,i)}jy(e)&&$y(e)})}function QE(r){return qn(r)&&r.O_.length<10}function JE(r,e){r.O_.push(e);let t=On(r);t.r_()&&t.V_&&t.m_(e.mutations)}function jy(r){return qn(r)&&!On(r).n_()&&r.O_.length>0}function $y(r){On(r).start()}function XE(r){return D(this,null,function*(){On(r).p_()})}function YE(r){return D(this,null,function*(){let e=On(r);for(let t of r.O_)e.m_(t.mutations)})}function ZE(r,e,t){return D(this,null,function*(){let n=r.O_.shift(),i=zl.from(n,e,t);yield By(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield bi(r)})}function eI(r,e){return D(this,null,function*(){e&&On(r).V_&&(yield function(n,i){return D(this,null,function*(){if(function(a){return cy(a)&&a!==S.ABORTED}(i.code)){let s=n.O_.shift();On(n).s_(),yield By(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield bi(n)}})}(r,e)),jy(r)&&$y(r)})}function g_(r,e){return D(this,null,function*(){let t=O(r);t.asyncQueue.verifyOperationInProgress(),k("RemoteStore","RemoteStore received new credentials");let n=qn(t);t.L_.add(3),yield Ai(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield uo(t)})}function qh(r,e){return D(this,null,function*(){let t=O(r);e?(t.L_.delete(2),yield uo(t)):e||(t.L_.add(2),yield Ai(t),t.q_.set("Unknown"))})}function Ci(r){return r.K_||(r.K_=function(t,n,i){let s=O(t);return s.w_(),new Mh(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:zE.bind(null,r),Ro:KE.bind(null,r),mo:WE.bind(null,r),d_:HE.bind(null,r)}),r.B_.push(e=>D(this,null,function*(){e?(r.K_.s_(),Nd(r)?kd(r):r.q_.set("Unknown")):(yield r.K_.stop(),qy(r))}))),r.K_}function On(r){return r.U_||(r.U_=function(t,n,i){let s=O(t);return s.w_(),new Fh(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:XE.bind(null,r),mo:eI.bind(null,r),f_:YE.bind(null,r),g_:ZE.bind(null,r)}),r.B_.push(e=>D(this,null,function*(){e?(r.U_.s_(),yield bi(r)):(yield r.U_.stop(),r.O_.length>0&&(k("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))}))),r.U_}var Bh=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new De,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let a=Date.now()+n,u=new r(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Si(r,e){if(we("AsyncQueue",`${e}: ${r}`),Un(r))return new V(S.UNAVAILABLE,`${e}: ${r}`);throw r}var Za=class r{constructor(e){this.comparator=e?(t,n)=>e(t,n)||L.comparator(t.key,n.key):(t,n)=>L.comparator(t.key,n.key),this.keyedMap=Ss(),this.sortedSet=new fe(this.comparator)}static emptySet(e){return new r(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var eu=class{constructor(){this.W_=new fe(L.comparator)}track(e){let t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):U():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}},_i=class r{constructor(e,t,n,i,s,a,u,c,d){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,t,n,i,s){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new r(e,t,Za.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&so(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};var jh=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},$h=class{constructor(){this.queries=__(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){let i=O(t),s=i.queries;i.queries=__(),s.forEach((a,u)=>{for(let c of u.j_)c.onError(n)})})(this,new V(S.ABORTED,"Firestore shutting down"))}};function __(){return new Bt(r=>Q_(r),so)}function Md(r,e){return D(this,null,function*(){let t=O(r),n=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(n=2):(s=new jh,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=Si(a,`Initialization of query '${Xr(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&Od(t)})}function Fd(r,e){return D(this,null,function*(){let t=O(r),n=e.query,i=3,s=t.queries.get(n);if(s){let a=s.j_.indexOf(e);a>=0&&(s.j_.splice(a,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function tI(r,e){let t=O(r),n=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let u of a.j_)u.X_(i)&&(n=!0);a.z_=i}}n&&Od(t)}function nI(r,e,t){let n=O(r),i=n.queries.get(e);if(i)for(let s of i.j_)s.onError(t);n.queries.delete(e)}function Od(r){r.Y_.forEach(e=>{e.next()})}var Gh,y_;(y_=Gh||(Gh={})).ea="default",y_.Cache="cache";var Xs=class{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new _i(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=_i.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Gh.Cache}};var zh=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var tu=class{constructor(e){this.serializer=e}Es(e){return Ot(this.serializer,e)}ds(e){return e.metadata.exists?_y(this.serializer,e.document,!1):Re.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ie(e)}},Kh=class{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Gy(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let n=ie.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,n=new tu(this.serializer);for(let i of e)if(i.metadata.queries){let s=n.Es(i.metadata.name);for(let a of i.metadata.queries){let u=(t.get(a)||J()).add(s);t.set(a,u)}}return t}complete(){return D(this,null,function*(){let e=yield jE(this.localStore,new tu(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let n of this.queries)yield $E(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function Gy(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var nu=class{constructor(e){this.key=e}},ru=class{constructor(e){this.key=e}},iu=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=J(),this.mutatedKeys=J(),this.Aa=X_(e),this.Ra=new Za(this.Aa)}get Va(){return this.Ta}ma(e,t){let n=t?t.fa:new eu,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,m)=>{let _=i.get(f),A=oo(this.query,m)?m:null,x=!!_&&this.mutatedKeys.has(_.key),N=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations),R=!1;_&&A?_.data.isEqual(A.data)?x!==N&&(n.track({type:3,doc:A}),R=!0):this.ga(_,A)||(n.track({type:2,doc:A}),R=!0,(c&&this.Aa(A,c)>0||d&&this.Aa(A,d)<0)&&(u=!0)):!_&&A?(n.track({type:0,doc:A}),R=!0):_&&!A&&(n.track({type:1,doc:_}),R=!0,(c||d)&&(u=!0)),R&&(A?(a=a.add(A),s=N?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ra:a,fa:n,ns:u,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let a=e.fa.G_();a.sort((f,m)=>function(A,x){let N=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return N(A)-N(x)}(f.type,m.type)||this.Aa(f.doc,m.doc)),this.pa(n),i=i!=null&&i;let u=t&&!i?this.ya():[],c=this.da.size===0&&this.current&&!i?1:0,d=c!==this.Ea;return this.Ea=c,a.length!==0||d?{snapshot:new _i(this.query,e.Ra,s,a,e.mutatedKeys,c===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new eu,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=J(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let t=[];return e.forEach(n=>{this.da.has(n)||t.push(new ru(n))}),this.da.forEach(n=>{e.has(n)||t.push(new nu(n))}),t}ba(e){this.Ta=e.Ts,this.da=J();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return _i.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Wh=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Hh=class{constructor(e){this.key=e,this.va=!1}},Qh=class{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Bt(u=>Q_(u),so),this.Ma=new Map,this.xa=new Set,this.Oa=new fe(L.comparator),this.Na=new Map,this.La=new Hs,this.Ba={},this.ka=new Map,this.qa=fi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function rI(r,e,t=!0){return D(this,null,function*(){let n=yu(r),i,s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield zy(n,e,t,!0),i})}function iI(r,e){return D(this,null,function*(){let t=yu(r);yield zy(t,e,!0,!1)})}function zy(r,e,t,n){return D(this,null,function*(){let i=yield pi(r.localStore,Ze(e)),s=i.targetId,a=t?r.sharedClientState.addLocalQueryTarget(s):"not-current",u;return n&&(u=yield Ld(r,e,s,a==="current",i.resumeToken)),r.isPrimaryClient&&t&&_u(r.remoteStore,i),u})}function Ld(r,e,t,n,i){return D(this,null,function*(){r.Ka=(m,_,A)=>function(N,R,G,z){return D(this,null,function*(){let F=R.view.ma(G);F.ns&&(F=yield Ka(N.localStore,R.query,!1).then(({documents:w})=>R.view.ma(w,F)));let K=z&&z.targetChanges.get(R.targetId),H=z&&z.targetMismatches.get(R.targetId)!=null,Q=R.view.applyChanges(F,N.isPrimaryClient,K,H);return Jh(N,R.targetId,Q.wa),Q.snapshot})}(r,m,_,A);let s=yield Ka(r.localStore,e,!0),a=new iu(e,s.Ts),u=a.ma(s.documents),c=Gs.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,c);Jh(r,t,d.wa);let f=new Wh(e,t,a);return r.Fa.set(e,f),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),d.snapshot})}function sI(r,e,t){return D(this,null,function*(){let n=O(r),i=n.Fa.get(e),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(a=>!so(a,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield mi(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&gi(n.remoteStore,i.targetId),yi(n,i.targetId)}).catch(Ln))):(yi(n,i.targetId),yield mi(n.localStore,i.targetId,!0))})}function oI(r,e){return D(this,null,function*(){let t=O(r),n=t.Fa.get(e),i=t.Ma.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),gi(t.remoteStore,n.targetId))})}function aI(r,e,t){return D(this,null,function*(){let n=jd(r);try{let i=yield function(a,u){let c=O(a),d=_e.now(),f=u.reduce((A,x)=>A.add(x.key),J()),m,_;return c.persistence.runTransaction("Locally write mutations","readwrite",A=>{let x=it(),N=J();return c.cs.getEntries(A,f).next(R=>{x=R,x.forEach((G,z)=>{z.isValidDocument()||(N=N.add(G))})}).next(()=>c.localDocuments.getOverlayedDocuments(A,x)).next(R=>{m=R;let G=[];for(let z of u){let F=EE(z,m.get(z.key).overlayedDocument);F!=null&&G.push(new Ct(z.key,F,j_(F.value.mapValue),ve.exists(!0)))}return c.mutationQueue.addMutationBatch(A,d,G,u)}).next(R=>{_=R;let G=R.applyToLocalDocumentSet(m,N);return c.documentOverlayCache.saveOverlays(A,R.batchId,G)})}).then(()=>({batchId:_.batchId,changes:Z_(m)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let d=a.Ba[a.currentUser.toKey()];d||(d=new fe(W)),d=d.insert(u,c),a.Ba[a.currentUser.toKey()]=d}(n,i.batchId,t),yield sn(n,i.changes),yield bi(n.remoteStore)}catch(i){let s=Si(i,"Failed to persist write");t.reject(s)}})}function Ky(r,e){return D(this,null,function*(){let t=O(r);try{let n=yield qE(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Na.get(s);a&&(B(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?B(a.va):i.removedDocuments.size>0&&(B(a.va),a.va=!1))}),yield sn(t,n,e)}catch(n){yield Ln(n)}})}function v_(r,e,t){let n=O(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.Fa.forEach((s,a)=>{let u=a.view.Z_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){let c=O(a);c.onlineState=u;let d=!1;c.queries.forEach((f,m)=>{for(let _ of m.j_)_.Z_(u)&&(d=!0)}),d&&Od(c)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function uI(r,e,t){return D(this,null,function*(){let n=O(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n.Na.get(e),s=i&&i.key;if(s){let a=new fe(L.comparator);a=a.insert(s,Re.newNoDocument(s,$.min()));let u=J().add(s),c=new $s($.min(),new Map,new fe(W),a,u);yield Ky(n,c),n.Oa=n.Oa.remove(s),n.Na.delete(e),Bd(n)}else yield mi(n.localStore,e,!1).then(()=>yi(n,e,t)).catch(Ln)})}function cI(r,e){return D(this,null,function*(){let t=O(r),n=e.batch.batchId;try{let i=yield UE(t.localStore,e);qd(t,n,null),Ud(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield sn(t,i)}catch(i){yield Ln(i)}})}function lI(r,e,t){return D(this,null,function*(){let n=O(r);try{let i=yield function(a,u){let c=O(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return c.mutationQueue.lookupMutationBatch(d,u).next(m=>(B(m!==null),f=m.keys(),c.mutationQueue.removeMutationBatch(d,m))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>c.localDocuments.getDocuments(d,f))})}(n.localStore,e);qd(n,e,t),Ud(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield sn(n,i)}catch(i){yield Ln(i)}})}function hI(r,e){return D(this,null,function*(){let t=O(r);qn(t.remoteStore)||k("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=O(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(n===-1)return void e.resolve();let i=t.ka.get(n)||[];i.push(e),t.ka.set(n,i)}catch(n){let i=Si(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Ud(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function qd(r,e,t){let n=O(r),i=n.Ba[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function yi(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Wy(r,n)})}function Wy(r,e){r.xa.delete(e.path.canonicalString());let t=r.Oa.get(e);t!==null&&(gi(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),Bd(r))}function Jh(r,e,t){for(let n of t)n instanceof nu?(r.La.addReference(n.key,e),dI(r,n)):n instanceof ru?(k("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Wy(r,n.key)):U()}function dI(r,e){let t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(k("SyncEngine","New document in limbo: "+t),r.xa.add(n),Bd(r))}function Bd(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){let e=r.xa.values().next().value;r.xa.delete(e);let t=new L(ie.fromString(e)),n=r.qa.next();r.Na.set(n,new Hh(t)),r.Oa=r.Oa.insert(t,n),_u(r.remoteStore,new di(Ze(Ti(t.path)),n,"TargetPurposeLimboResolution",ct.oe))}}function sn(r,e,t){return D(this,null,function*(){let n=O(r),i=[],s=[],a=[];n.Fa.isEmpty()||(n.Fa.forEach((u,c)=>{a.push(n.Ka(c,e,t).then(d=>{var f;if((d||t)&&n.isPrimaryClient){let m=d?!d.fromCache:(f=t?.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(d){i.push(d);let m=Ph.Wi(c.targetId,d);s.push(m)}}))}),yield Promise.all(a),n.Ca.d_(i),yield function(c,d){return D(this,null,function*(){let f=O(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>C.forEach(d,_=>C.forEach(_.$i,A=>f.persistence.referenceDelegate.addReference(m,_.targetId,A)).next(()=>C.forEach(_.Ui,A=>f.persistence.referenceDelegate.removeReference(m,_.targetId,A)))))}catch(m){if(!Un(m))throw m;k("LocalStore","Failed to update sequence numbers: "+m)}for(let m of d){let _=m.targetId;if(!m.fromCache){let A=f.os.get(_),x=A.snapshotVersion,N=A.withLastLimboFreeSnapshotVersion(x);f.os=f.os.insert(_,N)}}})}(n.localStore,s))})}function fI(r,e){return D(this,null,function*(){let t=O(r);if(!t.currentUser.isEqual(e)){k("SyncEngine","User change. New user:",e.toKey());let n=yield xy(t.localStore,e);t.currentUser=e,function(s,a){s.ka.forEach(u=>{u.forEach(c=>{c.reject(new V(S.CANCELLED,a))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield sn(t,n.hs)}})}function pI(r,e){let t=O(r),n=t.Na.get(e);if(n&&n.va)return J().add(n.key);{let i=J(),s=t.Ma.get(e);if(!s)return i;for(let a of s){let u=t.Fa.get(a);i=i.unionWith(u.view.Va)}return i}}function mI(r,e){return D(this,null,function*(){let t=O(r),n=yield Ka(t.localStore,e.query,!0),i=e.view.ba(n);return t.isPrimaryClient&&Jh(t,e.targetId,i.wa),i})}function gI(r,e){return D(this,null,function*(){let t=O(r);return Fy(t.localStore,e).then(n=>sn(t,n))})}function _I(r,e,t,n){return D(this,null,function*(){let i=O(r),s=yield function(u,c){let d=O(u),f=O(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",m=>f.Mn(m,c).next(_=>_?d.localDocuments.getDocuments(m,_):C.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield bi(i.remoteStore):t==="acknowledged"||t==="rejected"?(qd(i,e,n||null),Ud(i,e),function(u,c){O(O(u).mutationQueue).On(c)}(i.localStore,e)):U(),yield sn(i,s)):k("SyncEngine","Cannot apply mutation batch with id: "+e)})}function yI(r,e){return D(this,null,function*(){let t=O(r);if(yu(t),jd(t),e===!0&&t.Qa!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),i=yield w_(t,n.toArray());t.Qa=!0,yield qh(t.remoteStore,!0);for(let s of i)_u(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let n=[],i=Promise.resolve();t.Ma.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(yi(t,a),mi(t.localStore,a,!0))),gi(t.remoteStore,a)}),yield i,yield w_(t,n),function(a){let u=O(a);u.Na.forEach((c,d)=>{gi(u.remoteStore,d)}),u.La.pr(),u.Na=new Map,u.Oa=new fe(L.comparator)}(t),t.Qa=!1,yield qh(t.remoteStore,!1)}})}function w_(r,e,t){return D(this,null,function*(){let n=O(r),i=[],s=[];for(let a of e){let u,c=n.Ma.get(a);if(c&&c.length!==0){u=yield pi(n.localStore,Ze(c[0]));for(let d of c){let f=n.Fa.get(d),m=yield mI(n,f);m.snapshot&&s.push(m.snapshot)}}else{let d=yield My(n.localStore,a);u=yield pi(n.localStore,d),yield Ld(n,Hy(d),a,!1,u.resumeToken)}i.push(u)}return n.Ca.d_(s),i})}function Hy(r){return H_(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function vI(r){return function(t){return O(O(t).persistence).Qi()}(O(r).localStore)}function wI(r,e,t,n){return D(this,null,function*(){let i=O(r);if(i.Qa)return void k("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let a=yield Fy(i.localStore,J_(s[0])),u=$s.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Te.EMPTY_BYTE_STRING);yield sn(i,a,u);break}case"rejected":yield mi(i.localStore,e,!0),yi(i,e,n);break;default:U()}})}function EI(r,e,t){return D(this,null,function*(){let n=yu(r);if(n.Qa){for(let i of e){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){k("SyncEngine","Adding an already active target "+i);continue}let s=yield My(n.localStore,i),a=yield pi(n.localStore,s);yield Ld(n,Hy(s),a.targetId,!1,a.resumeToken),_u(n.remoteStore,a)}for(let i of t)n.Ma.has(i)&&(yield mi(n.localStore,i,!1).then(()=>{gi(n.remoteStore,i),yi(n,i)}).catch(Ln))}})}function yu(r){let e=O(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ky.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=pI.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=uI.bind(null,e),e.Ca.d_=tI.bind(null,e.eventManager),e.Ca.$a=nI.bind(null,e.eventManager),e}function jd(r){let e=O(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=cI.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=lI.bind(null,e),e}function II(r,e,t){let n=O(r);(function(s,a,u){return D(this,null,function*(){try{let c=yield a.getMetadata();if(yield function(A,x){let N=O(A),R=Ie(x.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",G=>N.Gr.getBundleMetadata(G,x.id)).then(G=>!!G&&G.createTime.compareTo(R)>=0)}(s.localStore,c))return yield a.close(),u._completeWith(function(A){return{taskState:"Success",documentsLoaded:A.totalDocuments,bytesLoaded:A.totalBytes,totalDocuments:A.totalDocuments,totalBytes:A.totalBytes}}(c)),Promise.resolve(new Set);u._updateProgress(Gy(c));let d=new Kh(c,s.localStore,a.serializer),f=yield a.Ua();for(;f;){let _=yield d.la(f);_&&u._updateProgress(_),f=yield a.Ua()}let m=yield d.complete();return yield sn(s,m.Ia,void 0),yield function(A,x){let N=O(A);return N.persistence.runTransaction("Save bundle","readwrite",R=>N.Gr.saveBundleMetadata(R,x))}(s.localStore,c),u._completeWith(m.progress),Promise.resolve(m.Pa)}catch(c){return mt("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var Ys=class{constructor(){this.synchronizeTabs=!1}initialize(e){return D(this,null,function*(){this.serializer=ao(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Vy(this.persistence,new za,e.initialUser,this.serializer)}createPersistence(e){return new $a(Ga.Zr,this.serializer)}createSharedClientState(e){return new Qa}terminate(){return D(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var su=class r extends Ys{constructor(e,t,n){super(),this.Wa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){return D(this,null,function*(){yield Ec(r.prototype,this,"initialize").call(this,e),yield this.Wa.initialize(this,e),yield jd(this.Wa.syncEngine),yield bi(this.Wa.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return Vy(this.persistence,new za,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new dh(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new Dl(t,this.persistence);return new Pl(e.asyncQueue,n)}createPersistence(e){let t=Vd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?pt.withCacheSize(this.cacheSizeBytes):pt.DEFAULT;return new Sh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Ly(),_a(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Qa}},Xh=class r extends su{constructor(e,t){super(e,t,!1),this.Wa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return D(this,null,function*(){yield Ec(r.prototype,this,"initialize").call(this,e);let t=this.Wa.syncEngine;this.sharedClientState instanceof ks&&(this.sharedClientState.syncEngine={no:_I.bind(null,t),ro:wI.bind(null,t),io:EI.bind(null,t),Qi:vI.bind(null,t),eo:gI.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>D(this,null,function*(){yield yI(this.Wa.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=Ly();if(!ks.D(t))throw new V(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=Vd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ks(t,e.asyncQueue,n,e.clientId,e.initialUser)}},Zs=class{initialize(e,t){return D(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>v_(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=fI.bind(null,this.syncEngine),yield qh(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new $h}()}createDatastore(e){let t=ao(e.databaseInfo.databaseId),n=function(s){return new Nh(s)}(e.databaseInfo);return function(s,a,u,c){return new Oh(s,a,u,c)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,i,s,a,u){return new Uh(n,i,s,a,u)}(this.localStore,this.datastore,e.asyncQueue,t=>v_(this.syncEngine,t,0),function(){return Ja.D()?new Ja:new xh}())}createSyncEngine(e,t){return function(i,s,a,u,c,d,f){let m=new Qh(i,s,a,u,c,d);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return D(this,null,function*(){var e,t;yield function(i){return D(this,null,function*(){let s=O(i);k("RemoteStore","RemoteStore shutting down."),s.L_.add(5),yield Ai(s),s.k_.shutdown(),s.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()})}};function E_(r,e=10240){let t=0;return{read(){return D(this,null,function*(){if(t<r.byteLength){let i={value:r.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return D(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var vi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):we("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Yh=class{constructor(e,t){this.ja=e,this.serializer=t,this.metadata=new De,this.buffer=new Uint8Array,this.Ha=function(){return new TextDecoder("utf-8")}(),this.Ja().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.ja.cancel()}getMetadata(){return D(this,null,function*(){return this.metadata.promise})}Ua(){return D(this,null,function*(){return yield this.getMetadata(),this.Ja()})}Ja(){return D(this,null,function*(){let e=yield this.Ya();if(e===null)return null;let t=this.Ha.decode(e),n=Number(t);isNaN(n)&&this.Za(`length string (${t}) is not valid number`);let i=yield this.Xa(n);return new zh(JSON.parse(i),e.length+n)})}eu(){return this.buffer.findIndex(e=>e===123)}Ya(){return D(this,null,function*(){for(;this.eu()<0&&!(yield this.tu()););if(this.buffer.length===0)return null;let e=this.eu();e<0&&this.Za("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Xa(e){return D(this,null,function*(){for(;this.buffer.length<e;)(yield this.tu())&&this.Za("Reached the end of bundle when more is expected.");let t=this.Ha.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}Za(e){throw this.ja.cancel(),new Error(`Invalid bundle format: ${e}`)}tu(){return D(this,null,function*(){let e=yield this.ja.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Zh=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return D(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new V(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return D(this,null,function*(){let a=O(i),u={documents:s.map(m=>zs(a.serializer,m))},c=yield a.Lo("BatchGetDocuments",a.serializer.databaseId,ie.emptyPath(),u,s.length),d=new Map;c.forEach(m=>{let _=SE(a.serializer,m);d.set(_.key.toString(),_)});let f=[];return s.forEach(m=>{let _=d.get(m.toString());B(!!_),f.push(_)}),f})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Fn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return D(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let i=L.fromPath(n);this.mutations.push(new qs(i,this.precondition(i)))}),yield function(n,i){return D(this,null,function*(){let s=O(n),a={writes:i.map(u=>Ks(s.serializer,u))};yield s.Mo("Commit",s.serializer.databaseId,ie.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U();t=$.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new V(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($.min())?ve.exists(!1):ve.updateTime(t):ve.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($.min()))throw new V(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ve.updateTime(t)}return ve.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var ed=class{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.nu=n.maxAttempts,this.t_=new Js(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){this.t_.Go(()=>D(this,null,function*(){let e=new Zh(this.datastore),t=this.su(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.ou(i)}))}).catch(n=>{this.ou(n)})}))}su(e){try{let t=this.updateFunction(e);return!ro(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ou(e){this.nu>0&&this._u(e)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(e)}_u(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!cy(t)}return!1}};var td=class{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Pe.UNAUTHENTICATED,this.clientId=wa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,s=>D(this,null,function*(){k("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(n,s=>(k("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new De;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=Si(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function ya(r,e){return D(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),k("FirestoreClient","Initializing OfflineComponentProvider");let t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(i=>D(this,null,function*(){n.isEqual(i)||(yield xy(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e})}function nd(r,e){return D(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let t=yield $d(r);k("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>g_(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>g_(e.remoteStore,i)),r._onlineComponents=e})}function Qy(r){return r.name==="FirebaseError"?r.code===S.FAILED_PRECONDITION||r.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}function $d(r){return D(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){k("FirestoreClient","Using user provided OfflineComponentProvider");try{yield ya(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!Qy(t))throw t;mt("Error using user provided cache. Falling back to memory cache: "+t),yield ya(r,new Ys)}}else k("FirestoreClient","Using default OfflineComponentProvider"),yield ya(r,new Ys);return r._offlineComponents})}function vu(r){return D(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(k("FirestoreClient","Using user provided OnlineComponentProvider"),yield nd(r,r._uninitializedComponentsProvider._online)):(k("FirestoreClient","Using default OnlineComponentProvider"),yield nd(r,new Zs))),r._onlineComponents})}function Jy(r){return $d(r).then(e=>e.persistence)}function Gd(r){return $d(r).then(e=>e.localStore)}function Xy(r){return vu(r).then(e=>e.remoteStore)}function zd(r){return vu(r).then(e=>e.syncEngine)}function TI(r){return vu(r).then(e=>e.datastore)}function wi(r){return D(this,null,function*(){let e=yield vu(r),t=e.eventManager;return t.onListen=rI.bind(null,e.syncEngine),t.onUnlisten=sI.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=iI.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=oI.bind(null,e.syncEngine),t})}function AI(r){return r.asyncQueue.enqueue(()=>D(this,null,function*(){let e=yield Jy(r),t=yield Xy(r);return e.setNetworkEnabled(!0),function(i){let s=O(i);return s.L_.delete(0),uo(s)}(t)}))}function bI(r){return r.asyncQueue.enqueue(()=>D(this,null,function*(){let e=yield Jy(r),t=yield Xy(r);return e.setNetworkEnabled(!1),function(i){return D(this,null,function*(){let s=O(i);s.L_.add(0),yield Ai(s),s.q_.set("Offline")})}(t)}))}function CI(r,e){let t=new De;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s,a){return D(this,null,function*(){try{let u=yield function(d,f){let m=O(d);return m.persistence.runTransaction("read document","readonly",_=>m.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new V(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=Si(u,`Failed to get document '${s} from cache`);a.reject(c)}})}(yield Gd(r),e,t)})),t.promise}function Yy(r,e,t={}){let n=new De;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,a,u,c,d){let f=new vi({next:_=>{a.enqueueAndForget(()=>Fd(s,m));let A=_.docs.has(u);!A&&_.fromCache?d.reject(new V(S.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&_.fromCache&&c&&c.source==="server"?d.reject(new V(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),m=new Xs(Ti(u.path),f,{includeMetadataChanges:!0,_a:!0});return Md(s,m)}(yield wi(r),r.asyncQueue,e,t,n)})),n.promise}function SI(r,e){let t=new De;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s,a){return D(this,null,function*(){try{let u=yield Ka(i,s,!0),c=new iu(s,u.Ts),d=c.ma(u.documents),f=c.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let c=Si(u,`Failed to execute query '${s} against cache`);a.reject(c)}})}(yield Gd(r),e,t)})),t.promise}function Zy(r,e,t={}){let n=new De;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,a,u,c,d){let f=new vi({next:_=>{a.enqueueAndForget(()=>Fd(s,m)),_.fromCache&&c.source==="server"?d.reject(new V(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),m=new Xs(u,f,{includeMetadataChanges:!0,_a:!0});return Md(s,m)}(yield wi(r),r.asyncQueue,e,t,n)})),n.promise}function PI(r,e){let t=new vi(e);return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s){O(i).Y_.add(s),s.next()}(yield wi(r),t)})),()=>{t.za(),r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s){O(i).Y_.delete(s)}(yield wi(r),t)}))}}function DI(r,e,t,n){let i=function(a,u){let c;return c=typeof a=="string"?hy().encode(a):a,function(f,m){return new Yh(f,m)}(function(f,m){if(f instanceof Uint8Array)return E_(f,m);if(f instanceof ArrayBuffer)return E_(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),u)}(t,ao(e));r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){II(yield zd(r),i,n)}))}function RI(r,e){return r.asyncQueue.enqueue(()=>D(this,null,function*(){return function(n,i){let s=O(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Gr.getNamedQuery(a,i))}(yield Gd(r),e)}))}function ev(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}var I_=new Map;function Kd(r,e,t){if(!t)throw new V(S.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Wd(r,e,t,n){if(e===!0&&n===!0)throw new V(S.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function T_(r){if(!L.isDocumentKey(r))throw new V(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function A_(r){if(L.isDocumentKey(r))throw new V(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function wu(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":U()}function se(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new V(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=wu(r);throw new V(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function tv(r,e){if(e<=0)throw new V(S.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}var ou=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new V(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new V(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Wd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ev((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},pr=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ou({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new V(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new V(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ou(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new yl;switch(n.type){case"firstParty":return new Il(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new V(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=I_.get(t);n&&(k("ComponentProvider","Removing Datastore"),I_.delete(t),n.terminate())}(this),Promise.resolve()}};function Eu(r,e,t,n={}){var i;let s=(r=se(r,pr))._getSettings(),a=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&mt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if(typeof n.mockUserToken=="string")u=n.mockUserToken,c=Pe.MOCK_USER;else{u=bm(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new V(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Pe(d)}r._authCredentials=new vl(new va(u,c))}}var Oe=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},he=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Lt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}},Lt=class r extends Oe{constructor(e,t,n){super(e,t,Ti(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new he(this.firestore,null,new L(e))}withConverter(e){return new r(this.firestore,e,this._path)}};function co(r,e,...t){if(r=ge(r),Kd("collection","path",e),r instanceof pr){let n=ie.fromString(e,...t);return A_(n),new Lt(r,null,n)}{if(!(r instanceof he||r instanceof Lt))throw new V(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(ie.fromString(e,...t));return A_(n),new Lt(r.firestore,null,n)}}function Hd(r,e){if(r=se(r,pr),Kd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new V(S.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Oe(r,null,function(n){return new bt(ie.emptyPath(),n)}(e))}function Pi(r,e,...t){if(r=ge(r),arguments.length===1&&(e=wa.newId()),Kd("doc","path",e),r instanceof pr){let n=ie.fromString(e,...t);return T_(n),new he(r,null,new L(n))}{if(!(r instanceof he||r instanceof Lt))throw new V(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(ie.fromString(e,...t));return T_(n),new he(r.firestore,r instanceof Lt?r.converter:null,new L(n))}}function lo(r,e){return r=ge(r),e=ge(e),(r instanceof he||r instanceof Lt)&&(e instanceof he||e instanceof Lt)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function Iu(r,e){return r=ge(r),e=ge(e),r instanceof Oe&&e instanceof Oe&&r.firestore===e.firestore&&so(r._query,e._query)&&r.converter===e.converter}var rd=class{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Js(this,"async_queue_retry"),this.Eu=()=>{let t=_a();t&&k("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};let e=_a();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;let t=_a();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});let t=new De;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){return D(this,null,function*(){if(this.uu.length!==0){try{yield this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!Un(e))throw e;k("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}})}Au(e){let t=this.au.then(()=>(this.Pu=!0,e().catch(n=>{this.hu=n,this.Pu=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw we("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.Pu=!1,n))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);let i=Bh.createAndSchedule(this,e,t,n,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&U()}verifyOperationInProgress(){}mu(){return D(this,null,function*(){let e;do e=this.au,yield e;while(e!==this.au)})}fu(e){for(let t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.lu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){let t=this.lu.indexOf(e);this.lu.splice(t,1)}};function id(r){return function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var sd=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new De,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var nv=-1,me=class extends pr{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=function(){return new rd}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||iv(this),this._firestoreClient.terminate()}};function rv(r,e){let t=typeof r=="object"?r:cs(),n=typeof r=="string"?r:e||"(default)",i=Mc(t,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=Am("firestore");s&&Eu(i,...s)}return i}function ke(r){return r._firestoreClient||iv(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function iv(r){var e,t,n;let i=r._freezeSettings(),s=function(u,c,d,f){return new Rl(u,c,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,ev(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._firestoreClient=new td(r._authCredentials,r._appCheckCredentials,r._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Qd(r,e){ov(r=se(r,me));let t=ke(r);if(t._uninitializedComponentsProvider)throw new V(S.FAILED_PRECONDITION,"SDK cache is already specified.");mt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=r._freezeSettings(),i=new Zs;return sv(t,i,new su(i,n.cacheSizeBytes,e?.forceOwnership))}function Jd(r){ov(r=se(r,me));let e=ke(r);if(e._uninitializedComponentsProvider)throw new V(S.FAILED_PRECONDITION,"SDK cache is already specified.");mt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings(),n=new Zs;return sv(e,n,new Xh(n,t.cacheSizeBytes))}function sv(r,e,t){let n=new De;return r.asyncQueue.enqueue(()=>D(this,null,function*(){try{yield ya(r,t),yield nd(r,e),n.resolve()}catch(i){let s=i;if(!Qy(s))throw s;mt("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function Xd(r){if(r._initialized&&!r._terminated)throw new V(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new De;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{yield function(n){return D(this,null,function*(){if(!Dn.D())return Promise.resolve();let i=n+"main";yield Dn.delete(i)})}(Vd(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Yd(r){return function(t){let n=new De;return t.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return hI(yield zd(t),n)})),n.promise}(ke(r=se(r,me)))}function Zd(r){return AI(ke(r=se(r,me)))}function ef(r){return bI(ke(r=se(r,me)))}function tf(r,e){let t=ke(r=se(r,me)),n=new sd;return DI(t,r._databaseId,e,n),n}function nf(r,e){return RI(ke(r=se(r,me)),e).then(t=>t?new Oe(r,null,t.query):null)}function ov(r){if(r._initialized||r._terminated)throw new V(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var jt=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(Te.fromBase64String(e))}catch(t){throw new V(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(Te.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var St=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ee(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var nn=class{constructor(e){this._methodName=e}};var mr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}};var eo=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}};var VI=/^__.*__$/,od=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Ct(e,this.data,this.fieldMask,t,this.fieldTransforms):new Mn(e,this.data,t,this.fieldTransforms)}},au=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ct(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function av(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}var uu=class r{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new r(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.vu(e),i}Cu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return cu(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(av(this.wu)&&VI.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}},ad=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ao(e)}Nu(e,t,n,i=!1){return new uu({wu:e,methodName:t,Ou:n,path:Ee.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function vr(r){let e=r._freezeSettings(),t=ao(r._databaseId);return new ad(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Tu(r,e,t,n,i,s={}){let a=r.Nu(s.merge||s.mergeFields?2:0,e,t,i);of("Data must be an object, but it was:",a,n);let u=lv(n,a),c,d;if(s.merge)c=new lt(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let m of s.mergeFields){let _=dd(e,m,t);if(!a.contains(_))throw new V(S.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);dv(f,_)||f.push(_)}c=new lt(f),d=a.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,d=a.fieldTransforms;return new od(new We(u),c,d)}var to=class r extends nn{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}};function uv(r,e,t){return new uu({wu:3,Ou:e.settings.Ou,methodName:r._methodName,Du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var ud=class r extends nn{_toFieldTransform(e){return new hr(e.path,new kn)}isEqual(e){return e instanceof r}},cd=class r extends nn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=uv(this,e,!0),n=this.Lu.map(s=>wr(s,t)),i=new en(n);return new hr(e.path,i)}isEqual(e){return e instanceof r&&Nc(this.Lu,e.Lu)}},ld=class r extends nn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=uv(this,e,!0),n=this.Lu.map(s=>wr(s,t)),i=new tn(n);return new hr(e.path,i)}isEqual(e){return e instanceof r&&Nc(this.Lu,e.Lu)}},hd=class r extends nn{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){let t=new Nn(e.serializer,ny(e.serializer,this.Bu));return new hr(e.path,t)}isEqual(e){return e instanceof r&&this.Bu===e.Bu}};function rf(r,e,t,n){let i=r.Nu(1,e,t);of("Data must be an object, but it was:",i,n);let s=[],a=We.empty();yr(n,(c,d)=>{let f=af(e,c,t);d=ge(d);let m=i.Cu(f);if(d instanceof to)s.push(f);else{let _=wr(d,m);_!=null&&(s.push(f),a.set(f,_))}});let u=new lt(s);return new au(a,u,i.fieldTransforms)}function sf(r,e,t,n,i,s){let a=r.Nu(1,e,t),u=[dd(e,n,t)],c=[i];if(s.length%2!=0)throw new V(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(dd(e,s[_])),c.push(s[_+1]);let d=[],f=We.empty();for(let _=u.length-1;_>=0;--_)if(!dv(d,u[_])){let A=u[_],x=c[_];x=ge(x);let N=a.Cu(A);if(x instanceof to)d.push(A);else{let R=wr(x,N);R!=null&&(d.push(A),f.set(A,R))}}let m=new lt(d);return new au(f,m,a.fieldTransforms)}function cv(r,e,t,n=!1){return wr(t,r.Nu(n?4:3,e))}function wr(r,e){if(hv(r=ge(r)))return of("Unsupported field value:",e,r),lv(r,e);if(r instanceof nn)return function(n,i){if(!av(i.wu))throw i.Mu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let c=wr(u,i.Fu(a));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=ge(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return ny(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=_e.fromDate(n);return{timestampValue:hi(i.serializer,s)}}if(n instanceof _e){let s=new _e(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:hi(i.serializer,s)}}if(n instanceof mr)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof jt)return{bytesValue:dy(i.serializer,n._byteString)};if(n instanceof he){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Mu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Pd(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof eo)return function(a,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(c=>{if(typeof c!="number")throw u.Mu("VectorValues must only contain numeric values.");return Sd(u.serializer,c)})}}}}}}(n,i);throw i.Mu(`Unsupported field value: ${wu(n)}`)}(r,e)}function lv(r,e){let t={};return L_(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):yr(r,(n,i)=>{let s=wr(i,e.bu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function hv(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof _e||r instanceof mr||r instanceof jt||r instanceof he||r instanceof nn||r instanceof eo)}function of(r,e,t){if(!hv(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let n=wu(t);throw n==="an object"?e.Mu(r+" a custom object"):e.Mu(r+" "+n)}}function dd(r,e,t){if((e=ge(e))instanceof St)return e._internalPath;if(typeof e=="string")return af(r,e);throw cu("Field path arguments must be of type string or ",r,!1,void 0,t)}var xI=new RegExp("[~\\*/\\[\\]]");function af(r,e,t){if(e.search(xI)>=0)throw cu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new St(...e.split("."))._internalPath}catch{throw cu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function cu(r,e,t,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new V(S.INVALID_ARGUMENT,u+r+c)}function dv(r,e){return r.some(t=>t.isEqual(e))}var gr=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new he(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new fd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Au("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},fd=class extends gr{data(){return super.data()}};function Au(r,e){return typeof e=="string"?af(r,e):e instanceof St?e._internalPath:e._delegate._internalPath}function fv(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new V(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var no=class{},_r=class extends no{};function $t(r,e,...t){let n=[];e instanceof no&&n.push(e),n=n.concat(t),function(s){let a=s.filter(c=>c instanceof pd).length,u=s.filter(c=>c instanceof lu).length;if(a>1||a>0&&u>0)throw new V(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var lu=class r extends _r{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=this._parse(e);return mv(e._query,t),new Oe(e.firestore,e.converter,$l(e._query,t))}_parse(e){let t=vr(e.firestore);return function(s,a,u,c,d,f,m){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new V(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){C_(m,f);let A=[];for(let x of m)A.push(b_(c,s,x));_={arrayValue:{values:A}}}else _=b_(c,s,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||C_(m,f),_=cv(u,a,m,f==="in"||f==="not-in");return te.create(d,f,_)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function uf(r,e,t){let n=e,i=Au("where",r);return lu._create(i,n,t)}var pd=class r extends no{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new r(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:ae.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let c of u)mv(a,c),a=$l(a,c)}(e._query,t),new Oe(e.firestore,e.converter,$l(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var md=class r extends _r{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new r(e,t)}_apply(e){let t=function(i,s,a){if(i.startAt!==null)throw new V(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new V(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new cr(s,a)}(e._query,this._field,this._direction);return new Oe(e.firestore,e.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new bt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function cf(r,e="asc"){let t=e,n=Au("orderBy",r);return md._create(n,t)}var hu=class r extends _r{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){return new Oe(e.firestore,e.converter,Ra(e._query,this._limit,this._limitType))}};function lf(r){return tv("limit",r),hu._create("limit",r,"F")}function hf(r){return tv("limitToLast",r),hu._create("limitToLast",r,"L")}var du=class r extends _r{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=pv(e,this.type,this._docOrFields,this._inclusive);return new Oe(e.firestore,e.converter,function(i,s){return new bt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function df(...r){return du._create("startAt",r,!0)}function ff(...r){return du._create("startAfter",r,!1)}var fu=class r extends _r{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=pv(e,this.type,this._docOrFields,this._inclusive);return new Oe(e.firestore,e.converter,function(i,s){return new bt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function pf(...r){return fu._create("endBefore",r,!1)}function mf(...r){return fu._create("endAt",r,!0)}function pv(r,e,t,n){if(t[0]=ge(t[0]),t[0]instanceof gr)return function(s,a,u,c,d){if(!c)throw new V(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let m of ri(s))if(m.field.isKeyField())f.push(ur(a,c.key));else{let _=c.data.field(m.field);if(mu(_))throw new V(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let A=m.field.canonicalString();throw new V(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}f.push(_)}return new qt(f,d)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{let i=vr(r.firestore);return function(a,u,c,d,f,m){let _=a.explicitOrderBy;if(f.length>_.length)throw new V(S.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let A=[];for(let x=0;x<f.length;x++){let N=f[x];if(_[x].field.isKeyField()){if(typeof N!="string")throw new V(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof N}`);if(!bd(a)&&N.indexOf("/")!==-1)throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${N}' contains a slash.`);let R=a.path.child(ie.fromString(N));if(!L.isDocumentKey(R))throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);let G=new L(R);A.push(ur(u,G))}else{let R=cv(c,d,N);A.push(R)}}return new qt(A,m)}(r._query,r.firestore._databaseId,i,e,t,n)}}function b_(r,e,t){if(typeof(t=ge(t))=="string"){if(t==="")throw new V(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bd(e)&&t.indexOf("/")!==-1)throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(ie.fromString(t));if(!L.isDocumentKey(n))throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ur(r,new L(n))}if(t instanceof he)return ur(r,t._key);throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${wu(t)}.`)}function C_(r,e){if(!Array.isArray(r)||r.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mv(r,e){let t=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new V(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new V(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Ei=class{convertValue(e,t="none"){switch(ar(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Rn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw U()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return yr(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;let s=(i=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>pe(a.doubleValue));return new eo(s)}convertGeoPoint(e){return new mr(pe(e.latitude),pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=Td(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Os(e));default:return null}}convertTimestamp(e){let t=Zt(e);return new _e(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=ie.fromString(e);B(Ty(n));let i=new Vn(n.get(1),n.get(3)),s=new L(n.popFirst(5));return i.isEqual(t)||we(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function bu(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}var gd=class extends Ei{constructor(e){super(),this.firestore=e}convertBytes(e){return new jt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new he(this.firestore,null,t)}};var Yt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},_t=class extends gr{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Sn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(Au("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},Sn=class extends _t{data(e={}){return super.data(e)}},Pt=class{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Yt(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Sn(this._firestore,this._userDataWriter,n.key,n,new Yt(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let c=new Sn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Yt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let c=new Sn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Yt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:kI(u.type),doc:c,oldIndex:d,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function kI(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function Cu(r,e){return r instanceof _t&&e instanceof _t?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(r._document===null?e._document===null:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Pt&&e instanceof Pt&&r._firestore===e._firestore&&Iu(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}function gf(r){r=se(r,he);let e=se(r.firestore,me);return Yy(ke(e),r._key).then(t=>Af(e,r,t))}var rn=class extends Ei{constructor(e){super(),this.firestore=e}convertBytes(e){return new jt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new he(this.firestore,null,t)}};function _f(r){r=se(r,he);let e=se(r.firestore,me),t=ke(e),n=new rn(e);return CI(t,r._key).then(i=>new _t(e,n,r._key,i,new Yt(i!==null&&i.hasLocalMutations,!0),r.converter))}function yf(r){r=se(r,he);let e=se(r.firestore,me);return Yy(ke(e),r._key,{source:"server"}).then(t=>Af(e,r,t))}function vf(r){r=se(r,Oe);let e=se(r.firestore,me),t=ke(e),n=new rn(e);return fv(r._query),Zy(t,r._query).then(i=>new Pt(e,n,r,i))}function wf(r){r=se(r,Oe);let e=se(r.firestore,me),t=ke(e),n=new rn(e);return SI(t,r._query).then(i=>new Pt(e,n,r,i))}function Ef(r){r=se(r,Oe);let e=se(r.firestore,me),t=ke(e),n=new rn(e);return Zy(t,r._query,{source:"server"}).then(i=>new Pt(e,n,r,i))}function Su(r,e,t){r=se(r,he);let n=se(r.firestore,me),i=bu(r.converter,e,t);return Ri(n,[Tu(vr(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,ve.none())])}function Pu(r,e,t,...n){r=se(r,he);let i=se(r.firestore,me),s=vr(i),a;return a=typeof(e=ge(e))=="string"||e instanceof St?sf(s,"updateDoc",r._key,e,t,n):rf(s,"updateDoc",r._key,e),Ri(i,[a.toMutation(r._key,ve.exists(!0))])}function If(r){return Ri(se(r.firestore,me),[new Fn(r._key,ve.none())])}function Du(r,e){let t=se(r.firestore,me),n=Pi(r),i=bu(r.converter,e);return Ri(t,[Tu(vr(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,ve.exists(!1))]).then(()=>n)}function Di(r,...e){var t,n,i;r=ge(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||id(e[a])||(s=e[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(id(e[a])){let m=e[a];e[a]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[a+1]=(n=m.error)===null||n===void 0?void 0:n.bind(m),e[a+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let c,d,f;if(r instanceof he)d=se(r.firestore,me),f=Ti(r._key.path),c={next:m=>{e[a]&&e[a](Af(d,r,m))},error:e[a+1],complete:e[a+2]};else{let m=se(r,Oe);d=se(m.firestore,me),f=m._query;let _=new rn(d);c={next:A=>{e[a]&&e[a](new Pt(d,_,m,A))},error:e[a+1],complete:e[a+2]},fv(r._query)}return function(_,A,x,N){let R=new vi(N),G=new Xs(A,R,x);return _.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return Md(yield wi(_),G)})),()=>{R.za(),_.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return Fd(yield wi(_),G)}))}}(ke(d),f,u,c)}function Tf(r,e){return PI(ke(r=se(r,me)),id(e)?e:{next:e})}function Ri(r,e){return function(n,i){let s=new De;return n.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return aI(yield zd(n),i,s)})),s.promise}(ke(r),e)}function Af(r,e,t){let n=t.docs.get(e._key),i=new rn(r);return new _t(r,i,e._key,n,new Yt(t.hasPendingWrites,t.fromCache),e.converter)}var NI={maxAttempts:5};var pu=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=vr(e)}set(e,t,n){this._verifyNotCommitted();let i=bn(e,this._firestore),s=bu(i.converter,t,n),a=Tu(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,ve.none())),this}update(e,t,n,...i){this._verifyNotCommitted();let s=bn(e,this._firestore),a;return a=typeof(t=ge(t))=="string"||t instanceof St?sf(this._dataReader,"WriteBatch.update",s._key,t,n,i):rf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,ve.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=bn(e,this._firestore);return this._mutations=this._mutations.concat(new Fn(t._key,ve.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function bn(r,e){if((r=ge(r)).firestore!==e)throw new V(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var _d=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=vr(t)}get(t){let n=bn(t,this._firestore),i=new gd(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return U();let a=s[0];if(a.isFoundDocument())return new gr(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new gr(this._firestore,i,n._key,null,n.converter);throw U()})}set(t,n,i){let s=bn(t,this._firestore),a=bu(s.converter,n,i),u=Tu(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){let a=bn(t,this._firestore),u;return u=typeof(n=ge(n))=="string"||n instanceof St?sf(this._dataReader,"Transaction.update",a._key,n,i,s):rf(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(t){let n=bn(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=bn(e,this._firestore),n=new rn(this._firestore);return super.get(e).then(i=>new _t(this._firestore,n,t._key,i._document,new Yt(!1,!1),t.converter))}};function bf(r,e,t){r=se(r,me);let n=Object.assign(Object.assign({},NI),t);return function(s){if(s.maxAttempts<1)throw new V(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let c=new De;return s.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){let d=yield TI(s);new ed(s.asyncQueue,d,u,a,c).ru()})),c.promise}(ke(r),i=>e(new _d(r,i)),n)}function Cf(){return new to("deleteField")}function Sf(){return new ud("serverTimestamp")}function Pf(...r){return new cd("arrayUnion",r)}function Df(...r){return new ld("arrayRemove",r)}function Rf(r){return new hd("increment",r)}(function(e,t=!0){(function(i){Ii=i})(Pm),us(new Qn("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new me(new wl(n.getProvider("auth-internal")),new Al(n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new V(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Vn(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),Ge(bg,"4.7.1",e),Ge(bg,"4.7.1","esm2017")})();var MI="@firebase/firestore-compat",FI="0.3.36";function Ff(r,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new V("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function gv(){if(typeof Uint8Array>"u")throw new V("unimplemented","Uint8Arrays are not available in this environment.")}function _v(){if(!U_())throw new V("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Ru=class r{constructor(e){this._delegate=e}static fromBase64String(e){return _v(),new r(jt.fromBase64String(e))}static fromUint8Array(e){return gv(),new r(jt.fromUint8Array(e))}toBase64(){return _v(),this._delegate.toBase64()}toUint8Array(){return gv(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Vf(r){return OI(r,["next","error","complete"])}function OI(r,e){if(typeof r!="object"||r===null)return!1;let t=r;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var xf=class{enableIndexedDbPersistence(e,t){return Qd(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Jd(e._delegate)}clearIndexedDbPersistence(e){return Xd(e._delegate)}},Vu=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Vn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&mt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){Eu(this._delegate,e,t,n)}enableNetwork(){return Zd(this._delegate)}disableNetwork(){return ef(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Wd("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Yd(this._delegate)}onSnapshotsInSync(e){return Tf(this._delegate,e)}get app(){if(!this._appCompat)throw new V("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ki(this,co(this._delegate,e))}catch(t){throw et(t,"collection()","Firestore.collection()")}}doc(e){try{return new Gt(this,Pi(this._delegate,e))}catch(t){throw et(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ar(this,Hd(this._delegate,e))}catch(t){throw et(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return bf(this._delegate,t=>e(new xu(this,t)))}batch(){return ke(this._delegate),new ku(new pu(this._delegate,e=>Ri(this._delegate,e)))}loadBundle(e){return tf(this._delegate,e)}namedQuery(e){return nf(this._delegate,e).then(t=>t?new Ar(this,t):null)}},Vi=class extends Ei{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ru(new jt(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Gt.forKey(t,this.firestore,null)}};function LI(r){yd(r)}var xu=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Vi(e)}get(e){let t=Er(e);return this._delegate.get(t).then(n=>new Ir(this._firestore,new _t(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let i=Er(e);return n?(Ff("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=Er(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=Er(e);return this._delegate.delete(t),this}},ku=class{constructor(e){this._delegate=e}set(e,t,n){let i=Er(e);return n?(Ff("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=Er(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=Er(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},xi=class r{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new Sn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Tr(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=r.INSTANCES,i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new r(e,new Vi(e),t),i.set(t,s)),s}};xi.INSTANCES=new WeakMap;var Gt=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Vi(e)}static forPath(e,t,n){if(e.length%2!==0)throw new V("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new r(t,new he(t._delegate,n,new L(e)))}static forKey(e,t,n){return new r(t,new he(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new ki(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ki(this.firestore,co(this._delegate,e))}catch(t){throw et(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ge(e),e instanceof he?lo(this._delegate,e):!1}set(e,t){t=Ff("DocumentReference.set",t);try{return t?Su(this._delegate,e,t):Su(this._delegate,e)}catch(n){throw et(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?Pu(this._delegate,e):Pu(this._delegate,e,t,...n)}catch(i){throw et(i,"updateDoc()","DocumentReference.update()")}}delete(){return If(this._delegate)}onSnapshot(...e){let t=yv(e),n=vv(e,i=>new Ir(this.firestore,new _t(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Di(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=_f(this._delegate):e?.source==="server"?t=yf(this._delegate):t=gf(this._delegate),t.then(n=>new Ir(this.firestore,new _t(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(xi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function et(r,e,t){return r.message=r.message.replace(e,t),r}function yv(r){for(let e of r)if(typeof e=="object"&&!Vf(e))return e;return{}}function vv(r,e){var t,n;let i;return Vf(r[0])?i=r[0]:Vf(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var Ir=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Gt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Cu(this._delegate,e._delegate)}},Tr=class extends Ir{data(e){let t=this._delegate.data(e);return this._delegate._converter||S_(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Ar=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Vi(e)}where(e,t,n){try{return new r(this.firestore,$t(this._delegate,uf(e,t,n)))}catch(i){throw et(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new r(this.firestore,$t(this._delegate,cf(e,t)))}catch(n){throw et(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new r(this.firestore,$t(this._delegate,lf(e)))}catch(t){throw et(t,"limit()","Query.limit()")}}limitToLast(e){try{return new r(this.firestore,$t(this._delegate,hf(e)))}catch(t){throw et(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new r(this.firestore,$t(this._delegate,df(...e)))}catch(t){throw et(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new r(this.firestore,$t(this._delegate,ff(...e)))}catch(t){throw et(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new r(this.firestore,$t(this._delegate,pf(...e)))}catch(t){throw et(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new r(this.firestore,$t(this._delegate,mf(...e)))}catch(t){throw et(t,"endAt()","Query.endAt()")}}isEqual(e){return Iu(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=wf(this._delegate):e?.source==="server"?t=Ef(this._delegate):t=vf(this._delegate),t.then(n=>new ho(this.firestore,new Pt(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=yv(e),n=vv(e,i=>new ho(this.firestore,new Pt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Di(this._delegate,t,n)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(xi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},kf=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Tr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},ho=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ar(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Tr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new kf(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new Tr(this._firestore,n))})}isEqual(e){return Cu(this._delegate,e._delegate)}},ki=class r extends Ar{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Gt(this.firestore,e):null}doc(e){try{return e===void 0?new Gt(this.firestore,Pi(this._delegate)):new Gt(this.firestore,Pi(this._delegate,e))}catch(t){throw et(t,"doc()","CollectionReference.doc()")}}add(e){return Du(this._delegate,e).then(t=>new Gt(this.firestore,t))}isEqual(e){return lo(this._delegate,e._delegate)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(xi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Er(r){return se(r,he)}var Nf=class r{constructor(...e){this._delegate=new St(...e)}static documentId(){return new r(Ee.keyField().canonicalString())}isEqual(e){return e=ge(e),e instanceof St?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Mf=class r{constructor(e){this._delegate=e}static serverTimestamp(){let e=Sf();return e._methodName="FieldValue.serverTimestamp",new r(e)}static delete(){let e=Cf();return e._methodName="FieldValue.delete",new r(e)}static arrayUnion(...e){let t=Pf(...e);return t._methodName="FieldValue.arrayUnion",new r(t)}static arrayRemove(...e){let t=Df(...e);return t._methodName="FieldValue.arrayRemove",new r(t)}static increment(e){let t=Rf(e);return t._methodName="FieldValue.increment",new r(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var UI={Firestore:Vu,GeoPoint:mr,Timestamp:_e,Blob:Ru,Transaction:xu,WriteBatch:ku,DocumentReference:Gt,DocumentSnapshot:Ir,Query:Ar,QueryDocumentSnapshot:Tr,QuerySnapshot:ho,CollectionReference:ki,FieldPath:Nf,FieldValue:Mf,setLogLevel:LI,CACHE_SIZE_UNLIMITED:nv};function qI(r,e){r.INTERNAL.registerComponent(new Qn("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},UI)))}function BI(r){qI(r,(e,t)=>new Vu(e,t,new xf)),r.registerVersion(MI,FI)}BI(Je);function jI(r,e=ko){return new Dt(t=>{let n;return e!=null?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function wv(r,e){return jI(r,e)}function $I(r,e){return wv(r,e).pipe(ts(void 0),Zi(),Ae(t=>{let[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Uf(r,e){return wv(r,e).pipe(Ae(t=>({payload:t,type:"query"})))}var Nu=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:i,query:s}=bv(n,t);return new Fu(i,s,this.afs)}snapshotChanges(){return $I(this.ref,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return this.snapshotChanges().pipe(Ae(({payload:t})=>e.idField?ot(je({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return wt(this.ref.get(e)).pipe(Xe)}};function Mu(r,e){return Uf(r,e).pipe(ts(void 0),Zi(),Ae(t=>{let[n,i]=t,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{let d=s.find(m=>m.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(m=>m.ref.isEqual(u.ref));d&&JSON.stringify(d.doc.metadata)===JSON.stringify(u.metadata)||!d&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),a}))}function Ev(r,e,t){return Mu(r,t).pipe(es((n,i)=>GI(n,i.map(s=>s.payload),e),[]),Ic(),Ae(n=>n.map(i=>({type:i.type,payload:i}))))}function GI(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=zI(r,n))}),r}function Of(r,e,t,...n){let i=r.slice();return i.splice(e,t,...n),i}function zI(r,e){switch(e.type){case"added":if(!(r[e.newIndex]&&r[e.newIndex].doc.ref.isEqual(e.doc.ref)))return Of(r,e.newIndex,0,e);break;case"modified":if(r[e.oldIndex]==null||r[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Of(r,e.newIndex,1,e);break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Of(r,e.oldIndex,1);break}return r}function Iv(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var Fu=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=Mu(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ae(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(ts(void 0),Zi(),Vr(([n,i])=>i.length>0||!n),Ae(([,n])=>n),Xe)}auditTrail(e){return this.stateChanges(e).pipe(es((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=Iv(e);return Ev(this.query,t,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return Uf(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(t=>t.payload.docs.map(n=>e.idField?ot(je({},n.data()),{[e.idField]:n.id}):n.data())),Xe)}get(e){return wt(this.query.get(e)).pipe(Xe)}add(e){return this.ref.add(e)}doc(e){return new Nu(this.ref.doc(e),this.afs)}},Lf=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Mu(this.query,this.afs.schedulers.outsideAngular).pipe(Xe):Mu(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(t=>t.filter(n=>e.indexOf(n.type)>-1)),Vr(t=>t.length>0),Xe)}auditTrail(e){return this.stateChanges(e).pipe(es((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=Iv(e);return Ev(this.query,t,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return Uf(this.query,this.afs.schedulers.outsideAngular).pipe(Ae(n=>n.payload.docs.map(i=>e.idField?je({[e.idField]:i.id},i.data()):i.data())),Xe)}get(e){return wt(this.query.get(e)).pipe(Xe)}},Tv=new ue("angularfire2.enableFirestorePersistence"),Av=new ue("angularfire2.firestore.persistenceSettings"),KI=new ue("angularfire2.firestore.settings"),WI=new ue("angularfire2.firestore.use-emulator");function bv(r,e=t=>t){return{query:e(r),ref:r}}var qf=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,s,a,u,c,d,f,m,_,A,x,N,R,G,z){this.schedulers=c;let F=vs(t,u,n),K=f;m&&ol(F,u,_,x,N,R,A,G),[this.firestore,this.persistenceEnabled$]=sa(`${F.name}.firestore`,"AngularFirestore",F.name,()=>{let H=u.runOutsideAngular(()=>F.firestore());if(s&&H.settings(s),K&&H.useEmulator(...K),i&&!Uo(a)){let Q=()=>{try{return wt(H.enablePersistence(d||void 0).then(()=>!0,()=>!1))}catch(w){return typeof console<"u"&&console.warn(w),hn(!1)}};return[H,u.runOutsideAngular(Q)]}else return[H,hn(!1)]},[s,K,i])}collection(t,n){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:a}=bv(i,n),u=this.schedulers.ngZone.run(()=>s);return new Fu(u,a,this)}collectionGroup(t,n){let i=n||(a=>a),s=this.firestore.collectionGroup(t);return new Lf(i(s),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let i=this.schedulers.ngZone.run(()=>n);return new Nu(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(Y(vn),Y(Gr,8),Y(Tv,8),Y(KI,8),Y(dn),Y(nt),Y(kt),Y(Av,8),Y(WI,8),Y(Es,8),Y(el,8),Y(tl,8),Y(nl,8),Y(rl,8),Y(il,8),Y(sl,8),Y(Tt,8))};static \u0275prov=at({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),Cv=(()=>{class r{constructor(){Je.registerVersion("angularfire",rt.full,"fst-compat")}static enablePersistence(t){return{ngModule:r,providers:[{provide:Tv,useValue:!0},{provide:Av,useValue:t}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=dt({type:r});static \u0275inj=ht({providers:[qf]})}return r})();var Bn=class r{loadingSubject=new Hp(!1);isLoading$=this.loadingSubject.asObservable();show(){this.loadingSubject.next(!0)}hide(){this.loadingSubject.next(!1)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=at({token:r,factory:r.\u0275fac,providedIn:"root"})};function QI(r,e){r&1&&(q(0,"div",1),Fe(1,"div",2),j())}var Ou=class r{constructor(e){this.loadingService=e}isLoading=!1;ngOnInit(){this.loadingService.isLoading$.subscribe(e=>{this.isLoading=e})}static \u0275fac=function(t){return new(t||r)(Z(Bn))};static \u0275cmp=$e({type:r,selectors:[["app-loading-spinner"]],decls:1,vars:1,consts:[["class","spinner-overlay",4,"ngIf"],[1,"spinner-overlay"],[1,"spinner"]],template:function(t,n){t&1&&Ve(0,QI,2,0,"div",0),t&2&&ee("ngIf",n.isLoading)},dependencies:[Vt],styles:['@charset "UTF-8";.spinner-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:5px solid rgba(255,255,255,.3);border-top:5px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}']})};var Lu=class r{constructor(e){this.router=e;this.router.events.subscribe(t=>{t instanceof ym&&(this.isLoading=!0),(t instanceof vm||t instanceof wm||t instanceof Em)&&(this.isLoading=!1)})}title="sala-de-juegos-miku";isLoading=!1;static \u0275fac=function(t){return new(t||r)(Z(mn))};static \u0275cmp=$e({type:r,selectors:[["app-root"]],decls:2,vars:0,template:function(t,n){t&1&&Fe(0,"app-loading-spinner")(1,"router-outlet")},dependencies:[Im,Ou]})};var Uu={production:!1,firebase:{apiKey:"AIzaSyAH2PDjT8fTlZKtxpamixaJHM577sd1ZEM",authDomain:"sala-de-juegos-miku.firebaseapp.com",projectId:"sala-de-juegos-miku",storageBucket:"sala-de-juegos-miku.appspot.com",messagingSenderId:"370998800826",appId:"1:370998800826:web:8a81d58f46e46b8f77ad83"}};var yt=class r{constructor(e,t){this.afAuth=e;this.firestore=t}registrarUsuario(e,t){return this.afAuth.createUserWithEmailAndPassword(e,t)}getUsuarioActual(){return this.afAuth.authState}loguearUsuario(e,t){return this.afAuth.signInWithEmailAndPassword(e,t)}registrarIngreso(e){let t=new Date().toISOString();return this.firestore.collection("logs").add({email:e,fechaIngreso:t})}guardarUsuario(e,t){return this.firestore.collection("usuarios").add({email:e,avatar:t})}verificarUsuario(e){return this.firestore.collection("usuarios",t=>t.where("email","==",e)).get()}obtenerDatosUsuario(e){return this.firestore.collection("usuarios",t=>t.where("email","==",e)).valueChanges()}logout(){return this.afAuth.signOut()}static \u0275fac=function(t){return new(t||r)(Y(Es),Y(qf))};static \u0275prov=at({token:r,factory:r.\u0275fac,providedIn:"root"})};var XI=r=>({selected:r});function YI(r,e){r&1&&(q(0,"div"),X(1,"El correo electr\xF3nico es requerido."),j())}function ZI(r,e){r&1&&(q(0,"div"),X(1,"Debe ingresar un correo electr\xF3nico v\xE1lido."),j())}function eT(r,e){if(r&1&&(q(0,"div"),Ve(1,YI,2,0,"div",5)(2,ZI,2,0,"div",5),j()),r&2){let t=Ne();ne(),ee("ngIf",t.email.errors==null?null:t.email.errors.required),ne(),ee("ngIf",t.email.errors==null?null:t.email.errors.email)}}function tT(r,e){r&1&&(q(0,"div"),X(1,"La contrase\xF1a es requerida."),j())}function nT(r,e){r&1&&(q(0,"div"),X(1,"La contrase\xF1a debe tener al menos 8 caracteres, incluyendo una letra may\xFAscula, una letra min\xFAscula y un n\xFAmero."),j())}function rT(r,e){if(r&1&&(q(0,"div"),Ve(1,tT,2,0,"div",5)(2,nT,2,0,"div",5),j()),r&2){let t=Ne();ne(),ee("ngIf",t.password.errors==null?null:t.password.errors.required),ne(),ee("ngIf",t.password.errors==null?null:t.password.errors.pattern)}}function iT(r,e){if(r&1){let t=Nr();q(0,"div",12),be("click",function(){let i=Et(t).index,s=Ne();return It(s.selectAvatar(i))}),j()}if(r&2){let t=e.index,n=Ne();ee("ngClass",um(1,XI,n.selectedAvatar===t))}}var Bu=class r{constructor(e,t){this.authService=e;this.router=t}email=new yn("",[ut.required,ut.email]);password=new yn("",[ut.required,ut.pattern("(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,}")]);avatars=[0,1,2,3,4,5];selectedAvatar=-1;selectAvatar(e){this.selectedAvatar=e}signup(){return D(this,null,function*(){if(this.email.valid&&this.password.valid&&this.selectedAvatar!==-1)try{let e=this.email.value??"",t=this.password.value??"";yield this.authService.registrarUsuario(e,t),yield this.authService.loguearUsuario(e,t),yield this.authService.registrarIngreso(e),yield this.authService.guardarUsuario(e,this.selectedAvatar+1),this.router.navigate(["/home"])}catch(e){console.error("Error al registrar usuario:",e)}else console.log("Formulario no v\xE1lido o avatar no seleccionado")})}static \u0275fac=function(t){return new(t||r)(Z(yt),Z(mn))};static \u0275cmp=$e({type:r,selectors:[["app-registro"]],standalone:!0,features:[ft],decls:21,vars:5,consts:[[1,"registro-container"],[3,"ngSubmit"],[1,"form-group"],["for","email"],["id","email","placeholder","Correo Electr\xF3nico","type","email",3,"formControl"],[4,"ngIf"],["for","password"],["id","password","placeholder","Contrase\xF1a","type","password",3,"formControl"],[1,"avatar-selection"],[1,"avatar-container"],["class","avatar",3,"ngClass","click",4,"ngFor","ngForOf"],["type","submit"],[1,"avatar",3,"click","ngClass"]],template:function(t,n){t&1&&(q(0,"div",0)(1,"h1"),X(2,"Registro"),j(),q(3,"form",1),be("ngSubmit",function(){return n.signup()}),q(4,"div",2)(5,"label",3),X(6,"Correo Electr\xF3nico"),j(),Fe(7,"input",4),Ve(8,eT,3,2,"div",5),j(),q(9,"div",2)(10,"label",6),X(11,"Contrase\xF1a"),j(),Fe(12,"input",7),Ve(13,rT,3,2,"div",5),j(),q(14,"div",8)(15,"h3"),X(16,"Selecciona tu avatar"),j(),q(17,"div",9),Ve(18,iT,1,3,"div",10),j()(),q(19,"button",11),X(20,"Registrar"),j()()()),t&2&&(ne(7),ee("formControl",n.email),ne(),ee("ngIf",n.email.invalid&&(n.email.dirty||n.email.touched)),ne(4),ee("formControl",n.password),ne(),ee("ngIf",n.password.invalid&&(n.password.dirty||n.password.touched)),ne(5),ee("ngForOf",n.avatars))},dependencies:[Br,ea,_n,qr,Xo,gs,Vt,jr,_s,Mr,Oo,Lo,pm],styles:['@charset "UTF-8";.registro-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-image:url("./media/bg-login-WAFZCKQU.jpg");background-size:cover;background-position:center;color:#fff;text-align:center;padding:20px}form[_ngcontent-%COMP%]{background:#00000080;padding:20px;border-radius:10px;width:100%;max-width:400px;display:flex;flex-direction:column;align-items:center}h1[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px;width:100%;text-align:left}label[_ngcontent-%COMP%]{margin-bottom:8px;font-size:1.2rem}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:5px;border:none;border-radius:5px;font-size:1rem;box-sizing:border-box}.avatar-selection[_ngcontent-%COMP%]{margin-bottom:20px}.avatar-selection[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:10px}.avatar-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px;margin-bottom:20px}.avatar[_ngcontent-%COMP%]{width:50px;height:50px;cursor:pointer;border-radius:50%;background-size:cover;background-position:center;transition:opacity .3s}.avatar[_ngcontent-%COMP%]:nth-child(1){background-image:url("./media/1-7JTWOHSV.png")}.avatar[_ngcontent-%COMP%]:nth-child(2){background-image:url("./media/2-A2XFVD4P.png")}.avatar[_ngcontent-%COMP%]:nth-child(3){background-image:url("./media/3-KTJXIZCC.png")}.avatar[_ngcontent-%COMP%]:nth-child(4){background-image:url("./media/4-KV5JVTCC.png")}.avatar[_ngcontent-%COMP%]:nth-child(5){background-image:url("./media/5-G3AF32Y2.png")}.avatar[_ngcontent-%COMP%]:nth-child(6){background-image:url("./media/6-RMVKQPLO.png")}.avatar.selected[_ngcontent-%COMP%]{opacity:.5}button[_ngcontent-%COMP%]{width:100%;padding:10px 20px;font-size:1.2rem;background-color:#6200ea;color:#fff;border:none;border-radius:5px;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{background-color:#3700b3}']})};function sT(r,e){r&1&&(q(0,"div"),X(1,"El correo electr\xF3nico es requerido."),j())}function oT(r,e){r&1&&(q(0,"div"),X(1,"Debe ingresar un correo electr\xF3nico v\xE1lido."),j())}function aT(r,e){if(r&1&&(q(0,"div"),Ve(1,sT,2,0,"div",5)(2,oT,2,0,"div",5),j()),r&2){let t=Ne();ne(),ee("ngIf",t.email.errors==null?null:t.email.errors.required),ne(),ee("ngIf",t.email.errors==null?null:t.email.errors.email)}}function uT(r,e){r&1&&(q(0,"div"),X(1,"La contrase\xF1a es requerida."),j())}function cT(r,e){r&1&&(q(0,"div"),X(1,"La contrase\xF1a debe tener al menos 8 caracteres, incluyendo una letra may\xFAscula, una letra min\xFAscula y un n\xFAmero."),j())}function lT(r,e){if(r&1&&(q(0,"div"),Ve(1,uT,2,0,"div",5)(2,cT,2,0,"div",5),j()),r&2){let t=Ne();ne(),ee("ngIf",t.password.errors==null?null:t.password.errors.required),ne(),ee("ngIf",t.password.errors==null?null:t.password.errors.pattern)}}var ju=class r{constructor(e,t){this.authService=e;this.router=t}fullname=new yn("",[ut.required]);email=new yn("",[ut.required,ut.email]);password=new yn("",[ut.required,ut.pattern("(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,}")]);signup(){return D(this,null,function*(){if(this.email.valid&&this.password.valid)try{let e=this.email.value??"",t=this.password.value??"";yield this.authService.loguearUsuario(e,t),yield this.authService.registrarIngreso(e),this.router.navigate(["/home"])}catch(e){console.error("Error al registrar usuario:",e)}else console.log("Formulario no v\xE1lido")})}fillDefaultValues(){this.email.setValue("aa@gmail.com"),this.password.setValue("Aa123456")}static \u0275fac=function(t){return new(t||r)(Z(yt),Z(mn))};static \u0275cmp=$e({type:r,selectors:[["app-login"]],standalone:!0,features:[ft],decls:18,vars:4,consts:[[1,"registro-container"],[3,"ngSubmit"],[1,"form-group"],["for","email"],["id","email","placeholder","Correo Electr\xF3nico","type","email",3,"formControl"],[4,"ngIf"],["for","password"],["id","password","placeholder","Contrase\xF1a","type","password",3,"formControl"],["type","submit"],["type","button",3,"click"]],template:function(t,n){t&1&&(q(0,"div",0)(1,"h1"),X(2,"Ingreso"),j(),q(3,"form",1),be("ngSubmit",function(){return n.signup()}),q(4,"div",2)(5,"label",3),X(6,"Correo Electr\xF3nico"),j(),Fe(7,"input",4),Ve(8,aT,3,2,"div",5),j(),q(9,"div",2)(10,"label",6),X(11,"Contrase\xF1a"),j(),Fe(12,"input",7),Ve(13,lT,3,2,"div",5),j(),q(14,"button",8),X(15,"Ingresar"),j(),q(16,"button",9),be("click",function(){return n.fillDefaultValues()}),X(17,"Rellenar Valores"),j()()()),t&2&&(ne(7),ee("formControl",n.email),ne(),ee("ngIf",n.email.invalid&&(n.email.dirty||n.email.touched)),ne(4),ee("formControl",n.password),ne(),ee("ngIf",n.password.invalid&&(n.password.dirty||n.password.touched)))},dependencies:[Br,ea,_n,qr,Xo,gs,Vt,jr,_s,Mr],styles:['@charset "UTF-8";.registro-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-image:url("./media/bg-login-WAFZCKQU.jpg");background-size:cover;color:#fff;text-align:center;padding:20px}form[_ngcontent-%COMP%]{background:#00000080;padding:20px;border-radius:10px;width:300px}h1[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:8px}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:5px;border:none;border-radius:5px;font-size:1rem;box-sizing:border-box}button[_ngcontent-%COMP%]{padding:10px 20px;font-size:1.2rem;background-color:#6200ea;color:#fff;border:none;border-radius:5px;cursor:pointer;margin-bottom:10px}button[_ngcontent-%COMP%]:hover{background-color:#3700b3}']})};var hT=["*"],$u=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=$e({type:r,selectors:[["app-cartel"]],standalone:!0,features:[ft],ngContentSelectors:hT,decls:2,vars:0,consts:[[1,"cartel-container"]],template:function(t,n){t&1&&(nm(),q(0,"div",0),rm(1),j())},styles:[".cartel-container[_ngcontent-%COMP%]{background-color:#00000080;padding:20px;border-radius:10px;color:#fff;box-shadow:0 4px 8px #0003;text-align:center;font-size:1.2rem}"]})};var Gu=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=$e({type:r,selectors:[["app-quien-soy"]],standalone:!0,features:[ft],decls:16,vars:0,consts:[[1,"sobre-mi-container"],[1,"info-container"],[1,"imagen"],["src","../../assets/foto.jpg"]],template:function(t,n){t&1&&(q(0,"div",0)(1,"h2"),X(2,"Quien soy?"),j(),q(3,"div",1)(4,"app-cartel")(5,"h3"),X(6,"Datos Personales"),j(),q(7,"p"),X(8,"Mi nombre es Franco Ferrari, soy estudiante de TUP, y esta p\xE1gina es mi tributo a VOCALOID."),j()(),q(9,"div",2),Fe(10,"img",3),j()(),q(11,"app-cartel")(12,"h3"),X(13,"Explicaci\xF3n del Juego"),j(),q(14,"p"),X(15,"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque vehicula, eros at ultrices efficitur, ligula est tincidunt odio, sed scelerisque justo quam eget mauris. Praesent sodales mollis libero nec volutpat. Ut auctor massa ac quam faucibus, at eleifend nisl suscipit. Nam maximus orci sit amet metus volutpat cursus."),j()()())},dependencies:[$u],styles:['@charset "UTF-8";.sobre-mi-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;padding:20px;height:100vh;background-image:url("./media/bg-quien-XPJPV2SH.jpg");background-size:cover;background-position:center;color:#fff}.info-container[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;margin-bottom:30px}.datos-personales[_ngcontent-%COMP%]{flex:1;padding:10px}.imagen[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:200px;height:auto;border-radius:50%}.explicacion-juego[_ngcontent-%COMP%]{max-width:600px}h2[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:20px}h3[_ngcontent-%COMP%]{margin-top:20px}p[_ngcontent-%COMP%]{font-size:1.2rem}']})};var Sv="auth",fo=class{constructor(e){return e}},po=class{constructor(){return ys(Sv)}};var $f=new ue("angularfire2.auth-instances");function hA(r,e){let t=na(Sv,r,e);return t&&new fo(t)}function dA(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new fo(n)}}var fA={provide:po,deps:[[new tt,$f]]},pA={provide:fo,useFactory:hA,deps:[[new tt,$f],Qt]};function Pv(r,...e){return Ge("angularfire",rt.full,"auth"),xr([pA,fA,{provide:$f,useFactory:dA(r),multi:!0,deps:[nt,Hn,kt,Yn,[new tt,Tt],...e]}])}var Dv=Ht(Fc,!0);var zu=function(){return zu=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},zu.apply(this,arguments)};var gA={includeMetadataChanges:!1};function Rv(r,e){return e===void 0&&(e=gA),new Dt(function(t){var n=Di(r,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:n}})}function Vv(r,e){var t;e===void 0&&(e={});var n=r.data(e);return!r.exists()||typeof n!="object"||n===null||!e.idField?n:zu(zu({},n),(t={},t[e.idField]=r.id,t))}function xv(r){return Rv(r,{includeMetadataChanges:!0}).pipe(Ae(function(e){return e.docs}))}function kv(r,e){return e===void 0&&(e={}),xv(r).pipe(Ae(function(t){return t.map(function(n){return Vv(n,e)})}))}var Cr=class{constructor(e){return e}},Nv="firestore",Gf=class{constructor(){return ys(Nv)}};var zf=new ue("angularfire2.firestore-instances");function _A(r,e){let t=na(Nv,r,e);return t&&new Cr(t)}function yA(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new Cr(n)}}var vA={provide:Gf,deps:[[new tt,zf]]},wA={provide:Cr,useFactory:_A,deps:[[new tt,zf],Qt]};function Mv(r,...e){return Ge("angularfire",rt.full,"fst"),xr([wA,vA,{provide:zf,useFactory:yA(r),multi:!0,deps:[nt,Hn,kt,Yn,[new tt,po],[new tt,Tt],...e]}])}var Fv=Ht(kv,!0);var Ov=Ht(Du,!0);var Kf=Ht(co,!0);var Lv=Ht(rv,!0);var IA=(r,e)=>({"my-message":r,"other-message":e});function TA(r,e){if(r&1&&(q(0,"div",8),Fe(1,"img",9),q(2,"span",10),X(3),j()()),r&2){let t=Ne().$implicit,n=Ne();ne(),ee("src",n.getAvatarURL(),Mo),ne(2),is(t.email)}}function AA(r,e){if(r&1&&(q(0,"div",5),Ve(1,TA,4,2,"div",6),q(2,"div",7)(3,"p"),X(4),j()()()),r&2){let t=e.$implicit,n=Ne();ee("ngClass",cm(3,IA,t.email===n.userEmail,t.email!==n.userEmail)),ne(),ee("ngIf",t.email!==n.userEmail),ne(3),is(t.text)}}var Ku=class r{constructor(e,t){this.authService=e;this.firestore=t}newMessage="";messages=[];userEmail=null;userAvatar=1;ngOnInit(){this.authService.getUsuarioActual().subscribe(e=>{e&&(this.userEmail=e.email,this.loadUserAvatar(),this.loadMessages())})}loadUserAvatar(){this.userEmail&&this.authService.obtenerDatosUsuario(this.userEmail).subscribe(e=>{e&&e.length>0?this.userAvatar=e[0].avatar:this.userAvatar=1})}loadMessages(){let e=Kf(this.firestore,"messages");Fv(e).subscribe(t=>{this.messages=t})}sendMessage(){if(this.newMessage.trim()){let e={email:this.userEmail,text:this.newMessage,avatar:this.userAvatar},t=Kf(this.firestore,"messages");Ov(t,e).then(()=>{this.newMessage=""})}}getAvatarURL(){return`/assets/profiles/${this.userAvatar}.png`}static \u0275fac=function(t){return new(t||r)(Z(yt),Z(Cr))};static \u0275cmp=$e({type:r,selectors:[["app-chat"]],standalone:!0,features:[ft],decls:6,vars:4,consts:[[1,"chat-container"],["class","message-container",3,"ngClass",4,"ngFor","ngForOf"],[1,"new-message"],["placeholder","Escribe un mensaje...",3,"ngModelChange","ngModel","disabled"],[3,"click","disabled"],[1,"message-container",3,"ngClass"],["class","message-header",4,"ngIf"],[1,"message-body"],[1,"message-header"],["alt","Avatar",1,"avatar",3,"src"],[1,"email"]],template:function(t,n){t&1&&(q(0,"div",0),Ve(1,AA,5,6,"div",1),j(),q(2,"div",2)(3,"input",3),am("ngModelChange",function(s){return om(n.newMessage,s)||(n.newMessage=s),s}),j(),q(4,"button",4),be("click",function(){return n.sendMessage()}),X(5,"Enviar"),j()()),t&2&&(ne(),ee("ngForOf",n.messages),ne(2),sm("ngModel",n.newMessage),ee("disabled",!n.userEmail),ne(),ee("disabled",!n.userEmail||!n.newMessage.trim()))},dependencies:[Br,_n,qr,Gc,Lo,Oo,Vt],styles:['@charset "UTF-8";.chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:5px;background-color:#000;height:25vh;max-width:400px;margin:10px auto;overflow-y:auto;border-radius:10px}.message-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:5px;max-width:60%;color:#0ff;font-size:12px;word-wrap:break-word;word-break:break-word;white-space:normal}.my-message[_ngcontent-%COMP%]{align-self:flex-end;background-color:#333;text-align:right;border-radius:12px 12px 0;padding:6px;color:#0ff;font-size:12px;word-wrap:break-word;word-break:break-word;white-space:normal}.other-message[_ngcontent-%COMP%]{align-self:flex-start;background-color:#444;border-radius:12px 12px 12px 0;padding:6px;color:#0ff;font-size:12px;word-wrap:break-word;word-break:break-word;white-space:normal}.new-message[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:6px;border-radius:8px;border:1px solid #555;background-color:#222;color:#0ff;font-size:12px}.new-message[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px;border-radius:8px;background-color:#4caf50;color:#fff;border:none;cursor:pointer;margin-left:5px;font-size:12px}.avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;object-fit:cover;margin-right:5px}']})};function bA(r,e){if(r&1&&Fe(0,"img",10),r&2){let t=Ne(2);ee("src",t.userPhotoURL,Mo)}}function CA(r,e){if(r&1){let t=Nr();q(0,"div"),Ve(1,bA,1,1,"img",8),q(2,"span",9),X(3),j(),q(4,"button",7),be("click",function(){Et(t);let i=Ne();return It(i.logout())}),X(5,"Cerrar Sesi\xF3n"),j()()}if(r&2){let t=Ne();ne(),ee("ngIf",t.userPhotoURL),ne(2),is(t.userEmail)}}function SA(r,e){if(r&1){let t=Nr();q(0,"button",7),be("click",function(){Et(t);let i=Ne();return It(i.goToLogin())}),X(1,"Ir a Login"),j(),q(2,"button",7),be("click",function(){Et(t);let i=Ne();return It(i.goToRegistro())}),X(3,"Registrarse"),j()}}var Wu=class r{constructor(e,t,n){this.router=e;this.authService=t;this.loadingService=n}isLoggedIn=!1;userEmail=null;userPhotoURL=null;ngOnInit(){this.authService.getUsuarioActual().subscribe(e=>{e?(this.isLoggedIn=!0,this.userEmail=e.email,this.userEmail&&this.authService.obtenerDatosUsuario(this.userEmail).subscribe(t=>{if(t&&t.length>0){let n=t[0].avatar;this.userPhotoURL=`/assets/profiles/${n}.png`}else this.userPhotoURL=null},t=>{console.error("Error al obtener datos del usuario:",t)})):this.isLoggedIn=!1},e=>{console.error("Error al obtener el estado de autenticaci\xF3n:",e)})}goToRegistro(){this.loadingService.show(),this.router.navigate(["/registro"]).then(()=>{this.loadingService.hide()})}goToLogin(){this.loadingService.show(),this.router.navigate(["/login"]).then(()=>{this.loadingService.hide()})}goToQuien(){this.loadingService.show(),this.router.navigate(["/quien-soy"]).then(()=>{this.loadingService.hide()})}goToJuego1(){this.loadingService.show(),this.router.navigate(["/juegos/juego1"]).then(()=>{this.loadingService.hide()})}goToJuego2(){this.loadingService.show(),this.router.navigate(["/juegos/juego2"]).then(()=>{this.loadingService.hide()})}goToJuego3(){this.loadingService.show(),this.router.navigate(["/juegos/juego3"]).then(()=>{this.loadingService.hide()})}goToJuego4(){this.loadingService.show(),this.router.navigate(["/juegos/juego4"]).then(()=>{this.loadingService.hide()})}logout(){this.loadingService.show(),this.authService.logout().then(()=>{this.isLoggedIn=!1,this.userEmail=null,this.userPhotoURL=null,this.router.navigate(["/login"]).then(()=>{this.loadingService.hide()})}).catch(e=>{console.error("Error al cerrar sesi\xF3n:",e),this.loadingService.hide()})}static \u0275fac=function(t){return new(t||r)(Z(mn),Z(yt),Z(Bn))};static \u0275cmp=$e({type:r,selectors:[["app-home"]],standalone:!0,features:[ft],decls:20,vars:6,consts:[["loggedOut",""],[1,"header"],[1,"header-content"],[4,"ngIf","ngIfElse"],[1,"home-container"],[1,"game-buttons"],[3,"click","disabled"],[1,"small-button",3,"click"],["alt","Foto de perfil","class","profile-pic",3,"src",4,"ngIf"],[1,"user-email"],["alt","Foto de perfil",1,"profile-pic",3,"src"]],template:function(t,n){if(t&1){let i=Nr();q(0,"div",1)(1,"div",2),Ve(2,CA,6,2,"div",3)(3,SA,4,0,"ng-template",null,0,lm),q(5,"h2"),X(6,"Sala de Juegos Miku!!"),j()()(),q(7,"div",4)(8,"div",5)(9,"button",6),be("click",function(){return Et(i),It(n.goToJuego1())}),X(10,"Juego 1"),j(),q(11,"button",6),be("click",function(){return Et(i),It(n.goToJuego2())}),X(12,"Juego 2"),j(),q(13,"button",6),be("click",function(){return Et(i),It(n.goToJuego3())}),X(14,"Juego 3"),j(),q(15,"button",6),be("click",function(){return Et(i),It(n.goToJuego4())}),X(16,"Juego 4"),j()(),q(17,"button",7),be("click",function(){return Et(i),It(n.goToQuien())}),X(18,"Ir a \xBFQui\xE9n Soy?"),j(),Fe(19,"app-chat"),j()}if(t&2){let i=im(4);ne(2),ee("ngIf",n.isLoggedIn)("ngIfElse",i),ne(7),ee("disabled",!n.isLoggedIn),ne(2),ee("disabled",!n.isLoggedIn),ne(2),ee("disabled",!n.isLoggedIn),ne(2),ee("disabled",!n.isLoggedIn)}},dependencies:[Vt,Ku],styles:['@charset "UTF-8";.home-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-image:url("./media/bg-home-JPORX2NV.jpg");background-size:cover;color:#fff2da;text-align:center;position:relative}.header[_ngcontent-%COMP%]{background-color:#000;color:#fff;padding:10px 0;display:flex;align-items:center;justify-content:center;position:relative;z-index:1000}.header-content[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;max-width:1200px;margin:0 auto;justify-content:space-between}.profile-pic[_ngcontent-%COMP%]{border-radius:50%;width:40px;height:40px;margin-right:10px}.user-email[_ngcontent-%COMP%]{margin-right:auto}h2[_ngcontent-%COMP%]{margin:0}.small-button[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem;background-color:#6200ea;color:#fff;border:none;border-radius:5px;cursor:pointer}.small-button[_ngcontent-%COMP%]:hover{background-color:#3700b3}.game-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:20px}.game-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;font-size:1rem;background-color:#6200ea;color:#fff;border:none;border-radius:5px;cursor:pointer}.game-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#3700b3}app-chat[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:20px;max-width:300px;z-index:100}']})};var Uv=[{path:"registro",component:Bu},{path:"login",component:ju},{path:"quien-soy",component:Gu},{path:"home",component:Wu},{path:"juegos",loadChildren:()=>import("./chunk-HNWUVJXD.js").then(r=>r.JuegosModule)},{path:"",redirectTo:"/home",pathMatch:"full"}];var Hu=class r{constructor(e){this.loadingService=e}intercept(e,t){return this.loadingService.show(),t.handle(e).pipe(Yp(()=>this.loadingService.hide()))}static \u0275fac=function(t){return new(t||r)(Y(Bn))};static \u0275prov=at({token:r,factory:r.\u0275fac})};var Qu=class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=dt({type:r,bootstrap:[Lu]});static \u0275inj=ht({providers:[{provide:vn,useValue:Uu.firebase},ag(()=>ug(Uu.firebase)),{provide:mm,useClass:Hu,multi:!0},Pv(()=>Dv()),Mv(()=>Lv()),yt],imports:[_m,jr,Mr.forRoot(Uv),og.initializeApp(Uu.firebase),Eg,Cv]})};gm().bootstrapModule(Qu).catch(r=>console.error(r));
