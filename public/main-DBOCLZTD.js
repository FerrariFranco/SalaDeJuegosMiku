import{a as Xm,b as Ym,c as vc,d as Zm,e as Wi,f as wc,g as Do,h as ep,i as tp,j as Ec,k as ge,l as Gn,m as St,n as Ro,o as Qi,p as Ic,q as np,r as rp,s as Hi,t as Vo,u as qe,v as ze,w as Tc}from"./chunk-ZAC5UBO3.js";import{$ as Ar,A as X,Aa as Cr,B as Je,Ba as Sr,C as ut,D as ct,E as zt,F as Tr,G as Fm,H as _t,I as yt,J as Mm,K as jn,L as Gi,M as Xe,N as fc,O as ln,P as Om,Q as pe,R as le,S as mc,T as zi,U as $n,V as Ye,W as de,X as pc,Y as G,Z as z,_ as lt,a as an,aa as Ve,b as vo,ba as Ze,c as wo,ca as Lm,d as Dm,da as Um,e as un,ea as qm,f as qn,fa as Y,g as bt,ga as Bm,h as cn,ha as Co,i as ke,ia as Ct,j as Rm,ja as jm,k as Vm,ka as $m,l as $i,la as gc,m as xm,ma as So,n as km,na as Gm,o as Eo,oa as _c,p as Io,pa as Ki,q as hc,qa as hn,r as To,ra as yc,s as Bn,sa as zm,t as dc,ta as Km,u as Nm,ua as br,v as Ao,va as Wm,w as bo,wa as Po,x as Gt,xa as Qm,y as at,ya as Hm,z as se,za as Jm}from"./chunk-TSOGT2P4.js";import{a as Ue,b as it,d as lc,e as D}from"./chunk-7A67K276.js";var lp=(()=>{let e=class e{constructor(n,i){this._renderer=n,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}};e.\u0275fac=function(i){return new(i||e)(le(mc),le(fc))},e.\u0275dir=zt({type:e});let r=e;return r})(),Gv=(()=>{let e=class e extends lp{};e.\u0275fac=(()=>{let n;return function(s){return(n||(n=Mm(e)))(s||e)}})(),e.\u0275dir=zt({type:e,features:[$n]});let r=e;return r})(),hp=new se("");var zv={provide:hp,useExisting:bo(()=>Vr),multi:!0};function Kv(){let r=yc()?yc().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}var Wv=new se(""),Vr=(()=>{let e=class e extends lp{constructor(n,i,s){super(n,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!Kv())}writeValue(n){let i=n??"";this.setProperty("value",i)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}};e.\u0275fac=function(i){return new(i||e)(le(mc),le(fc),le(Wv,8))},e.\u0275dir=zt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&Ve("input",function(u){return s._handleInput(u.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(u){return s._compositionEnd(u.target.value)})},features:[Co([zv]),$n]});let r=e;return r})();function dn(r){return r==null||(typeof r=="string"||Array.isArray(r))&&r.length===0}function dp(r){return r!=null&&typeof r.length=="number"}var fp=new se(""),mp=new se(""),Qv=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,et=class{static min(e){return Hv(e)}static max(e){return Jv(e)}static required(e){return Xv(e)}static requiredTrue(e){return Yv(e)}static email(e){return Zv(e)}static minLength(e){return ew(e)}static maxLength(e){return tw(e)}static pattern(e){return nw(e)}static nullValidator(e){return pp(e)}static compose(e){return Ep(e)}static composeAsync(e){return Ip(e)}};function Hv(r){return e=>{if(dn(e.value)||dn(r))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<r?{min:{min:r,actual:e.value}}:null}}function Jv(r){return e=>{if(dn(e.value)||dn(r))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>r?{max:{max:r,actual:e.value}}:null}}function Xv(r){return dn(r.value)?{required:!0}:null}function Yv(r){return r.value===!0?null:{required:!0}}function Zv(r){return dn(r.value)||Qv.test(r.value)?null:{email:!0}}function ew(r){return e=>dn(e.value)||!dp(e.value)?null:e.value.length<r?{minlength:{requiredLength:r,actualLength:e.value.length}}:null}function tw(r){return e=>dp(e.value)&&e.value.length>r?{maxlength:{requiredLength:r,actualLength:e.value.length}}:null}function nw(r){if(!r)return pp;let e,t;return typeof r=="string"?(t="",r.charAt(0)!=="^"&&(t+="^"),t+=r,r.charAt(r.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=r.toString(),e=r),n=>{if(dn(n.value))return null;let i=n.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function pp(r){return null}function gp(r){return r!=null}function _p(r){return Gm(r)?bt(r):r}function yp(r){let e={};return r.forEach(t=>{e=t!=null?Ue(Ue({},e),t):e}),Object.keys(e).length===0?null:e}function vp(r,e){return e.map(t=>t(r))}function rw(r){return!r.validate}function wp(r){return r.map(e=>rw(e)?e:t=>e.validate(t))}function Ep(r){if(!r)return null;let e=r.filter(gp);return e.length==0?null:function(t){return yp(vp(t,e))}}function bc(r){return r!=null?Ep(wp(r)):null}function Ip(r){if(!r)return null;let e=r.filter(gp);return e.length==0?null:function(t){let n=vp(t,e).map(_p);return Rm(n).pipe(ke(yp))}}function Cc(r){return r!=null?Ip(wp(r)):null}function ip(r,e){return r===null?[e]:Array.isArray(r)?[...r,e]:[r,e]}function Tp(r){return r._rawValidators}function Ap(r){return r._rawAsyncValidators}function Ac(r){return r?Array.isArray(r)?r:[r]:[]}function ko(r,e){return Array.isArray(r)?r.includes(e):r===e}function sp(r,e){let t=Ac(e);return Ac(r).forEach(i=>{ko(t,i)||t.push(i)}),t}function op(r,e){return Ac(e).filter(t=>!ko(r,t))}var No=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=bc(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Cc(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},ts=class extends No{get formDirective(){return null}get path(){return null}},ns=class extends No{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Fo=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},iw={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},cA=it(Ue({},iw),{"[class.ng-submitted]":"isSubmitted"}),qo=(()=>{let e=class e extends Fo{constructor(n){super(n)}};e.\u0275fac=function(i){return new(i||e)(le(ns,2))},e.\u0275dir=zt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&pc("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[$n]});let r=e;return r})(),Bo=(()=>{let e=class e extends Fo{constructor(n){super(n)}};e.\u0275fac=function(i){return new(i||e)(le(ts,10))},e.\u0275dir=zt({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&pc("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[$n]});let r=e;return r})();var Ji="VALID",xo="INVALID",Pr="PENDING",Xi="DISABLED",Rr=class{},Mo=class extends Rr{constructor(e,t){super(),this.value=e,this.source=t}},Zi=class extends Rr{constructor(e,t){super(),this.pristine=e,this.source=t}},es=class extends Rr{constructor(e,t){super(),this.touched=e,this.source=t}},Dr=class extends Rr{constructor(e,t){super(),this.status=e,this.source=t}};function bp(r){return(jo(r)?r.validators:r)||null}function sw(r){return Array.isArray(r)?bc(r):r||null}function Cp(r,e){return(jo(e)?e.asyncValidators:r)||null}function ow(r){return Array.isArray(r)?Cc(r):r||null}function jo(r){return r!=null&&!Array.isArray(r)&&typeof r=="object"}function aw(r,e,t){let n=r.controls;if(!(e?Object.keys(n):n).length)throw new Ao(1e3,"");if(!n[t])throw new Ao(1001,"")}function uw(r,e,t){r._forEachChild((n,i)=>{if(t[i]===void 0)throw new Ao(1002,"")})}var Oo=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Ki(()=>this.statusReactive()),this.statusReactive=zi(void 0),this._pristine=Ki(()=>this.pristineReactive()),this.pristineReactive=zi(!0),this._touched=Ki(()=>this.touchedReactive()),this.touchedReactive=zi(!1),this._events=new vo,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return hn(this.statusReactive)}set status(e){hn(()=>this.statusReactive.set(e))}get valid(){return this.status===Ji}get invalid(){return this.status===xo}get pending(){return this.status==Pr}get disabled(){return this.status===Xi}get enabled(){return this.status!==Xi}get pristine(){return hn(this.pristineReactive)}set pristine(e){hn(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return hn(this.touchedReactive)}set touched(e){hn(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(sp(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(sp(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(op(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(op(e,this._rawAsyncValidators))}hasValidator(e){return ko(this._rawValidators,e)}hasAsyncValidator(e){return ko(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(it(Ue({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new es(!0,n))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:n})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,n),t&&e.emitEvent!==!1&&this._events.next(new es(!1,n))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(it(Ue({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new Zi(!1,n))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,n),t&&e.emitEvent!==!1&&this._events.next(new Zi(!0,n))}markAsPending(e={}){this.status=Pr;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Dr(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(it(Ue({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Xi,this.errors=null,this._forEachChild(i=>{i.disable(it(Ue({},e),{onlySelf:!0}))}),this._updateValue();let n=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Mo(this.value,n)),this._events.next(new Dr(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(it(Ue({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ji,this._forEachChild(n=>{n.enable(it(Ue({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(it(Ue({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ji||this.status===Pr)&&this._runAsyncValidator(n,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Mo(this.value,t)),this._events.next(new Dr(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(it(Ue({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Xi:Ji}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Pr,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let n=_p(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((n,i)=>n&&n._find(i),this)}getError(e,t){let n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,n){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||n)&&this._events.next(new Dr(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,n)}_initObservables(){this.valueChanges=new Gi,this.statusChanges=new Gi}_calculateStatus(){return this._allControlsDisabled()?Xi:this.errors?xo:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Pr)?Pr:this._anyControlsHaveStatus(xo)?xo:Ji}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let n=!this._anyControlsDirty(),i=this.pristine!==n;this.pristine=n,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new Zi(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new es(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){jo(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=sw(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=ow(this._rawAsyncValidators)}},Lo=class extends Oo{constructor(e,t,n){super(bp(t),Cp(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){uw(this,!0,e),Object.keys(e).forEach(n=>{aw(this,!0,n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(n=>{let i=this.controls[n];i&&i.patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,i)=>{n.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,n)=>n._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,n]of Object.entries(this.controls))if(this.contains(t)&&e(n))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,n,i)=>((n.enabled||this.disabled)&&(t[i]=n.value),t))}_reduceChildren(e,t){let n=e;return this._forEachChild((i,s)=>{n=t(n,i,s)}),n}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var $o=new se("CallSetDisabledState",{providedIn:"root",factory:()=>Go}),Go="always";function Sp(r,e,t=Go){Pp(r,e),e.valueAccessor.writeValue(r.value),(r.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(r.disabled),hw(r,e),fw(r,e),dw(r,e),cw(r,e)}function ap(r,e,t=!0){let n=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(n),e.valueAccessor.registerOnTouched(n)),lw(r,e),r&&(e._invokeOnDestroyCallbacks(),r._registerOnCollectionChange(()=>{}))}function Uo(r,e){r.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function cw(r,e){if(e.valueAccessor.setDisabledState){let t=n=>{e.valueAccessor.setDisabledState(n)};r.registerOnDisabledChange(t),e._registerOnDestroy(()=>{r._unregisterOnDisabledChange(t)})}}function Pp(r,e){let t=Tp(r);e.validator!==null?r.setValidators(ip(t,e.validator)):typeof t=="function"&&r.setValidators([t]);let n=Ap(r);e.asyncValidator!==null?r.setAsyncValidators(ip(n,e.asyncValidator)):typeof n=="function"&&r.setAsyncValidators([n]);let i=()=>r.updateValueAndValidity();Uo(e._rawValidators,i),Uo(e._rawAsyncValidators,i)}function lw(r,e){let t=!1;if(r!==null){if(e.validator!==null){let i=Tp(r);if(Array.isArray(i)&&i.length>0){let s=i.filter(a=>a!==e.validator);s.length!==i.length&&(t=!0,r.setValidators(s))}}if(e.asyncValidator!==null){let i=Ap(r);if(Array.isArray(i)&&i.length>0){let s=i.filter(a=>a!==e.asyncValidator);s.length!==i.length&&(t=!0,r.setAsyncValidators(s))}}}let n=()=>{};return Uo(e._rawValidators,n),Uo(e._rawAsyncValidators,n),t}function hw(r,e){e.valueAccessor.registerOnChange(t=>{r._pendingValue=t,r._pendingChange=!0,r._pendingDirty=!0,r.updateOn==="change"&&Dp(r,e)})}function dw(r,e){e.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,r.updateOn==="blur"&&r._pendingChange&&Dp(r,e),r.updateOn!=="submit"&&r.markAsTouched()})}function Dp(r,e){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function fw(r,e){let t=(n,i)=>{e.valueAccessor.writeValue(n),i&&e.viewToModelUpdate(n)};r.registerOnChange(t),e._registerOnDestroy(()=>{r._unregisterOnChange(t)})}function mw(r,e){r==null,Pp(r,e)}function pw(r,e){if(!r.hasOwnProperty("model"))return!1;let t=r.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function gw(r){return Object.getPrototypeOf(r.constructor)===Gv}function _w(r,e){r._syncPendingControls(),e.forEach(t=>{let n=t.control;n.updateOn==="submit"&&n._pendingChange&&(t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function yw(r,e){if(!e)return null;Array.isArray(e);let t,n,i;return e.forEach(s=>{s.constructor===Vr?t=s:gw(s)?n=s:i=s}),i||n||t||null}var vw={provide:ts,useExisting:bo(()=>rs)},Yi=Promise.resolve(),rs=(()=>{let e=class e extends ts{get submitted(){return hn(this.submittedReactive)}constructor(n,i,s){super(),this.callSetDisabledState=s,this._submitted=Ki(()=>this.submittedReactive()),this.submittedReactive=zi(!1),this._directives=new Set,this.ngSubmit=new Gi,this.form=new Lo({},bc(n),Cc(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){Yi.then(()=>{let i=this._findContainer(n.path);n.control=i.registerControl(n.name,n.control),Sp(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){Yi.then(()=>{let i=this._findContainer(n.path);i&&i.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){Yi.then(()=>{let i=this._findContainer(n.path),s=new Lo({});mw(s,n),i.registerControl(n.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){Yi.then(()=>{let i=this._findContainer(n.path);i&&i.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,i){Yi.then(()=>{this.form.get(n.path).setValue(i)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submittedReactive.set(!0),_w(this.form,this._directives),this.ngSubmit.emit(n),n?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}};e.\u0275fac=function(i){return new(i||e)(le(fp,10),le(mp,10),le($o,8))},e.\u0275dir=zt({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&Ve("submit",function(u){return s.onSubmit(u)})("reset",function(){return s.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Co([vw]),$n]});let r=e;return r})();function up(r,e){let t=r.indexOf(e);t>-1&&r.splice(t,1)}function cp(r){return typeof r=="object"&&r!==null&&Object.keys(r).length===2&&"value"in r&&"disabled"in r}var fn=class extends Oo{constructor(e=null,t,n){super(bp(t),Cp(n,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),jo(t)&&(t.nonNullable||t.initialValueIsDefault)&&(cp(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){up(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){up(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){cp(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var zo=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=zt({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let r=e;return r})();var Rp=new se(""),ww={provide:ns,useExisting:bo(()=>is)},is=(()=>{let e=class e extends ns{set isDisabled(n){}constructor(n,i,s,a,u){super(),this._ngModelWarningConfig=a,this.callSetDisabledState=u,this.update=new Gi,this._ngModelWarningSent=!1,this._setValidators(n),this._setAsyncValidators(i),this.valueAccessor=yw(this,s)}ngOnChanges(n){if(this._isControlChanged(n)){let i=n.form.previousValue;i&&ap(i,this,!1),Sp(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}pw(n,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&ap(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_isControlChanged(n){return n.hasOwnProperty("form")}};e._ngModelWarningSentOnce=!1,e.\u0275fac=function(i){return new(i||e)(le(fp,10),le(mp,10),le(hp,10),le(Rp,8),le($o,8))},e.\u0275dir=zt({type:e,selectors:[["","formControl",""]],inputs:{form:[0,"formControl","form"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[Co([ww]),$n,Fm]});let r=e;return r})();var Vp=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=ct({type:e}),e.\u0275inj=at({});let r=e;return r})();var Ko=(()=>{let e=class e{static withConfig(n){return{ngModule:e,providers:[{provide:$o,useValue:n.callSetDisabledState??Go}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=ct({type:e}),e.\u0275inj=at({imports:[Vp]});let r=e;return r})(),xr=(()=>{let e=class e{static withConfig(n){return{ngModule:e,providers:[{provide:Rp,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:$o,useValue:n.callSetDisabledState??Go}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=ct({type:e}),e.\u0275inj=at({imports:[Vp]});let r=e;return r})();var Ew="firebase",Iw="10.13.1";qe(Ew,Iw,"app");var tt=new gc("ANGULARFIRE2_VERSION");function Qo(r,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(a=>a.app===t);if(s.length===1)return s[0]}return t.container.getProvider(r).getImmediate({optional:!0})}var ss=(r,e)=>{let t=e?[e]:Vo(),n=[];return t.forEach(i=>{i.container.getProvider(r).instances.forEach(a=>{n.includes(a)||n.push(a)})}),n},vt=class{constructor(){return ss(Tw)}},Tw="app-check";function kr(){}var Wo=class{zone;delegate;constructor(e,t=Dm){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){let i=this.zone,s=function(a){i.runGuarded(()=>{e.apply(this,[a])})};return this.delegate.schedule(s,t,n)}},Sc=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",kr,{},kr,kr)),t.pipe(Nm({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Pt=(()=>{class r{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Wo(Zone.current)),this.insideAngular=t.run(()=>new Wo(Zone.current,wo)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(n){return new(n||r)(X(Xe))};static \u0275prov=Gt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Ho(){let r=globalThis.\u0275AngularFireScheduler;if(!r)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return r}function Aw(r){return Ho().ngZone.runOutsideAngular(()=>r())}function zn(r){return Ho().ngZone.run(()=>r())}function Ke(r){return bw(Ho())(r)}function bw(r){return function(t){return t=t.lift(new Sc(r.ngZone)),t.pipe(qn(r.outsideAngular),un(r.insideAngular))}}var Cw=(r,e)=>function(){let n=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),zn(()=>r.apply(void 0,n))},Nr=(r,e)=>function(){let t,n=arguments;for(let s=0;s<arguments.length;s++)typeof n[s]=="function"&&(e&&(t||=zn(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",kr,{},kr,kr))),n[s]=Cw(n[s],t));let i=Aw(()=>r.apply(this,n));if(!e)if(i instanceof an){let s=Ho();return i.pipe(qn(s.outsideAngular),un(s.insideAngular))}else return zn(()=>i);return i instanceof an?i.pipe(Ke):i instanceof Promise?zn(()=>new Promise((s,a)=>i.then(u=>zn(()=>s(u)),u=>zn(()=>a(u))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:zn(()=>i)};var Sw="firebase",Pw="10.13.1";ze.registerVersion(Sw,Pw,"app-compat");var Dw=["ngOnDestroy"],Fp=(r,e,t,n={})=>new Proxy(r,{get:(i,s)=>t.runOutsideAngular(()=>{if(r[s])return n?.spy?.get&&n.spy.get(s,r[s]),r[s];if(Dw.indexOf(s)>-1)return()=>{};let a=e.toPromise().then(u=>{let c=u?.[s];return typeof c=="function"?c.bind(u):c?.then?c.then(d=>t.run(()=>d)):t.run(()=>c)});return new Proxy(()=>{},{get:(u,c)=>a[c],apply:(u,c,d)=>a.then(f=>{let p=f?.(...d);return n?.spy?.apply&&n.spy.apply(s,d,p),p})})})});var Jo=class{constructor(e){return e}},mn=new se("angularfire2.app.options"),Fr=new se("angularfire2.app.name");function os(r,e,t){let n=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||n;let a=ze.apps.filter(u=>u&&u.name===i.name)[0]||e.runOutsideAngular(()=>ze.initializeApp(r,i));try{if(JSON.stringify(r)!==JSON.stringify(a.options)){let u=!!module.hot;Rw("error",`${a.name} Firebase App already initialized with different options${u?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Jo(a)}var Rw=(r,...e)=>{_c()&&typeof console<"u"&&console[r](...e)},Vw={provide:Jo,useFactory:os,deps:[mn,Xe,[new Je,Fr]]},Mp=(()=>{class r{static initializeApp(t,n){return{ngModule:r,providers:[{provide:mn,useValue:t},{provide:Fr,useValue:n}]}}constructor(t){ze.registerVersion("angularfire",tt.full,"core"),ze.registerVersion("angularfire",tt.full,"app-compat"),ze.registerVersion("angular",So.full,t.toString())}static \u0275fac=function(n){return new(n||r)(X(ln))};static \u0275mod=ct({type:r});static \u0275inj=at({providers:[Vw]})}return r})();function Xo(r,e,t,n,i){let[,s,a]=globalThis.\u0275AngularfireInstanceCache.find(u=>u[0]===r)||[];if(s)return xw(i,a)||(Np("error",`${e} was already initialized on the ${t} Firebase App with different settings.${kw?" You may need to reload as Firebase is not HMR aware.":""}`),Np("warn",{is:i,was:a})),s;{let u=n();return globalThis.\u0275AngularfireInstanceCache.push([r,u,i]),u}}function xw(r,e){try{return r.toString()===e.toString()}catch{return r===e}}var kw=typeof module<"u"&&!!module.hot,Np=(r,...e)=>{_c()&&typeof console<"u"&&console[r](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Kt=class{constructor(e){return e}},Kn=class{constructor(){return Vo()}};function Nw(r){return r&&r.length===1?r[0]:new Kt(Hi())}var Pc=new se("angularfire2._apps"),Fw={provide:Kt,useFactory:Nw,deps:[[new Je,Pc]]},Mw={provide:Kn,deps:[[new Je,Pc]]};function Ow(r){return(e,t)=>{let n=t.get(ln);qe("angularfire",tt.full,"core"),qe("angularfire",tt.full,"app"),qe("angular",So.full,n.toString());let i=e.runOutsideAngular(()=>r(t));return new Kt(i)}}function Op(r,...e){return Tr([Fw,Mw,{provide:Pc,useFactory:Ow(r),multi:!0,deps:[Xe,jn,Pt,...e]}])}var Lp=Nr(rp,!0);var Lw=new Map,Uw={activated:!1,tokenObservers:[]},qw={initialized:!1,enabled:!1};function wt(r){return Lw.get(r)||Object.assign({},Uw)}function $p(){return qw}var Bw="https://content-firebaseappcheck.googleapis.com/v1";var jw="exchangeDebugToken",Up={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},QA=24*60*60*1e3;var Rc=class{constructor(e,t,n,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return D(this,null,function*(){this.stop();try{this.pending=new vc,this.pending.promise.catch(t=>{}),yield $w(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new vc,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function $w(r){return new Promise(e=>{setTimeout(e,r)})}var Gw={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},pn=new tp("appCheck","AppCheck",Gw);function Gp(r){if(!wt(r).activated)throw pn.create("use-before-activation",{appName:r.name})}function zp(n,i){return D(this,arguments,function*({url:r,body:e},t){let s={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let A=yield a.getHeartbeatsHeader();A&&(s["X-Firebase-Client"]=A)}let u={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(r,u)}catch(A){throw pn.create("fetch-network-error",{originalErrorMessage:A?.message})}if(c.status!==200)throw pn.create("fetch-status-error",{httpStatus:c.status});let d;try{d=yield c.json()}catch(A){throw pn.create("fetch-parse-error",{originalErrorMessage:A?.message})}let f=d.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw pn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let p=Number(f[1])*1e3,_=Date.now();return{token:d.token,expireTimeMillis:_+p,issuedAtTimeMillis:_}})}function Kp(r,e){let{projectId:t,appId:n,apiKey:i}=r.options;return{url:`${Bw}/projects/${t}/apps/${n}:${jw}?key=${i}`,body:{debug_token:e}}}var zw="firebase-app-check-database",Kw=1,Vc="firebase-app-check-store";var Yo=null;function Ww(){return Yo||(Yo=new Promise((r,e)=>{try{let t=indexedDB.open(zw,Kw);t.onsuccess=n=>{r(n.target.result)},t.onerror=n=>{var i;e(pn.create("storage-open",{originalErrorMessage:(i=n.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=n=>{let i=n.target.result;switch(n.oldVersion){case 0:i.createObjectStore(Vc,{keyPath:"compositeKey"})}}}catch(t){e(pn.create("storage-open",{originalErrorMessage:t?.message}))}}),Yo)}function Qw(r,e){return Hw(Jw(r),e)}function Hw(r,e){return D(this,null,function*(){let n=(yield Ww()).transaction(Vc,"readwrite"),s=n.objectStore(Vc).put({compositeKey:r,value:e});return new Promise((a,u)=>{s.onsuccess=c=>{a()},n.onerror=c=>{var d;u(pn.create("storage-set",{originalErrorMessage:(d=c.target.error)===null||d===void 0?void 0:d.message}))}})})}function Jw(r){return`${r.options.appId}-${r.name}`}var xc=new Ro("@firebase/app-check");function Dc(r,e){return Do()?Qw(r,e).catch(t=>{xc.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Wp(){return $p().enabled}function Qp(){return D(this,null,function*(){let r=$p();if(r.enabled&&r.token)return r.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var Xw={error:"UNKNOWN_ERROR"};function Yw(r){return Xm.encodeString(JSON.stringify(r),!1)}function kc(r,e=!1){return D(this,null,function*(){let t=r.app;Gp(t);let n=wt(t),i=n.token,s;if(i&&!as(i)&&(n.token=void 0,i=void 0),!i){let c=yield n.cachedTokenPromise;c&&(as(c)?i=c:yield Dc(t,void 0))}if(!e&&i&&as(i))return{token:i.token};let a=!1;if(Wp()){n.exchangeTokenPromise||(n.exchangeTokenPromise=zp(Kp(t,yield Qp()),r.heartbeatServiceProvider).finally(()=>{n.exchangeTokenPromise=void 0}),a=!0);let c=yield n.exchangeTokenPromise;return yield Dc(t,c),n.token=c,{token:c.token}}try{n.exchangeTokenPromise||(n.exchangeTokenPromise=n.provider.getToken().finally(()=>{n.exchangeTokenPromise=void 0}),a=!0),i=yield wt(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?xc.warn(c.message):xc.error(c),s=c}let u;return i?s?as(i)?u={token:i.token,internalError:s}:u=Bp(s):(u={token:i.token},n.token=i,yield Dc(t,i)):u=Bp(s),a&&n0(t,u),u})}function Zw(r){return D(this,null,function*(){let e=r.app;Gp(e);let{provider:t}=wt(e);if(Wp()){let n=yield Qp(),{token:i}=yield zp(Kp(e,n),r.heartbeatServiceProvider);return{token:i}}else{let{token:n}=yield t.getToken();return{token:n}}})}function e0(r,e,t,n){let{app:i}=r,s=wt(i),a={next:t,error:n,type:e};if(s.tokenObservers=[...s.tokenObservers,a],s.token&&as(s.token)){let u=s.token;Promise.resolve().then(()=>{t({token:u.token}),qp(r)}).catch(()=>{})}s.cachedTokenPromise.then(()=>qp(r))}function Hp(r,e){let t=wt(r),n=t.tokenObservers.filter(i=>i.next!==e);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function qp(r){let{app:e}=r,t=wt(e),n=t.tokenRefresher;n||(n=t0(r),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function t0(r){let{app:e}=r;return new Rc(()=>D(this,null,function*(){let t=wt(e),n;if(t.token?n=yield kc(r,!0):n=yield kc(r),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=wt(e);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,i),Math.max(0,n-Date.now())}else return 0},Up.RETRIAL_MIN_WAIT,Up.RETRIAL_MAX_WAIT)}function n0(r,e){let t=wt(r).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function as(r){return r.expireTimeMillis-Date.now()>0}function Bp(r){return{token:Yw(Xw),error:r}}var Nc=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=wt(this.app);for(let t of e)Hp(this.app,t.next);return Promise.resolve()}};function r0(r,e){return new Nc(r,e)}function i0(r){return{getToken:e=>kc(r,e),getLimitedUseToken:()=>Zw(r),addTokenListener:e=>e0(r,"INTERNAL",e),removeTokenListener:e=>Hp(r.app,e)}}var s0="@firebase/app-check",o0="0.8.7";var a0="app-check",jp="app-check-internal";function u0(){Qi(new Gn(a0,r=>{let e=r.getProvider("app").getImmediate(),t=r.getProvider("heartbeat");return r0(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,e,t)=>{r.getProvider(jp).initialize()})),Qi(new Gn(jp,r=>{let e=r.getProvider("app-check").getImmediate();return i0(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),qe(s0,o0)}u0();var c0=["localhost","0.0.0.0","127.0.0.1"],ob=typeof window<"u"&&c0.includes(window.location.hostname);var Fc=new se("angularfire2.auth.use-emulator"),Mc=new se("angularfire2.auth.settings"),Oc=new se("angularfire2.auth.tenant-id"),Lc=new se("angularfire2.auth.langugage-code"),Uc=new se("angularfire2.auth.use-device-language"),qc=new se("angularfire.auth.persistence"),Bc=(r,e,t,n,i,s,a,u)=>Xo(`${r.name}.auth`,"AngularFireAuth",r.name,()=>{let c=e.runOutsideAngular(()=>r.auth());if(t&&c.useEmulator(...t),n&&(c.tenantId=n),c.languageCode=i,s&&c.useDeviceLanguage(),a)for(let[d,f]of Object.entries(a))c.settings[d]=f;return u&&c.setPersistence(u),c},[t,n,i,s,a,u]),us=(()=>{class r{authState;idToken;user;idTokenResult;credential;constructor(t,n,i,s,a,u,c,d,f,p,_,A){let x=new vo,N=cn(void 0).pipe(un(a.outsideAngular),Bn(()=>s.runOutsideAngular(()=>import("./chunk-NJXUPNMH.js"))),ke(()=>os(t,s,n)),ke(R=>Bc(R,s,u,d,f,p,c,_)),hc({bufferSize:1,refCount:!1}));if(Po(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=cn(null);else{N.pipe(km()).subscribe();let R=N.pipe(Bn(M=>M.getRedirectResult().then(K=>K,()=>null)),Ke,hc({bufferSize:1,refCount:!1})),j=N.pipe(Bn(M=>new an(K=>({unsubscribe:s.runOutsideAngular(()=>M.onAuthStateChanged(Q=>K.next(Q),Q=>K.error(Q),()=>K.complete()))})))),$=N.pipe(Bn(M=>new an(K=>({unsubscribe:s.runOutsideAngular(()=>M.onIdTokenChanged(Q=>K.next(Q),Q=>K.error(Q),()=>K.complete()))}))));this.authState=R.pipe(dc(j),qn(a.outsideAngular),un(a.insideAngular)),this.user=R.pipe(dc($),qn(a.outsideAngular),un(a.insideAngular)),this.idToken=this.user.pipe(Bn(M=>M?bt(M.getIdToken()):cn(null))),this.idTokenResult=this.user.pipe(Bn(M=>M?bt(M.getIdTokenResult()):cn(null))),this.credential=Vm(R,x,this.authState.pipe($i(M=>!M))).pipe(ke(M=>M?.user?M:null),qn(a.outsideAngular),un(a.insideAngular))}return Fp(this,N,s,{spy:{apply:(R,j,$)=>{(R.startsWith("signIn")||R.startsWith("createUser"))&&$.then(M=>x.next(M))}}})}static \u0275fac=function(n){return new(n||r)(X(mn),X(Fr,8),X(ln),X(Xe),X(Pt),X(Fc,8),X(Mc,8),X(Oc,8),X(Lc,8),X(Uc,8),X(qc,8),X(vt,8))};static \u0275prov=Gt({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),Xp=(()=>{class r{constructor(){ze.registerVersion("angularfire",tt.full,"auth-compat")}static \u0275fac=function(n){return new(n||r)};static \u0275mod=ct({type:r});static \u0275inj=at({providers:[us]})}return r})();var Zp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},eg={};var gn,jc;(function(){var r;function e(w,g){function v(){}v.prototype=g.prototype,w.D=g.prototype,w.prototype=new v,w.prototype.constructor=w,w.C=function(E,I,b){for(var y=Array(arguments.length-2),Bt=2;Bt<arguments.length;Bt++)y[Bt-2]=arguments[Bt];return g.prototype[I].apply(E,y)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,g,v){v||(v=0);var E=Array(16);if(typeof g=="string")for(var I=0;16>I;++I)E[I]=g.charCodeAt(v++)|g.charCodeAt(v++)<<8|g.charCodeAt(v++)<<16|g.charCodeAt(v++)<<24;else for(I=0;16>I;++I)E[I]=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24;g=w.g[0],v=w.g[1],I=w.g[2];var b=w.g[3],y=g+(b^v&(I^b))+E[0]+3614090360&4294967295;g=v+(y<<7&4294967295|y>>>25),y=b+(I^g&(v^I))+E[1]+3905402710&4294967295,b=g+(y<<12&4294967295|y>>>20),y=I+(v^b&(g^v))+E[2]+606105819&4294967295,I=b+(y<<17&4294967295|y>>>15),y=v+(g^I&(b^g))+E[3]+3250441966&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(b^v&(I^b))+E[4]+4118548399&4294967295,g=v+(y<<7&4294967295|y>>>25),y=b+(I^g&(v^I))+E[5]+1200080426&4294967295,b=g+(y<<12&4294967295|y>>>20),y=I+(v^b&(g^v))+E[6]+2821735955&4294967295,I=b+(y<<17&4294967295|y>>>15),y=v+(g^I&(b^g))+E[7]+4249261313&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(b^v&(I^b))+E[8]+1770035416&4294967295,g=v+(y<<7&4294967295|y>>>25),y=b+(I^g&(v^I))+E[9]+2336552879&4294967295,b=g+(y<<12&4294967295|y>>>20),y=I+(v^b&(g^v))+E[10]+4294925233&4294967295,I=b+(y<<17&4294967295|y>>>15),y=v+(g^I&(b^g))+E[11]+2304563134&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(b^v&(I^b))+E[12]+1804603682&4294967295,g=v+(y<<7&4294967295|y>>>25),y=b+(I^g&(v^I))+E[13]+4254626195&4294967295,b=g+(y<<12&4294967295|y>>>20),y=I+(v^b&(g^v))+E[14]+2792965006&4294967295,I=b+(y<<17&4294967295|y>>>15),y=v+(g^I&(b^g))+E[15]+1236535329&4294967295,v=I+(y<<22&4294967295|y>>>10),y=g+(I^b&(v^I))+E[1]+4129170786&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^I&(g^v))+E[6]+3225465664&4294967295,b=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(b^g))+E[11]+643717713&4294967295,I=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(I^b))+E[0]+3921069994&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(I^b&(v^I))+E[5]+3593408605&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^I&(g^v))+E[10]+38016083&4294967295,b=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(b^g))+E[15]+3634488961&4294967295,I=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(I^b))+E[4]+3889429448&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(I^b&(v^I))+E[9]+568446438&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^I&(g^v))+E[14]+3275163606&4294967295,b=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(b^g))+E[3]+4107603335&4294967295,I=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(I^b))+E[8]+1163531501&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(I^b&(v^I))+E[13]+2850285829&4294967295,g=v+(y<<5&4294967295|y>>>27),y=b+(v^I&(g^v))+E[2]+4243563512&4294967295,b=g+(y<<9&4294967295|y>>>23),y=I+(g^v&(b^g))+E[7]+1735328473&4294967295,I=b+(y<<14&4294967295|y>>>18),y=v+(b^g&(I^b))+E[12]+2368359562&4294967295,v=I+(y<<20&4294967295|y>>>12),y=g+(v^I^b)+E[5]+4294588738&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^I)+E[8]+2272392833&4294967295,b=g+(y<<11&4294967295|y>>>21),y=I+(b^g^v)+E[11]+1839030562&4294967295,I=b+(y<<16&4294967295|y>>>16),y=v+(I^b^g)+E[14]+4259657740&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(v^I^b)+E[1]+2763975236&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^I)+E[4]+1272893353&4294967295,b=g+(y<<11&4294967295|y>>>21),y=I+(b^g^v)+E[7]+4139469664&4294967295,I=b+(y<<16&4294967295|y>>>16),y=v+(I^b^g)+E[10]+3200236656&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(v^I^b)+E[13]+681279174&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^I)+E[0]+3936430074&4294967295,b=g+(y<<11&4294967295|y>>>21),y=I+(b^g^v)+E[3]+3572445317&4294967295,I=b+(y<<16&4294967295|y>>>16),y=v+(I^b^g)+E[6]+76029189&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(v^I^b)+E[9]+3654602809&4294967295,g=v+(y<<4&4294967295|y>>>28),y=b+(g^v^I)+E[12]+3873151461&4294967295,b=g+(y<<11&4294967295|y>>>21),y=I+(b^g^v)+E[15]+530742520&4294967295,I=b+(y<<16&4294967295|y>>>16),y=v+(I^b^g)+E[2]+3299628645&4294967295,v=I+(y<<23&4294967295|y>>>9),y=g+(I^(v|~b))+E[0]+4096336452&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~I))+E[7]+1126891415&4294967295,b=g+(y<<10&4294967295|y>>>22),y=I+(g^(b|~v))+E[14]+2878612391&4294967295,I=b+(y<<15&4294967295|y>>>17),y=v+(b^(I|~g))+E[5]+4237533241&4294967295,v=I+(y<<21&4294967295|y>>>11),y=g+(I^(v|~b))+E[12]+1700485571&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~I))+E[3]+2399980690&4294967295,b=g+(y<<10&4294967295|y>>>22),y=I+(g^(b|~v))+E[10]+4293915773&4294967295,I=b+(y<<15&4294967295|y>>>17),y=v+(b^(I|~g))+E[1]+2240044497&4294967295,v=I+(y<<21&4294967295|y>>>11),y=g+(I^(v|~b))+E[8]+1873313359&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~I))+E[15]+4264355552&4294967295,b=g+(y<<10&4294967295|y>>>22),y=I+(g^(b|~v))+E[6]+2734768916&4294967295,I=b+(y<<15&4294967295|y>>>17),y=v+(b^(I|~g))+E[13]+1309151649&4294967295,v=I+(y<<21&4294967295|y>>>11),y=g+(I^(v|~b))+E[4]+4149444226&4294967295,g=v+(y<<6&4294967295|y>>>26),y=b+(v^(g|~I))+E[11]+3174756917&4294967295,b=g+(y<<10&4294967295|y>>>22),y=I+(g^(b|~v))+E[2]+718787259&4294967295,I=b+(y<<15&4294967295|y>>>17),y=v+(b^(I|~g))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+g&4294967295,w.g[1]=w.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,w.g[2]=w.g[2]+I&4294967295,w.g[3]=w.g[3]+b&4294967295}n.prototype.u=function(w,g){g===void 0&&(g=w.length);for(var v=g-this.blockSize,E=this.B,I=this.h,b=0;b<g;){if(I==0)for(;b<=v;)i(this,w,b),b+=this.blockSize;if(typeof w=="string"){for(;b<g;)if(E[I++]=w.charCodeAt(b++),I==this.blockSize){i(this,E),I=0;break}}else for(;b<g;)if(E[I++]=w[b++],I==this.blockSize){i(this,E),I=0;break}}this.h=I,this.o+=g},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var g=1;g<w.length-8;++g)w[g]=0;var v=8*this.o;for(g=w.length-8;g<w.length;++g)w[g]=v&255,v/=256;for(this.u(w),w=Array(16),g=v=0;4>g;++g)for(var E=0;32>E;E+=8)w[v++]=this.g[g]>>>E&255;return w};function s(w,g){var v=u;return Object.prototype.hasOwnProperty.call(v,w)?v[w]:v[w]=g(w)}function a(w,g){this.h=g;for(var v=[],E=!0,I=w.length-1;0<=I;I--){var b=w[I]|0;E&&b==g||(v[I]=b,E=!1)}this.g=v}var u={};function c(w){return-128<=w&&128>w?s(w,function(g){return new a([g|0],0>g?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return p;if(0>w)return R(d(-w));for(var g=[],v=1,E=0;w>=v;E++)g[E]=w/v|0,v*=4294967296;return new a(g,0)}function f(w,g){if(w.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(w.charAt(0)=="-")return R(f(w.substring(1),g));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=d(Math.pow(g,8)),E=p,I=0;I<w.length;I+=8){var b=Math.min(8,w.length-I),y=parseInt(w.substring(I,I+b),g);8>b?(b=d(Math.pow(g,b)),E=E.j(b).add(d(y))):(E=E.j(v),E=E.add(d(y)))}return E}var p=c(0),_=c(1),A=c(16777216);r=a.prototype,r.m=function(){if(N(this))return-R(this).m();for(var w=0,g=1,v=0;v<this.g.length;v++){var E=this.i(v);w+=(0<=E?E:4294967296+E)*g,g*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(x(this))return"0";if(N(this))return"-"+R(this).toString(w);for(var g=d(Math.pow(w,6)),v=this,E="";;){var I=K(v,g).g;v=j(v,I.j(g));var b=((0<v.g.length?v.g[0]:v.h)>>>0).toString(w);if(v=I,x(v))return b+E;for(;6>b.length;)b="0"+b;E=b+E}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function x(w){if(w.h!=0)return!1;for(var g=0;g<w.g.length;g++)if(w.g[g]!=0)return!1;return!0}function N(w){return w.h==-1}r.l=function(w){return w=j(this,w),N(w)?-1:x(w)?0:1};function R(w){for(var g=w.g.length,v=[],E=0;E<g;E++)v[E]=~w.g[E];return new a(v,~w.h).add(_)}r.abs=function(){return N(this)?R(this):this},r.add=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],E=0,I=0;I<=g;I++){var b=E+(this.i(I)&65535)+(w.i(I)&65535),y=(b>>>16)+(this.i(I)>>>16)+(w.i(I)>>>16);E=y>>>16,b&=65535,y&=65535,v[I]=y<<16|b}return new a(v,v[v.length-1]&-2147483648?-1:0)};function j(w,g){return w.add(R(g))}r.j=function(w){if(x(this)||x(w))return p;if(N(this))return N(w)?R(this).j(R(w)):R(R(this).j(w));if(N(w))return R(this.j(R(w)));if(0>this.l(A)&&0>w.l(A))return d(this.m()*w.m());for(var g=this.g.length+w.g.length,v=[],E=0;E<2*g;E++)v[E]=0;for(E=0;E<this.g.length;E++)for(var I=0;I<w.g.length;I++){var b=this.i(E)>>>16,y=this.i(E)&65535,Bt=w.i(I)>>>16,Ai=w.i(I)&65535;v[2*E+2*I]+=y*Ai,$(v,2*E+2*I),v[2*E+2*I+1]+=b*Ai,$(v,2*E+2*I+1),v[2*E+2*I+1]+=y*Bt,$(v,2*E+2*I+1),v[2*E+2*I+2]+=b*Bt,$(v,2*E+2*I+2)}for(E=0;E<g;E++)v[E]=v[2*E+1]<<16|v[2*E];for(E=g;E<2*g;E++)v[E]=0;return new a(v,0)};function $(w,g){for(;(w[g]&65535)!=w[g];)w[g+1]+=w[g]>>>16,w[g]&=65535,g++}function M(w,g){this.g=w,this.h=g}function K(w,g){if(x(g))throw Error("division by zero");if(x(w))return new M(p,p);if(N(w))return g=K(R(w),g),new M(R(g.g),R(g.h));if(N(g))return g=K(w,R(g)),new M(R(g.g),g.h);if(30<w.g.length){if(N(w)||N(g))throw Error("slowDivide_ only works with positive integers.");for(var v=_,E=g;0>=E.l(w);)v=Q(v),E=Q(E);var I=H(v,1),b=H(E,1);for(E=H(E,2),v=H(v,2);!x(E);){var y=b.add(E);0>=y.l(w)&&(I=I.add(v),b=y),E=H(E,1),v=H(v,1)}return g=j(w,I.j(g)),new M(I,g)}for(I=p;0<=w.l(g);){for(v=Math.max(1,Math.floor(w.m()/g.m())),E=Math.ceil(Math.log(v)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),b=d(v),y=b.j(g);N(y)||0<y.l(w);)v-=E,b=d(v),y=b.j(g);x(b)&&(b=_),I=I.add(b),w=j(w,y)}return new M(I,w)}r.A=function(w){return K(this,w).h},r.and=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],E=0;E<g;E++)v[E]=this.i(E)&w.i(E);return new a(v,this.h&w.h)},r.or=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],E=0;E<g;E++)v[E]=this.i(E)|w.i(E);return new a(v,this.h|w.h)},r.xor=function(w){for(var g=Math.max(this.g.length,w.g.length),v=[],E=0;E<g;E++)v[E]=this.i(E)^w.i(E);return new a(v,this.h^w.h)};function Q(w){for(var g=w.g.length+1,v=[],E=0;E<g;E++)v[E]=w.i(E)<<1|w.i(E-1)>>>31;return new a(v,w.h)}function H(w,g){var v=g>>5;g%=32;for(var E=w.g.length-v,I=[],b=0;b<E;b++)I[b]=0<g?w.i(b+v)>>>g|w.i(b+v+1)<<32-g:w.i(b+v);return new a(I,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,jc=eg.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,gn=eg.Integer=a}).apply(typeof Zp<"u"?Zp:typeof self<"u"?self:typeof window<"u"?window:{});var Zo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Wt={};var $c,Gc,Mr,zc,cs,ea,Kc,Wc,Qc;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,l,h){return o==Array.prototype||o==Object.prototype||(o[l]=h.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Zo=="object"&&Zo];for(var l=0;l<o.length;++l){var h=o[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=t(this);function i(o,l){if(l)e:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var T=o[m];if(!(T in h))break e;h=h[T]}o=o[o.length-1],m=h[o],l=l(m),l!=m&&l!=null&&e(h,o,{configurable:!0,writable:!0,value:l})}}function s(o,l){o instanceof String&&(o+="");var h=0,m=!1,T={next:function(){if(!m&&h<o.length){var P=h++;return{value:l(P,o[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return T[Symbol.iterator]=function(){return T},T}i("Array.prototype.values",function(o){return o||function(){return s(this,function(l,h){return h})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return l=l!="object"?l:o?Array.isArray(o)?"array":l:"null",l=="array"||l=="object"&&typeof o.length=="number"}function d(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function f(o,l,h){return o.call.apply(o.bind,arguments)}function p(o,l,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var T=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(T,m),o.apply(l,T)}}return function(){return o.apply(l,arguments)}}function _(o,l,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,_.apply(null,arguments)}function A(o,l){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function x(o,l){function h(){}h.prototype=l.prototype,o.aa=l.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,T,P){for(var F=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)F[oe-2]=arguments[oe];return l.prototype[T].apply(m,F)}}function N(o){let l=o.length;if(0<l){let h=Array(l);for(let m=0;m<l;m++)h[m]=o[m];return h}return[]}function R(o,l){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(c(m)){let T=o.length||0,P=m.length||0;o.length=T+P;for(let F=0;F<P;F++)o[T+F]=m[F]}else o.push(m)}}class j{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function $(o){return/^[\s\xa0]*$/.test(o)}function M(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function K(o){return K[" "](o),o}K[" "]=function(){};var Q=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function H(o,l,h){for(let m in o)l.call(h,o[m],m,o)}function w(o,l){for(let h in o)l.call(void 0,o[h],h,o)}function g(o){let l={};for(let h in o)l[h]=o[h];return l}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,l){let h,m;for(let T=1;T<arguments.length;T++){m=arguments[T];for(h in m)o[h]=m[h];for(let P=0;P<v.length;P++)h=v[P],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function I(o){var l=1;o=o.split(":");let h=[];for(;0<l&&o.length;)h.push(o.shift()),l--;return o.length&&h.push(o.join(":")),h}function b(o){u.setTimeout(()=>{throw o},0)}function y(){var o=Uu;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class Bt{constructor(){this.h=this.g=null}add(l,h){let m=Ai.get();m.set(l,h),this.h?this.h.next=m:this.g=m,this.h=m}}var Ai=new j(()=>new lv,o=>o.reset());class lv{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let bi,Ci=!1,Uu=new Bt,Pf=()=>{let o=u.Promise.resolve(void 0);bi=()=>{o.then(hv)}};var hv=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){b(h)}var l=Ai;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}Ci=!1};function nn(){this.s=this.s,this.C=this.C}nn.prototype.s=!1,nn.prototype.ma=function(){this.s||(this.s=!0,this.N())},nn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Fe(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Fe.prototype.h=function(){this.defaultPrevented=!0};var dv=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,l),u.removeEventListener("test",h,l)}catch{}return o}();function Si(o,l){if(Fe.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(Q){e:{try{K(l.nodeName);var T=!0;break e}catch{}T=!1}T||(l=null)}}else h=="mouseover"?l=o.fromElement:h=="mouseout"&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:fv[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Si.aa.h.call(this)}}x(Si,Fe);var fv={2:"touch",3:"pen",4:"mouse"};Si.prototype.h=function(){Si.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Pi="closure_listenable_"+(1e6*Math.random()|0),mv=0;function pv(o,l,h,m,T){this.listener=o,this.proxy=null,this.src=l,this.type=h,this.capture=!!m,this.ha=T,this.key=++mv,this.da=this.fa=!1}function to(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function no(o){this.src=o,this.g={},this.h=0}no.prototype.add=function(o,l,h,m,T){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var F=Bu(o,l,m,T);return-1<F?(l=o[F],h||(l.fa=!1)):(l=new pv(l,this.src,P,!!m,T),l.fa=h,o.push(l)),l};function qu(o,l){var h=l.type;if(h in o.g){var m=o.g[h],T=Array.prototype.indexOf.call(m,l,void 0),P;(P=0<=T)&&Array.prototype.splice.call(m,T,1),P&&(to(l),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Bu(o,l,h,m){for(var T=0;T<o.length;++T){var P=o[T];if(!P.da&&P.listener==l&&P.capture==!!h&&P.ha==m)return T}return-1}var ju="closure_lm_"+(1e6*Math.random()|0),$u={};function Df(o,l,h,m,T){if(m&&m.once)return Vf(o,l,h,m,T);if(Array.isArray(l)){for(var P=0;P<l.length;P++)Df(o,l[P],h,m,T);return null}return h=Wu(h),o&&o[Pi]?o.K(l,h,d(m)?!!m.capture:!!m,T):Rf(o,l,h,!1,m,T)}function Rf(o,l,h,m,T,P){if(!l)throw Error("Invalid event type");var F=d(T)?!!T.capture:!!T,oe=zu(o);if(oe||(o[ju]=oe=new no(o)),h=oe.add(l,h,m,F,P),h.proxy)return h;if(m=gv(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)dv||(T=F),T===void 0&&(T=!1),o.addEventListener(l.toString(),m,T);else if(o.attachEvent)o.attachEvent(kf(l.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function gv(){function o(h){return l.call(o.src,o.listener,h)}let l=_v;return o}function Vf(o,l,h,m,T){if(Array.isArray(l)){for(var P=0;P<l.length;P++)Vf(o,l[P],h,m,T);return null}return h=Wu(h),o&&o[Pi]?o.L(l,h,d(m)?!!m.capture:!!m,T):Rf(o,l,h,!0,m,T)}function xf(o,l,h,m,T){if(Array.isArray(l))for(var P=0;P<l.length;P++)xf(o,l[P],h,m,T);else m=d(m)?!!m.capture:!!m,h=Wu(h),o&&o[Pi]?(o=o.i,l=String(l).toString(),l in o.g&&(P=o.g[l],h=Bu(P,h,m,T),-1<h&&(to(P[h]),Array.prototype.splice.call(P,h,1),P.length==0&&(delete o.g[l],o.h--)))):o&&(o=zu(o))&&(l=o.g[l.toString()],o=-1,l&&(o=Bu(l,h,m,T)),(h=-1<o?l[o]:null)&&Gu(h))}function Gu(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[Pi])qu(l.i,o);else{var h=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(h,m,o.capture):l.detachEvent?l.detachEvent(kf(h),m):l.addListener&&l.removeListener&&l.removeListener(m),(h=zu(l))?(qu(h,o),h.h==0&&(h.src=null,l[ju]=null)):to(o)}}}function kf(o){return o in $u?$u[o]:$u[o]="on"+o}function _v(o,l){if(o.da)o=!0;else{l=new Si(l,this);var h=o.listener,m=o.ha||o.src;o.fa&&Gu(o),o=h.call(m,l)}return o}function zu(o){return o=o[ju],o instanceof no?o:null}var Ku="__closure_events_fn_"+(1e9*Math.random()>>>0);function Wu(o){return typeof o=="function"?o:(o[Ku]||(o[Ku]=function(l){return o.handleEvent(l)}),o[Ku])}function Me(){nn.call(this),this.i=new no(this),this.M=this,this.F=null}x(Me,nn),Me.prototype[Pi]=!0,Me.prototype.removeEventListener=function(o,l,h,m){xf(this,o,l,h,m)};function $e(o,l){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=l.type||l,typeof l=="string")l=new Fe(l,o);else if(l instanceof Fe)l.target=l.target||o;else{var T=l;l=new Fe(m,o),E(l,T)}if(T=!0,h)for(var P=h.length-1;0<=P;P--){var F=l.g=h[P];T=ro(F,m,!0,l)&&T}if(F=l.g=o,T=ro(F,m,!0,l)&&T,T=ro(F,m,!1,l)&&T,h)for(P=0;P<h.length;P++)F=l.g=h[P],T=ro(F,m,!1,l)&&T}Me.prototype.N=function(){if(Me.aa.N.call(this),this.i){var o=this.i,l;for(l in o.g){for(var h=o.g[l],m=0;m<h.length;m++)to(h[m]);delete o.g[l],o.h--}}this.F=null},Me.prototype.K=function(o,l,h,m){return this.i.add(String(o),l,!1,h,m)},Me.prototype.L=function(o,l,h,m){return this.i.add(String(o),l,!0,h,m)};function ro(o,l,h,m){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();for(var T=!0,P=0;P<l.length;++P){var F=l[P];if(F&&!F.da&&F.capture==h){var oe=F.listener,xe=F.ha||F.src;F.fa&&qu(o.i,F),T=oe.call(xe,m)!==!1&&T}}return T&&!m.defaultPrevented}function Nf(o,l,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function Ff(o){o.g=Nf(()=>{o.g=null,o.i&&(o.i=!1,Ff(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class yv extends nn{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Ff(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Di(o){nn.call(this),this.h=o,this.g={}}x(Di,nn);var Mf=[];function Of(o){H(o.g,function(l,h){this.g.hasOwnProperty(h)&&Gu(l)},o),o.g={}}Di.prototype.N=function(){Di.aa.N.call(this),Of(this)},Di.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Qu=u.JSON.stringify,vv=u.JSON.parse,wv=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Hu(){}Hu.prototype.h=null;function Lf(o){return o.h||(o.h=o.i())}function Uf(){}var Ri={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ju(){Fe.call(this,"d")}x(Ju,Fe);function Xu(){Fe.call(this,"c")}x(Xu,Fe);var Mn={},qf=null;function io(){return qf=qf||new Me}Mn.La="serverreachability";function Bf(o){Fe.call(this,Mn.La,o)}x(Bf,Fe);function Vi(o){let l=io();$e(l,new Bf(l))}Mn.STAT_EVENT="statevent";function jf(o,l){Fe.call(this,Mn.STAT_EVENT,o),this.stat=l}x(jf,Fe);function Ge(o){let l=io();$e(l,new jf(l,o))}Mn.Ma="timingevent";function $f(o,l){Fe.call(this,Mn.Ma,o),this.size=l}x($f,Fe);function xi(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function ki(){this.g=!0}ki.prototype.xa=function(){this.g=!1};function Ev(o,l,h,m,T,P){o.info(function(){if(o.g)if(P)for(var F="",oe=P.split("&"),xe=0;xe<oe.length;xe++){var re=oe[xe].split("=");if(1<re.length){var Oe=re[0];re=re[1];var Le=Oe.split("_");F=2<=Le.length&&Le[1]=="type"?F+(Oe+"="+re+"&"):F+(Oe+"=redacted&")}}else F=null;else F=P;return"XMLHTTP REQ ("+m+") [attempt "+T+"]: "+l+`
`+h+`
`+F})}function Iv(o,l,h,m,T,P,F){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+T+"]: "+l+`
`+h+`
`+P+" "+F})}function vr(o,l,h,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+Av(o,h)+(m?" "+m:"")})}function Tv(o,l){o.info(function(){return"TIMEOUT: "+l})}ki.prototype.info=function(){};function Av(o,l){if(!o.g)return l;if(!l)return null;try{var h=JSON.parse(l);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var T=m[1];if(Array.isArray(T)&&!(1>T.length)){var P=T[0];if(P!="noop"&&P!="stop"&&P!="close")for(var F=1;F<T.length;F++)T[F]=""}}}}return Qu(h)}catch{return l}}var so={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Gf={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Yu;function oo(){}x(oo,Hu),oo.prototype.g=function(){return new XMLHttpRequest},oo.prototype.i=function(){return{}},Yu=new oo;function rn(o,l,h,m){this.j=o,this.i=l,this.l=h,this.R=m||1,this.U=new Di(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new zf}function zf(){this.i=null,this.g="",this.h=!1}var Kf={},Zu={};function ec(o,l,h){o.L=1,o.v=lo(jt(l)),o.m=h,o.P=!0,Wf(o,null)}function Wf(o,l){o.F=Date.now(),ao(o),o.A=jt(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),am(h.i,"t",m),o.C=0,h=o.j.J,o.h=new zf,o.g=bm(o.j,h?l:null,!o.m),0<o.O&&(o.M=new yv(_(o.Y,o,o.g),o.O)),l=o.U,h=o.g,m=o.ca;var T="readystatechange";Array.isArray(T)||(T&&(Mf[0]=T.toString()),T=Mf);for(var P=0;P<T.length;P++){var F=Df(h,T[P],m||l.handleEvent,!1,l.h||l);if(!F)break;l.g[F.key]=F}l=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),Vi(),Ev(o.i,o.u,o.A,o.l,o.R,o.m)}rn.prototype.ca=function(o){o=o.target;let l=this.M;l&&$t(o)==3?l.j():this.Y(o)},rn.prototype.Y=function(o){try{if(o==this.g)e:{let Le=$t(this.g);var l=this.g.Ba();let Ir=this.g.Z();if(!(3>Le)&&(Le!=3||this.g&&(this.h.h||this.g.oa()||mm(this.g)))){this.J||Le!=4||l==7||(l==8||0>=Ir?Vi(3):Vi(2)),tc(this);var h=this.g.Z();this.X=h;t:if(Qf(this)){var m=mm(this.g);o="";var T=m.length,P=$t(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){On(this),Ni(this);var F="";break t}this.h.i=new u.TextDecoder}for(l=0;l<T;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(P&&l==T-1)});m.length=0,this.h.g+=o,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=h==200,Iv(this.i,this.u,this.A,this.l,this.R,Le,h),this.o){if(this.T&&!this.K){t:{if(this.g){var oe,xe=this.g;if((oe=xe.g?xe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(oe)){var re=oe;break t}}re=null}if(h=re)vr(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,nc(this,h);else{this.o=!1,this.s=3,Ge(12),On(this),Ni(this);break e}}if(this.P){h=!0;let gt;for(;!this.J&&this.C<F.length;)if(gt=bv(this,F),gt==Zu){Le==4&&(this.s=4,Ge(14),h=!1),vr(this.i,this.l,null,"[Incomplete Response]");break}else if(gt==Kf){this.s=4,Ge(15),vr(this.i,this.l,F,"[Invalid Chunk]"),h=!1;break}else vr(this.i,this.l,gt,null),nc(this,gt);if(Qf(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Le!=4||F.length!=0||this.h.h||(this.s=1,Ge(16),h=!1),this.o=this.o&&h,!h)vr(this.i,this.l,F,"[Invalid Chunked Response]"),On(this),Ni(this);else if(0<F.length&&!this.W){this.W=!0;var Oe=this.j;Oe.g==this&&Oe.ba&&!Oe.M&&(Oe.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),uc(Oe),Oe.M=!0,Ge(11))}}else vr(this.i,this.l,F,null),nc(this,F);Le==4&&On(this),this.o&&!this.J&&(Le==4?Em(this.j,this):(this.o=!1,ao(this)))}else jv(this.g),h==400&&0<F.indexOf("Unknown SID")?(this.s=3,Ge(12)):(this.s=0,Ge(13)),On(this),Ni(this)}}}catch{}finally{}};function Qf(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function bv(o,l){var h=o.C,m=l.indexOf(`
`,h);return m==-1?Zu:(h=Number(l.substring(h,m)),isNaN(h)?Kf:(m+=1,m+h>l.length?Zu:(l=l.slice(m,m+h),o.C=m+h,l)))}rn.prototype.cancel=function(){this.J=!0,On(this)};function ao(o){o.S=Date.now()+o.I,Hf(o,o.I)}function Hf(o,l){if(o.B!=null)throw Error("WatchDog timer not null");o.B=xi(_(o.ba,o),l)}function tc(o){o.B&&(u.clearTimeout(o.B),o.B=null)}rn.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Tv(this.i,this.A),this.L!=2&&(Vi(),Ge(17)),On(this),this.s=2,Ni(this)):Hf(this,this.S-o)};function Ni(o){o.j.G==0||o.J||Em(o.j,o)}function On(o){tc(o);var l=o.M;l&&typeof l.ma=="function"&&l.ma(),o.M=null,Of(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function nc(o,l){try{var h=o.j;if(h.G!=0&&(h.g==o||rc(h.h,o))){if(!o.K&&rc(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var T=m;if(T[0]==0){e:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)go(h),mo(h);else break e;ac(h),Ge(18)}}else h.za=T[1],0<h.za-h.T&&37500>T[2]&&h.F&&h.v==0&&!h.C&&(h.C=xi(_(h.Za,h),6e3));if(1>=Yf(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else Un(h,11)}else if((o.K||h.g==o)&&go(h),!$(l))for(T=h.Da.g.parse(l),l=0;l<T.length;l++){let re=T[l];if(h.T=re[0],re=re[1],h.G==2)if(re[0]=="c"){h.K=re[1],h.ia=re[2];let Oe=re[3];Oe!=null&&(h.la=Oe,h.j.info("VER="+h.la));let Le=re[4];Le!=null&&(h.Aa=Le,h.j.info("SVER="+h.Aa));let Ir=re[5];Ir!=null&&typeof Ir=="number"&&0<Ir&&(m=1.5*Ir,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let gt=o.g;if(gt){let yo=gt.g?gt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(yo){var P=m.h;P.g||yo.indexOf("spdy")==-1&&yo.indexOf("quic")==-1&&yo.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(ic(P,P.h),P.h=null))}if(m.D){let cc=gt.g?gt.g.getResponseHeader("X-HTTP-Session-Id"):null;cc&&(m.ya=cc,ce(m.I,m.D,cc))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var F=o;if(m.qa=Am(m,m.J?m.ia:null,m.W),F.K){Zf(m.h,F);var oe=F,xe=m.L;xe&&(oe.I=xe),oe.B&&(tc(oe),ao(oe)),m.g=F}else vm(m);0<h.i.length&&po(h)}else re[0]!="stop"&&re[0]!="close"||Un(h,7);else h.G==3&&(re[0]=="stop"||re[0]=="close"?re[0]=="stop"?Un(h,7):oc(h):re[0]!="noop"&&h.l&&h.l.ta(re),h.v=0)}}Vi(4)}catch{}}var Cv=class{constructor(o,l){this.g=o,this.map=l}};function Jf(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xf(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Yf(o){return o.h?1:o.g?o.g.size:0}function rc(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function ic(o,l){o.g?o.g.add(l):o.h=l}function Zf(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}Jf.prototype.cancel=function(){if(this.i=em(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function em(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let h of o.g.values())l=l.concat(h.D);return l}return N(o.i)}function Sv(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(c(o)){for(var l=[],h=o.length,m=0;m<h;m++)l.push(o[m]);return l}l=[],h=0;for(m in o)l[h++]=o[m];return l}function Pv(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||typeof o=="string"){var l=[];o=o.length;for(var h=0;h<o;h++)l.push(h);return l}l=[],h=0;for(let m in o)l[h++]=m;return l}}}function tm(o,l){if(o.forEach&&typeof o.forEach=="function")o.forEach(l,void 0);else if(c(o)||typeof o=="string")Array.prototype.forEach.call(o,l,void 0);else for(var h=Pv(o),m=Sv(o),T=m.length,P=0;P<T;P++)l.call(void 0,m[P],h&&h[P],o)}var nm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Dv(o,l){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),T=null;if(0<=m){var P=o[h].substring(0,m);T=o[h].substring(m+1)}else P=o[h];l(P,T?decodeURIComponent(T.replace(/\+/g," ")):"")}}}function Ln(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Ln){this.h=o.h,uo(this,o.j),this.o=o.o,this.g=o.g,co(this,o.s),this.l=o.l;var l=o.i,h=new Oi;h.i=l.i,l.g&&(h.g=new Map(l.g),h.h=l.h),rm(this,h),this.m=o.m}else o&&(l=String(o).match(nm))?(this.h=!1,uo(this,l[1]||"",!0),this.o=Fi(l[2]||""),this.g=Fi(l[3]||"",!0),co(this,l[4]),this.l=Fi(l[5]||"",!0),rm(this,l[6]||"",!0),this.m=Fi(l[7]||"")):(this.h=!1,this.i=new Oi(null,this.h))}Ln.prototype.toString=function(){var o=[],l=this.j;l&&o.push(Mi(l,im,!0),":");var h=this.g;return(h||l=="file")&&(o.push("//"),(l=this.o)&&o.push(Mi(l,im,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Mi(h,h.charAt(0)=="/"?xv:Vv,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Mi(h,Nv)),o.join("")};function jt(o){return new Ln(o)}function uo(o,l,h){o.j=h?Fi(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function co(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function rm(o,l,h){l instanceof Oi?(o.i=l,Fv(o.i,o.h)):(h||(l=Mi(l,kv)),o.i=new Oi(l,o.h))}function ce(o,l,h){o.i.set(l,h)}function lo(o){return ce(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Fi(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Mi(o,l,h){return typeof o=="string"?(o=encodeURI(o).replace(l,Rv),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Rv(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var im=/[#\/\?@]/g,Vv=/[#\?:]/g,xv=/[#\?]/g,kv=/[#\?@]/g,Nv=/#/g;function Oi(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function sn(o){o.g||(o.g=new Map,o.h=0,o.i&&Dv(o.i,function(l,h){o.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}r=Oi.prototype,r.add=function(o,l){sn(this),this.i=null,o=wr(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(l),this.h+=1,this};function sm(o,l){sn(o),l=wr(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function om(o,l){return sn(o),l=wr(o,l),o.g.has(l)}r.forEach=function(o,l){sn(this),this.g.forEach(function(h,m){h.forEach(function(T){o.call(l,T,m,this)},this)},this)},r.na=function(){sn(this);let o=Array.from(this.g.values()),l=Array.from(this.g.keys()),h=[];for(let m=0;m<l.length;m++){let T=o[m];for(let P=0;P<T.length;P++)h.push(l[m])}return h},r.V=function(o){sn(this);let l=[];if(typeof o=="string")om(this,o)&&(l=l.concat(this.g.get(wr(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)l=l.concat(o[h])}return l},r.set=function(o,l){return sn(this),this.i=null,o=wr(this,o),om(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o?(o=this.V(o),0<o.length?String(o[0]):l):l};function am(o,l,h){sm(o,l),0<h.length&&(o.i=null,o.g.set(wr(o,l),N(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(var h=0;h<l.length;h++){var m=l[h];let P=encodeURIComponent(String(m)),F=this.V(m);for(m=0;m<F.length;m++){var T=P;F[m]!==""&&(T+="="+encodeURIComponent(String(F[m]))),o.push(T)}}return this.i=o.join("&")};function wr(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Fv(o,l){l&&!o.j&&(sn(o),o.i=null,o.g.forEach(function(h,m){var T=m.toLowerCase();m!=T&&(sm(this,m),am(this,T,h))},o)),o.j=l}function Mv(o,l){let h=new ki;if(u.Image){let m=new Image;m.onload=A(on,h,"TestLoadImage: loaded",!0,l,m),m.onerror=A(on,h,"TestLoadImage: error",!1,l,m),m.onabort=A(on,h,"TestLoadImage: abort",!1,l,m),m.ontimeout=A(on,h,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}function Ov(o,l){let h=new ki,m=new AbortController,T=setTimeout(()=>{m.abort(),on(h,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:m.signal}).then(P=>{clearTimeout(T),P.ok?on(h,"TestPingServer: ok",!0,l):on(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(T),on(h,"TestPingServer: error",!1,l)})}function on(o,l,h,m,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),m(h)}catch{}}function Lv(){this.g=new wv}function Uv(o,l,h){let m=h||"";try{tm(o,function(T,P){let F=T;d(T)&&(F=Qu(T)),l.push(m+P+"="+encodeURIComponent(F))})}catch(T){throw l.push(m+"type="+encodeURIComponent("_badmap")),T}}function Li(o){this.l=o.Ub||null,this.j=o.eb||!1}x(Li,Hu),Li.prototype.g=function(){return new ho(this.l,this.j)},Li.prototype.i=function(o){return function(){return o}}({});function ho(o,l){Me.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(ho,Me),r=ho.prototype,r.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,qi(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ui(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,qi(this)),this.g&&(this.readyState=3,qi(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;um(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function um(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Ui(this):qi(this),this.readyState==3&&um(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Ui(this))},r.Qa=function(o){this.g&&(this.response=o,Ui(this))},r.ga=function(){this.g&&Ui(this)};function Ui(o){o.readyState=4,o.l=null,o.j=null,o.v=null,qi(o)}r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=l.next();return o.join(`\r
`)};function qi(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(ho.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function cm(o){let l="";return H(o,function(h,m){l+=m,l+=":",l+=h,l+=`\r
`}),l}function sc(o,l,h){e:{for(m in h){var m=!1;break e}m=!0}m||(h=cm(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):ce(o,l,h))}function ye(o){Me.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(ye,Me);var qv=/^https?$/i,Bv=["POST","PUT"];r=ye.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,l,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Yu.g(),this.v=this.o?Lf(this.o):Lf(Yu),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(P){lm(this,P);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var T in m)h.set(T,m[T]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())h.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),T=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Bv,l,void 0))||m||T||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,F]of h)this.g.setRequestHeader(P,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{fm(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){lm(this,P)}};function lm(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,hm(o),fo(o)}function hm(o){o.A||(o.A=!0,$e(o,"complete"),$e(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,$e(this,"complete"),$e(this,"abort"),fo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),fo(this,!0)),ye.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?dm(this):this.bb())},r.bb=function(){dm(this)};function dm(o){if(o.h&&typeof a<"u"&&(!o.v[1]||$t(o)!=4||o.Z()!=2)){if(o.u&&$t(o)==4)Nf(o.Ea,0,o);else if($e(o,"readystatechange"),$t(o)==4){o.h=!1;try{let F=o.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var h;if(!(h=l)){var m;if(m=F===0){var T=String(o.D).match(nm)[1]||null;!T&&u.self&&u.self.location&&(T=u.self.location.protocol.slice(0,-1)),m=!qv.test(T?T.toLowerCase():"")}h=m}if(h)$e(o,"complete"),$e(o,"success");else{o.m=6;try{var P=2<$t(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",hm(o)}}finally{fo(o)}}}}function fo(o,l){if(o.g){fm(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||$e(o,"ready");try{h.onreadystatechange=m}catch{}}}function fm(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function $t(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<$t(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),vv(l)}};function mm(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function jv(o){let l={};o=(o.g&&2<=$t(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if($(o[m]))continue;var h=I(o[m]);let T=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let P=l[T]||[];l[T]=P,P.push(h)}w(l,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Bi(o,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||l}function pm(o){this.Aa=0,this.i=[],this.j=new ki,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Bi("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Bi("baseRetryDelayMs",5e3,o),this.cb=Bi("retryDelaySeedMs",1e4,o),this.Wa=Bi("forwardChannelMaxRetries",2,o),this.wa=Bi("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Jf(o&&o.concurrentRequestLimit),this.Da=new Lv,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=pm.prototype,r.la=8,r.G=1,r.connect=function(o,l,h,m){Ge(0),this.W=o,this.H=l||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=Am(this,null,this.W),po(this)};function oc(o){if(gm(o),o.G==3){var l=o.U++,h=jt(o.I);if(ce(h,"SID",o.K),ce(h,"RID",l),ce(h,"TYPE","terminate"),ji(o,h),l=new rn(o,o.j,l),l.L=2,l.v=lo(jt(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=l.v,h=!0),h||(l.g=bm(l.j,null),l.g.ea(l.v)),l.F=Date.now(),ao(l)}Tm(o)}function mo(o){o.g&&(uc(o),o.g.cancel(),o.g=null)}function gm(o){mo(o),o.u&&(u.clearTimeout(o.u),o.u=null),go(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function po(o){if(!Xf(o.h)&&!o.s){o.s=!0;var l=o.Ga;bi||Pf(),Ci||(bi(),Ci=!0),Uu.add(l,o),o.B=0}}function $v(o,l){return Yf(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=l.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=xi(_(o.Ga,o,l),Im(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let T=new rn(this,this.j,o),P=this.o;if(this.S&&(P?(P=g(P),E(P,this.S)):P=this.S),this.m!==null||this.O||(T.H=P,P=null),this.P)e:{for(var l=0,h=0;h<this.i.length;h++){t:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=h;break e}if(l===4096||h===this.i.length-1){l=h+1;break e}}l=1e3}else l=1e3;l=ym(this,T,l),h=jt(this.I),ce(h,"RID",o),ce(h,"CVER",22),this.D&&ce(h,"X-HTTP-Session-Id",this.D),ji(this,h),P&&(this.O?l="headers="+encodeURIComponent(String(cm(P)))+"&"+l:this.m&&sc(h,this.m,P)),ic(this.h,T),this.Ua&&ce(h,"TYPE","init"),this.P?(ce(h,"$req",l),ce(h,"SID","null"),T.T=!0,ec(T,h,null)):ec(T,h,l),this.G=2}}else this.G==3&&(o?_m(this,o):this.i.length==0||Xf(this.h)||_m(this))};function _m(o,l){var h;l?h=l.l:h=o.U++;let m=jt(o.I);ce(m,"SID",o.K),ce(m,"RID",h),ce(m,"AID",o.T),ji(o,m),o.m&&o.o&&sc(m,o.m,o.o),h=new rn(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),l&&(o.i=l.D.concat(o.i)),l=ym(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),ic(o.h,h),ec(h,m,l)}function ji(o,l){o.H&&H(o.H,function(h,m){ce(l,m,h)}),o.l&&tm({},function(h,m){ce(l,m,h)})}function ym(o,l,h){h=Math.min(o.i.length,h);var m=o.l?_(o.l.Na,o.l,o):null;e:{var T=o.i;let P=-1;for(;;){let F=["count="+h];P==-1?0<h?(P=T[0].g,F.push("ofs="+P)):P=0:F.push("ofs="+P);let oe=!0;for(let xe=0;xe<h;xe++){let re=T[xe].g,Oe=T[xe].map;if(re-=P,0>re)P=Math.max(0,T[xe].g-100),oe=!1;else try{Uv(Oe,F,"req"+re+"_")}catch{m&&m(Oe)}}if(oe){m=F.join("&");break e}}}return o=o.i.splice(0,h),l.D=o,m}function vm(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;bi||Pf(),Ci||(bi(),Ci=!0),Uu.add(l,o),o.v=0}}function ac(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=xi(_(o.Fa,o),Im(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,wm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=xi(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ge(10),mo(this),wm(this))};function uc(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function wm(o){o.g=new rn(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var l=jt(o.qa);ce(l,"RID","rpc"),ce(l,"SID",o.K),ce(l,"AID",o.T),ce(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&ce(l,"TO",o.ja),ce(l,"TYPE","xmlhttp"),ji(o,l),o.m&&o.o&&sc(l,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=lo(jt(l)),h.m=null,h.P=!0,Wf(h,o)}r.Za=function(){this.C!=null&&(this.C=null,mo(this),ac(this),Ge(19))};function go(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Em(o,l){var h=null;if(o.g==l){go(o),uc(o),o.g=null;var m=2}else if(rc(o.h,l))h=l.D,Zf(o.h,l),m=1;else return;if(o.G!=0){if(l.o)if(m==1){h=l.m?l.m.length:0,l=Date.now()-l.F;var T=o.B;m=io(),$e(m,new $f(m,h)),po(o)}else vm(o);else if(T=l.s,T==3||T==0&&0<l.X||!(m==1&&$v(o,l)||m==2&&ac(o)))switch(h&&0<h.length&&(l=o.h,l.i=l.i.concat(h)),T){case 1:Un(o,5);break;case 4:Un(o,10);break;case 3:Un(o,6);break;default:Un(o,2)}}}function Im(o,l){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*l}function Un(o,l){if(o.j.info("Error code "+l),l==2){var h=_(o.fb,o),m=o.Xa;let T=!m;m=new Ln(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||uo(m,"https"),lo(m),T?Mv(m.toString(),h):Ov(m.toString(),h)}else Ge(2);o.G=0,o.l&&o.l.sa(l),Tm(o),gm(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ge(2)):(this.j.info("Failed to ping google.com"),Ge(1))};function Tm(o){if(o.G=0,o.ka=[],o.l){let l=em(o.h);(l.length!=0||o.i.length!=0)&&(R(o.ka,l),R(o.ka,o.i),o.h.i.length=0,N(o.i),o.i.length=0),o.l.ra()}}function Am(o,l,h){var m=h instanceof Ln?jt(h):new Ln(h);if(m.g!="")l&&(m.g=l+"."+m.g),co(m,m.s);else{var T=u.location;m=T.protocol,l=l?l+"."+T.hostname:T.hostname,T=+T.port;var P=new Ln(null);m&&uo(P,m),l&&(P.g=l),T&&co(P,T),h&&(P.l=h),m=P}return h=o.D,l=o.ya,h&&l&&ce(m,h,l),ce(m,"VER",o.la),ji(o,m),m}function bm(o,l,h){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Ca&&!o.pa?new ye(new Li({eb:h})):new ye(o.pa),l.Ha(o.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Cm(){}r=Cm.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function _o(){}_o.prototype.g=function(o,l){return new rt(o,l)};function rt(o,l){Me.call(this),this.g=new pm(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!$(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!$(l)&&(this.g.D=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new Er(this)}x(rt,Me),rt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},rt.prototype.close=function(){oc(this.g)},rt.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=Qu(o),o=h);l.i.push(new Cv(l.Ya++,o)),l.G==3&&po(l)},rt.prototype.N=function(){this.g.l=null,delete this.j,oc(this.g),delete this.g,rt.aa.N.call(this)};function Sm(o){Ju.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(let h in l){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}x(Sm,Ju);function Pm(){Xu.call(this),this.status=1}x(Pm,Xu);function Er(o){this.g=o}x(Er,Cm),Er.prototype.ua=function(){$e(this.g,"a")},Er.prototype.ta=function(o){$e(this.g,new Sm(o))},Er.prototype.sa=function(o){$e(this.g,new Pm)},Er.prototype.ra=function(){$e(this.g,"b")},_o.prototype.createWebChannel=_o.prototype.g,rt.prototype.send=rt.prototype.o,rt.prototype.open=rt.prototype.m,rt.prototype.close=rt.prototype.close,Qc=Wt.createWebChannelTransport=function(){return new _o},Wc=Wt.getStatEventTarget=function(){return io()},Kc=Wt.Event=Mn,ea=Wt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},so.NO_ERROR=0,so.TIMEOUT=8,so.HTTP_ERROR=6,cs=Wt.ErrorCode=so,Gf.COMPLETE="complete",zc=Wt.EventType=Gf,Uf.EventType=Ri,Ri.OPEN="a",Ri.CLOSE="b",Ri.ERROR="c",Ri.MESSAGE="d",Me.prototype.listen=Me.prototype.K,Mr=Wt.WebChannel=Uf,Gc=Wt.FetchXmlHttpFactory=Li,ye.prototype.listenOnce=ye.prototype.L,ye.prototype.getLastError=ye.prototype.Ka,ye.prototype.getLastErrorCode=ye.prototype.Ba,ye.prototype.getStatus=ye.prototype.Z,ye.prototype.getResponseJson=ye.prototype.Oa,ye.prototype.getResponseText=ye.prototype.oa,ye.prototype.send=ye.prototype.ea,ye.prototype.setWithCredentials=ye.prototype.Ha,$c=Wt.XhrIo=ye}).apply(typeof Zo<"u"?Zo:typeof self<"u"?self:typeof window<"u"?window:{});var tg="@firebase/firestore";var Ce=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ce.UNAUTHENTICATED=new Ce(null),Ce.GOOGLE_CREDENTIALS=new Ce("google-credentials-uid"),Ce.FIRST_PARTY=new Ce("first-party-uid"),Ce.MOCK_USER=new Ce("mock-user");var fi="10.13.1";var Tn=new Ro("@firebase/firestore");function Br(){return Tn.logLevel}function Zh(r){Tn.setLogLevel(r)}function k(r,...e){if(Tn.logLevel<=St.DEBUG){let t=e.map(ed);Tn.debug(`Firestore (${fi}): ${r}`,...t)}}function we(r,...e){if(Tn.logLevel<=St.ERROR){let t=e.map(ed);Tn.error(`Firestore (${fi}): ${r}`,...t)}}function ft(r,...e){if(Tn.logLevel<=St.WARN){let t=e.map(ed);Tn.warn(`Firestore (${fi}): ${r}`,...t)}}function ed(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}function U(r="Unexpected state"){let e=`FIRESTORE (${fi}) INTERNAL ASSERTION FAILED: `+r;throw we(e),new Error(e)}function q(r,e){r||U()}function r_(r,e){r||U()}function O(r,e){return r}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends ep{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Se=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ha=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Zc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ce.UNAUTHENTICATED))}shutdown(){}},el=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},tl=class{constructor(e){this.t=e,this.currentUser=Ce.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,i=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),s=new Se;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Se,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let c=s;e.enqueueRetryable(()=>D(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},u=c=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Se)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q(typeof n.accessToken=="string"),new ha(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return q(e===null||typeof e=="string"),new Ce(e)}},nl=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ce.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},rl=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new nl(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ce.FIRST_PARTY))}shutdown(){}invalidateToken(){}},il=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},sl=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let n=s=>{s.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q(typeof t.token=="string"),this.R=t.token,new il(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function l0(r){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}var da=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let i=l0(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}};function W(r,e){return r<e?-1:r>e?1:0}function Jr(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function i_(r){return r+"\0"}var _e=class r{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new r(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var B=class r{constructor(e){this.timestamp=e}static fromTimestamp(e){return new r(e)}static min(){return new r(new _e(0,0))}static max(){return new r(new _e(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var fa=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&U(),n===void 0?n=e.length-t:n>e.length-t&&U(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},te=class r extends fa{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new V(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},h0=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ee=class r extends fa{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return h0.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new V(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new V(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new V(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};var L=class r{constructor(e){this.path=e}static fromPath(e){return new r(te.fromString(e))}static fromName(e){return new r(te.fromString(e).popFirst(5))}static empty(){return new r(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new te(e.slice()))}};var Xr=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};function ol(r){return r.fields.find(e=>e.kind===2)}function Qn(r){return r.fields.filter(e=>e.kind!==2)}Xr.UNKNOWN_ID=-1;var Wr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Es=class r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r(0,mt.min())}};function s_(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=B.fromTimestamp(n===1e9?new _e(t+1,0):new _e(t,n));return new mt(i,L.empty(),e)}function o_(r){return new mt(r.readTime,r.key,-1)}var mt=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r(B.min(),L.empty(),-1)}static max(){return new r(B.max(),L.empty(),-1)}};function td(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(r.documentKey,e.documentKey),t!==0?t:W(r.largestBatchId,e.largestBatchId))}var a_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ma=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function kn(r){return D(this,null,function*(){if(r.code!==S.FAILED_PRECONDITION||r.message!==a_)throw r;k("LocalStore","Unexpectedly lost primary lease")})}var C=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,a=new Array(s),u=0;for(let c=0;c<s;c++){let d=c;t(e[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};var pa=class r{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Se,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new er(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=nd(n.target.error);this.V.reject(new er(e,i))}}static open(e,t,n,i){try{return new r(t,e.transaction(i,n))}catch(s){throw new er(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(k("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new ul(t)}},An=class r{constructor(e,t,n){this.name=e,this.version=t,this.p=n,r.S(Wi())===12.2&&we("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return k("SimpleDb","Removing database:",e),Hn(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Do())return!1;if(r.v())return!0;let e=Wi(),t=r.S(e),n=0<t&&t<10,i=u_(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return D(this,null,function*(){return this.db||(k("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;t(a)},i.onblocked=()=>{n(new er(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new V(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new V(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new er(e,a))},i.onupgradeneeded=s=>{k("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.p.O(a,i.transaction,s.oldVersion,this.version).next(()=>{k("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return D(this,null,function*(){let s=t==="readonly",a=0;for(;;){++a;try{this.db=yield this.M(e);let u=pa.open(this.db,e,s?"readonly":"readwrite",n),c=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),C.reject(d))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){let c=u,d=c.name!=="FirebaseError"&&a<3;if(k("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function u_(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var al=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Hn(this.B.delete())}},er=class extends V{constructor(e,t){super(S.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Nn(r){return r.name==="IndexedDbTransactionError"}var ul=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(k("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(k("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Hn(n)}add(e){return k("SimpleDb","ADD",this.store.name,e,e),Hn(this.store.add(e))}get(e){return Hn(this.store.get(e)).next(t=>(t===void 0&&(t=null),k("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return k("SimpleDb","DELETE",this.store.name,e),Hn(this.store.delete(e))}count(){return k("SimpleDb","COUNT",this.store.name),Hn(this.store.count())}U(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new C((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{let s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new C((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(e,t){k("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.W(i,t)}Y(e){let t=this.cursor({});return new C((n,i)=>{t.onerror=s=>{let a=nd(s.target.error);i(a)},t.onsuccess=s=>{let a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(e,t){let n=[];return new C((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let c=new al(u),d=t(u.primaryKey,u.value,c);if(d instanceof C){let f=d.catch(p=>(c.done(),C.reject(p)));n.push(f)}c.isDone?i():c.K===null?u.continue():u.continue(c.K)}}).next(()=>C.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Hn(r){return new C((e,t)=>{r.onsuccess=n=>{let i=n.target.result;e(i)},r.onerror=n=>{let i=nd(n.target.error);t(i)}})}var ng=!1;function nd(r){let e=An.S(Wi());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new V("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ng||(ng=!0,setTimeout(()=>{throw n},0)),n}}return r}var cl=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){k("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>D(this,null,function*(){this.task=null;try{k("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Nn(t)?k("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield kn(t)}yield this.X(6e4)}))}},ll=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return D(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,i=t,s=!0;return C.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!n.has(a))return k("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(k("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{let a=o_(s);td(a,n)>0&&(n=a)}),new mt(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var st=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function Gs(r){return r==null}function Is(r){return r===0&&1/r==-1/0}function c_(r){return typeof r=="number"&&Number.isInteger(r)&&!Is(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function We(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=rg(e)),e=d0(r.get(t),e);return rg(e)}function d0(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function rg(r){return r+""}function Dt(r){let e=r.length;if(q(e>=2),e===2)return q(r.charAt(0)===""&&r.charAt(1)===""),te.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let a=r.indexOf("",s);switch((a<0||a>t)&&U(),r.charAt(a+1)){case"":let u=r.substring(s,a),c;i.length===0?c=u:(i+=u,c=i,i=""),n.push(c);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:U()}s=a+2}return new te(n)}var ig=["userId","batchId"];function sa(r,e){return[r,We(e)]}function l_(r,e,t){return[r,We(e),t]}var f0={},m0=["prefixPath","collectionGroup","readTime","documentId"],p0=["prefixPath","collectionGroup","documentId"],g0=["collectionGroup","readTime","prefixPath","documentId"],_0=["canonicalId","targetId"],y0=["targetId","path"],v0=["path","targetId"],w0=["collectionId","parent"],E0=["indexId","uid"],I0=["uid","sequenceNumber"],T0=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],A0=["indexId","uid","orderedDocumentKey"],b0=["userId","collectionPath","documentId"],C0=["userId","collectionPath","largestBatchId"],S0=["userId","collectionGroup","largestBatchId"],h_=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],P0=[...h_,"documentOverlays"],d_=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],f_=d_,rd=[...f_,"indexConfiguration","indexState","indexEntries"],D0=rd,R0=[...rd,"globals"];var Ts=class extends ma{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function De(r,e){let t=O(r);return An.F(t._e,e)}function sg(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function dr(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function m_(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}var he=class r{constructor(e,t){this.comparator=e,this.root=t||Vt.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Vt.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Kr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Kr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Kr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Kr(this.root,e,this.comparator,!0)}},Kr=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Vt=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();let e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}};Vt.EMPTY=null,Vt.RED=!0,Vt.BLACK=!1;Vt.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Vt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ae=class r{constructor(e){this.comparator=e,this.data=new he(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ga(this.data.getIterator())}getIteratorFrom(e){return new ga(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},ga=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Or(r){return r.hasNext()?r.getNext():void 0}var ot=class r{constructor(e){this.fields=e,e.sort(Ee.comparator)}static empty(){return new r([])}unionWith(e){let t=new ae(Ee.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Jr(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var _a=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function p_(){return typeof atob<"u"}var Te=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new _a("Invalid base64 string: "+s):s}}(e);return new r(t)}static fromUint8Array(e){let t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Te.EMPTY_BYTE_STRING=new Te("");var V0=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Jt(r){if(q(!!r),typeof r=="string"){let e=0,t=V0.exec(r);if(q(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:fe(r.seconds),nanos:fe(r.nanos)}}function fe(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function bn(r){return typeof r=="string"?Te.fromBase64String(r):Te.fromUint8Array(r)}function au(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function id(r){let e=r.mapValue.fields.__previous_value__;return au(e)?id(e):e}function As(r){let e=Jt(r.mapValue.fields.__local_write_time__.timestampValue);return new _e(e.seconds,e.nanos)}var hl=class{constructor(e,t,n,i,s,a,u,c,d){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=d}},Cn=class r{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};var En={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},oa={nullValue:"NULL_VALUE"};function tr(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?au(r)?4:g_(r)?9007199254740991:uu(r)?10:11:U()}function Nt(r,e){if(r===e)return!0;let t=tr(r);if(t!==tr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return As(r).isEqual(As(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=Jt(i.timestampValue),u=Jt(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return bn(i.bytesValue).isEqual(bn(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return fe(i.geoPointValue.latitude)===fe(s.geoPointValue.latitude)&&fe(i.geoPointValue.longitude)===fe(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return fe(i.integerValue)===fe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=fe(i.doubleValue),u=fe(s.doubleValue);return a===u?Is(a)===Is(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return Jr(r.arrayValue.values||[],e.arrayValue.values||[],Nt);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(sg(a)!==sg(u))return!1;for(let c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!Nt(a[c],u[c])))return!1;return!0}(r,e);default:return U()}}function bs(r,e){return(r.values||[]).find(t=>Nt(t,e))!==void 0}function Sn(r,e){if(r===e)return 0;let t=tr(r),n=tr(e);if(t!==n)return W(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(r.booleanValue,e.booleanValue);case 2:return function(s,a){let u=fe(s.integerValue||s.doubleValue),c=fe(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return og(r.timestampValue,e.timestampValue);case 4:return og(As(r),As(e));case 5:return W(r.stringValue,e.stringValue);case 6:return function(s,a){let u=bn(s),c=bn(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){let u=s.split("/"),c=a.split("/");for(let d=0;d<u.length&&d<c.length;d++){let f=W(u[d],c[d]);if(f!==0)return f}return W(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){let u=W(fe(s.latitude),fe(a.latitude));return u!==0?u:W(fe(s.longitude),fe(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return ag(r.arrayValue,e.arrayValue);case 10:return function(s,a){var u,c,d,f;let p=s.fields||{},_=a.fields||{},A=(u=p.value)===null||u===void 0?void 0:u.arrayValue,x=(c=_.value)===null||c===void 0?void 0:c.arrayValue,N=W(((d=A?.values)===null||d===void 0?void 0:d.length)||0,((f=x?.values)===null||f===void 0?void 0:f.length)||0);return N!==0?N:ag(A,x)}(r.mapValue,e.mapValue);case 11:return function(s,a){if(s===En.mapValue&&a===En.mapValue)return 0;if(s===En.mapValue)return 1;if(a===En.mapValue)return-1;let u=s.fields||{},c=Object.keys(u),d=a.fields||{},f=Object.keys(d);c.sort(),f.sort();for(let p=0;p<c.length&&p<f.length;++p){let _=W(c[p],f[p]);if(_!==0)return _;let A=Sn(u[c[p]],d[f[p]]);if(A!==0)return A}return W(c.length,f.length)}(r.mapValue,e.mapValue);default:throw U()}}function og(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return W(r,e);let t=Jt(r),n=Jt(e),i=W(t.seconds,n.seconds);return i!==0?i:W(t.nanos,n.nanos)}function ag(r,e){let t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){let s=Sn(t[i],n[i]);if(s)return s}return W(t.length,n.length)}function Yr(r){return dl(r)}function dl(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){let n=Jt(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return bn(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return L.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=dl(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${dl(t.fields[a])}`;return i+"}"}(r.mapValue):U()}function nr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function fl(r){return!!r&&"integerValue"in r}function Cs(r){return!!r&&"arrayValue"in r}function ug(r){return!!r&&"nullValue"in r}function cg(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function aa(r){return!!r&&"mapValue"in r}function uu(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function gs(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return dr(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=gs(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=gs(r.arrayValue.values[t]);return e}return Object.assign({},r)}function g_(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var __={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function x0(r){return"nullValue"in r?oa:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?nr(Cn.empty(),L.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?uu(r)?__:{mapValue:{}}:U()}function k0(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?nr(Cn.empty(),L.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?__:"mapValue"in r?uu(r)?{mapValue:{}}:En:U()}function lg(r,e){let t=Sn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function hg(r,e){let t=Sn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}var je=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!aa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=gs(t)}setAll(e){let t=Ee.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=gs(a):i.push(u.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());aa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Nt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];aa(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){dr(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(gs(this.value))}};function y_(r){let e=[];return dr(r.fields,(t,n)=>{let i=new Ee([t]);if(aa(n)){let s=y_(n.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new ot(e)}var Pe=class r{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new r(e,0,B.min(),B.min(),B.min(),je.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,B.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,B.min(),B.min(),je.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,B.min(),B.min(),je.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=je.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=je.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Ft=class{constructor(e,t){this.position=e,this.inclusive=t}};function dg(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],a=r.position[i];if(s.field.isKeyField()?n=L.comparator(L.fromName(a.referenceValue),t.key):n=Sn(a,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function fg(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Nt(r.position[t],e.position[t]))return!1;return!0}var rr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function N0(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}var ya=class{},Z=class r extends ya{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new gl(e,t,n):t==="array-contains"?new vl(e,n):t==="in"?new va(e,n):t==="not-in"?new wl(e,n):t==="array-contains-any"?new El(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new _l(e,n):new yl(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Sn(t,this.value)):t!==null&&tr(this.value)===tr(t)&&this.matchesComparison(Sn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ie=class r extends ya{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new r(e,t)}matches(e){return Zr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Zr(r){return r.op==="and"}function ml(r){return r.op==="or"}function sd(r){return v_(r)&&Zr(r)}function v_(r){for(let e of r.filters)if(e instanceof ie)return!1;return!0}function pl(r){if(r instanceof Z)return r.field.canonicalString()+r.op.toString()+Yr(r.value);if(sd(r))return r.filters.map(e=>pl(e)).join(",");{let e=r.filters.map(t=>pl(t)).join(",");return`${r.op}(${e})`}}function w_(r,e){return r instanceof Z?function(n,i){return i instanceof Z&&n.op===i.op&&n.field.isEqual(i.field)&&Nt(n.value,i.value)}(r,e):r instanceof ie?function(n,i){return i instanceof ie&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&w_(a,i.filters[u]),!0):!1}(r,e):void U()}function E_(r,e){let t=r.filters.concat(e);return ie.create(t,r.op)}function I_(r){return r instanceof Z?function(t){return`${t.field.canonicalString()} ${t.op} ${Yr(t.value)}`}(r):r instanceof ie?function(t){return t.op.toString()+" {"+t.getFilters().map(I_).join(" ,")+"}"}(r):"Filter"}var gl=class extends Z{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},_l=class extends Z{constructor(e,t){super(e,"in",t),this.keys=T_("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},yl=class extends Z{constructor(e,t){super(e,"not-in",t),this.keys=T_("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function T_(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>L.fromName(n.referenceValue))}var vl=class extends Z{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Cs(t)&&bs(t.arrayValue,this.value)}},va=class extends Z{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&bs(this.value.arrayValue,t)}},wl=class extends Z{constructor(e,t){super(e,"not-in",t)}matches(e){if(bs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!bs(this.value.arrayValue,t)}},El=class extends Z{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Cs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>bs(this.value.arrayValue,n))}};var Il=class{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function Tl(r,e=null,t=[],n=[],i=null,s=null,a=null){return new Il(r,e,t,n,i,s,a)}function ir(r){let e=O(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>pl(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Gs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Yr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Yr(n)).join(",")),e.ue=t}return e.ue}function zs(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!N0(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!w_(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!fg(r.startAt,e.startAt)&&fg(r.endAt,e.endAt)}function wa(r){return L.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Ea(r,e){return r.filters.filter(t=>t instanceof Z&&t.field.isEqual(e))}function mg(r,e,t){let n=oa,i=!0;for(let s of Ea(r,e)){let a=oa,u=!0;switch(s.op){case"<":case"<=":a=x0(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=oa}lg({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let a=t.position[s];lg({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}}return{value:n,inclusive:i}}function pg(r,e,t){let n=En,i=!0;for(let s of Ea(r,e)){let a=En,u=!0;switch(s.op){case">=":case">":a=k0(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=En}hg({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let a=t.position[s];hg({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}}return{value:n,inclusive:i}}var Et=class{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function A_(r,e,t,n,i,s,a,u){return new Et(r,e,t,n,i,s,a,u)}function mi(r){return new Et(r)}function gg(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function od(r){return r.collectionGroup!==null}function Qr(r){let e=O(r);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ae(Ee.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new rr(s,n))}),t.has(Ee.keyField().canonicalString())||e.ce.push(new rr(Ee.keyField(),n))}return e.ce}function Qe(r){let e=O(r);return e.le||(e.le=F0(e,Qr(r))),e.le}function F0(r,e){if(r.limitType==="F")return Tl(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new rr(i.field,s)});let t=r.endAt?new Ft(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Ft(r.startAt.position,r.startAt.inclusive):null;return Tl(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function Al(r,e){let t=r.filters.concat([e]);return new Et(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Ia(r,e,t){return new Et(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Ks(r,e){return zs(Qe(r),Qe(e))&&r.limitType===e.limitType}function b_(r){return`${ir(Qe(r))}|lt:${r.limitType}`}function jr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>I_(i)).join(", ")}]`),Gs(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Yr(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Yr(i)).join(",")),`Target(${n})`}(Qe(r))}; limitType=${r.limitType})`}function Ws(r,e){return e.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):L.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(let s of Qr(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(a,u,c){let d=dg(a,u,c);return a.inclusive?d<=0:d<0}(n.startAt,Qr(n),i)||n.endAt&&!function(a,u,c){let d=dg(a,u,c);return a.inclusive?d>=0:d>0}(n.endAt,Qr(n),i))}(r,e)}function C_(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function S_(r){return(e,t)=>{let n=!1;for(let i of Qr(r)){let s=M0(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function M0(r,e,t){let n=r.field.isKeyField()?L.comparator(e.key,t.key):function(s,a,u){let c=a.data.field(s),d=u.data.field(s);return c!==null&&d!==null?Sn(c,d):U()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return U()}}var Mt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){dr(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return m_(this.inner)}size(){return this.innerSize}};var O0=new he(L.comparator);function nt(){return O0}var P_=new he(L.comparator);function ms(...r){let e=P_;for(let t of r)e=e.insert(t.key,t);return e}function D_(r){let e=P_;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Rt(){return _s()}function R_(){return _s()}function _s(){return new Mt(r=>r.toString(),(r,e)=>r.isEqual(e))}var L0=new he(L.comparator),U0=new ae(L.comparator);function J(...r){let e=U0;for(let t of r)e=e.add(t);return e}var q0=new ae(W);function ad(){return q0}function ud(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Is(e)?"-0":e}}function V_(r){return{integerValue:""+r}}function x_(r,e){return c_(e)?V_(e):ud(r,e)}var ei=class{constructor(){this._=void 0}};function B0(r,e,t){return r instanceof Pn?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&au(s)&&(s=id(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof Xt?N_(r,e):r instanceof Yt?F_(r,e):function(i,s){let a=k_(i,s),u=_g(a)+_g(i.Pe);return fl(a)&&fl(i.Pe)?V_(u):ud(i.serializer,u)}(r,e)}function j0(r,e,t){return r instanceof Xt?N_(r,e):r instanceof Yt?F_(r,e):t}function k_(r,e){return r instanceof Dn?function(n){return fl(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}var Pn=class extends ei{},Xt=class extends ei{constructor(e){super(),this.elements=e}};function N_(r,e){let t=M_(e);for(let n of r.elements)t.some(i=>Nt(i,n))||t.push(n);return{arrayValue:{values:t}}}var Yt=class extends ei{constructor(e){super(),this.elements=e}};function F_(r,e){let t=M_(e);for(let n of r.elements)t=t.filter(i=>!Nt(i,n));return{arrayValue:{values:t}}}var Dn=class extends ei{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function _g(r){return fe(r.integerValue||r.doubleValue)}function M_(r){return Cs(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var sr=class{constructor(e,t){this.field=e,this.transform=t}};function $0(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof Xt&&i instanceof Xt||n instanceof Yt&&i instanceof Yt?Jr(n.elements,i.elements,Nt):n instanceof Dn&&i instanceof Dn?Nt(n.Pe,i.Pe):n instanceof Pn&&i instanceof Pn}(r.transform,e.transform)}var bl=class{constructor(e,t){this.version=e,this.transformResults=t}},ve=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ua(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}var ti=class{};function O_(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Vn(r.key,ve.none()):new Rn(r.key,r.data,ve.none());{let t=r.data,n=je.empty(),i=new ae(Ee.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new It(r.key,n,new ot(i.toArray()),ve.none())}}function G0(r,e,t){r instanceof Rn?function(i,s,a){let u=i.value.clone(),c=vg(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof It?function(i,s,a){if(!ua(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=vg(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(L_(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function ys(r,e,t,n){return r instanceof Rn?function(s,a,u,c){if(!ua(s.precondition,a))return u;let d=s.value.clone(),f=wg(s.fieldTransforms,c,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,e,t,n):r instanceof It?function(s,a,u,c){if(!ua(s.precondition,a))return u;let d=wg(s.fieldTransforms,c,a),f=a.data;return f.setAll(L_(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(r,e,t,n):function(s,a,u){return ua(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,e,t)}function z0(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=k_(n.transform,i||null);s!=null&&(t===null&&(t=je.empty()),t.set(n.field,s))}return t||null}function yg(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Jr(n,i,(s,a)=>$0(s,a))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}var Rn=class extends ti{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},It=class extends ti{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function L_(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function vg(r,e,t){let n=new Map;q(r.length===t.length);for(let i=0;i<t.length;i++){let s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,j0(a,u,t[i]))}return n}function wg(r,e,t){let n=new Map;for(let i of r){let s=i.transform,a=t.data.field(i.field);n.set(i.field,B0(s,a,e))}return n}var Vn=class extends ti{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ss=class extends ti{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ps=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&G0(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=ys(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=ys(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=R_();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;let c=O_(a,u);c!==null&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(B.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),J())}isEqual(e){return this.batchId===e.batchId&&Jr(this.mutations,e.mutations,(t,n)=>yg(t,n))&&Jr(this.baseMutations,e.baseMutations,(t,n)=>yg(t,n))}},Cl=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){q(e.mutations.length===n.length);let i=function(){return L0}(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(e,t,n,i)}};var Ds=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Sl=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ae,ee;function U_(r){switch(r){default:return U();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0}}function q_(r){if(r===void 0)return we("GRPC error has no .code"),S.UNKNOWN;switch(r){case Ae.OK:return S.OK;case Ae.CANCELLED:return S.CANCELLED;case Ae.UNKNOWN:return S.UNKNOWN;case Ae.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case Ae.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case Ae.INTERNAL:return S.INTERNAL;case Ae.UNAVAILABLE:return S.UNAVAILABLE;case Ae.UNAUTHENTICATED:return S.UNAUTHENTICATED;case Ae.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case Ae.NOT_FOUND:return S.NOT_FOUND;case Ae.ALREADY_EXISTS:return S.ALREADY_EXISTS;case Ae.PERMISSION_DENIED:return S.PERMISSION_DENIED;case Ae.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case Ae.ABORTED:return S.ABORTED;case Ae.OUT_OF_RANGE:return S.OUT_OF_RANGE;case Ae.UNIMPLEMENTED:return S.UNIMPLEMENTED;case Ae.DATA_LOSS:return S.DATA_LOSS;default:return U()}}(ee=Ae||(Ae={}))[ee.OK=0]="OK",ee[ee.CANCELLED=1]="CANCELLED",ee[ee.UNKNOWN=2]="UNKNOWN",ee[ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ee[ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ee[ee.NOT_FOUND=5]="NOT_FOUND",ee[ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",ee[ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",ee[ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",ee[ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ee[ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ee[ee.ABORTED=10]="ABORTED",ee[ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",ee[ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",ee[ee.INTERNAL=13]="INTERNAL",ee[ee.UNAVAILABLE=14]="UNAVAILABLE",ee[ee.DATA_LOSS=15]="DATA_LOSS";var Eg=null;function B_(){return new TextEncoder}var K0=new gn([4294967295,4294967295],0);function Ig(r){let e=B_().encode(r),t=new jc;return t.update(e),new Uint8Array(t.digest())}function Tg(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new gn([t,n],0),new gn([i,s],0)]}var Pl=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Zn(`Invalid padding: ${t}`);if(n<0)throw new Zn(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Zn(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Zn(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=gn.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(gn.fromNumber(n)));return i.compare(K0)===1&&(i=new gn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Ig(e),[n,i]=Tg(t);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new r(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(this.Ie===0)return;let t=Ig(e),[n,i]=Tg(t);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},Zn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Rs=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,Vs.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r(B.min(),i,new he(W),nt(),J())}},Vs=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,J(),J(),J())}};var Hr=class{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}},Ta=class{constructor(e,t){this.targetId=e,this.me=t}},Aa=class{constructor(e,t,n=Te.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},ba=class{constructor(){this.fe=0,this.ge=bg(),this.pe=Te.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=J(),t=J(),n=J();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:U()}}),new Vs(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=bg()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Dl=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=nt(),this.qe=Ag(),this.Qe=new he(W)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,n=e.me.count,i=this.Je(t);if(i){let s=i.target;if(wa(s))if(n===0){let a=new L(s.path);this.Ue(t,a,Pe.newNoDocument(a,B.min()))}else q(n===1);else{let a=this.Ye(t);if(a!==n){let u=this.Ze(e),c=u?this.Xe(u,e,a):1;if(c!==0){this.je(t);let d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}Eg?.et(function(f,p,_,A,x){var N,R,j,$,M,K;let Q={localCacheCount:f,existenceFilterCount:p.count,databaseId:_.database,projectId:_.projectId},H=p.unchangedNames;return H&&(Q.bloomFilter={applied:x===0,hashCount:(N=H?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:($=(j=(R=H?.bits)===null||R===void 0?void 0:R.bitmap)===null||j===void 0?void 0:j.length)!==null&&$!==void 0?$:0,padding:(K=(M=H?.bits)===null||M===void 0?void 0:M.padding)!==null&&K!==void 0?K:0,mightContain:w=>{var g;return(g=A?.mightContain(w))!==null&&g!==void 0&&g}}),Q}(a,e.me,this.Le.tt(),u,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,a,u;try{a=bn(n).toUint8Array()}catch(c){if(c instanceof _a)return ft("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Pl(a,i,s)}catch(c){return ft(c instanceof Zn?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.Ie===0?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,a)=>{let u=this.Je(a);if(u){if(s.current&&wa(u.target)){let c=new L(u.target.path);this.ke.get(c)!==null||this.it(a,c)||this.Ue(a,c,Pe.newNoDocument(c,e))}s.be&&(t.set(a,s.ve()),s.Ce())}});let n=J();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{let d=this.Je(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));let i=new Rs(e,t,this.Qe,this.ke,n);return this.ke=nt(),this.qe=Ag(),this.Qe=new he(W),i}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new ba,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ae(W),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||k("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new ba),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Ag(){return new he(L.comparator)}function bg(){return new he(L.comparator)}var W0={asc:"ASCENDING",desc:"DESCENDING"},Q0={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},H0={and:"AND",or:"OR"},Rl=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Vl(r,e){return r.useProto3Json||Gs(e)?e:{value:e}}function ni(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function j_(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function J0(r,e){return ni(r,e.toTimestamp())}function Ie(r){return q(!!r),B.fromTimestamp(function(t){let n=Jt(t);return new _e(n.seconds,n.nanos)}(r))}function cd(r,e){return xl(r,e).canonicalString()}function xl(r,e){let t=function(i){return new te(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function $_(r){let e=te.fromString(r);return q(Z_(e)),e}function xs(r,e){return cd(r.databaseId,e.path)}function xt(r,e){let t=$_(e);if(t.get(1)!==r.databaseId.projectId)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new L(K_(t))}function G_(r,e){return cd(r.databaseId,e)}function z_(r){let e=$_(r);return e.length===4?te.emptyPath():K_(e)}function kl(r){return new te(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function K_(r){return q(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Cg(r,e,t){return{name:xs(r,e),fields:t.value.mapValue.fields}}function W_(r,e,t){let n=xt(r,e.name),i=Ie(e.updateTime),s=e.createTime?Ie(e.createTime):B.min(),a=new je({mapValue:{fields:e.fields}}),u=Pe.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function X0(r,e){return"found"in e?function(n,i){q(!!i.found),i.found.name,i.found.updateTime;let s=xt(n,i.found.name),a=Ie(i.found.updateTime),u=i.found.createTime?Ie(i.found.createTime):B.min(),c=new je({mapValue:{fields:i.found.fields}});return Pe.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){q(!!i.missing),q(!!i.readTime);let s=xt(n,i.missing),a=Ie(i.readTime);return Pe.newNoDocument(s,a)}(r,e):U()}function Y0(r,e){let t;if("targetChange"in e){e.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:U()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(q(f===void 0||typeof f=="string"),Te.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Te.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(d){let f=d.code===void 0?S.UNKNOWN:q_(d.code);return new V(f,d.message||"")}(a);t=new Aa(n,i,s,u||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=xt(r,n.document.name),s=Ie(n.document.updateTime),a=n.document.createTime?Ie(n.document.createTime):B.min(),u=new je({mapValue:{fields:n.document.fields}}),c=Pe.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];t=new Hr(d,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=xt(r,n.document),s=n.readTime?Ie(n.readTime):B.min(),a=Pe.newNoDocument(i,s),u=n.removedTargetIds||[];t=new Hr([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=xt(r,n.document),s=n.removedTargetIds||[];t=new Hr([],s,i,null)}else{if(!("filter"in e))return U();{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new Sl(i,s),u=n.targetId;t=new Ta(u,a)}}return t}function ks(r,e){let t;if(e instanceof Rn)t={update:Cg(r,e.key,e.value)};else if(e instanceof Vn)t={delete:xs(r,e.key)};else if(e instanceof It)t={update:Cg(r,e.key,e.data),updateMask:iE(e.fieldMask)};else{if(!(e instanceof Ss))return U();t={verify:xs(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof Pn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Xt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Yt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Dn)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw U()}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:J0(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:U()}(r,e.precondition)),t}function Nl(r,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?ve.updateTime(Ie(s.updateTime)):s.exists!==void 0?ve.exists(s.exists):ve.none()}(e.currentDocument):ve.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME"),c=new Pn;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new Xt(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new Yt(f)}else"increment"in u?c=new Dn(a,u.increment):U();let d=Ee.fromServerFormat(u.fieldPath);return new sr(d,c)}(r,i)):[];if(e.update){e.update.name;let i=xt(r,e.update.name),s=new je({mapValue:{fields:e.update.fields}});if(e.updateMask){let a=function(c){let d=c.fieldPaths||[];return new ot(d.map(f=>Ee.fromServerFormat(f)))}(e.updateMask);return new It(i,s,a,t,n)}return new Rn(i,s,t,n)}if(e.delete){let i=xt(r,e.delete);return new Vn(i,t)}if(e.verify){let i=xt(r,e.verify);return new Ss(i,t)}return U()}function Z0(r,e){return r&&r.length>0?(q(e!==void 0),r.map(t=>function(i,s){let a=i.updateTime?Ie(i.updateTime):Ie(s);return a.isEqual(B.min())&&(a=Ie(s)),new bl(a,i.transformResults||[])}(t,e))):[]}function Q_(r,e){return{documents:[G_(r,e.path)]}}function H_(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=G_(r,i);let s=function(d){if(d.length!==0)return Y_(ie.create(d,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(_){return{field:$r(_.field),direction:tE(_.dir)}}(f))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=Vl(r,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:i}}function J_(r){let e=z_(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){q(n===1);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(p){let _=X_(p);return _ instanceof ie&&sd(_)?_.getFilters():[_]}(t.where));let a=[];t.orderBy&&(a=function(p){return p.map(_=>function(x){return new rr(Gr(x.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(_))}(t.orderBy));let u=null;t.limit&&(u=function(p){let _;return _=typeof p=="object"?p.value:p,Gs(_)?null:_}(t.limit));let c=null;t.startAt&&(c=function(p){let _=!!p.before,A=p.values||[];return new Ft(A,_)}(t.startAt));let d=null;return t.endAt&&(d=function(p){let _=!p.before,A=p.values||[];return new Ft(A,_)}(t.endAt)),A_(e,i,a,s,u,"F",c,d)}function eE(r,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function X_(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=Gr(t.unaryFilter.field);return Z.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Gr(t.unaryFilter.field);return Z.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Gr(t.unaryFilter.field);return Z.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Gr(t.unaryFilter.field);return Z.create(a,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(r):r.fieldFilter!==void 0?function(t){return Z.create(Gr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return ie.create(t.compositeFilter.filters.map(n=>X_(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U()}}(t.compositeFilter.op))}(r):U()}function tE(r){return W0[r]}function nE(r){return Q0[r]}function rE(r){return H0[r]}function $r(r){return{fieldPath:r.canonicalString()}}function Gr(r){return Ee.fromServerFormat(r.fieldPath)}function Y_(r){return r instanceof Z?function(t){if(t.op==="=="){if(cg(t.value))return{unaryFilter:{field:$r(t.field),op:"IS_NAN"}};if(ug(t.value))return{unaryFilter:{field:$r(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(cg(t.value))return{unaryFilter:{field:$r(t.field),op:"IS_NOT_NAN"}};if(ug(t.value))return{unaryFilter:{field:$r(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$r(t.field),op:nE(t.op),value:t.value}}}(r):r instanceof ie?function(t){let n=t.getFilters().map(i=>Y_(i));return n.length===1?n[0]:{compositeFilter:{op:rE(t.op),filters:n}}}(r):U()}function iE(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Z_(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var ri=class r{constructor(e,t,n,i,s=B.min(),a=B.min(),u=Te.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Ca=class{constructor(e){this.ct=e}};function sE(r,e){let t;if(e.document)t=W_(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=L.fromSegments(e.noDocument.path),i=ar(e.noDocument.readTime);t=Pe.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U();{let n=L.fromSegments(e.unknownDocument.path),i=ar(e.unknownDocument.version);t=Pe.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){let s=new _e(i[0],i[1]);return B.fromTimestamp(s)}(e.readTime)),t}function Sg(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Sa(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,a){return{name:xs(s,a.key),fields:a.data.value.mapValue.fields,updateTime:ni(s,a.version.toTimestamp()),createTime:ni(s,a.createTime.toTimestamp())}}(r.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:or(e.version)};else{if(!e.isUnknownDocument())return U();n.unknownDocument={path:t.path.toArray(),version:or(e.version)}}return n}function Sa(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function or(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ar(r){let e=new _e(r.seconds,r.nanoseconds);return B.fromTimestamp(e)}function Jn(r,e){let t=(e.baseMutations||[]).map(s=>Nl(r.ct,s));for(let s=0;s<e.mutations.length-1;++s){let a=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let u=e.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>Nl(r.ct,s)),i=_e.fromMillis(e.localWriteTimeMs);return new Ps(e.batchId,i,t,n)}function ps(r){let e=ar(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?ar(r.lastLimboFreeSnapshotVersion):B.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return q(s.documents.length===1),Qe(mi(z_(s.documents[0])))}(r.query):function(s){return Qe(J_(s))}(r.query),new ri(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,Te.fromBase64String(r.resumeToken))}function ey(r,e){let t=or(e.snapshotVersion),n=or(e.lastLimboFreeSnapshotVersion),i;i=wa(e.target)?Q_(r.ct,e.target):H_(r.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ir(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function ld(r){let e=J_({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Ia(e,e.limit,"L"):e}function Hc(r,e){return new Ds(e.largestBatchId,Nl(r.ct,e.overlayMutation))}function Pg(r,e){let t=e.path.lastSegment();return[r,We(e.path.popLast()),t]}function Dg(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:or(n.readTime),documentKey:We(n.documentKey.path),largestBatchId:n.largestBatchId}}var Fl=class{getBundleMetadata(e,t){return Rg(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:ar(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return Rg(e).put(function(i){return{bundleId:i.id,createTime:or(Ie(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return Vg(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:ld(s.bundledQuery),readTime:ar(s.readTime)}}(n)})}saveNamedQuery(e,t){return Vg(e).put(function(i){return{name:i.name,readTime:or(Ie(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function Rg(r){return De(r,"bundles")}function Vg(r){return De(r,"namedQueries")}var Pa=class r{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new r(e,n)}getOverlay(e,t){return ls(e).get(Pg(this.userId,t)).next(n=>n?Hc(this.serializer,n):null)}getOverlays(e,t){let n=Rt();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,a)=>{let u=new Ds(t,a);i.push(this.ht(e,u))}),C.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(a=>i.add(We(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(ls(e).j("collectionPathOverlayIndex",u))}),C.waitFor(s)}getOverlaysForCollection(e,t,n){let i=Rt(),s=We(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ls(e).U("collectionPathOverlayIndex",a).next(u=>{for(let c of u){let d=Hc(this.serializer,c);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s=Rt(),a,u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ls(e).J({index:"collectionGroupOverlayIndex",range:u},(c,d,f)=>{let p=Hc(this.serializer,d);s.size()<i||p.largestBatchId===a?(s.set(p.getKey(),p),a=p.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return ls(e).put(function(i,s,a){let[u,c,d]=Pg(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:ks(i.ct,a.mutation)}}(this.serializer,this.userId,t))}};function ls(r){return De(r,"documentOverlays")}var Ml=class{Pt(e){return De(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let n=t?.value;return n?Te.fromUint8Array(n):Te.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var Qt=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(fe(e.integerValue));else if("doubleValue"in e){let n=fe(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Is(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=Jt(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(bn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?g_(e)?this.dt(t,Number.MAX_SAFE_INTEGER):uu(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):U()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let n=e.fields||{};this.dt(t,55);for(let i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;let s=e.fields||{};this.dt(t,53);let a="value",u=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(fe(u)),this.Vt(a,t),this.Tt(s[a],t)}bt(e,t){let n=e.values||[];this.dt(t,50);for(let i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),L.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};Qt.vt=new Qt;function oE(r){if(r===0)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function xg(r){let e=64-function(n){let i=0;for(let s=0;s<8;++s){let a=oE(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(e/8)}var Ol=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),n=xg(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),n=xg(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},Ll=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},Ul=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},Xn=class{constructor(){this.jt=new Ol,this.Ht=new Ll(this.jt),this.Jt=new Ul(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var Yn=class r{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function _n(r,e){let t=r.indexId-e.indexId;return t!==0?t:(t=kg(r.arrayValue,e.arrayValue),t!==0?t:(t=kg(r.directionalValue,e.directionalValue),t!==0?t:L.comparator(r.documentKey,e.documentKey)))}function kg(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}var Da=class{constructor(e){this.Xt=new ae((t,n)=>Ee.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(q(e.collectionGroup===this.collectionId),this.nn)return!1;let t=ol(e);if(t!==void 0&&!this.sn(t))return!1;let n=Qn(e),i=new Set,s=0,a=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){let u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=n[s];if(!this.on(u,c)||!this._n(this.en[a++],c))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.en.length||!this._n(this.en[a++],u))return!1}return!0}an(){if(this.nn)return null;let e=new ae(Ee.comparator),t=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new Wr(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Wr(n.field,0))}for(let n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Wr(n.field,n.dir==="asc"?0:1)));return new Xr(Xr.UNKNOWN_ID,this.collectionId,t,Es.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function ty(r){var e,t;if(q(r instanceof Z||r instanceof ie),r instanceof Z){if(r instanceof va){let i=((t=(e=r.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>Z.create(r.field,"==",s)))||[];return ie.create(i,"or")}return r}let n=r.filters.map(i=>ty(i));return ie.create(n,r.op)}function aE(r){if(r.getFilters().length===0)return[];let e=jl(ty(r));return q(ny(e)),ql(e)||Bl(e)?[e]:e.getFilters()}function ql(r){return r instanceof Z}function Bl(r){return r instanceof ie&&sd(r)}function ny(r){return ql(r)||Bl(r)||function(t){if(t instanceof ie&&ml(t)){for(let n of t.getFilters())if(!ql(n)&&!Bl(n))return!1;return!0}return!1}(r)}function jl(r){if(q(r instanceof Z||r instanceof ie),r instanceof Z)return r;if(r.filters.length===1)return jl(r.filters[0]);let e=r.filters.map(n=>jl(n)),t=ie.create(e,r.op);return t=Ra(t),ny(t)?t:(q(t instanceof ie),q(Zr(t)),q(t.filters.length>1),t.filters.reduce((n,i)=>hd(n,i)))}function hd(r,e){let t;return q(r instanceof Z||r instanceof ie),q(e instanceof Z||e instanceof ie),t=r instanceof Z?e instanceof Z?function(i,s){return ie.create([i,s],"and")}(r,e):Ng(r,e):e instanceof Z?Ng(e,r):function(i,s){if(q(i.filters.length>0&&s.filters.length>0),Zr(i)&&Zr(s))return E_(i,s.getFilters());let a=ml(i)?i:s,u=ml(i)?s:i,c=a.filters.map(d=>hd(d,u));return ie.create(c,"or")}(r,e),Ra(t)}function Ng(r,e){if(Zr(e))return E_(e,r.getFilters());{let t=e.filters.map(n=>hd(r,n));return ie.create(t,"or")}}function Ra(r){if(q(r instanceof Z||r instanceof ie),r instanceof Z)return r;let e=r.getFilters();if(e.length===1)return Ra(e[0]);if(v_(r))return r;let t=e.map(i=>Ra(i)),n=[];return t.forEach(i=>{i instanceof Z?n.push(i):i instanceof ie&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:ie.create(n,r.op)}var $l=class{constructor(){this.un=new Ns}addToCollectionParentIndex(e,t){return this.un.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(mt.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(mt.min())}updateCollectionGroup(e,t,n){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},Ns=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new ae(te.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new ae(te.comparator)).toArray()}};var ta=new Uint8Array(0),Gl=class{constructor(e,t){this.databaseId=t,this.cn=new Ns,this.ln=new Mt(n=>ir(n),(n,i)=>zs(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:n,parent:We(i)};return Fg(e).put(s)}return C.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[i_(t),""],!1,!0);return Fg(e).U(i).next(s=>{for(let a of s){if(a.collectionId!==t)break;n.push(Dt(a.parent))}return n})}addFieldIndex(e,t){let n=hs(e),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;let s=n.add(i);if(t.indexState){let a=Ur(e);return s.next(u=>{a.put(Dg(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=hs(e),i=Ur(e),s=Lr(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=hs(e),n=Lr(e),i=Ur(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return C.forEach(this.hn(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new Da(n).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=Lr(e),i=!0,s=new Map;return C.forEach(this.hn(t),a=>this.Pn(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=J(),u=[];return C.forEach(s,(c,d)=>{k("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(K=>`${K.fieldPath}:${K.kind}`).join(",")}`}(c)} to execute ${ir(t)}`);let f=function(M,K){let Q=ol(K);if(Q===void 0)return null;for(let H of Ea(M,Q.fieldPath))switch(H.op){case"array-contains-any":return H.value.arrayValue.values||[];case"array-contains":return[H.value]}return null}(d,c),p=function(M,K){let Q=new Map;for(let H of Qn(K))for(let w of Ea(M,H.fieldPath))switch(w.op){case"==":case"in":Q.set(H.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return Q.set(H.fieldPath.canonicalString(),w.value),Array.from(Q.values())}return null}(d,c),_=function(M,K){let Q=[],H=!0;for(let w of Qn(K)){let g=w.kind===0?mg(M,w.fieldPath,M.startAt):pg(M,w.fieldPath,M.startAt);Q.push(g.value),H&&(H=g.inclusive)}return new Ft(Q,H)}(d,c),A=function(M,K){let Q=[],H=!0;for(let w of Qn(K)){let g=w.kind===0?pg(M,w.fieldPath,M.endAt):mg(M,w.fieldPath,M.endAt);Q.push(g.value),H&&(H=g.inclusive)}return new Ft(Q,H)}(d,c),x=this.In(c,d,_),N=this.In(c,d,A),R=this.Tn(c,d,p),j=this.En(c.indexId,f,x,_.inclusive,N,A.inclusive,R);return C.forEach(j,$=>n.G($,t.limit).next(M=>{M.forEach(K=>{let Q=L.fromSegments(K.documentKey);a.has(Q)||(a=a.add(Q),u.push(Q))})}))}).next(()=>u)}return C.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=aE(ie.create(e.filters,"and")).map(n=>Tl(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,i,s,a,u){let c=(t!=null?t.length:1)*Math.max(n.length,s.length),d=c/(t!=null?t.length:1),f=[];for(let p=0;p<c;++p){let _=t?this.dn(t[p/d]):ta,A=this.An(e,_,n[p%d],i),x=this.Rn(e,_,s[p%d],a),N=u.map(R=>this.An(e,_,R,!0));f.push(...this.createRange(A,x,N))}return f}An(e,t,n,i){let s=new Yn(e,L.empty(),t,n);return i?s:s.Zt()}Rn(e,t,n,i){let s=new Yn(e,L.empty(),t,n);return i?s.Zt():s}Pn(e,t){let n=new Da(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(let u of s)n.rn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2,i=this.hn(t);return C.forEach(i,s=>this.Pn(e,s).next(a=>{a?n!==0&&a.fields.length<function(c){let d=new ae(Ee.comparator),f=!1;for(let p of c.filters)for(let _ of p.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let p of c.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(t)&&i.length>1&&n===2?1:n)}Vn(e,t){let n=new Xn;for(let i of Qn(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let a=n.Yt(i.kind);Qt.vt.It(s,a)}return n.zt()}dn(e){let t=new Xn;return Qt.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let n=new Xn;return Qt.vt.It(nr(this.databaseId,t),n.Yt(function(s){let a=Qn(s);return a.length===0?0:a[a.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let i=[];i.push(new Xn);let s=0;for(let a of Qn(e)){let u=n[s++];for(let c of i)if(this.fn(t,a.fieldPath)&&Cs(u))i=this.gn(i,a,u);else{let d=c.Yt(a.kind);Qt.vt.It(u,d)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){let i=[...e],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let c=new Xn;c.seed(u.zt()),Qt.vt.It(a,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof Z&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=hs(e),i=Ur(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{let a=[];return C.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,p){let _=p?new Es(p.sequenceNumber,new mt(ar(p.readTime),new L(Dt(p.documentKey)),p.largestBatchId)):Es.empty(),A=f.fields.map(([x,N])=>new Wr(Ee.fromServerFormat(x),N));return new Xr(f.indexId,f.collectionGroup,A,_)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:W(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=hs(e),s=Ur(e);return this.yn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>C.forEach(u,c=>s.put(Dg(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){let n=new Map;return C.forEach(t,(i,s)=>{let a=n.get(i.collectionGroup);return(a?C.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),C.forEach(u,c=>this.wn(e,i,c).next(d=>{let f=this.Sn(s,c);return d.isEqual(f)?C.resolve():this.bn(e,s,c,d,f)}))))})}Dn(e,t,n,i){return Lr(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return Lr(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){let i=Lr(e),s=new ae(_n);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(a,u)=>{s=s.add(new Yn(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(e,t){let n=new ae(_n),i=this.Vn(t,e);if(i==null)return n;let s=ol(t);if(s!=null){let a=e.data.field(s.fieldPath);if(Cs(a))for(let u of a.arrayValue.values||[])n=n.add(new Yn(t.indexId,e.key,this.dn(u),i))}else n=n.add(new Yn(t.indexId,e.key,ta,i));return n}bn(e,t,n,i,s){k("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let a=[];return function(c,d,f,p,_){let A=c.getIterator(),x=d.getIterator(),N=Or(A),R=Or(x);for(;N||R;){let j=!1,$=!1;if(N&&R){let M=f(N,R);M<0?$=!0:M>0&&(j=!0)}else N!=null?$=!0:j=!0;j?(p(R),R=Or(x)):$?(_(N),N=Or(A)):(N=Or(A),R=Or(x))}}(i,s,_n,u=>{a.push(this.Dn(e,t,n,u))},u=>{a.push(this.vn(e,t,n,u))}),C.waitFor(a)}yn(e){let t=1;return Ur(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>_n(a,u)).filter((a,u,c)=>!u||_n(a,c[u-1])!==0);let i=[];i.push(e);for(let a of n){let u=_n(a,e),c=_n(a,t);if(u===0)i[0]=e.Zt();else if(u>0&&c<0)i.push(a),i.push(a.Zt());else if(c>0)break}i.push(t);let s=[];for(let a=0;a<i.length;a+=2){if(this.Cn(i[a],i[a+1]))return[];let u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,ta,[]],c=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,ta,[]];s.push(IDBKeyRange.bound(u,c))}return s}Cn(e,t){return _n(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Mg)}getMinOffset(e,t){return C.mapArray(this.hn(t),n=>this.Pn(e,n).next(i=>i||U())).next(Mg)}};function Fg(r){return De(r,"collectionParents")}function Lr(r){return De(r,"indexEntries")}function hs(r){return De(r,"indexConfiguration")}function Ur(r){return De(r,"indexState")}function Mg(r){q(r.length!==0);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;td(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new mt(e.readTime,e.documentKey,t)}var Og={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},dt=class r{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function ry(r,e,t){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId),u=0,c=n.J({range:a},(f,p,_)=>(u++,_.delete()));s.push(c.next(()=>{q(u===1)}));let d=[];for(let f of t.mutations){let p=l_(e,f.key.path,t.batchId);s.push(i.delete(p)),d.push(f.key)}return C.waitFor(s).next(()=>d)}function Va(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw U();e=r.noDocument}return JSON.stringify(e).length}dt.DEFAULT_COLLECTION_PERCENTILE=10,dt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,dt.DEFAULT=new dt(41943040,dt.DEFAULT_COLLECTION_PERCENTILE,dt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),dt.DISABLED=new dt(-1,0,0);var xa=class r{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){q(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new r(s,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return yn(e).J({index:"userMutationsIndex",range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=zr(e),a=yn(e);return a.add({}).next(u=>{q(typeof u=="number");let c=new Ps(u,t,n,i),d=function(A,x,N){let R=N.baseMutations.map($=>ks(A.ct,$)),j=N.mutations.map($=>ks(A.ct,$));return{userId:x,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:R,mutations:j}}(this.serializer,this.userId,c),f=[],p=new ae((_,A)=>W(_.canonicalString(),A.canonicalString()));for(let _ of i){let A=l_(this.userId,_.key.path,u);p=p.add(_.key.path.popLast()),f.push(a.put(d)),f.push(s.put(A,f0))}return p.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Fn[u]=c.keys()}),C.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return yn(e).get(t).next(n=>n?(q(n.userId===this.userId),Jn(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?C.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return yn(e).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(q(u.batchId>=n),s=Jn(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return yn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return yn(e).U("userMutationsIndex",t).next(n=>n.map(i=>Jn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=sa(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return zr(e).J({range:i},(a,u,c)=>{let[d,f,p]=a,_=Dt(f);if(d===this.userId&&t.path.isEqual(_))return yn(e).get(p).next(A=>{if(!A)throw U();q(A.userId===this.userId),s.push(Jn(this.serializer,A))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ae(W),i=[];return t.forEach(s=>{let a=sa(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=zr(e).J({range:u},(d,f,p)=>{let[_,A,x]=d,N=Dt(A);_===this.userId&&s.path.isEqual(N)?n=n.add(x):p.done()});i.push(c)}),C.waitFor(i).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=sa(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new ae(W);return zr(e).J({range:a},(c,d,f)=>{let[p,_,A]=c,x=Dt(_);p===this.userId&&n.isPrefixOf(x)?x.length===i&&(u=u.add(A)):f.done()}).next(()=>this.xn(e,u))}xn(e,t){let n=[],i=[];return t.forEach(s=>{i.push(yn(e).get(s).next(a=>{if(a===null)throw U();q(a.userId===this.userId),n.push(Jn(this.serializer,a))}))}),C.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return ry(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),C.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return C.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return zr(e).J({range:n},(s,a,u)=>{if(s[0]===this.userId){let c=Dt(s[1]);i.push(c)}else u.done()}).next(()=>{q(i.length===0)})})}containsKey(e,t){return iy(e,this.userId,t)}Nn(e){return sy(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function iy(r,e,t){let n=sa(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return zr(r).J({range:s,H:!0},(u,c,d)=>{let[f,p,_]=u;f===e&&p===i&&(a=!0),d.done()}).next(()=>a)}function yn(r){return De(r,"mutations")}function zr(r){return De(r,"documentMutations")}function sy(r){return De(r,"mutationQueues")}var ii=class r{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new r(0)}static kn(){return new r(-1)}};var zl=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let n=new ii(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>B.fromTimestamp(new _e(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>qr(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(q(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let i=0,s=[];return qr(e).J((a,u)=>{let c=ps(u);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>C.waitFor(s)).next(()=>i)}forEachTarget(e,t){return qr(e).J((n,i)=>{let s=ps(i);t(s)})}qn(e){return Lg(e).get("targetGlobalKey").next(t=>(q(t!==null),t))}Qn(e,t){return Lg(e).put("targetGlobalKey",t)}Kn(e,t){return qr(e).put(ey(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=ir(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return qr(e).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{let d=ps(u);zs(t,d.target)&&(s=d,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=vn(e);return t.forEach(a=>{let u=We(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),C.waitFor(i)}removeMatchingKeys(e,t,n){let i=vn(e);return C.forEach(t,s=>{let a=We(s.path);return C.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=vn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=vn(e),s=J();return i.J({range:n,H:!0},(a,u,c)=>{let d=Dt(a[1]),f=new L(d);s=s.add(f)}).next(()=>s)}containsKey(e,t){let n=We(t.path),i=IDBKeyRange.bound([n],[i_(n)],!1,!0),s=0;return vn(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}ot(e,t){return qr(e).get(t).next(n=>n?ps(n):null)}};function qr(r){return De(r,"targets")}function Lg(r){return De(r,"targetGlobal")}function vn(r){return De(r,"targetDocuments")}function Ug([r,e],[t,n]){let i=W(r,t);return i===0?W(e,n):i}var Kl=class{constructor(e){this.Un=e,this.buffer=new ae(Ug),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();Ug(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},Wl=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){k("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>D(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Nn(t)?k("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield kn(t)}yield this.Hn(3e5)}))}},Ql=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return C.resolve(st.oe);let n=new Kl(t);return this.Jn.forEachTarget(e,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(Og)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Og):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,a,u,c,d,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,a=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(n=p,u=Date.now(),this.removeTargets(e,n,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(d=Date.now(),Br()<=St.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${p} documents in `+(d-c)+`ms
Total Duration: ${d-f}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}};function uE(r,e){return new Ql(r,e)}var Hl=class{constructor(e,t){this.db=e,this.garbageCollector=uE(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,i)=>t(i))}addReference(e,t,n){return na(e,n)}removeReference(e,t,n){return na(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return na(e,t)}nr(e,t){return function(i,s){let a=!1;return sy(i).Y(u=>iy(i,u,s).next(c=>(c&&(a=!0),C.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(a,u)=>{if(u<=t){let c=this.nr(e,a).next(d=>{if(!d)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,B.min()),vn(e).delete(function(p){return[0,We(p.path)]}(a))))});i.push(c)}}).next(()=>C.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return na(e,t)}tr(e,t){let n=vn(e),i,s=st.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:d})=>{a===0?(s!==st.oe&&t(new L(Dt(i)),s),s=d,i=c):s=st.oe}).next(()=>{s!==st.oe&&t(new L(Dt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function na(r,e){return vn(r).put(function(n,i){return{targetId:0,path:We(n.path),sequenceNumber:i}}(e,r.currentSequenceNumber))}var ka=class{constructor(){this.changes=new Mt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Pe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?C.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Jl=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Wn(e).put(n)}removeEntry(e,t,n){return Wn(e).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Sa(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=Pe.newInvalidDocument(t);return Wn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ds(t))},(i,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:Pe.newInvalidDocument(t)};return Wn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ds(t))},(i,s)=>{n={document:this.ir(t,s),size:Va(s)}}).next(()=>n)}getEntries(e,t){let n=nt();return this._r(e,t,(i,s)=>{let a=this.ir(i,s);n=n.insert(i,a)}).next(()=>n)}ar(e,t){let n=nt(),i=new he(L.comparator);return this._r(e,t,(s,a)=>{let u=this.ir(s,a);n=n.insert(s,u),i=i.insert(s,Va(a))}).next(()=>({documents:n,ur:i}))}_r(e,t,n){if(t.isEmpty())return C.resolve();let i=new ae(jg);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(ds(i.first()),ds(i.last())),a=i.getIterator(),u=a.getNext();return Wn(e).J({index:"documentKeyIndex",range:s},(c,d,f)=>{let p=L.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&jg(u,p)<0;)n(u,null),u=a.getNext();u&&u.isEqual(p)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.$(ds(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let a=t.path,u=[a.popLast().toArray(),a.lastSegment(),Sa(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Wn(e).U(IDBKeyRange.bound(u,c,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=nt();for(let p of d){let _=this.ir(L.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);_.isFoundDocument()&&(Ws(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=nt(),a=Bg(t,n),u=Bg(t,mt.max());return Wn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,d,f)=>{let p=this.ir(L.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(p.key,p),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Xl(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return qg(e).get("remoteDocumentGlobalKey").next(t=>(q(!!t),t))}rr(e,t){return qg(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let n=sE(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(B.min())))return n}return Pe.newInvalidDocument(e)}};function oy(r){return new Jl(r)}var Xl=class extends ka{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Mt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new ae((s,a)=>W(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,u.readTime)),a.isValidDocument()){let c=Sg(this.cr.serializer,a);i=i.add(s.path.popLast());let d=Va(c);n+=d-u.size,t.push(this.cr.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){let c=Sg(this.cr.serializer,a.convertToNoDocument(B.min()));t.push(this.cr.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),C.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:i})=>(i.forEach((s,a)=>{this.lr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function qg(r){return De(r,"remoteDocumentGlobal")}function Wn(r){return De(r,"remoteDocumentsV14")}function ds(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Bg(r,e){let t=e.documentKey.path.toArray();return[r,Sa(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function jg(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=W(t[s],n[s]),i)return i;return i=W(t.length,n.length),i||(i=W(t[t.length-2],n[n.length-2]),i||W(t[t.length-1],n[n.length-1]))}var Yl=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Na=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&ys(n.mutation,i,ot.empty(),_e.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,J()).next(()=>n))}getLocalViewOfDocuments(e,t,n=J()){let i=Rt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=ms();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let n=Rt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,J()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=nt(),a=_s(),u=function(){return _s()}();return t.forEach((c,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof It)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),ys(f.mutation,d,f.mutation.getFieldMask(),_e.now())):a.set(d.key,ot.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((d,f)=>a.set(d,f)),t.forEach((d,f)=>{var p;return u.set(d,new Yl(f,(p=a.get(d))!==null&&p!==void 0?p:null))}),u))}recalculateAndSaveOverlays(e,t){let n=_s(),i=new he((a,u)=>a-u),s=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(c=>{let d=t.get(c);if(d===null)return;let f=n.get(c)||ot.empty();f=u.applyToLocalView(d,f),n.set(c,f);let p=(i.get(u.batchId)||J()).add(c);i=i.insert(u.batchId,p)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),d=c.key,f=c.value,p=R_();f.forEach(_=>{if(!s.has(_)){let A=O_(t.get(_),n.get(_));A!==null&&p.set(_,A),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,p))}return C.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):od(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):C.resolve(Rt()),u=-1,c=s;return a.next(d=>C.forEach(d,(f,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),s.get(f)?C.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,c,d,J())).next(f=>({batchId:u,changes:D_(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(n=>{let i=ms();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,a=ms();return this.indexManager.getCollectionParents(e,s).next(u=>C.forEach(u,c=>{let d=function(p,_){return new Et(_,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,n,i).next(f=>{f.forEach((p,_)=>{a=a.insert(p,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,Pe.newInvalidDocument(f)))});let u=ms();return a.forEach((c,d)=>{let f=s.get(c);f!==void 0&&ys(f.mutation,d,ot.empty(),_e.now()),Ws(t,d)&&(u=u.insert(c,d))}),u})}};var Zl=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return C.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ie(i.createTime)}}(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:ld(i.bundledQuery),readTime:Ie(i.readTime)}}(t)),C.resolve()}};var eh=class{constructor(){this.overlays=new he(L.comparator),this.Ir=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Rt();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),C.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Ir.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),C.resolve()}getOverlaysForCollection(e,t,n){let i=Rt(),s=t.length+1,a=new L(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let c=u.getNext().value,d=c.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new he((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=Rt(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=Rt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return C.resolve(u)}ht(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Ds(t,n));let s=this.Ir.get(t);s===void 0&&(s=J(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}};var th=class{constructor(){this.sessionToken=Te.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var Fs=class{constructor(){this.Tr=new ae(be.Er),this.dr=new ae(be.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let n=new be(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new be(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){let t=new L(new te([])),n=new be(t,e),i=new be(t,e+1),s=[];return this.dr.forEachInRange([n,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new L(new te([])),n=new be(t,e),i=new be(t,e+1),s=J();return this.dr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new be(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},be=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return L.comparator(e.key,t.key)||W(e.wr,t.wr)}static Ar(e,t){return W(e.wr,t.wr)||L.comparator(e.key,t.key)}};var nh=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ae(be.Er)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Ps(s,t,n,i);this.mutationQueue.push(a);for(let u of i)this.br=this.br.add(new be(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.vr(n),s=i<0?0:i;return C.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new be(t,0),i=new be(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],a=>{let u=this.Dr(a.wr);s.push(u)}),C.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ae(W);return t.forEach(i=>{let s=new be(i,0),a=new be(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],u=>{n=n.add(u.wr)})}),C.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;L.isDocumentKey(s)||(s=s.child(""));let a=new be(new L(s),0),u=new ae(W);return this.br.forEachWhile(c=>{let d=c.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(c.wr)),!0)},a),C.resolve(this.Cr(u))}Cr(e){let t=[];return e.forEach(n=>{let i=this.Dr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){q(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return C.forEach(t.mutations,i=>{let s=new be(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){let n=new be(t,0),i=this.br.firstAfterOrEqual(n);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var rh=class{constructor(e){this.Mr=e,this.docs=function(){return new he(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return C.resolve(n?n.document.mutableCopy():Pe.newInvalidDocument(t))}getEntries(e,t){let n=nt();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Pe.newInvalidDocument(i))}),C.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=nt(),a=t.path,u=new L(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:d,value:{document:f}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||td(o_(f),n)<=0||(i.has(f.key)||Ws(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return C.resolve(s)}getAllFromCollectionGroup(e,t,n,i){U()}Or(e,t){return C.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new ih(this)}getSize(e){return C.resolve(this.size)}},ih=class extends ka{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),C.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var sh=class{constructor(e){this.persistence=e,this.Nr=new Mt(t=>ir(t),zs),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Fs,this.targetCount=0,this.kr=ii.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),C.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new ii(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Kn(t),C.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),C.waitFor(s).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let n=this.Nr.get(t)||null;return C.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),C.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),C.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Br.yr(t);return C.resolve(n)}containsKey(e,t){return C.resolve(this.Br.containsKey(t))}};var Fa=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new st(0),this.Kr=!1,this.Kr=!0,this.$r=new th,this.referenceDelegate=e(this),this.Ur=new sh(this),this.indexManager=new $l,this.remoteDocumentCache=function(i){return new rh(i)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Ca(t),this.Gr=new Zl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new eh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new nh(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){k("MemoryPersistence","Starting transaction:",e);let i=new oh(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return C.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}},oh=class extends ma{constructor(e){super(),this.currentSequenceNumber=e}},Ma=class r{constructor(e){this.persistence=e,this.Jr=new Fs,this.Yr=null}static Zr(e){return new r(e)}get Xr(){if(this.Yr)return this.Yr;throw U()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),C.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),C.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.Xr,n=>{let i=L.fromPath(n);return this.ei(e,i).next(s=>{s||t.removeEntry(i,B.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return C.or([()=>C.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var ah=class{constructor(e){this.serializer=e}O(e,t,n,i){let s=new pa("createOrUpgrade",t);n<1&&i>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ig,{unique:!0}),c.createObjectStore("documentMutations")}(e),$g(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=C.resolve();return n<3&&i>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),$g(e)),a=a.next(()=>function(c){let d=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(c,d){return d.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ig,{unique:!0});let p=d.store("mutations"),_=f.map(A=>p.put(A));return C.waitFor(_)})}(e,s))),a=a.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&i>=5&&(a=a.next(()=>this.ni(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&i>=7&&(a=a.next(()=>this.ii(s))),n<8&&i>=8&&(a=a.next(()=>this.si(e,s))),n<9&&i>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&i>=10&&(a=a.next(()=>this.oi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{(function(c){let d=c.createObjectStore("documentOverlays",{keyPath:b0});d.createIndex("collectionPathOverlayIndex",C0,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",S0,{unique:!1})})(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){let d=c.createObjectStore("remoteDocumentsV14",{keyPath:m0});d.createIndex("documentKeyIndex",p0),d.createIndex("collectionGroupIndex",g0)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.ai(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:E0}).createIndex("sequenceNumberIndex",I0,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:T0}).createIndex("documentKeyIndex",A0,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),a}ri(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=Va(i)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>C.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>C.forEach(u,c=>{q(c.userId===s.userId);let d=Jn(this.serializer,c);return ry(e,s.userId,d).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((a,u)=>{let c=new te(a),d=function(p){return[0,We(p)]}(c);s.push(t.get(d).next(f=>f?C.resolve():(p=>t.put({targetId:0,path:We(p),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>C.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:w0});let n=t.store("collectionParents"),i=new Ns,s=a=>{if(i.add(a)){let u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:We(c)})}};return t.store("remoteDocuments").J({H:!0},(a,u)=>{let c=new te(a);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,u,c],d)=>{let f=Dt(u);return s(f.popLast())}))}oi(e){let t=e.store("targets");return t.J((n,i)=>{let s=ps(i),a=ey(this.serializer,s);return t.put(a)})}_i(e,t){let n=t.store("remoteDocuments"),i=[];return n.J((s,a)=>{let u=t.store("remoteDocumentsV14"),c=function(p){return p.document?new L(te.fromString(p.document.name).popFirst(5)):p.noDocument?L.fromSegments(p.noDocument.path):p.unknownDocument?L.fromSegments(p.unknownDocument.path):U()}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>C.waitFor(i))}ai(e,t){let n=t.store("mutations"),i=oy(this.serializer),s=new Fa(Ma.Zr,this.serializer.ct);return n.U().next(a=>{let u=new Map;return a.forEach(c=>{var d;let f=(d=u.get(c.userId))!==null&&d!==void 0?d:J();Jn(this.serializer,c).keys().forEach(p=>f=f.add(p)),u.set(c.userId,f)}),C.forEach(u,(c,d)=>{let f=new Ce(d),p=Pa.lt(this.serializer,f),_=s.getIndexManager(f),A=xa.lt(f,this.serializer,_,s.referenceDelegate);return new Na(i,A,p,_).recalculateAndSaveOverlaysForDocumentKeys(new Ts(t,st.oe),c).next()})})}};function $g(r){r.createObjectStore("targetDocuments",{keyPath:y0}).createIndex("documentTargetsIndex",v0,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",_0,{unique:!0}),r.createObjectStore("targetGlobal")}var Jc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",uh=class r{constructor(e,t,n,i,s,a,u,c,d,f,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=a,this.document=u,this.ci=d,this.li=f,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!r.D())throw new V(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Hl(this,i),this.Ai=t+"main",this.serializer=new Ca(c),this.Ri=new An(this.Ai,this.hi,new ah(this.serializer)),this.$r=new Ml,this.Ur=new zl(this.referenceDelegate,this.serializer),this.remoteDocumentCache=oy(this.serializer),this.Gr=new Fl,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,f===!1&&we("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new V(S.FAILED_PRECONDITION,Jc);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new st(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>D(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>D(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>D(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ra(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Nn(e))return k("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return k("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return fs(e).get("owner").next(t=>C.resolve(this.vi(t)))}Ci(e){return ra(e).delete(this.clientId)}Fi(){return D(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=De(t,"clientMetadata");return n.U().next(i=>{let s=this.xi(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return C.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?C.resolve(!0):fs(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new V(S.FAILED_PRECONDITION,Jc);return!1}}return!(!this.networkEnabled||!this.inForeground)||ra(e).U().next(n=>this.xi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&k("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return D(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Ts(e,st.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>ra(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return xa.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Gl(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Pa.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){k("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(c){return c===17?R0:c===16?D0:c===15?rd:c===14?f_:c===13?d_:c===12?P0:c===11?h_:void U()}(this.hi),a;return this.Ri.runTransaction(e,i,s,u=>(a=new Ts(u,this.Qr?this.Qr.next():st.oe),t==="readwrite-primary"?this.wi(a).next(c=>!!c||this.Si(a)).next(c=>{if(!c)throw we(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new V(S.FAILED_PRECONDITION,a_);return n(a)}).next(c=>this.Di(a).next(()=>c)):this.Ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ki(e){return fs(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new V(S.FAILED_PRECONDITION,Jc)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return fs(e).put("owner",t)}static D(){return An.D()}bi(e){let t=fs(e);return t.get("owner").next(n=>this.vi(n)?(k("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):C.resolve())}Mi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(we(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;wc()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return k("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return we("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){we("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function fs(r){return De(r,"owner")}function ra(r){return De(r,"clientMetadata")}function dd(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}var ch=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=J(),i=J();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};var lh=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Oa=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return wc()?8:u_(Wi())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.Yi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new lh;return this.Xi(e,t,a).next(u=>{if(s.result=u,this.zi)return this.es(e,t,a,u.size)})}).next(()=>s.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(Br()<=St.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",jr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),C.resolve()):(Br()<=St.DEBUG&&k("QueryEngine","Query:",jr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(Br()<=St.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",jr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qe(t))):C.resolve())}Yi(e,t){if(gg(t))return C.resolve(null);let n=Qe(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Ia(t,null,"F"),n=Qe(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let a=J(...s);return this.Ji.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{let d=this.ts(t,u);return this.ns(t,d,a,c.readTime)?this.Yi(e,Ia(t,null,"F")):this.rs(e,d,t,c)}))})))}Zi(e,t,n,i){return gg(t)||i.isEqual(B.min())?C.resolve(null):this.Ji.getDocuments(e,n).next(s=>{let a=this.ts(t,s);return this.ns(t,a,n,i)?C.resolve(null):(Br()<=St.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),jr(t)),this.rs(e,a,t,s_(i,-1)).next(u=>u))})}ts(e,t){let n=new ae(S_(e));return t.forEach((i,s)=>{Ws(e,s)&&(n=n.add(s))}),n}ns(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,n){return Br()<=St.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",jr(t)),this.Ji.getDocumentsMatchingQuery(e,t,mt.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var hh=class{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new he(W),this._s=new Mt(s=>ir(s),zs),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Na(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function ay(r,e,t,n){return new hh(r,e,t,n)}function uy(r,e){return D(this,null,function*(){let t=O(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],c=J();for(let d of i){a.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function cE(r,e){let t=O(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,c,d,f){let p=d.batch,_=p.keys(),A=C.resolve();return _.forEach(x=>{A=A.next(()=>f.getEntry(c,x)).next(N=>{let R=d.docVersions.get(x);q(R!==null),N.version.compareTo(R)<0&&(p.applyToRemoteDocument(N,d),N.isValidDocument()&&(N.setReadTime(d.commitVersion),f.addEntry(N)))})}),A.next(()=>u.mutationQueue.removeMutationBatch(c,p))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=J();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(c=c.add(u.batch.mutations[d].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function cy(r){let e=O(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function lE(r,e){let t=O(r),n=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let u=[];e.targetChanges.forEach((f,p)=>{let _=i.get(p);if(!_)return;u.push(t.Ur.removeMatchingKeys(s,f.removedDocuments,p).next(()=>t.Ur.addMatchingKeys(s,f.addedDocuments,p)));let A=_.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?A=A.withResumeToken(Te.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,n)),i=i.insert(p,A),function(N,R,j){return N.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(_,A,f)&&u.push(t.Ur.updateTargetData(s,A))});let c=nt(),d=J();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(ly(s,a,e.documentUpdates).next(f=>{c=f.Ps,d=f.Is})),!n.isEqual(B.min())){let f=t.Ur.getLastRemoteSnapshotVersion(s).next(p=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return C.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,d)).next(()=>c)}).then(s=>(t.os=i,s))}function ly(r,e,t){let n=J(),i=J();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=nt();return t.forEach((u,c)=>{let d=s.get(u);c.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(B.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):k("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",c.version)}),{Ps:a,Is:i}})}function hE(r,e){let t=O(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function si(r,e){let t=O(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ur.getTargetData(n,e).next(s=>s?(i=s,C.resolve(i)):t.Ur.allocateTargetId(n).next(a=>(i=new ri(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.os.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function oi(r,e,t){return D(this,null,function*(){let n=O(r),i=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Nn(a))throw a;k("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.os=n.os.remove(e),n._s.delete(i.target)})}function La(r,e,t){let n=O(r),i=B.min(),s=J();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,f){let p=O(c),_=p._s.get(f);return _!==void 0?C.resolve(p.os.get(_)):p.Ur.getTargetData(d,f)}(n,a,Qe(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.ss.getDocumentsMatchingQuery(a,e,t?i:B.min(),t?s:J())).next(u=>(fy(n,C_(e),u),{documents:u,Ts:s})))}function hy(r,e){let t=O(r),n=O(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(a=>a?a.target:null))}function dy(r,e){let t=O(r),n=t.us.get(e)||B.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,s_(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(fy(t,e,i),i))}function fy(r,e,t){let n=r.us.get(e)||B.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(e,n)}function dE(r,e,t,n){return D(this,null,function*(){let i=O(r),s=J(),a=nt();for(let d of t){let f=e.Es(d.metadata.name);d.document&&(s=s.add(f));let p=e.ds(d);p.setReadTime(e.As(d.metadata.readTime)),a=a.insert(f,p)}let u=i.cs.newChangeBuffer({trackRemovals:!0}),c=yield si(i,function(f){return Qe(mi(te.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>ly(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(d,c.targetId).next(()=>i.Ur.addMatchingKeys(d,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.Ps,f.Is)).next(()=>f.Ps)))})}function fE(n,i){return D(this,arguments,function*(r,e,t=J()){let s=yield si(r,Qe(ld(e.bundledQuery))),a=O(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let c=Ie(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return a.Gr.saveNamedQuery(u,e);let d=s.withResumeToken(Te.EMPTY_BYTE_STRING,c);return a.os=a.os.insert(d.targetId,d),a.Ur.updateTargetData(u,d).next(()=>a.Ur.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.Ur.addMatchingKeys(u,t,s.targetId)).next(()=>a.Gr.saveNamedQuery(u,e))})})}function Gg(r,e){return`firestore_clients_${r}_${e}`}function zg(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function Xc(r,e){return`firestore_targets_${r}_${e}`}var Ua=class r{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Rs(e,t,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new V(i.error.code,i.error.message))),a?new r(e,t,i.state,s):(we("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},vs=class r{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){let n=JSON.parse(t),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new V(n.error.code,n.error.message))),s?new r(e,n.state,i):(we("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},qa=class r{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let n=JSON.parse(t),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=ad();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=c_(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(e,s):(we("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},dh=class r{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new r(t.clientId,t.onlineState):(we("SharedClientState",`Failed to parse online state: ${e}`),null)}},Ms=class{constructor(){this.activeTargetIds=ad()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},ws=class{constructor(e,t,n,i,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new he(W),this.started=!1,this.bs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=Gg(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Ms),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return D(this,null,function*(){let e=yield this.syncEngine.Qi();for(let n of e){if(n===this.ps)continue;let i=this.getItem(Gg(this.persistenceKey,n));if(i){let s=qa.Rs(n,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let n=this.Ls(t);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(Xc(this.persistenceKey,e));if(n){let i=vs.Rs(e,n);i&&(t=i.state)}}return this.Ks.fs(e),this.Ns(),t}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Xc(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return k("SharedClientState","READ",e,t),t}setItem(e,t){k("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){k("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(k("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void we("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>D(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let n=this.Gs(t.key);return this.zs(n,null)}{let n=this.js(t.key,t.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let n=this.Ys(t.key,t.newValue);if(n)return this.Zs(n)}}else if(t.key===this.xs){if(t.newValue!==null){let n=this.Ls(t.newValue);if(n)return this.Bs(n)}}else if(t.key===this.vs){let n=function(s){let a=st.oe;if(s!=null)try{let u=JSON.parse(s);q(typeof u=="number"),a=u}catch(u){we("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(t.newValue);n!==st.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Os){let n=this.Xs(t.newValue);yield Promise.all(n.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){let i=new Ua(this.currentUser,e,t,n),s=zg(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=zg(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){let i=Xc(this.persistenceKey,e),s=new vs(e,t,n);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let n=this.Gs(e);return qa.Rs(n,t)}Hs(e,t){let n=this.Fs.exec(e),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Ua.Rs(new Ce(s),i,t)}Ys(e,t){let n=this.Ms.exec(e),i=Number(n[1]);return vs.Rs(i,t)}Ls(e){return dh.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return D(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);k("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let n=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.io(a,u).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=ad();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Ba=class{constructor(){this.so=new Ms,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Ms,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var fh=class{_o(e){}shutdown(){}};var ja=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){k("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){k("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ia=null;function Yc(){return ia===null?ia=function(){return 268435456+Math.round(2147483648*Math.random())}():ia++,"0x"+ia.toString(16)}var mE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var mh=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Be="WebChannelConnection",ph=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,n,i,s,a){let u=Yc(),c=this.xo(t,n.toUriEncodedString());k("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);let d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,s,a),this.No(t,c,d,i).then(f=>(k("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw ft("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}Lo(t,n,i,s,a,u){return this.Mo(t,n,i,s,a)}Oo(t,n,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+fi}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}xo(t,n){let i=mE[t];return`${this.Do}/v1/${n}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){let s=Yc();return new Promise((a,u)=>{let c=new $c;c.setWithCredentials(!0),c.listenOnce(zc.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case cs.NO_ERROR:let f=c.getResponseJson();k(Be,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case cs.TIMEOUT:k(Be,`RPC '${e}' ${s} timed out`),u(new V(S.DEADLINE_EXCEEDED,"Request time out"));break;case cs.HTTP_ERROR:let p=c.getStatus();if(k(Be,`RPC '${e}' ${s} failed with status:`,p,"response text:",c.getResponseText()),p>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);let A=_?.error;if(A&&A.status&&A.message){let x=function(R){let j=R.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(j)>=0?j:S.UNKNOWN}(A.status);u(new V(x,A.message))}else u(new V(S.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new V(S.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{k(Be,`RPC '${e}' ${s} completed.`)}});let d=JSON.stringify(i);k(Be,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",d,n,15)})}Bo(e,t,n){let i=Yc(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Qc(),u=Wc(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.xmlHttpFactory=new Gc({})),this.Oo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let f=s.join("");k(Be,`Creating RPC '${e}' stream ${i}: ${f}`,c);let p=a.createWebChannel(f,c),_=!1,A=!1,x=new mh({Io:R=>{A?k(Be,`Not sending because RPC '${e}' stream ${i} is closed:`,R):(_||(k(Be,`Opening RPC '${e}' stream ${i} transport.`),p.open(),_=!0),k(Be,`RPC '${e}' stream ${i} sending:`,R),p.send(R))},To:()=>p.close()}),N=(R,j,$)=>{R.listen(j,M=>{try{$(M)}catch(K){setTimeout(()=>{throw K},0)}})};return N(p,Mr.EventType.OPEN,()=>{A||(k(Be,`RPC '${e}' stream ${i} transport opened.`),x.yo())}),N(p,Mr.EventType.CLOSE,()=>{A||(A=!0,k(Be,`RPC '${e}' stream ${i} transport closed`),x.So())}),N(p,Mr.EventType.ERROR,R=>{A||(A=!0,ft(Be,`RPC '${e}' stream ${i} transport errored:`,R),x.So(new V(S.UNAVAILABLE,"The operation could not be completed")))}),N(p,Mr.EventType.MESSAGE,R=>{var j;if(!A){let $=R.data[0];q(!!$);let M=$,K=M.error||((j=M[0])===null||j===void 0?void 0:j.error);if(K){k(Be,`RPC '${e}' stream ${i} received error:`,K);let Q=K.status,H=function(v){let E=Ae[v];if(E!==void 0)return q_(E)}(Q),w=K.message;H===void 0&&(H=S.INTERNAL,w="Unknown error status: "+Q+" with message "+K.message),A=!0,x.So(new V(H,w)),p.close()}else k(Be,`RPC '${e}' stream ${i} received:`,$),x.bo($)}}),N(u,Kc.STAT_EVENT,R=>{R.stat===ea.PROXY?k(Be,`RPC '${e}' stream ${i} detected buffering proxy`):R.stat===ea.NOPROXY&&k(Be,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.wo()},0),x}};function my(){return typeof window<"u"?window:null}function ca(){return typeof document<"u"?document:null}function Qs(r){return new Rl(r,!0)}var Os=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&k("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var $a=class{constructor(e,t,n,i,s,a,u,c){this.ui=e,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Os(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return D(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return D(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return D(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(we(t.toString()),we("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===t&&this.P_(n,i)},n=>{e(()=>{let i=new V(S.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,t){let n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>D(this,null,function*(){this.state=0,this.start()}))}I_(e){return k("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(k("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},gh=class extends $a{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=Y0(this.serializer,e),n=function(s){if(!("targetChange"in s))return B.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?Ie(a.readTime):B.min()}(e);return this.listener.d_(t,n)}A_(e){let t={};t.database=kl(this.serializer),t.addTarget=function(s,a){let u,c=a.target;if(u=wa(c)?{documents:Q_(s,c)}:{query:H_(s,c)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=j_(s,a.resumeToken);let d=Vl(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(B.min())>0){u.readTime=ni(s,a.snapshotVersion.toTimestamp());let d=Vl(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,e);let n=eE(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){let t={};t.database=kl(this.serializer),t.removeTarget=e,this.a_(t)}},_h=class extends $a{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return q(!!e.streamToken),this.lastStreamToken=e.streamToken,q(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=Z0(e.writeResults,e.commitTime),n=Ie(e.commitTime);return this.listener.g_(n,t)}p_(){let e={};e.database=kl(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>ks(this.serializer,n))};this.a_(t)}};var yh=class extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(e,xl(t,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new V(S.UNKNOWN,s.toString())})}Lo(e,t,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(e,xl(t,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(S.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},vh=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(we(t),this.D_=!1):k("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var wh=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(a=>{n.enqueueAndForget(()=>D(this,null,function*(){Fn(this)&&(k("RemoteStore","Restarting streams for network reachability change."),yield function(c){return D(this,null,function*(){let d=O(c);d.L_.add(4),yield pi(d),d.q_.set("Unknown"),d.L_.delete(4),yield Hs(d)})}(this))}))}),this.q_=new vh(n,i)}};function Hs(r){return D(this,null,function*(){if(Fn(r))for(let e of r.B_)yield e(!0)})}function pi(r){return D(this,null,function*(){for(let e of r.B_)yield e(!1)})}function cu(r,e){let t=O(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),pd(t)?md(t):_i(t).r_()&&fd(t,e))}function ai(r,e){let t=O(r),n=_i(t);t.N_.delete(e),n.r_()&&py(t,e),t.N_.size===0&&(n.r_()?n.o_():Fn(t)&&t.q_.set("Unknown"))}function fd(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(B.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}_i(r).A_(e)}function py(r,e){r.Q_.xe(e),_i(r).R_(e)}function md(r){r.Q_=new Dl({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),_i(r).start(),r.q_.v_()}function pd(r){return Fn(r)&&!_i(r).n_()&&r.N_.size>0}function Fn(r){return O(r).L_.size===0}function gy(r){r.Q_=void 0}function pE(r){return D(this,null,function*(){r.q_.set("Online")})}function gE(r){return D(this,null,function*(){r.N_.forEach((e,t)=>{fd(r,e)})})}function _E(r,e){return D(this,null,function*(){gy(r),pd(r)?(r.q_.M_(e),md(r)):r.q_.set("Unknown")})}function yE(r,e,t){return D(this,null,function*(){if(r.q_.set("Online"),e instanceof Aa&&e.state===2&&e.cause)try{yield function(i,s){return D(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.N_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.N_.delete(u),i.Q_.removeTarget(u))})}(r,e)}catch(n){k("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Ga(r,n)}else if(e instanceof Hr?r.Q_.Ke(e):e instanceof Ta?r.Q_.He(e):r.Q_.We(e),!t.isEqual(B.min()))try{let n=yield cy(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){let u=s.Q_.rt(a);return u.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let f=s.N_.get(d);f&&s.N_.set(d,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,d)=>{let f=s.N_.get(c);if(!f)return;s.N_.set(c,f.withResumeToken(Te.EMPTY_BYTE_STRING,f.snapshotVersion)),py(s,c);let p=new ri(f.target,c,d,f.sequenceNumber);fd(s,p)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){k("RemoteStore","Failed to raise snapshot:",n),yield Ga(r,n)}})}function Ga(r,e,t){return D(this,null,function*(){if(!Nn(e))throw e;r.L_.add(1),yield pi(r),r.q_.set("Offline"),t||(t=()=>cy(r.localStore)),r.asyncQueue.enqueueRetryable(()=>D(this,null,function*(){k("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Hs(r)}))})}function _y(r,e){return e().catch(t=>Ga(r,t,e))}function gi(r){return D(this,null,function*(){let e=O(r),t=xn(e),n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;vE(e);)try{let i=yield hE(e.localStore,n);if(i===null){e.O_.length===0&&t.o_();break}n=i.batchId,wE(e,i)}catch(i){yield Ga(e,i)}yy(e)&&vy(e)})}function vE(r){return Fn(r)&&r.O_.length<10}function wE(r,e){r.O_.push(e);let t=xn(r);t.r_()&&t.V_&&t.m_(e.mutations)}function yy(r){return Fn(r)&&!xn(r).n_()&&r.O_.length>0}function vy(r){xn(r).start()}function EE(r){return D(this,null,function*(){xn(r).p_()})}function IE(r){return D(this,null,function*(){let e=xn(r);for(let t of r.O_)e.m_(t.mutations)})}function TE(r,e,t){return D(this,null,function*(){let n=r.O_.shift(),i=Cl.from(n,e,t);yield _y(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield gi(r)})}function AE(r,e){return D(this,null,function*(){e&&xn(r).V_&&(yield function(n,i){return D(this,null,function*(){if(function(a){return U_(a)&&a!==S.ABORTED}(i.code)){let s=n.O_.shift();xn(n).s_(),yield _y(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield gi(n)}})}(r,e)),yy(r)&&vy(r)})}function Kg(r,e){return D(this,null,function*(){let t=O(r);t.asyncQueue.verifyOperationInProgress(),k("RemoteStore","RemoteStore received new credentials");let n=Fn(t);t.L_.add(3),yield pi(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Hs(t)})}function Eh(r,e){return D(this,null,function*(){let t=O(r);e?(t.L_.delete(2),yield Hs(t)):e||(t.L_.add(2),yield pi(t),t.q_.set("Unknown"))})}function _i(r){return r.K_||(r.K_=function(t,n,i){let s=O(t);return s.w_(),new gh(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:pE.bind(null,r),Ro:gE.bind(null,r),mo:_E.bind(null,r),d_:yE.bind(null,r)}),r.B_.push(e=>D(this,null,function*(){e?(r.K_.s_(),pd(r)?md(r):r.q_.set("Unknown")):(yield r.K_.stop(),gy(r))}))),r.K_}function xn(r){return r.U_||(r.U_=function(t,n,i){let s=O(t);return s.w_(),new _h(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:EE.bind(null,r),mo:AE.bind(null,r),f_:IE.bind(null,r),g_:TE.bind(null,r)}),r.B_.push(e=>D(this,null,function*(){e?(r.U_.s_(),yield gi(r)):(yield r.U_.stop(),r.O_.length>0&&(k("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))}))),r.U_}var Ih=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Se,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let a=Date.now()+n,u=new r(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function yi(r,e){if(we("AsyncQueue",`${e}: ${r}`),Nn(r))return new V(S.UNAVAILABLE,`${e}: ${r}`);throw r}var za=class r{constructor(e){this.comparator=e?(t,n)=>e(t,n)||L.comparator(t.key,n.key):(t,n)=>L.comparator(t.key,n.key),this.keyedMap=ms(),this.sortedSet=new he(this.comparator)}static emptySet(e){return new r(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var Ka=class{constructor(){this.W_=new he(L.comparator)}track(e){let t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):U():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}},ui=class r{constructor(e,t,n,i,s,a,u,c,d){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,t,n,i,s){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new r(e,t,za.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ks(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};var Th=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Ah=class{constructor(){this.queries=Wg(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){let i=O(t),s=i.queries;i.queries=Wg(),s.forEach((a,u)=>{for(let c of u.j_)c.onError(n)})})(this,new V(S.ABORTED,"Firestore shutting down"))}};function Wg(){return new Mt(r=>b_(r),Ks)}function gd(r,e){return D(this,null,function*(){let t=O(r),n=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(n=2):(s=new Th,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=yi(a,`Initialization of query '${jr(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&yd(t)})}function _d(r,e){return D(this,null,function*(){let t=O(r),n=e.query,i=3,s=t.queries.get(n);if(s){let a=s.j_.indexOf(e);a>=0&&(s.j_.splice(a,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function bE(r,e){let t=O(r),n=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let u of a.j_)u.X_(i)&&(n=!0);a.z_=i}}n&&yd(t)}function CE(r,e,t){let n=O(r),i=n.queries.get(e);if(i)for(let s of i.j_)s.onError(t);n.queries.delete(e)}function yd(r){r.Y_.forEach(e=>{e.next()})}var bh,Qg;(Qg=bh||(bh={})).ea="default",Qg.Cache="cache";var Ls=class{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new ui(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=ui.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==bh.Cache}};var Ch=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var Wa=class{constructor(e){this.serializer=e}Es(e){return xt(this.serializer,e)}ds(e){return e.metadata.exists?W_(this.serializer,e.document,!1):Pe.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ie(e)}},Sh=class{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=wy(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let n=te.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,n=new Wa(this.serializer);for(let i of e)if(i.metadata.queries){let s=n.Es(i.metadata.name);for(let a of i.metadata.queries){let u=(t.get(a)||J()).add(s);t.set(a,u)}}return t}complete(){return D(this,null,function*(){let e=yield dE(this.localStore,new Wa(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let n of this.queries)yield fE(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function wy(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var Qa=class{constructor(e){this.key=e}},Ha=class{constructor(e){this.key=e}},Ja=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=J(),this.mutatedKeys=J(),this.Aa=S_(e),this.Ra=new za(this.Aa)}get Va(){return this.Ta}ma(e,t){let n=t?t.fa:new Ka,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,p)=>{let _=i.get(f),A=Ws(this.query,p)?p:null,x=!!_&&this.mutatedKeys.has(_.key),N=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations),R=!1;_&&A?_.data.isEqual(A.data)?x!==N&&(n.track({type:3,doc:A}),R=!0):this.ga(_,A)||(n.track({type:2,doc:A}),R=!0,(c&&this.Aa(A,c)>0||d&&this.Aa(A,d)<0)&&(u=!0)):!_&&A?(n.track({type:0,doc:A}),R=!0):_&&!A&&(n.track({type:1,doc:_}),R=!0,(c||d)&&(u=!0)),R&&(A?(a=a.add(A),s=N?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ra:a,fa:n,ns:u,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let a=e.fa.G_();a.sort((f,p)=>function(A,x){let N=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return N(A)-N(x)}(f.type,p.type)||this.Aa(f.doc,p.doc)),this.pa(n),i=i!=null&&i;let u=t&&!i?this.ya():[],c=this.da.size===0&&this.current&&!i?1:0,d=c!==this.Ea;return this.Ea=c,a.length!==0||d?{snapshot:new ui(this.query,e.Ra,s,a,e.mutatedKeys,c===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Ka,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=J(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Ha(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Qa(n))}),t}ba(e){this.Ta=e.Ts,this.da=J();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ui.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Ph=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Dh=class{constructor(e){this.key=e,this.va=!1}},Rh=class{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Mt(u=>b_(u),Ks),this.Ma=new Map,this.xa=new Set,this.Oa=new he(L.comparator),this.Na=new Map,this.La=new Fs,this.Ba={},this.ka=new Map,this.qa=ii.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function SE(r,e,t=!0){return D(this,null,function*(){let n=lu(r),i,s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Ey(n,e,t,!0),i})}function PE(r,e){return D(this,null,function*(){let t=lu(r);yield Ey(t,e,!0,!1)})}function Ey(r,e,t,n){return D(this,null,function*(){let i=yield si(r.localStore,Qe(e)),s=i.targetId,a=t?r.sharedClientState.addLocalQueryTarget(s):"not-current",u;return n&&(u=yield vd(r,e,s,a==="current",i.resumeToken)),r.isPrimaryClient&&t&&cu(r.remoteStore,i),u})}function vd(r,e,t,n,i){return D(this,null,function*(){r.Ka=(p,_,A)=>function(N,R,j,$){return D(this,null,function*(){let M=R.view.ma(j);M.ns&&(M=yield La(N.localStore,R.query,!1).then(({documents:w})=>R.view.ma(w,M)));let K=$&&$.targetChanges.get(R.targetId),Q=$&&$.targetMismatches.get(R.targetId)!=null,H=R.view.applyChanges(M,N.isPrimaryClient,K,Q);return Vh(N,R.targetId,H.wa),H.snapshot})}(r,p,_,A);let s=yield La(r.localStore,e,!0),a=new Ja(e,s.Ts),u=a.ma(s.documents),c=Vs.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,c);Vh(r,t,d.wa);let f=new Ph(e,t,a);return r.Fa.set(e,f),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),d.snapshot})}function DE(r,e,t){return D(this,null,function*(){let n=O(r),i=n.Fa.get(e),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(a=>!Ks(a,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield oi(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&ai(n.remoteStore,i.targetId),ci(n,i.targetId)}).catch(kn))):(ci(n,i.targetId),yield oi(n.localStore,i.targetId,!0))})}function RE(r,e){return D(this,null,function*(){let t=O(r),n=t.Fa.get(e),i=t.Ma.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),ai(t.remoteStore,n.targetId))})}function VE(r,e,t){return D(this,null,function*(){let n=Td(r);try{let i=yield function(a,u){let c=O(a),d=_e.now(),f=u.reduce((A,x)=>A.add(x.key),J()),p,_;return c.persistence.runTransaction("Locally write mutations","readwrite",A=>{let x=nt(),N=J();return c.cs.getEntries(A,f).next(R=>{x=R,x.forEach((j,$)=>{$.isValidDocument()||(N=N.add(j))})}).next(()=>c.localDocuments.getOverlayedDocuments(A,x)).next(R=>{p=R;let j=[];for(let $ of u){let M=z0($,p.get($.key).overlayedDocument);M!=null&&j.push(new It($.key,M,y_(M.value.mapValue),ve.exists(!0)))}return c.mutationQueue.addMutationBatch(A,d,j,u)}).next(R=>{_=R;let j=R.applyToLocalDocumentSet(p,N);return c.documentOverlayCache.saveOverlays(A,R.batchId,j)})}).then(()=>({batchId:_.batchId,changes:D_(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let d=a.Ba[a.currentUser.toKey()];d||(d=new he(W)),d=d.insert(u,c),a.Ba[a.currentUser.toKey()]=d}(n,i.batchId,t),yield tn(n,i.changes),yield gi(n.remoteStore)}catch(i){let s=yi(i,"Failed to persist write");t.reject(s)}})}function Iy(r,e){return D(this,null,function*(){let t=O(r);try{let n=yield lE(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Na.get(s);a&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?q(a.va):i.removedDocuments.size>0&&(q(a.va),a.va=!1))}),yield tn(t,n,e)}catch(n){yield kn(n)}})}function Hg(r,e,t){let n=O(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.Fa.forEach((s,a)=>{let u=a.view.Z_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){let c=O(a);c.onlineState=u;let d=!1;c.queries.forEach((f,p)=>{for(let _ of p.j_)_.Z_(u)&&(d=!0)}),d&&yd(c)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function xE(r,e,t){return D(this,null,function*(){let n=O(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n.Na.get(e),s=i&&i.key;if(s){let a=new he(L.comparator);a=a.insert(s,Pe.newNoDocument(s,B.min()));let u=J().add(s),c=new Rs(B.min(),new Map,new he(W),a,u);yield Iy(n,c),n.Oa=n.Oa.remove(s),n.Na.delete(e),Id(n)}else yield oi(n.localStore,e,!1).then(()=>ci(n,e,t)).catch(kn)})}function kE(r,e){return D(this,null,function*(){let t=O(r),n=e.batch.batchId;try{let i=yield cE(t.localStore,e);Ed(t,n,null),wd(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield tn(t,i)}catch(i){yield kn(i)}})}function NE(r,e,t){return D(this,null,function*(){let n=O(r);try{let i=yield function(a,u){let c=O(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return c.mutationQueue.lookupMutationBatch(d,u).next(p=>(q(p!==null),f=p.keys(),c.mutationQueue.removeMutationBatch(d,p))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>c.localDocuments.getDocuments(d,f))})}(n.localStore,e);Ed(n,e,t),wd(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield tn(n,i)}catch(i){yield kn(i)}})}function FE(r,e){return D(this,null,function*(){let t=O(r);Fn(t.remoteStore)||k("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=O(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(n===-1)return void e.resolve();let i=t.ka.get(n)||[];i.push(e),t.ka.set(n,i)}catch(n){let i=yi(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function wd(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function Ed(r,e,t){let n=O(r),i=n.Ba[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function ci(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Ty(r,n)})}function Ty(r,e){r.xa.delete(e.path.canonicalString());let t=r.Oa.get(e);t!==null&&(ai(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),Id(r))}function Vh(r,e,t){for(let n of t)n instanceof Qa?(r.La.addReference(n.key,e),ME(r,n)):n instanceof Ha?(k("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Ty(r,n.key)):U()}function ME(r,e){let t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(k("SyncEngine","New document in limbo: "+t),r.xa.add(n),Id(r))}function Id(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){let e=r.xa.values().next().value;r.xa.delete(e);let t=new L(te.fromString(e)),n=r.qa.next();r.Na.set(n,new Dh(t)),r.Oa=r.Oa.insert(t,n),cu(r.remoteStore,new ri(Qe(mi(t.path)),n,"TargetPurposeLimboResolution",st.oe))}}function tn(r,e,t){return D(this,null,function*(){let n=O(r),i=[],s=[],a=[];n.Fa.isEmpty()||(n.Fa.forEach((u,c)=>{a.push(n.Ka(c,e,t).then(d=>{var f;if((d||t)&&n.isPrimaryClient){let p=d?!d.fromCache:(f=t?.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(d){i.push(d);let p=ch.Wi(c.targetId,d);s.push(p)}}))}),yield Promise.all(a),n.Ca.d_(i),yield function(c,d){return D(this,null,function*(){let f=O(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>C.forEach(d,_=>C.forEach(_.$i,A=>f.persistence.referenceDelegate.addReference(p,_.targetId,A)).next(()=>C.forEach(_.Ui,A=>f.persistence.referenceDelegate.removeReference(p,_.targetId,A)))))}catch(p){if(!Nn(p))throw p;k("LocalStore","Failed to update sequence numbers: "+p)}for(let p of d){let _=p.targetId;if(!p.fromCache){let A=f.os.get(_),x=A.snapshotVersion,N=A.withLastLimboFreeSnapshotVersion(x);f.os=f.os.insert(_,N)}}})}(n.localStore,s))})}function OE(r,e){return D(this,null,function*(){let t=O(r);if(!t.currentUser.isEqual(e)){k("SyncEngine","User change. New user:",e.toKey());let n=yield uy(t.localStore,e);t.currentUser=e,function(s,a){s.ka.forEach(u=>{u.forEach(c=>{c.reject(new V(S.CANCELLED,a))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield tn(t,n.hs)}})}function LE(r,e){let t=O(r),n=t.Na.get(e);if(n&&n.va)return J().add(n.key);{let i=J(),s=t.Ma.get(e);if(!s)return i;for(let a of s){let u=t.Fa.get(a);i=i.unionWith(u.view.Va)}return i}}function UE(r,e){return D(this,null,function*(){let t=O(r),n=yield La(t.localStore,e.query,!0),i=e.view.ba(n);return t.isPrimaryClient&&Vh(t,e.targetId,i.wa),i})}function qE(r,e){return D(this,null,function*(){let t=O(r);return dy(t.localStore,e).then(n=>tn(t,n))})}function BE(r,e,t,n){return D(this,null,function*(){let i=O(r),s=yield function(u,c){let d=O(u),f=O(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",p=>f.Mn(p,c).next(_=>_?d.localDocuments.getDocuments(p,_):C.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield gi(i.remoteStore):t==="acknowledged"||t==="rejected"?(Ed(i,e,n||null),wd(i,e),function(u,c){O(O(u).mutationQueue).On(c)}(i.localStore,e)):U(),yield tn(i,s)):k("SyncEngine","Cannot apply mutation batch with id: "+e)})}function jE(r,e){return D(this,null,function*(){let t=O(r);if(lu(t),Td(t),e===!0&&t.Qa!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Jg(t,n.toArray());t.Qa=!0,yield Eh(t.remoteStore,!0);for(let s of i)cu(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let n=[],i=Promise.resolve();t.Ma.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(ci(t,a),oi(t.localStore,a,!0))),ai(t.remoteStore,a)}),yield i,yield Jg(t,n),function(a){let u=O(a);u.Na.forEach((c,d)=>{ai(u.remoteStore,d)}),u.La.pr(),u.Na=new Map,u.Oa=new he(L.comparator)}(t),t.Qa=!1,yield Eh(t.remoteStore,!1)}})}function Jg(r,e,t){return D(this,null,function*(){let n=O(r),i=[],s=[];for(let a of e){let u,c=n.Ma.get(a);if(c&&c.length!==0){u=yield si(n.localStore,Qe(c[0]));for(let d of c){let f=n.Fa.get(d),p=yield UE(n,f);p.snapshot&&s.push(p.snapshot)}}else{let d=yield hy(n.localStore,a);u=yield si(n.localStore,d),yield vd(n,Ay(d),a,!1,u.resumeToken)}i.push(u)}return n.Ca.d_(s),i})}function Ay(r){return A_(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function $E(r){return function(t){return O(O(t).persistence).Qi()}(O(r).localStore)}function GE(r,e,t,n){return D(this,null,function*(){let i=O(r);if(i.Qa)return void k("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let a=yield dy(i.localStore,C_(s[0])),u=Rs.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Te.EMPTY_BYTE_STRING);yield tn(i,a,u);break}case"rejected":yield oi(i.localStore,e,!0),ci(i,e,n);break;default:U()}})}function zE(r,e,t){return D(this,null,function*(){let n=lu(r);if(n.Qa){for(let i of e){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){k("SyncEngine","Adding an already active target "+i);continue}let s=yield hy(n.localStore,i),a=yield si(n.localStore,s);yield vd(n,Ay(s),a.targetId,!1,a.resumeToken),cu(n.remoteStore,a)}for(let i of t)n.Ma.has(i)&&(yield oi(n.localStore,i,!1).then(()=>{ai(n.remoteStore,i),ci(n,i)}).catch(kn))}})}function lu(r){let e=O(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Iy.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=LE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xE.bind(null,e),e.Ca.d_=bE.bind(null,e.eventManager),e.Ca.$a=CE.bind(null,e.eventManager),e}function Td(r){let e=O(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=kE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=NE.bind(null,e),e}function KE(r,e,t){let n=O(r);(function(s,a,u){return D(this,null,function*(){try{let c=yield a.getMetadata();if(yield function(A,x){let N=O(A),R=Ie(x.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",j=>N.Gr.getBundleMetadata(j,x.id)).then(j=>!!j&&j.createTime.compareTo(R)>=0)}(s.localStore,c))return yield a.close(),u._completeWith(function(A){return{taskState:"Success",documentsLoaded:A.totalDocuments,bytesLoaded:A.totalBytes,totalDocuments:A.totalDocuments,totalBytes:A.totalBytes}}(c)),Promise.resolve(new Set);u._updateProgress(wy(c));let d=new Sh(c,s.localStore,a.serializer),f=yield a.Ua();for(;f;){let _=yield d.la(f);_&&u._updateProgress(_),f=yield a.Ua()}let p=yield d.complete();return yield tn(s,p.Ia,void 0),yield function(A,x){let N=O(A);return N.persistence.runTransaction("Save bundle","readwrite",R=>N.Gr.saveBundleMetadata(R,x))}(s.localStore,c),u._completeWith(p.progress),Promise.resolve(p.Pa)}catch(c){return ft("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var Us=class{constructor(){this.synchronizeTabs=!1}initialize(e){return D(this,null,function*(){this.serializer=Qs(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return ay(this.persistence,new Oa,e.initialUser,this.serializer)}createPersistence(e){return new Fa(Ma.Zr,this.serializer)}createSharedClientState(e){return new Ba}terminate(){return D(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Xa=class r extends Us{constructor(e,t,n){super(),this.Wa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){return D(this,null,function*(){yield lc(r.prototype,this,"initialize").call(this,e),yield this.Wa.initialize(this,e),yield Td(this.Wa.syncEngine),yield gi(this.Wa.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return ay(this.persistence,new Oa,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new Wl(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new ll(t,this.persistence);return new cl(e.asyncQueue,n)}createPersistence(e){let t=dd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?dt.withCacheSize(this.cacheSizeBytes):dt.DEFAULT;return new uh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,my(),ca(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Ba}},xh=class r extends Xa{constructor(e,t){super(e,t,!1),this.Wa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return D(this,null,function*(){yield lc(r.prototype,this,"initialize").call(this,e);let t=this.Wa.syncEngine;this.sharedClientState instanceof ws&&(this.sharedClientState.syncEngine={no:BE.bind(null,t),ro:GE.bind(null,t),io:zE.bind(null,t),Qi:$E.bind(null,t),eo:qE.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>D(this,null,function*(){yield jE(this.Wa.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=my();if(!ws.D(t))throw new V(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=dd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ws(t,e.asyncQueue,n,e.clientId,e.initialUser)}},qs=class{initialize(e,t){return D(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Hg(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=OE.bind(null,this.syncEngine),yield Eh(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Ah}()}createDatastore(e){let t=Qs(e.databaseInfo.databaseId),n=function(s){return new ph(s)}(e.databaseInfo);return function(s,a,u,c){return new yh(s,a,u,c)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,i,s,a,u){return new wh(n,i,s,a,u)}(this.localStore,this.datastore,e.asyncQueue,t=>Hg(this.syncEngine,t,0),function(){return ja.D()?new ja:new fh}())}createSyncEngine(e,t){return function(i,s,a,u,c,d,f){let p=new Rh(i,s,a,u,c,d);return f&&(p.Qa=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return D(this,null,function*(){var e,t;yield function(i){return D(this,null,function*(){let s=O(i);k("RemoteStore","RemoteStore shutting down."),s.L_.add(5),yield pi(s),s.k_.shutdown(),s.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()})}};function Xg(r,e=10240){let t=0;return{read(){return D(this,null,function*(){if(t<r.byteLength){let i={value:r.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return D(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var li=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):we("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var kh=class{constructor(e,t){this.ja=e,this.serializer=t,this.metadata=new Se,this.buffer=new Uint8Array,this.Ha=function(){return new TextDecoder("utf-8")}(),this.Ja().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.ja.cancel()}getMetadata(){return D(this,null,function*(){return this.metadata.promise})}Ua(){return D(this,null,function*(){return yield this.getMetadata(),this.Ja()})}Ja(){return D(this,null,function*(){let e=yield this.Ya();if(e===null)return null;let t=this.Ha.decode(e),n=Number(t);isNaN(n)&&this.Za(`length string (${t}) is not valid number`);let i=yield this.Xa(n);return new Ch(JSON.parse(i),e.length+n)})}eu(){return this.buffer.findIndex(e=>e===123)}Ya(){return D(this,null,function*(){for(;this.eu()<0&&!(yield this.tu()););if(this.buffer.length===0)return null;let e=this.eu();e<0&&this.Za("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Xa(e){return D(this,null,function*(){for(;this.buffer.length<e;)(yield this.tu())&&this.Za("Reached the end of bundle when more is expected.");let t=this.Ha.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}Za(e){throw this.ja.cancel(),new Error(`Invalid bundle format: ${e}`)}tu(){return D(this,null,function*(){let e=yield this.ja.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Nh=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return D(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new V(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return D(this,null,function*(){let a=O(i),u={documents:s.map(p=>xs(a.serializer,p))},c=yield a.Lo("BatchGetDocuments",a.serializer.databaseId,te.emptyPath(),u,s.length),d=new Map;c.forEach(p=>{let _=X0(a.serializer,p);d.set(_.key.toString(),_)});let f=[];return s.forEach(p=>{let _=d.get(p.toString());q(!!_),f.push(_)}),f})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Vn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return D(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let i=L.fromPath(n);this.mutations.push(new Ss(i,this.precondition(i)))}),yield function(n,i){return D(this,null,function*(){let s=O(n),a={writes:i.map(u=>ks(s.serializer,u))};yield s.Mo("Commit",s.serializer.databaseId,te.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U();t=B.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new V(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(B.min())?ve.exists(!1):ve.updateTime(t):ve.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(B.min()))throw new V(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ve.updateTime(t)}return ve.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Fh=class{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.nu=n.maxAttempts,this.t_=new Os(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){this.t_.Go(()=>D(this,null,function*(){let e=new Nh(this.datastore),t=this.su(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.ou(i)}))}).catch(n=>{this.ou(n)})}))}su(e){try{let t=this.updateFunction(e);return!Gs(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ou(e){this.nu>0&&this._u(e)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(e)}_u(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!U_(t)}return!1}};var Mh=class{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ce.UNAUTHENTICATED,this.clientId=da.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,s=>D(this,null,function*(){k("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(n,s=>(k("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Se;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=yi(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function la(r,e){return D(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),k("FirestoreClient","Initializing OfflineComponentProvider");let t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(i=>D(this,null,function*(){n.isEqual(i)||(yield uy(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e})}function Oh(r,e){return D(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let t=yield Ad(r);k("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Kg(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Kg(e.remoteStore,i)),r._onlineComponents=e})}function by(r){return r.name==="FirebaseError"?r.code===S.FAILED_PRECONDITION||r.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}function Ad(r){return D(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){k("FirestoreClient","Using user provided OfflineComponentProvider");try{yield la(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!by(t))throw t;ft("Error using user provided cache. Falling back to memory cache: "+t),yield la(r,new Us)}}else k("FirestoreClient","Using default OfflineComponentProvider"),yield la(r,new Us);return r._offlineComponents})}function hu(r){return D(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(k("FirestoreClient","Using user provided OnlineComponentProvider"),yield Oh(r,r._uninitializedComponentsProvider._online)):(k("FirestoreClient","Using default OnlineComponentProvider"),yield Oh(r,new qs))),r._onlineComponents})}function Cy(r){return Ad(r).then(e=>e.persistence)}function bd(r){return Ad(r).then(e=>e.localStore)}function Sy(r){return hu(r).then(e=>e.remoteStore)}function Cd(r){return hu(r).then(e=>e.syncEngine)}function WE(r){return hu(r).then(e=>e.datastore)}function hi(r){return D(this,null,function*(){let e=yield hu(r),t=e.eventManager;return t.onListen=SE.bind(null,e.syncEngine),t.onUnlisten=DE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=PE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=RE.bind(null,e.syncEngine),t})}function QE(r){return r.asyncQueue.enqueue(()=>D(this,null,function*(){let e=yield Cy(r),t=yield Sy(r);return e.setNetworkEnabled(!0),function(i){let s=O(i);return s.L_.delete(0),Hs(s)}(t)}))}function HE(r){return r.asyncQueue.enqueue(()=>D(this,null,function*(){let e=yield Cy(r),t=yield Sy(r);return e.setNetworkEnabled(!1),function(i){return D(this,null,function*(){let s=O(i);s.L_.add(0),yield pi(s),s.q_.set("Offline")})}(t)}))}function JE(r,e){let t=new Se;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s,a){return D(this,null,function*(){try{let u=yield function(d,f){let p=O(d);return p.persistence.runTransaction("read document","readonly",_=>p.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new V(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=yi(u,`Failed to get document '${s} from cache`);a.reject(c)}})}(yield bd(r),e,t)})),t.promise}function Py(r,e,t={}){let n=new Se;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,a,u,c,d){let f=new li({next:_=>{a.enqueueAndForget(()=>_d(s,p));let A=_.docs.has(u);!A&&_.fromCache?d.reject(new V(S.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&_.fromCache&&c&&c.source==="server"?d.reject(new V(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),p=new Ls(mi(u.path),f,{includeMetadataChanges:!0,_a:!0});return gd(s,p)}(yield hi(r),r.asyncQueue,e,t,n)})),n.promise}function XE(r,e){let t=new Se;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s,a){return D(this,null,function*(){try{let u=yield La(i,s,!0),c=new Ja(s,u.Ts),d=c.ma(u.documents),f=c.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let c=yi(u,`Failed to execute query '${s} against cache`);a.reject(c)}})}(yield bd(r),e,t)})),t.promise}function Dy(r,e,t={}){let n=new Se;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,a,u,c,d){let f=new li({next:_=>{a.enqueueAndForget(()=>_d(s,p)),_.fromCache&&c.source==="server"?d.reject(new V(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),p=new Ls(u,f,{includeMetadataChanges:!0,_a:!0});return gd(s,p)}(yield hi(r),r.asyncQueue,e,t,n)})),n.promise}function YE(r,e){let t=new li(e);return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s){O(i).Y_.add(s),s.next()}(yield hi(r),t)})),()=>{t.za(),r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s){O(i).Y_.delete(s)}(yield hi(r),t)}))}}function ZE(r,e,t,n){let i=function(a,u){let c;return c=typeof a=="string"?B_().encode(a):a,function(f,p){return new kh(f,p)}(function(f,p){if(f instanceof Uint8Array)return Xg(f,p);if(f instanceof ArrayBuffer)return Xg(new Uint8Array(f),p);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),u)}(t,Qs(e));r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){KE(yield Cd(r),i,n)}))}function eI(r,e){return r.asyncQueue.enqueue(()=>D(this,null,function*(){return function(n,i){let s=O(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Gr.getNamedQuery(a,i))}(yield bd(r),e)}))}function Ry(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}var Yg=new Map;function Sd(r,e,t){if(!t)throw new V(S.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Pd(r,e,t,n){if(e===!0&&n===!0)throw new V(S.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Zg(r){if(!L.isDocumentKey(r))throw new V(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function e_(r){if(L.isDocumentKey(r))throw new V(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function du(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":U()}function ne(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new V(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=du(r);throw new V(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function Vy(r,e){if(e<=0)throw new V(S.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}var Ya=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new V(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new V(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Pd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ry((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},ur=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ya({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new V(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new V(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ya(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Zc;switch(n.type){case"firstParty":return new rl(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new V(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=Yg.get(t);n&&(k("ComponentProvider","Removing Datastore"),Yg.delete(t),n.terminate())}(this),Promise.resolve()}};function fu(r,e,t,n={}){var i;let s=(r=ne(r,ur))._getSettings(),a=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&ft("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if(typeof n.mockUserToken=="string")u=n.mockUserToken,c=Ce.MOCK_USER;else{u=Zm(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new V(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Ce(d)}r._authCredentials=new el(new ha(u,c))}}var Ne=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},ue=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new kt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}},kt=class r extends Ne{constructor(e,t,n){super(e,t,mi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ue(this.firestore,null,new L(e))}withConverter(e){return new r(this.firestore,e,this._path)}};function mu(r,e,...t){if(r=ge(r),Sd("collection","path",e),r instanceof ur){let n=te.fromString(e,...t);return e_(n),new kt(r,null,n)}{if(!(r instanceof ue||r instanceof kt))throw new V(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(te.fromString(e,...t));return e_(n),new kt(r.firestore,null,n)}}function Dd(r,e){if(r=ne(r,ur),Sd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new V(S.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ne(r,null,function(n){return new Et(te.emptyPath(),n)}(e))}function vi(r,e,...t){if(r=ge(r),arguments.length===1&&(e=da.newId()),Sd("doc","path",e),r instanceof ur){let n=te.fromString(e,...t);return Zg(n),new ue(r,null,new L(n))}{if(!(r instanceof ue||r instanceof kt))throw new V(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(te.fromString(e,...t));return Zg(n),new ue(r.firestore,r instanceof kt?r.converter:null,new L(n))}}function pu(r,e){return r=ge(r),e=ge(e),(r instanceof ue||r instanceof kt)&&(e instanceof ue||e instanceof kt)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function gu(r,e){return r=ge(r),e=ge(e),r instanceof Ne&&e instanceof Ne&&r.firestore===e.firestore&&Ks(r._query,e._query)&&r.converter===e.converter}var Lh=class{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new Os(this,"async_queue_retry"),this.Eu=()=>{let t=ca();t&&k("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};let e=ca();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;let t=ca();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});let t=new Se;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){return D(this,null,function*(){if(this.uu.length!==0){try{yield this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!Nn(e))throw e;k("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}})}Au(e){let t=this.au.then(()=>(this.Pu=!0,e().catch(n=>{this.hu=n,this.Pu=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw we("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.Pu=!1,n))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);let i=Ih.createAndSchedule(this,e,t,n,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&U()}verifyOperationInProgress(){}mu(){return D(this,null,function*(){let e;do e=this.au,yield e;while(e!==this.au)})}fu(e){for(let t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.lu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){let t=this.lu.indexOf(e);this.lu.splice(t,1)}};function Uh(r){return function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var qh=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Se,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var xy=-1,me=class extends ur{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=function(){return new Lh}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Ny(this),this._firestoreClient.terminate()}};function ky(r,e){let t=typeof r=="object"?r:Hi(),n=typeof r=="string"?r:e||"(default)",i=Ic(t,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=Ym("firestore");s&&fu(i,...s)}return i}function Re(r){return r._firestoreClient||Ny(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Ny(r){var e,t,n;let i=r._freezeSettings(),s=function(u,c,d,f){return new hl(u,c,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Ry(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._firestoreClient=new Mh(r._authCredentials,r._appCheckCredentials,r._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Rd(r,e){My(r=ne(r,me));let t=Re(r);if(t._uninitializedComponentsProvider)throw new V(S.FAILED_PRECONDITION,"SDK cache is already specified.");ft("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=r._freezeSettings(),i=new qs;return Fy(t,i,new Xa(i,n.cacheSizeBytes,e?.forceOwnership))}function Vd(r){My(r=ne(r,me));let e=Re(r);if(e._uninitializedComponentsProvider)throw new V(S.FAILED_PRECONDITION,"SDK cache is already specified.");ft("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings(),n=new qs;return Fy(e,n,new xh(n,t.cacheSizeBytes))}function Fy(r,e,t){let n=new Se;return r.asyncQueue.enqueue(()=>D(this,null,function*(){try{yield la(r,t),yield Oh(r,e),n.resolve()}catch(i){let s=i;if(!by(s))throw s;ft("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function xd(r){if(r._initialized&&!r._terminated)throw new V(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Se;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{yield function(n){return D(this,null,function*(){if(!An.D())return Promise.resolve();let i=n+"main";yield An.delete(i)})}(dd(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function kd(r){return function(t){let n=new Se;return t.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return FE(yield Cd(t),n)})),n.promise}(Re(r=ne(r,me)))}function Nd(r){return QE(Re(r=ne(r,me)))}function Fd(r){return HE(Re(r=ne(r,me)))}function Md(r,e){let t=Re(r=ne(r,me)),n=new qh;return ZE(t,r._databaseId,e,n),n}function Od(r,e){return eI(Re(r=ne(r,me)),e).then(t=>t?new Ne(r,null,t.query):null)}function My(r){if(r._initialized||r._terminated)throw new V(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Ot=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(Te.fromBase64String(e))}catch(t){throw new V(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(Te.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Tt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ee(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Zt=class{constructor(e){this._methodName=e}};var cr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}};var Bs=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}};var tI=/^__.*__$/,Bh=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new It(e,this.data,this.fieldMask,t,this.fieldTransforms):new Rn(e,this.data,t,this.fieldTransforms)}},Za=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new It(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Oy(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}var eu=class r{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new r(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.vu(e),i}Cu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return tu(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(Oy(this.wu)&&tI.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}},jh=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Qs(e)}Nu(e,t,n,i=!1){return new eu({wu:e,methodName:t,Ou:n,path:Ee.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function fr(r){let e=r._freezeSettings(),t=Qs(r._databaseId);return new jh(r._databaseId,!!e.ignoreUndefinedProperties,t)}function _u(r,e,t,n,i,s={}){let a=r.Nu(s.merge||s.mergeFields?2:0,e,t,i);qd("Data must be an object, but it was:",a,n);let u=qy(n,a),c,d;if(s.merge)c=new ot(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let p of s.mergeFields){let _=Wh(e,p,t);if(!a.contains(_))throw new V(S.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);jy(f,_)||f.push(_)}c=new ot(f),d=a.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,d=a.fieldTransforms;return new Bh(new je(u),c,d)}var js=class r extends Zt{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}};function Ly(r,e,t){return new eu({wu:3,Ou:e.settings.Ou,methodName:r._methodName,Du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var $h=class r extends Zt{_toFieldTransform(e){return new sr(e.path,new Pn)}isEqual(e){return e instanceof r}},Gh=class r extends Zt{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=Ly(this,e,!0),n=this.Lu.map(s=>mr(s,t)),i=new Xt(n);return new sr(e.path,i)}isEqual(e){return e instanceof r&&Ec(this.Lu,e.Lu)}},zh=class r extends Zt{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=Ly(this,e,!0),n=this.Lu.map(s=>mr(s,t)),i=new Yt(n);return new sr(e.path,i)}isEqual(e){return e instanceof r&&Ec(this.Lu,e.Lu)}},Kh=class r extends Zt{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){let t=new Dn(e.serializer,x_(e.serializer,this.Bu));return new sr(e.path,t)}isEqual(e){return e instanceof r&&this.Bu===e.Bu}};function Ld(r,e,t,n){let i=r.Nu(1,e,t);qd("Data must be an object, but it was:",i,n);let s=[],a=je.empty();dr(n,(c,d)=>{let f=Bd(e,c,t);d=ge(d);let p=i.Cu(f);if(d instanceof js)s.push(f);else{let _=mr(d,p);_!=null&&(s.push(f),a.set(f,_))}});let u=new ot(s);return new Za(a,u,i.fieldTransforms)}function Ud(r,e,t,n,i,s){let a=r.Nu(1,e,t),u=[Wh(e,n,t)],c=[i];if(s.length%2!=0)throw new V(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Wh(e,s[_])),c.push(s[_+1]);let d=[],f=je.empty();for(let _=u.length-1;_>=0;--_)if(!jy(d,u[_])){let A=u[_],x=c[_];x=ge(x);let N=a.Cu(A);if(x instanceof js)d.push(A);else{let R=mr(x,N);R!=null&&(d.push(A),f.set(A,R))}}let p=new ot(d);return new Za(f,p,a.fieldTransforms)}function Uy(r,e,t,n=!1){return mr(t,r.Nu(n?4:3,e))}function mr(r,e){if(By(r=ge(r)))return qd("Unsupported field value:",e,r),qy(r,e);if(r instanceof Zt)return function(n,i){if(!Oy(i.wu))throw i.Mu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let c=mr(u,i.Fu(a));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=ge(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return x_(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=_e.fromDate(n);return{timestampValue:ni(i.serializer,s)}}if(n instanceof _e){let s=new _e(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:ni(i.serializer,s)}}if(n instanceof cr)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Ot)return{bytesValue:j_(i.serializer,n._byteString)};if(n instanceof ue){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Mu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:cd(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Bs)return function(a,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(c=>{if(typeof c!="number")throw u.Mu("VectorValues must only contain numeric values.");return ud(u.serializer,c)})}}}}}}(n,i);throw i.Mu(`Unsupported field value: ${du(n)}`)}(r,e)}function qy(r,e){let t={};return m_(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):dr(r,(n,i)=>{let s=mr(i,e.bu(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function By(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof _e||r instanceof cr||r instanceof Ot||r instanceof ue||r instanceof Zt||r instanceof Bs)}function qd(r,e,t){if(!By(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let n=du(t);throw n==="an object"?e.Mu(r+" a custom object"):e.Mu(r+" "+n)}}function Wh(r,e,t){if((e=ge(e))instanceof Tt)return e._internalPath;if(typeof e=="string")return Bd(r,e);throw tu("Field path arguments must be of type string or ",r,!1,void 0,t)}var nI=new RegExp("[~\\*/\\[\\]]");function Bd(r,e,t){if(e.search(nI)>=0)throw tu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Tt(...e.split("."))._internalPath}catch{throw tu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function tu(r,e,t,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new V(S.INVALID_ARGUMENT,u+r+c)}function jy(r,e){return r.some(t=>t.isEqual(e))}var lr=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Qh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(yu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Qh=class extends lr{data(){return super.data()}};function yu(r,e){return typeof e=="string"?Bd(r,e):e instanceof Tt?e._internalPath:e._delegate._internalPath}function $y(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new V(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var $s=class{},hr=class extends $s{};function Lt(r,e,...t){let n=[];e instanceof $s&&n.push(e),n=n.concat(t),function(s){let a=s.filter(c=>c instanceof Hh).length,u=s.filter(c=>c instanceof nu).length;if(a>1||a>0&&u>0)throw new V(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var nu=class r extends hr{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=this._parse(e);return zy(e._query,t),new Ne(e.firestore,e.converter,Al(e._query,t))}_parse(e){let t=fr(e.firestore);return function(s,a,u,c,d,f,p){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new V(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){n_(p,f);let A=[];for(let x of p)A.push(t_(c,s,x));_={arrayValue:{values:A}}}else _=t_(c,s,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||n_(p,f),_=Uy(u,a,p,f==="in"||f==="not-in");return Z.create(d,f,_)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function jd(r,e,t){let n=e,i=yu("where",r);return nu._create(i,n,t)}var Hh=class r extends $s{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new r(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:ie.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let c of u)zy(a,c),a=Al(a,c)}(e._query,t),new Ne(e.firestore,e.converter,Al(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Jh=class r extends hr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new r(e,t)}_apply(e){let t=function(i,s,a){if(i.startAt!==null)throw new V(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new V(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new rr(s,a)}(e._query,this._field,this._direction);return new Ne(e.firestore,e.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new Et(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function $d(r,e="asc"){let t=e,n=yu("orderBy",r);return Jh._create(n,t)}var ru=class r extends hr{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){return new Ne(e.firestore,e.converter,Ia(e._query,this._limit,this._limitType))}};function Gd(r){return Vy("limit",r),ru._create("limit",r,"F")}function zd(r){return Vy("limitToLast",r),ru._create("limitToLast",r,"L")}var iu=class r extends hr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=Gy(e,this.type,this._docOrFields,this._inclusive);return new Ne(e.firestore,e.converter,function(i,s){return new Et(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function Kd(...r){return iu._create("startAt",r,!0)}function Wd(...r){return iu._create("startAfter",r,!1)}var su=class r extends hr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=Gy(e,this.type,this._docOrFields,this._inclusive);return new Ne(e.firestore,e.converter,function(i,s){return new Et(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function Qd(...r){return su._create("endBefore",r,!1)}function Hd(...r){return su._create("endAt",r,!0)}function Gy(r,e,t,n){if(t[0]=ge(t[0]),t[0]instanceof lr)return function(s,a,u,c,d){if(!c)throw new V(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let p of Qr(s))if(p.field.isKeyField())f.push(nr(a,c.key));else{let _=c.data.field(p.field);if(au(_))throw new V(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let A=p.field.canonicalString();throw new V(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}f.push(_)}return new Ft(f,d)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{let i=fr(r.firestore);return function(a,u,c,d,f,p){let _=a.explicitOrderBy;if(f.length>_.length)throw new V(S.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let A=[];for(let x=0;x<f.length;x++){let N=f[x];if(_[x].field.isKeyField()){if(typeof N!="string")throw new V(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof N}`);if(!od(a)&&N.indexOf("/")!==-1)throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${N}' contains a slash.`);let R=a.path.child(te.fromString(N));if(!L.isDocumentKey(R))throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);let j=new L(R);A.push(nr(u,j))}else{let R=Uy(c,d,N);A.push(R)}}return new Ft(A,p)}(r._query,r.firestore._databaseId,i,e,t,n)}}function t_(r,e,t){if(typeof(t=ge(t))=="string"){if(t==="")throw new V(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!od(e)&&t.indexOf("/")!==-1)throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(te.fromString(t));if(!L.isDocumentKey(n))throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return nr(r,new L(n))}if(t instanceof ue)return nr(r,t._key);throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${du(t)}.`)}function n_(r,e){if(!Array.isArray(r)||r.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function zy(r,e){let t=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new V(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new V(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var di=class{convertValue(e,t="none"){switch(tr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(bn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw U()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return dr(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;let s=(i=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>fe(a.doubleValue));return new Bs(s)}convertGeoPoint(e){return new cr(fe(e.latitude),fe(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=id(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(As(e));default:return null}}convertTimestamp(e){let t=Jt(e);return new _e(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=te.fromString(e);q(Z_(n));let i=new Cn(n.get(1),n.get(3)),s=new L(n.popFirst(5));return i.isEqual(t)||we(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function vu(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}var Xh=class extends di{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ot(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ue(this.firestore,null,t)}};var Ht=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},pt=class extends lr{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new In(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(yu("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},In=class extends pt{data(e={}){return super.data(e)}},At=class{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ht(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new In(this._firestore,this._userDataWriter,n.key,n,new Ht(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let c=new In(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ht(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let c=new In(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ht(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:rI(u.type),doc:c,oldIndex:d,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function rI(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function wu(r,e){return r instanceof pt&&e instanceof pt?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(r._document===null?e._document===null:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof At&&e instanceof At&&r._firestore===e._firestore&&gu(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}function Jd(r){r=ne(r,ue);let e=ne(r.firestore,me);return Py(Re(e),r._key).then(t=>of(e,r,t))}var en=class extends di{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ot(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ue(this.firestore,null,t)}};function Xd(r){r=ne(r,ue);let e=ne(r.firestore,me),t=Re(e),n=new en(e);return JE(t,r._key).then(i=>new pt(e,n,r._key,i,new Ht(i!==null&&i.hasLocalMutations,!0),r.converter))}function Yd(r){r=ne(r,ue);let e=ne(r.firestore,me);return Py(Re(e),r._key,{source:"server"}).then(t=>of(e,r,t))}function Zd(r){r=ne(r,Ne);let e=ne(r.firestore,me),t=Re(e),n=new en(e);return $y(r._query),Dy(t,r._query).then(i=>new At(e,n,r,i))}function ef(r){r=ne(r,Ne);let e=ne(r.firestore,me),t=Re(e),n=new en(e);return XE(t,r._query).then(i=>new At(e,n,r,i))}function tf(r){r=ne(r,Ne);let e=ne(r.firestore,me),t=Re(e),n=new en(e);return Dy(t,r._query,{source:"server"}).then(i=>new At(e,n,r,i))}function Eu(r,e,t){r=ne(r,ue);let n=ne(r.firestore,me),i=vu(r.converter,e,t);return wi(n,[_u(fr(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,ve.none())])}function Iu(r,e,t,...n){r=ne(r,ue);let i=ne(r.firestore,me),s=fr(i),a;return a=typeof(e=ge(e))=="string"||e instanceof Tt?Ud(s,"updateDoc",r._key,e,t,n):Ld(s,"updateDoc",r._key,e),wi(i,[a.toMutation(r._key,ve.exists(!0))])}function nf(r){return wi(ne(r.firestore,me),[new Vn(r._key,ve.none())])}function rf(r,e){let t=ne(r.firestore,me),n=vi(r),i=vu(r.converter,e);return wi(t,[_u(fr(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,ve.exists(!1))]).then(()=>n)}function Tu(r,...e){var t,n,i;r=ge(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Uh(e[a])||(s=e[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Uh(e[a])){let p=e[a];e[a]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[a+1]=(n=p.error)===null||n===void 0?void 0:n.bind(p),e[a+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let c,d,f;if(r instanceof ue)d=ne(r.firestore,me),f=mi(r._key.path),c={next:p=>{e[a]&&e[a](of(d,r,p))},error:e[a+1],complete:e[a+2]};else{let p=ne(r,Ne);d=ne(p.firestore,me),f=p._query;let _=new en(d);c={next:A=>{e[a]&&e[a](new At(d,_,p,A))},error:e[a+1],complete:e[a+2]},$y(r._query)}return function(_,A,x,N){let R=new li(N),j=new Ls(A,R,x);return _.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return gd(yield hi(_),j)})),()=>{R.za(),_.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return _d(yield hi(_),j)}))}}(Re(d),f,u,c)}function sf(r,e){return YE(Re(r=ne(r,me)),Uh(e)?e:{next:e})}function wi(r,e){return function(n,i){let s=new Se;return n.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return VE(yield Cd(n),i,s)})),s.promise}(Re(r),e)}function of(r,e,t){let n=t.docs.get(e._key),i=new en(r);return new pt(r,i,e._key,n,new Ht(t.hasPendingWrites,t.fromCache),e.converter)}var iI={maxAttempts:5};var ou=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=fr(e)}set(e,t,n){this._verifyNotCommitted();let i=wn(e,this._firestore),s=vu(i.converter,t,n),a=_u(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,ve.none())),this}update(e,t,n,...i){this._verifyNotCommitted();let s=wn(e,this._firestore),a;return a=typeof(t=ge(t))=="string"||t instanceof Tt?Ud(this._dataReader,"WriteBatch.update",s._key,t,n,i):Ld(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,ve.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=wn(e,this._firestore);return this._mutations=this._mutations.concat(new Vn(t._key,ve.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function wn(r,e){if((r=ge(r)).firestore!==e)throw new V(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var Yh=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=fr(t)}get(t){let n=wn(t,this._firestore),i=new Xh(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return U();let a=s[0];if(a.isFoundDocument())return new lr(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new lr(this._firestore,i,n._key,null,n.converter);throw U()})}set(t,n,i){let s=wn(t,this._firestore),a=vu(s.converter,n,i),u=_u(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){let a=wn(t,this._firestore),u;return u=typeof(n=ge(n))=="string"||n instanceof Tt?Ud(this._dataReader,"Transaction.update",a._key,n,i,s):Ld(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(t){let n=wn(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=wn(e,this._firestore),n=new en(this._firestore);return super.get(e).then(i=>new pt(this._firestore,n,t._key,i._document,new Ht(!1,!1),t.converter))}};function af(r,e,t){r=ne(r,me);let n=Object.assign(Object.assign({},iI),t);return function(s){if(s.maxAttempts<1)throw new V(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let c=new Se;return s.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){let d=yield WE(s);new Fh(s.asyncQueue,d,u,a,c).ru()})),c.promise}(Re(r),i=>e(new Yh(r,i)),n)}function uf(){return new js("deleteField")}function cf(){return new $h("serverTimestamp")}function lf(...r){return new Gh("arrayUnion",r)}function hf(...r){return new zh("arrayRemove",r)}function df(r){return new Kh("increment",r)}(function(e,t=!0){(function(i){fi=i})(np),Qi(new Gn("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new me(new tl(n.getProvider("auth-internal")),new sl(n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new V(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cn(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),qe(tg,"4.7.1",e),qe(tg,"4.7.1","esm2017")})();var sI="@firebase/firestore-compat",oI="0.3.36";function yf(r,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new V("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function Ky(){if(typeof Uint8Array>"u")throw new V("unimplemented","Uint8Arrays are not available in this environment.")}function Wy(){if(!p_())throw new V("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Au=class r{constructor(e){this._delegate=e}static fromBase64String(e){return Wy(),new r(Ot.fromBase64String(e))}static fromUint8Array(e){return Ky(),new r(Ot.fromUint8Array(e))}toBase64(){return Wy(),this._delegate.toBase64()}toUint8Array(){return Ky(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function ff(r){return aI(r,["next","error","complete"])}function aI(r,e){if(typeof r!="object"||r===null)return!1;let t=r;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var mf=class{enableIndexedDbPersistence(e,t){return Rd(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Vd(e._delegate)}clearIndexedDbPersistence(e){return xd(e._delegate)}},bu=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Cn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&ft("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){fu(this._delegate,e,t,n)}enableNetwork(){return Nd(this._delegate)}disableNetwork(){return Fd(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Pd("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return kd(this._delegate)}onSnapshotsInSync(e){return sf(this._delegate,e)}get app(){if(!this._appCompat)throw new V("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ti(this,mu(this._delegate,e))}catch(t){throw He(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ut(this,vi(this._delegate,e))}catch(t){throw He(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new yr(this,Dd(this._delegate,e))}catch(t){throw He(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return af(this._delegate,t=>e(new Cu(this,t)))}batch(){return Re(this._delegate),new Su(new ou(this._delegate,e=>wi(this._delegate,e)))}loadBundle(e){return Md(this._delegate,e)}namedQuery(e){return Od(this._delegate,e).then(t=>t?new yr(this,t):null)}},Ei=class extends di{constructor(e){super(),this.firestore=e}convertBytes(e){return new Au(new Ot(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Ut.forKey(t,this.firestore,null)}};function uI(r){Zh(r)}var Cu=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ei(e)}get(e){let t=pr(e);return this._delegate.get(t).then(n=>new gr(this._firestore,new pt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let i=pr(e);return n?(yf("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=pr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=pr(e);return this._delegate.delete(t),this}},Su=class{constructor(e){this._delegate=e}set(e,t,n){let i=pr(e);return n?(yf("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=pr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=pr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Ii=class r{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new In(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new _r(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=r.INSTANCES,i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new r(e,new Ei(e),t),i.set(t,s)),s}};Ii.INSTANCES=new WeakMap;var Ut=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ei(e)}static forPath(e,t,n){if(e.length%2!==0)throw new V("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new r(t,new ue(t._delegate,n,new L(e)))}static forKey(e,t,n){return new r(t,new ue(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Ti(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ti(this.firestore,mu(this._delegate,e))}catch(t){throw He(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ge(e),e instanceof ue?pu(this._delegate,e):!1}set(e,t){t=yf("DocumentReference.set",t);try{return t?Eu(this._delegate,e,t):Eu(this._delegate,e)}catch(n){throw He(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?Iu(this._delegate,e):Iu(this._delegate,e,t,...n)}catch(i){throw He(i,"updateDoc()","DocumentReference.update()")}}delete(){return nf(this._delegate)}onSnapshot(...e){let t=Qy(e),n=Hy(e,i=>new gr(this.firestore,new pt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Tu(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=Xd(this._delegate):e?.source==="server"?t=Yd(this._delegate):t=Jd(this._delegate),t.then(n=>new gr(this.firestore,new pt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(Ii.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function He(r,e,t){return r.message=r.message.replace(e,t),r}function Qy(r){for(let e of r)if(typeof e=="object"&&!ff(e))return e;return{}}function Hy(r,e){var t,n;let i;return ff(r[0])?i=r[0]:ff(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var gr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ut(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return wu(this._delegate,e._delegate)}},_r=class extends gr{data(e){let t=this._delegate.data(e);return this._delegate._converter||r_(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},yr=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ei(e)}where(e,t,n){try{return new r(this.firestore,Lt(this._delegate,jd(e,t,n)))}catch(i){throw He(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new r(this.firestore,Lt(this._delegate,$d(e,t)))}catch(n){throw He(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new r(this.firestore,Lt(this._delegate,Gd(e)))}catch(t){throw He(t,"limit()","Query.limit()")}}limitToLast(e){try{return new r(this.firestore,Lt(this._delegate,zd(e)))}catch(t){throw He(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new r(this.firestore,Lt(this._delegate,Kd(...e)))}catch(t){throw He(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new r(this.firestore,Lt(this._delegate,Wd(...e)))}catch(t){throw He(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new r(this.firestore,Lt(this._delegate,Qd(...e)))}catch(t){throw He(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new r(this.firestore,Lt(this._delegate,Hd(...e)))}catch(t){throw He(t,"endAt()","Query.endAt()")}}isEqual(e){return gu(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=ef(this._delegate):e?.source==="server"?t=tf(this._delegate):t=Zd(this._delegate),t.then(n=>new Js(this.firestore,new At(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=Qy(e),n=Hy(e,i=>new Js(this.firestore,new At(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Tu(this._delegate,t,n)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(Ii.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},pf=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new _r(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Js=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new yr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new _r(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new pf(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new _r(this._firestore,n))})}isEqual(e){return wu(this._delegate,e._delegate)}},Ti=class r extends yr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Ut(this.firestore,e):null}doc(e){try{return e===void 0?new Ut(this.firestore,vi(this._delegate)):new Ut(this.firestore,vi(this._delegate,e))}catch(t){throw He(t,"doc()","CollectionReference.doc()")}}add(e){return rf(this._delegate,e).then(t=>new Ut(this.firestore,t))}isEqual(e){return pu(this._delegate,e._delegate)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(Ii.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function pr(r){return ne(r,ue)}var gf=class r{constructor(...e){this._delegate=new Tt(...e)}static documentId(){return new r(Ee.keyField().canonicalString())}isEqual(e){return e=ge(e),e instanceof Tt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var _f=class r{constructor(e){this._delegate=e}static serverTimestamp(){let e=cf();return e._methodName="FieldValue.serverTimestamp",new r(e)}static delete(){let e=uf();return e._methodName="FieldValue.delete",new r(e)}static arrayUnion(...e){let t=lf(...e);return t._methodName="FieldValue.arrayUnion",new r(t)}static arrayRemove(...e){let t=hf(...e);return t._methodName="FieldValue.arrayRemove",new r(t)}static increment(e){let t=df(e);return t._methodName="FieldValue.increment",new r(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var cI={Firestore:bu,GeoPoint:cr,Timestamp:_e,Blob:Au,Transaction:Cu,WriteBatch:Su,DocumentReference:Ut,DocumentSnapshot:gr,Query:yr,QueryDocumentSnapshot:_r,QuerySnapshot:Js,CollectionReference:Ti,FieldPath:gf,FieldValue:_f,setLogLevel:uI,CACHE_SIZE_UNLIMITED:xy};function lI(r,e){r.INTERNAL.registerComponent(new Gn("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},cI)))}function hI(r){lI(r,(e,t)=>new bu(e,t,new mf)),r.registerVersion(sI,oI)}hI(ze);function dI(r,e=wo){return new an(t=>{let n;return e!=null?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function Jy(r,e){return dI(r,e)}function fI(r,e){return Jy(r,e).pipe(To(void 0),Eo(),ke(t=>{let[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Ef(r,e){return Jy(r,e).pipe(ke(t=>({payload:t,type:"query"})))}var Pu=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:i,query:s}=tv(n,t);return new Ru(i,s,this.afs)}snapshotChanges(){return fI(this.ref,this.afs.schedulers.outsideAngular).pipe(Ke)}valueChanges(e={}){return this.snapshotChanges().pipe(ke(({payload:t})=>e.idField?it(Ue({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return bt(this.ref.get(e)).pipe(Ke)}};function Du(r,e){return Ef(r,e).pipe(To(void 0),Eo(),ke(t=>{let[n,i]=t,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{let d=s.find(p=>p.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(p=>p.ref.isEqual(u.ref));d&&JSON.stringify(d.doc.metadata)===JSON.stringify(u.metadata)||!d&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),a}))}function Xy(r,e,t){return Du(r,t).pipe(Io((n,i)=>mI(n,i.map(s=>s.payload),e),[]),xm(),ke(n=>n.map(i=>({type:i.type,payload:i}))))}function mI(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=pI(r,n))}),r}function vf(r,e,t,...n){let i=r.slice();return i.splice(e,t,...n),i}function pI(r,e){switch(e.type){case"added":if(!(r[e.newIndex]&&r[e.newIndex].doc.ref.isEqual(e.doc.ref)))return vf(r,e.newIndex,0,e);break;case"modified":if(r[e.oldIndex]==null||r[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return vf(r,e.newIndex,1,e);break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return vf(r,e.oldIndex,1);break}return r}function Yy(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var Ru=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=Du(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(ke(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(To(void 0),Eo(),$i(([n,i])=>i.length>0||!n),ke(([,n])=>n),Ke)}auditTrail(e){return this.stateChanges(e).pipe(Io((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=Yy(e);return Xy(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ke)}valueChanges(e={}){return Ef(this.query,this.afs.schedulers.outsideAngular).pipe(ke(t=>t.payload.docs.map(n=>e.idField?it(Ue({},n.data()),{[e.idField]:n.id}):n.data())),Ke)}get(e){return bt(this.query.get(e)).pipe(Ke)}add(e){return this.ref.add(e)}doc(e){return new Pu(this.ref.doc(e),this.afs)}},wf=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Du(this.query,this.afs.schedulers.outsideAngular).pipe(Ke):Du(this.query,this.afs.schedulers.outsideAngular).pipe(ke(t=>t.filter(n=>e.indexOf(n.type)>-1)),$i(t=>t.length>0),Ke)}auditTrail(e){return this.stateChanges(e).pipe(Io((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=Yy(e);return Xy(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ke)}valueChanges(e={}){return Ef(this.query,this.afs.schedulers.outsideAngular).pipe(ke(n=>n.payload.docs.map(i=>e.idField?Ue({[e.idField]:i.id},i.data()):i.data())),Ke)}get(e){return bt(this.query.get(e)).pipe(Ke)}},Zy=new se("angularfire2.enableFirestorePersistence"),ev=new se("angularfire2.firestore.persistenceSettings"),gI=new se("angularfire2.firestore.settings"),_I=new se("angularfire2.firestore.use-emulator");function tv(r,e=t=>t){return{query:e(r),ref:r}}var If=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,s,a,u,c,d,f,p,_,A,x,N,R,j,$){this.schedulers=c;let M=os(t,u,n),K=f;p&&Bc(M,u,_,x,N,R,A,j),[this.firestore,this.persistenceEnabled$]=Xo(`${M.name}.firestore`,"AngularFirestore",M.name,()=>{let Q=u.runOutsideAngular(()=>M.firestore());if(s&&Q.settings(s),K&&Q.useEmulator(...K),i&&!Po(a)){let H=()=>{try{return bt(Q.enablePersistence(d||void 0).then(()=>!0,()=>!1))}catch(w){return typeof console<"u"&&console.warn(w),cn(!1)}};return[Q,u.runOutsideAngular(H)]}else return[Q,cn(!1)]},[s,K,i])}collection(t,n){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:a}=tv(i,n),u=this.schedulers.ngZone.run(()=>s);return new Ru(u,a,this)}collectionGroup(t,n){let i=n||(a=>a),s=this.firestore.collectionGroup(t);return new wf(i(s),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let i=this.schedulers.ngZone.run(()=>n);return new Pu(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(X(mn),X(Fr,8),X(Zy,8),X(gI,8),X(ln),X(Xe),X(Pt),X(ev,8),X(_I,8),X(us,8),X(Fc,8),X(Mc,8),X(Oc,8),X(Lc,8),X(Uc,8),X(qc,8),X(vt,8))};static \u0275prov=Gt({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),nv=(()=>{class r{constructor(){ze.registerVersion("angularfire",tt.full,"fst-compat")}static enablePersistence(t){return{ngModule:r,providers:[{provide:Zy,useValue:!0},{provide:ev,useValue:t}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=ct({type:r});static \u0275inj=at({providers:[If]})}return r})();var Vu=class r{title="sala-de-juegos-miku";static \u0275fac=function(t){return new(t||r)};static \u0275cmp=ut({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(t,n){t&1&&lt(0,"router-outlet")},dependencies:[Jm]})};var xu={production:!1,firebase:{apiKey:"AIzaSyAH2PDjT8fTlZKtxpamixaJHM577sd1ZEM",authDomain:"sala-de-juegos-miku.firebaseapp.com",projectId:"sala-de-juegos-miku",storageBucket:"sala-de-juegos-miku.appspot.com",messagingSenderId:"370998800826",appId:"1:370998800826:web:8a81d58f46e46b8f77ad83"}};var qt=class r{constructor(e,t){this.afAuth=e;this.firestore=t}registrarUsuario(e,t){return this.afAuth.createUserWithEmailAndPassword(e,t)}getUsuarioActual(){return this.afAuth.authState}loguearUsuario(e,t){return this.afAuth.signInWithEmailAndPassword(e,t)}registrarIngreso(e){let t=new Date().toISOString();return this.firestore.collection("logs").add({email:e,fechaIngreso:t})}guardarUsuario(e,t){return this.firestore.collection("usuarios").add({email:e,avatar:t})}verificarUsuario(e){return this.firestore.collection("usuarios",t=>t.where("email","==",e)).get()}obtenerDatosUsuario(e){return this.firestore.collection("usuarios",t=>t.where("email","==",e)).valueChanges()}logout(){return this.afAuth.signOut()}static \u0275fac=function(t){return new(t||r)(X(us),X(If))};static \u0275prov=Gt({token:r,factory:r.\u0275fac,providedIn:"root"})};var vI=r=>({selected:r});function wI(r,e){r&1&&(G(0,"div"),Y(1,"El correo electr\xF3nico es requerido."),z())}function EI(r,e){r&1&&(G(0,"div"),Y(1,"Debe ingresar un correo electr\xF3nico v\xE1lido."),z())}function II(r,e){if(r&1&&(G(0,"div"),Ye(1,wI,2,0,"div",5)(2,EI,2,0,"div",5),z()),r&2){let t=Ze();pe(),de("ngIf",t.email.errors==null?null:t.email.errors.required),pe(),de("ngIf",t.email.errors==null?null:t.email.errors.email)}}function TI(r,e){r&1&&(G(0,"div"),Y(1,"La contrase\xF1a es requerida."),z())}function AI(r,e){r&1&&(G(0,"div"),Y(1,"La contrase\xF1a debe tener al menos 8 caracteres, incluyendo una letra may\xFAscula, una letra min\xFAscula y un n\xFAmero."),z())}function bI(r,e){if(r&1&&(G(0,"div"),Ye(1,TI,2,0,"div",5)(2,AI,2,0,"div",5),z()),r&2){let t=Ze();pe(),de("ngIf",t.password.errors==null?null:t.password.errors.required),pe(),de("ngIf",t.password.errors==null?null:t.password.errors.pattern)}}function CI(r,e){if(r&1){let t=Ar();G(0,"div",12),Ve("click",function(){let i=_t(t).index,s=Ze();return yt(s.selectAvatar(i))}),z()}if(r&2){let t=e.index,n=Ze();de("ngClass",jm(1,vI,n.selectedAvatar===t))}}var ku=class r{constructor(e,t){this.authService=e;this.router=t}fullname=new fn("",[et.required]);email=new fn("",[et.required,et.email]);password=new fn("",[et.required,et.pattern("(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,}")]);avatars=[0,1,2,3,4,5];selectedAvatar=-1;selectAvatar(e){this.selectedAvatar=e}signup(){return D(this,null,function*(){if(this.fullname.valid&&this.email.valid&&this.password.valid&&this.selectedAvatar!==-1)try{let e=this.email.value??"",t=this.password.value??"";yield this.authService.registrarUsuario(e,t),yield this.authService.loguearUsuario(e,t),yield this.authService.registrarIngreso(e),yield this.authService.guardarUsuario(e,this.selectedAvatar+1),this.router.navigate(["/home"])}catch(e){console.error("Error al registrar usuario:",e)}else console.log("Formulario no v\xE1lido o avatar no seleccionado")})}static \u0275fac=function(t){return new(t||r)(le(qt),le(Cr))};static \u0275cmp=ut({type:r,selectors:[["app-registro"]],standalone:!0,features:[Ct],decls:21,vars:5,consts:[[1,"registro-container"],[3,"ngSubmit"],[1,"form-group"],["for","email"],["id","email","placeholder","Correo Electr\xF3nico","type","email",3,"formControl"],[4,"ngIf"],["for","password"],["id","password","placeholder","Contrase\xF1a","type","password",3,"formControl"],[1,"avatar-selection"],[1,"avatar-container"],["class","avatar",3,"ngClass","click",4,"ngFor","ngForOf"],["type","submit"],[1,"avatar",3,"click","ngClass"]],template:function(t,n){t&1&&(G(0,"div",0)(1,"h1"),Y(2,"Registro"),z(),G(3,"form",1),Ve("ngSubmit",function(){return n.signup()}),G(4,"div",2)(5,"label",3),Y(6,"Correo Electr\xF3nico"),z(),lt(7,"input",4),Ye(8,II,3,2,"div",5),z(),G(9,"div",2)(10,"label",6),Y(11,"Contrase\xF1a"),z(),lt(12,"input",7),Ye(13,bI,3,2,"div",5),z(),G(14,"div",8)(15,"h3"),Y(16,"Selecciona tu avatar"),z(),G(17,"div",9),Ye(18,CI,1,3,"div",10),z()(),G(19,"button",11),Y(20,"Registrar"),z()()()),t&2&&(pe(7),de("formControl",n.email),pe(),de("ngIf",n.email.invalid&&(n.email.dirty||n.email.touched)),pe(4),de("formControl",n.password),pe(),de("ngIf",n.password.invalid&&(n.password.dirty||n.password.touched)),pe(5),de("ngForOf",n.avatars))},dependencies:[Ko,zo,Vr,qo,Bo,rs,br,xr,is,Sr,zm,Km,Wm],styles:['.registro-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-image:url("./media/bg-login-WAFZCKQU.jpg");background-size:cover;background-position:center;color:#fff;text-align:center;padding:20px}form[_ngcontent-%COMP%]{background:#00000080;padding:20px;border-radius:10px;width:100%;max-width:400px}h1[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;text-align:left;font-size:1.2rem}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:5px;border:none;border-radius:5px;font-size:1rem}.avatar-selection[_ngcontent-%COMP%]{margin-bottom:20px}.avatar-selection[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:10px}.avatar-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px;margin-bottom:20px}.avatar[_ngcontent-%COMP%]{width:50px;height:50px;cursor:pointer;border-radius:50%;background-size:cover;background-position:center;transition:opacity .3s}.avatar[_ngcontent-%COMP%]:nth-child(1){background-image:url("./media/m1-7JTWOHSV.png")}.avatar[_ngcontent-%COMP%]:nth-child(2){background-image:url("./media/m2-A2XFVD4P.png")}.avatar[_ngcontent-%COMP%]:nth-child(3){background-image:url("./media/m3-KTJXIZCC.png")}.avatar[_ngcontent-%COMP%]:nth-child(4){background-image:url("./media/m4-KV5JVTCC.png")}.avatar[_ngcontent-%COMP%]:nth-child(5){background-image:url("./media/m5-G3AF32Y2.png")}.avatar[_ngcontent-%COMP%]:nth-child(6){background-image:url("./media/m6-RMVKQPLO.png")}.avatar.selected[_ngcontent-%COMP%]{opacity:.5}button[_ngcontent-%COMP%]{width:100%;padding:10px 20px;font-size:1.2rem;background-color:#6200ea;color:#fff;border:none;border-radius:5px;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{background-color:#3700b3}']})};function SI(r,e){r&1&&(G(0,"div"),Y(1,"El correo electr\xF3nico es requerido."),z())}function PI(r,e){r&1&&(G(0,"div"),Y(1,"Debe ingresar un correo electr\xF3nico v\xE1lido."),z())}function DI(r,e){if(r&1&&(G(0,"div"),Ye(1,SI,2,0,"div",5)(2,PI,2,0,"div",5),z()),r&2){let t=Ze();pe(),de("ngIf",t.email.errors==null?null:t.email.errors.required),pe(),de("ngIf",t.email.errors==null?null:t.email.errors.email)}}function RI(r,e){r&1&&(G(0,"div"),Y(1,"La contrase\xF1a es requerida."),z())}function VI(r,e){r&1&&(G(0,"div"),Y(1,"La contrase\xF1a debe tener al menos 8 caracteres, incluyendo una letra may\xFAscula, una letra min\xFAscula y un n\xFAmero."),z())}function xI(r,e){if(r&1&&(G(0,"div"),Ye(1,RI,2,0,"div",5)(2,VI,2,0,"div",5),z()),r&2){let t=Ze();pe(),de("ngIf",t.password.errors==null?null:t.password.errors.required),pe(),de("ngIf",t.password.errors==null?null:t.password.errors.pattern)}}var Nu=class r{constructor(e,t){this.authService=e;this.router=t}fullname=new fn("",[et.required]);email=new fn("",[et.required,et.email]);password=new fn("",[et.required,et.pattern("(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,}")]);signup(){return D(this,null,function*(){if(this.email.valid&&this.password.valid)try{let e=this.email.value??"",t=this.password.value??"";yield this.authService.loguearUsuario(e,t),yield this.authService.registrarIngreso(e),this.router.navigate(["/home"])}catch(e){console.error("Error al registrar usuario:",e)}else console.log("Formulario no v\xE1lido")})}fillDefaultValues(){this.email.setValue("aa@gmail.com"),this.password.setValue("Aa123456")}static \u0275fac=function(t){return new(t||r)(le(qt),le(Cr))};static \u0275cmp=ut({type:r,selectors:[["app-login"]],standalone:!0,features:[Ct],decls:18,vars:4,consts:[[1,"registro-container"],[3,"ngSubmit"],[1,"form-group"],["for","email"],["id","email","placeholder","Correo Electr\xF3nico","type","email",3,"formControl"],[4,"ngIf"],["for","password"],["id","password","placeholder","Contrase\xF1a","type","password",3,"formControl"],["type","submit"],["type","button",3,"click"]],template:function(t,n){t&1&&(G(0,"div",0)(1,"h1"),Y(2,"Ingreso"),z(),G(3,"form",1),Ve("ngSubmit",function(){return n.signup()}),G(4,"div",2)(5,"label",3),Y(6,"Correo Electr\xF3nico"),z(),lt(7,"input",4),Ye(8,DI,3,2,"div",5),z(),G(9,"div",2)(10,"label",6),Y(11,"Contrase\xF1a"),z(),lt(12,"input",7),Ye(13,xI,3,2,"div",5),z(),G(14,"button",8),Y(15,"Registrar"),z(),G(16,"button",9),Ve("click",function(){return n.fillDefaultValues()}),Y(17,"Rellenar Valores"),z()()()),t&2&&(pe(7),de("formControl",n.email),pe(),de("ngIf",n.email.invalid&&(n.email.dirty||n.email.touched)),pe(4),de("formControl",n.password),pe(),de("ngIf",n.password.invalid&&(n.password.dirty||n.password.touched)))},dependencies:[Ko,zo,Vr,qo,Bo,rs,br,xr,is,Sr],styles:['.registro-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-image:url("./media/bg-login-WAFZCKQU.jpg");background-size:cover;color:#fff;text-align:center;padding:20px}form[_ngcontent-%COMP%]{background:#00000080;padding:20px;border-radius:10px;width:300px}h1[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{display:block;margin-bottom:8px}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:15px;border:none;border-radius:5px;font-size:1rem}button[_ngcontent-%COMP%]{padding:10px 20px;font-size:1.2rem;background-color:#6200ea;color:#fff;border:none;border-radius:5px;cursor:pointer}button[_ngcontent-%COMP%]:hover{background-color:#3700b3}']})};var kI=["*"],Fu=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=ut({type:r,selectors:[["app-cartel"]],standalone:!0,features:[Ct],ngContentSelectors:kI,decls:2,vars:0,consts:[[1,"cartel-container"]],template:function(t,n){t&1&&(Lm(),G(0,"div",0),Um(1),z())},styles:[".cartel-container[_ngcontent-%COMP%]{background-color:#00000080;padding:20px;border-radius:10px;color:#fff;box-shadow:0 4px 8px #0003;text-align:center;font-size:1.2rem}"]})};var Mu=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=ut({type:r,selectors:[["app-quien-soy"]],standalone:!0,features:[Ct],decls:16,vars:0,consts:[[1,"sobre-mi-container"],[1,"info-container"],[1,"imagen"],["src","../../assets/foto.jpg"]],template:function(t,n){t&1&&(G(0,"div",0)(1,"h2"),Y(2,"Quien soy?"),z(),G(3,"div",1)(4,"app-cartel")(5,"h3"),Y(6,"Datos Personales"),z(),G(7,"p"),Y(8,"Mi nombre es Franco Ferrari, soy estudiante de TUP, y esta p\xE1gina es mi tributo a VOCALOID."),z()(),G(9,"div",2),lt(10,"img",3),z()(),G(11,"app-cartel")(12,"h3"),Y(13,"Explicaci\xF3n del Juego"),z(),G(14,"p"),Y(15,"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque vehicula, eros at ultrices efficitur, ligula est tincidunt odio, sed scelerisque justo quam eget mauris. Praesent sodales mollis libero nec volutpat. Ut auctor massa ac quam faucibus, at eleifend nisl suscipit. Nam maximus orci sit amet metus volutpat cursus."),z()()())},dependencies:[Fu],styles:['@charset "UTF-8";.sobre-mi-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;padding:20px;height:100vh;background-image:url("./media/bg-quien-XPJPV2SH.jpg");background-size:cover;background-position:center;color:#fff}.info-container[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;margin-bottom:30px}.datos-personales[_ngcontent-%COMP%]{flex:1;padding:10px}.imagen[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:200px;height:auto;border-radius:50%}.explicacion-juego[_ngcontent-%COMP%]{max-width:600px}h2[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:20px}h3[_ngcontent-%COMP%]{margin-top:20px}p[_ngcontent-%COMP%]{font-size:1.2rem}']})};function NI(r,e){if(r&1&&lt(0,"img",10),r&2){let t=Ze(2);de("src",t.userPhotoURL,Om)}}function FI(r,e){if(r&1){let t=Ar();G(0,"div"),Ye(1,NI,1,1,"img",8),G(2,"span",9),Y(3),z(),G(4,"button",7),Ve("click",function(){_t(t);let i=Ze();return yt(i.logout())}),Y(5,"Cerrar Sesi\xF3n"),z()()}if(r&2){let t=Ze();pe(),de("ngIf",t.userPhotoURL),pe(2),Bm(t.userEmail)}}function MI(r,e){if(r&1){let t=Ar();G(0,"button",7),Ve("click",function(){_t(t);let i=Ze();return yt(i.goToLogin())}),Y(1,"Ir a Login"),z(),G(2,"button",7),Ve("click",function(){_t(t);let i=Ze();return yt(i.goToRegistro())}),Y(3,"Registrarse"),z()}}var Ou=class r{constructor(e,t){this.router=e;this.authService=t}isLoggedIn=!1;userEmail=null;userPhotoURL=null;ngOnInit(){this.authService.getUsuarioActual().subscribe(e=>{e?(this.isLoggedIn=!0,this.userEmail=e.email,this.userEmail&&this.authService.obtenerDatosUsuario(this.userEmail).subscribe(t=>{if(t&&t.length>0){let n=t[0].avatar;this.userPhotoURL=`/assets/profiles/m${n}.png`}else this.userPhotoURL=null},t=>{console.error("Error al obtener datos del usuario:",t)})):this.isLoggedIn=!1},e=>{console.error("Error al obtener el estado de autenticaci\xF3n:",e)})}goToRegistro(){this.router.navigate(["/registro"])}goToLogin(){this.router.navigate(["/login"])}goToQuien(){this.router.navigate(["/quien-soy"])}goToJuego1(){this.router.navigate(["/juegos/juego1"])}goToJuego2(){this.router.navigate(["/juegos/juego2"])}goToJuego3(){this.router.navigate(["/juegos/juego3"])}goToJuego4(){this.router.navigate(["/juegos/juego4"])}logout(){this.authService.logout().then(()=>{this.isLoggedIn=!1,this.userEmail=null,this.userPhotoURL=null,this.router.navigate(["/login"])}).catch(e=>{console.error("Error al cerrar sesi\xF3n:",e)})}static \u0275fac=function(t){return new(t||r)(le(Cr),le(qt))};static \u0275cmp=ut({type:r,selectors:[["app-home"]],standalone:!0,features:[Ct],decls:19,vars:2,consts:[["loggedOut",""],[1,"header"],[1,"header-content"],[4,"ngIf","ngIfElse"],[1,"home-container"],[1,"game-buttons"],[3,"click"],[1,"small-button",3,"click"],["alt","Foto de perfil","class","profile-pic",3,"src",4,"ngIf"],[1,"user-email"],["alt","Foto de perfil",1,"profile-pic",3,"src"]],template:function(t,n){if(t&1){let i=Ar();G(0,"div",1)(1,"div",2),Ye(2,FI,6,2,"div",3)(3,MI,4,0,"ng-template",null,0,$m),G(5,"h2"),Y(6,"Sala de Juegos Miku!!"),z()()(),G(7,"div",4)(8,"div",5)(9,"button",6),Ve("click",function(){return _t(i),yt(n.goToJuego1())}),Y(10,"Juego 1"),z(),G(11,"button",6),Ve("click",function(){return _t(i),yt(n.goToJuego2())}),Y(12,"Juego 2"),z(),G(13,"button",6),Ve("click",function(){return _t(i),yt(n.goToJuego3())}),Y(14,"Juego 3"),z(),G(15,"button",6),Ve("click",function(){return _t(i),yt(n.goToJuego4())}),Y(16,"Juego 4"),z()(),G(17,"button",7),Ve("click",function(){return _t(i),yt(n.goToQuien())}),Y(18,"Ir a \xBFQui\xE9n Soy?"),z()()}if(t&2){let i=qm(4);pe(2),de("ngIf",n.isLoggedIn)("ngIfElse",i)}},dependencies:[br],styles:['.home-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-image:url("./media/bg-home-JPORX2NV.jpg");background-size:cover;color:#fff2da;text-align:center}.header[_ngcontent-%COMP%]{background-color:#000;color:#fff;padding:10px 0;display:flex;align-items:center;justify-content:center;position:relative;z-index:1000}.header-content[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;max-width:1200px;margin:0 auto;justify-content:space-between}.profile-pic[_ngcontent-%COMP%]{border-radius:50%;width:40px;height:40px;margin-right:10px}.user-email[_ngcontent-%COMP%]{margin-right:auto}h2[_ngcontent-%COMP%]{margin:0}.small-button[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem;background-color:#6200ea;color:#fff;border:none;border-radius:5px;cursor:pointer}.small-button[_ngcontent-%COMP%]:hover{background-color:#3700b3}.game-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:20px}.game-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;font-size:1rem;background-color:#6200ea;color:#fff;border:none;border-radius:5px;cursor:pointer}.game-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#3700b3}']})};var rv=[{path:"registro",component:ku},{path:"login",component:Nu},{path:"quien-soy",component:Mu},{path:"home",component:Ou},{path:"juegos",loadChildren:()=>import("./chunk-2WUTFH7B.js").then(r=>r.JuegosModule)},{path:"",redirectTo:"/home",pathMatch:"full"}];var iv="auth",Ys=class{constructor(e){return e}},Zs=class{constructor(){return ss(iv)}};var bf=new se("angularfire2.auth-instances");function MT(r,e){let t=Qo(iv,r,e);return t&&new Ys(t)}function OT(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new Ys(n)}}var LT={provide:Zs,deps:[[new Je,bf]]},UT={provide:Ys,useFactory:MT,deps:[[new Je,bf],Kt]};function sv(r,...e){return qe("angularfire",tt.full,"auth"),Tr([UT,LT,{provide:bf,useFactory:OT(r),multi:!0,deps:[Xe,jn,Pt,Kn,[new Je,vt],...e]}])}var ov=Nr(Tc,!0);var eo=class{constructor(e){return e}},av="firestore",Cf=class{constructor(){return ss(av)}};var Sf=new se("angularfire2.firestore-instances");function qT(r,e){let t=Qo(av,r,e);return t&&new eo(t)}function BT(r){return(e,t)=>{let n=e.runOutsideAngular(()=>r(t));return new eo(n)}}var jT={provide:Cf,deps:[[new Je,Sf]]},$T={provide:eo,useFactory:qT,deps:[[new Je,Sf],Kt]};function uv(r,...e){return qe("angularfire",tt.full,"fst"),Tr([$T,jT,{provide:Sf,useFactory:BT(r),multi:!0,deps:[Xe,jn,Pt,Kn,[new Je,Zs],[new Je,vt],...e]}])}var cv=Nr(ky,!0);var Lu=class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=ct({type:r,bootstrap:[Vu]});static \u0275inj=at({providers:[{provide:mn,useValue:xu.firebase},Op(()=>Lp(xu.firebase)),sv(()=>ov()),uv(()=>cv()),qt],imports:[Hm,xr,Sr.forRoot(rv),Mp.initializeApp(xu.firebase),Xp,nv]})};Qm().bootstrapModule(Lu).catch(r=>console.error(r));
